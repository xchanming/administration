{"version":3,"file":"index-CRv9DVFR.js","sources":["../../../app/administration/src/app/component/entity/sw-one-to-many-grid/sw-one-to-many-grid.html.twig","../../../app/administration/src/app/component/entity/sw-one-to-many-grid/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_data_grid_slot_pagination %}\n<sw-pagination\n    v-bind=\"{ page, limit, total }\"\n    :total-visible=\"7\"\n    @page-change=\"paginate\"\n/>\n{% endblock %}\n\n<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_data_grid_slot_actions %}\n<slot\n    name=\"more-actions\"\n    v-bind=\"{ item }\"\n></slot>\n\n<slot\n    name=\"delete-action\"\n    :item=\"item\"\n>\n    <sw-context-menu-item\n        v-tooltip.bottom=\"tooltipDelete\"\n        class=\"sw-one-to-many-grid__delete-action\"\n        variant=\"danger\"\n        :disabled=\"!allowDelete || undefined\"\n        @click=\"deleteItem(item.id)\"\n    >\n        {{ $tc('global.default.delete') }}\n    </sw-context-menu-item>\n</slot>\n{% endblock %}\n","/**\n * @package admin\n */\n\nimport template from './sw-one-to-many-grid.html.twig';\n\nconst { Component } = Cicada;\nconst { Criteria } = Cicada.Data;\n\n/**\n * @private\n */\nComponent.extend('sw-one-to-many-grid', 'sw-data-grid', {\n    template,\n\n    inject: ['repositoryFactory'],\n\n    emits: [\n        'load-finish',\n        'delete-item-failed',\n        'items-delete-finish',\n        'column-sort',\n    ],\n\n    props: {\n        collection: {\n            required: true,\n            type: Array,\n        },\n        localMode: {\n            type: Boolean,\n            // eslint-disable-next-line vue/no-boolean-default\n            default: true,\n        },\n        // eslint-disable-next-line vue/require-default-prop\n        dataSource: {\n            type: [\n                Array,\n                Object,\n            ],\n            required: false,\n        },\n        allowDelete: {\n            type: Boolean,\n            required: false,\n            // eslint-disable-next-line vue/no-boolean-default\n            default: true,\n        },\n        tooltipDelete: {\n            type: Object,\n            required: false,\n            default() {\n                return {\n                    message: '',\n                    disabled: true,\n                };\n            },\n        },\n    },\n\n    data() {\n        return {\n            page: 1,\n            limit: 25,\n            total: 0,\n            /**\n             * @deprecated tag:v6.7.0 - Will be removed because wrong typo, use `initial` instead\n             */\n            intial: true,\n            initial: true,\n        };\n    },\n\n    watch: {\n        collection: {\n            handler() {\n                if (!this.initial) {\n                    this.load();\n                }\n            },\n            deep: true,\n        },\n    },\n\n    methods: {\n        createdComponent() {\n            this.$super('createdComponent');\n\n            // assign collection as records for the sw-data-grid\n            this.applyResult(this.collection);\n\n            /**\n             * @deprecated tag:v6.7.0 - Will be removed this.intial assignment\n             */\n            this.intial = false;\n            this.initial = false;\n\n            // local mode means, the records are loaded with the parent record\n            if (this.localMode) {\n                return Promise.resolve();\n            }\n\n            // Create repository by collection sources\n            // the collection contains the route for the entities /customer/{id}/addresses\n            this.repository = this.repositoryFactory.create(\n                // product_price\n                this.collection.entity,\n\n                // product/{id}/price-rules/\n                this.collection.source,\n            );\n\n            // records contains a pre loaded offset\n            if (Array.isArray(this.records) && this.records.length > 0) {\n                return Promise.resolve();\n            }\n\n            return this.load();\n        },\n\n        applyResult(result) {\n            this.result = result;\n\n            if (!this.collection || !this.initial) {\n                this.records = result;\n            }\n\n            if (result.total) {\n                this.total = result.total;\n            } else {\n                this.total = result.length;\n            }\n\n            if (result.criteria) {\n                this.page = result.criteria.page || this.page;\n                this.limit = result.criteria.limit || this.limit;\n            }\n        },\n\n        save(record) {\n            if (this.localMode) {\n                // records will be saved with the root record\n                return Promise.resolve();\n            }\n\n            return this.repository.save(record, this.result.context).then(() => {\n                return this.load();\n            });\n        },\n\n        revert() {\n            if (this.localMode) {\n                return Promise.resolve();\n            }\n\n            return this.load();\n        },\n\n        load() {\n            // If in local mode, return early since data is loaded with parent\n            if (this.localMode) {\n                return Promise.resolve();\n            }\n\n            return this.repository.search(this.result.criteria, this.result.context).then((response) => {\n                this.applyResult(response);\n                this.$emit('load-finish');\n            });\n        },\n\n        deleteItem(id) {\n            if (this.localMode) {\n                this.collection.remove(id);\n                // records will be saved with the root record\n                return Promise.resolve();\n            }\n\n            return this.repository\n                .delete(id, this.result.context)\n                .then(() => {\n                    this.resetSelection();\n\n                    return this.load();\n                })\n                .catch((errorResponse) => {\n                    this.$emit('delete-item-failed', { id, errorResponse });\n                });\n        },\n\n        deleteItems() {\n            const selection = Object.values(this.selection);\n            if (this.localMode) {\n                selection.forEach((selectedProxy) => {\n                    this.collection.remove(selectedProxy.id);\n                });\n\n                this.resetSelection();\n\n                // records will be saved with the root record\n                return Promise.resolve();\n            }\n\n            this.isBulkLoading = true;\n            const selectedIds = selection.map((selectedProxy) => selectedProxy.id);\n\n            return this.repository\n                .syncDeleted(selectedIds, this.result.context)\n                .then(() => {\n                    this.resetSelection();\n                    this.load();\n                })\n                .catch(() => {\n                    return this.deleteItemsFinish();\n                });\n        },\n\n        deleteItemsFinish() {\n            this.resetSelection();\n            this.isBulkLoading = false;\n            this.showBulkDeleteModal = false;\n            this.$emit('items-delete-finish');\n\n            return this.load();\n        },\n\n        sort(column) {\n            if (this.localMode) {\n                this.$emit('column-sort', column);\n\n                return Promise.resolve();\n            }\n\n            this.result.criteria.resetSorting();\n\n            let direction = 'ASC';\n            if (this.currentSortBy === column.dataIndex) {\n                if (this.currentSortDirection === direction) {\n                    direction = 'DESC';\n                }\n            }\n\n            this.result.criteria.addSorting(Criteria.sort(column.dataIndex, direction, !!column.naturalSorting));\n\n            this.currentSortBy = column.dataIndex;\n            this.currentSortDirection = direction;\n            this.currentNaturalSorting = !!column.naturalSorting;\n\n            return this.load();\n        },\n\n        paginate(params) {\n            if (this.localMode) {\n                return Promise.resolve();\n            }\n\n            this.result.criteria.setPage(params.page);\n            this.result.criteria.setLimit(params.limit);\n\n            return this.load();\n        },\n    },\n});\n"],"names":["template","Component","Criteria","result","record","response","id","errorResponse","selection","selectedProxy","selectedIds","column","direction","params"],"mappings":"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"}