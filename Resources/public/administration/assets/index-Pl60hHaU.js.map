{"version":3,"file":"index-Pl60hHaU.js","sources":["../../../app/administration/src/module/sw-settings-shipping/component/sw-settings-shipping-price-matrix/sw-settings-shipping-price-matrix.html.twig","../../../app/administration/src/module/sw-settings-shipping/component/sw-settings-shipping-price-matrix/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_settings_shipping_price_matrix %}\n<sw-card\n    :title=\"cardTitle\"\n    :is-loading=\"isLoading\"\n    class=\"sw-settings-shipping-price-matrix\"\n    position-identifier=\"sw-settings-shipping-price-matrix\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_shipping_price_matrix_topbar_alert %}\n    <sw-alert\n        v-if=\"priceGroup.isNew\"\n        class=\"sw-settings-shipping-price-matrix__new-matrix-alert\"\n        variant=\"warning\"\n        :title=\"$tc('global.default.warning')\"\n        :closable=\"false\"\n    >\n        {{ $tc('sw-settings-shipping.priceMatrix.newMatrixAlertMessage') }}\n    </sw-alert>\n    {% endblock %}\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_shipping_price_matrix_topbar %}\n    <sw-container\n        columns=\"1fr auto 35px\"\n        gap=\"0px 24px\"\n        class=\"sw-settings-shipping-price-matrix__top-container\"\n    >\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_price_matrix_topbar_rule_select %}\n        <sw-select-rule-create\n            class=\"sw-settings-shipping-price-matrix__top-container-rule-select\"\n            :rule-id=\"priceGroup.ruleId\"\n            :rule-filter=\"ruleFilterCriteria\"\n            size=\"small\"\n            :disabled=\"disabled || undefined\"\n            :placeholder=\"mainRulePlaceholder\"\n            rule-aware-group-key=\"shippingMethodPrices\"\n            :restricted-rule-ids=\"restrictedRuleIds\"\n            :restricted-rule-ids-tooltip-label=\"$tc('sw-settings-shipping.priceMatrix.ruleAlreadyUsedOrRestricted')\"\n            @save-rule=\"onSaveMainRule\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_price_matrix_topbar_new_price %}\n        <sw-button\n            size=\"x-small\"\n            class=\"sw-settings-shipping-price-matrix__top-container-add-new-rule\"\n            :variant=\"!showDataGrid ? '': 'ghost'\"\n            :disabled=\"!showDataGrid || disabled\"\n            @click=\"onAddNewShippingPrice\"\n        >\n            <template v-if=\"isRuleMatrix\">\n                {{ $tc('sw-settings-shipping.priceMatrix.addNewRule') }}\n            </template>\n            <template v-else>\n                {{ $tc('sw-settings-shipping.priceMatrix.addNewShippingPrice') }}\n            </template>\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_price_matrix_topbar_context_button %}\n        <sw-context-button\n            :disabled=\"!showDataGrid || disabled\"\n            class=\"sw-settings-shipping-price-matrix__price-group-context\"\n        >\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_shipping_price_matrix_topbar_context_button_duplicate %}\n            <sw-context-menu-item\n                v-tooltip=\"{\n                    showDelay: 300,\n                    showOnDisabledElements: true,\n                    message: $tc('sw-settings-shipping.priceMatrix.newMatrixAlreadyExists'),\n                    disabled: !newPriceMatrixExists\n                }\"\n                :disabled=\"newPriceMatrixExists\"\n                class=\"sw-settings-shipping-price-matrix__action-duplicate\"\n                @click=\"$emit('duplicate-price-matrix', priceGroup)\"\n            >\n                {{ $tc('sw-settings-shipping.priceMatrix.duplicateMatrixContextLabel') }}\n            </sw-context-menu-item>\n            {% endblock %}\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_shipping_price_matrix_topbar_context_button_delete %}\n            <sw-context-menu-item\n                class=\"sw-settings-shipping-price-matrix__action-delete\"\n                variant=\"danger\"\n                @click=\"onDeletePriceMatrix\"\n            >\n                {{ $tc('sw-settings-shipping.priceMatrix.deleteMatrixContextLabel') }}\n            </sw-context-menu-item>\n            {% endblock %}\n        </sw-context-button>\n        {% endblock %}\n    </sw-container>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_shipping_price_matrix_price_grid %}\n    <sw-data-grid\n        v-if=\"showDataGrid\"\n        :data-source=\"prices\"\n        :columns=\"ruleColumns\"\n        :show-selection=\"false\"\n        :show-settings=\"true\"\n        :compact-mode=\"true\"\n    >\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_price_matrix_price_grid_column_calculcation_rule %}\n        <template\n            #column-calculationRule=\"{ item, itemIndex, compact }\"\n        >\n            <sw-select-rule-create\n                class=\"sw-settings-shipping-price-matrix__column-calculation-rule-select\"\n                size=\"small\"\n                :disabled=\"disabled\"\n                :rule-id=\"item.calculationRuleId\"\n                :rule-filter=\"shippingRuleFilterCriteria\"\n                :placeholder=\"$tc('sw-settings-shipping.priceMatrix.chooseCustomRule')\"\n                rule-aware-group-key=\"shippingMethodPriceCalculations\"\n                :restricted-rule-ids=\"usedCalculationRules\"\n                :restricted-rule-ids-tooltip-label=\"$tc('sw-settings-shipping.priceMatrix.ruleAlreadyUsedInMatrix')\"\n                @save-rule=\"(ruleId) => onSaveCustomShippingRule(ruleId, item)\"\n            >\n                <template #rule-modal=\"{ showRuleModal, onSaveRule, onCloseRuleModal }\">\n                    <sw-price-rule-modal\n                        v-if=\"showRuleModal\"\n                        rule-aware-group-key=\"shippingMethodPriceCalculations\"\n                        @save=\"onSaveRule\"\n                        @modal-close=\"onCloseRuleModal\"\n                    />\n                </template>\n            </sw-select-rule-create>\n        </template>\n        {% endblock %}\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_price_matrix_price_grid_column_quantity_start %}\n        <template\n            #column-quantityStart=\"{ item, itemIndex, compact }\"\n        >\n            <sw-number-field\n                v-model:value=\"item.quantityStart\"\n                :disabled=\"disabled\"\n                :name=\"`sw-field--${item.id}-quantity-start`\"\n                :number-type=\"numberFieldType\"\n                :size=\"compact ? 'small' : 'default'\"\n                :min=\"priceGroup.prices[itemIndex - 1] ? priceGroup.prices[itemIndex - 1].quantityEnd : 0\"\n                :max=\"item.quantityEnd ? item.quantityEnd : null\"\n                :digits=\"3\"\n            />\n        </template>\n        {% endblock %}\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_price_matrix_price_grid_column_quantity_end %}\n        <template\n            #column-quantityEnd=\"{ item, itemIndex, compact }\"\n        >\n            <sw-number-field\n                v-model:value=\"item.quantityEnd\"\n                :disabled=\"disabled\"\n                :name=\"`sw-field--${item.id}-quantity-end`\"\n                :number-type=\"numberFieldType\"\n                :size=\"compact ? 'small' : 'default'\"\n                :placeholder=\"$tc('sw-settings-shipping.priceMatrix.any')\"\n                :validation=\"item.quantityEnd === null || item.quantityEnd > item.quantityStart\"\n                :min=\"item.quantityStart\"\n                :digits=\"3\"\n                @update:value=\"onQuantityEndChange(item)\"\n            />\n        </template>\n        {% endblock %}\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_price_matrix_price_grid_currencies_list %}\n        <template\n            v-for=\"currency in currencies\"\n            :key=\"currency.isoCode\"\n            #[`column-price-${currency.isoCode}`]=\"{ item, column, compact }\"\n        >\n            <sw-inherit-wrapper\n                class=\"sw-settings-shipping-price-matrix__price\"\n                :value=\"getPrice(item, currency)\"\n                :has-parent=\"!currency.isSystemDefault\"\n                :inherited-value=\"currency.isSystemDefault ? null : convertDefaultPriceToCurrencyPrice(item, currency)\"\n                @update:value=\"setPrice(item, currency, $event)\"\n            >\n                <template #content=\"props\">\n\n                    <sw-inheritance-switch\n                        v-if=\"!currency.isSystemDefault\"\n                        class=\"sw-settings-shipping-price-matrix__price-inherit-icon\"\n                        :is-inherited=\"props.isInherited\"\n                        :disabled=\"disabled\"\n                        @inheritance-restore=\"props.restoreInheritance\"\n                        @inheritance-remove=\"props.removeInheritance\"\n                    />\n\n                    <sw-number-field\n                        v-model:value=\"props.currentValue.gross\"\n                        :name=\"`sw-field--${item.id}-${currency.id}-gross`\"\n                        :size=\"compact ? 'small' : 'default'\"\n                        class=\"sw-settings-shipping-price-matrix__price-input\"\n                        :digits=\"50\"\n                        :disabled=\"props.isInherited || disabled\"\n                    />\n                    <sw-number-field\n                        v-model:value=\"props.currentValue.net\"\n                        :name=\"`sw-field--${item.id}-${currency.id}-net`\"\n                        :size=\"compact ? 'small' : 'default'\"\n                        class=\"sw-settings-shipping-price-matrix__price-input\"\n                        :digits=\"50\"\n                        :disabled=\"props.isInherited || disabled\"\n                    />\n                </template>\n            </sw-inherit-wrapper>\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_price_matrix_price_grid_actions %}\n        <template #actions=\"{ item }\">\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_shipping_price_matrix_price_grid_actions_delete %}\n            <sw-context-menu-item\n                :disabled=\"disableDeleteButton || disabled\"\n                variant=\"danger\"\n                @click=\"onDeleteShippingPrice(item)\"\n            >\n                {{ $tc('sw-settings-shipping.priceMatrix.contextMenuDeletePrice') }}\n            </sw-context-menu-item>\n            {% endblock %}\n        </template>\n        {% endblock %}\n    </sw-data-grid>\n    <div\n        v-if=\"showDataGrid && !showAllPrices\"\n        class=\"sw-settings-shipping-price-matrix__price-load-all\"\n    >\n        <sw-button\n            variant=\"ghost\"\n            size=\"small\"\n            class=\"sw-settings-shipping-price-matrix__price-load-all-button\"\n            @click=\"updateShowAllPrices\"\n        >\n            {{ $tc('sw-settings-shipping.priceMatrix.buttonLoadAllPrices') }}\n        </sw-button>\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_shipping_price_matrix_empty %}\n    <div\n        v-else\n        class=\"sw-settings-shipping-price-matrix__empty\"\n    >\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_price_matrix_empty_text %}\n        <p class=\"sw-settings-shipping-price-matrix__empty-text\">\n            {{ $tc('sw-settings-shipping.priceMatrix.emptyText') }}\n        </p>\n        {% endblock %}\n        <sw-container\n            columns=\"1fr 10px 1fr\"\n            gap=\"0px 24px\"\n        >\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_shipping_price_matrix_empty_property_store %}\n            <sw-single-select\n                class=\"sw-settings-shipping-price-matrix__empty--select-property\"\n                :options=\"calculationTypes\"\n                :value=\"priceGroup.calculation\"\n                :disabled=\"disabled\"\n                size=\"small\"\n                show-clearable-button\n                :placeholder=\"$tc('sw-settings-shipping.priceMatrix.selectProperty')\"\n                @update:value=\"onCalculationChange\"\n            />\n            {% endblock %}\n\n            <p class=\"sw-settings-shipping-price-matrix__empty-text-or\">\n                {{ $tc('sw-settings-shipping.priceMatrix.textOr') }}\n            </p>\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_shipping_price_matrix_empty_rule_select %}\n            <sw-select-rule-create\n                size=\"small\"\n                :disabled=\"disabled\"\n                :placeholder=\"$tc('sw-settings-shipping.priceMatrix.chooseCustomRule')\"\n                rule-aware-group-key=\"shippingMethodPriceCalculations\"\n                :restricted-rule-ids=\"usedCalculationRules\"\n                :restricted-rule-ids-tooltip-label=\"$tc('sw-settings-shipping.priceMatrix.ruleAlreadyUsedInMatrix')\"\n                @save-rule=\"(ruleId) => { onSaveCustomShippingRule(ruleId) }\"\n            >\n                <template #rule-modal=\"{ showRuleModal, onSaveRule, onCloseRuleModal }\">\n                    <sw-price-rule-modal\n                        v-if=\"showRuleModal\"\n                        rule-aware-group-key=\"shippingMethodPriceCalculations\"\n                        @save=\"onSaveRule\"\n                        @modal-close=\"onCloseRuleModal\"\n                    />\n                </template>\n            </sw-select-rule-create>\n            {% endblock %}\n        </sw-container>\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_shipping_price_matrix_delete_modal %}\n    <sw-modal\n        v-if=\"showDeleteModal\"\n        :title=\"$tc('global.default.warning')\"\n        variant=\"small\"\n        @modal-close=\"onCloseDeleteModal\"\n    >\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_price_matrix_delete_modal_confirm_delete_text %}\n        <p class=\"sw-settings-shipping-price-matrix__confirm-delete-text\">\n            {{ confirmDeleteText }}\n        </p>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_price_matrix_delete_modal_footer %}\n        <template #modal-footer>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_shipping_price_matrix_delete_modal_cancel %}\n            <sw-button\n                size=\"small\"\n                @click=\"onCloseDeleteModal\"\n            >\n                {{ $tc('global.default.cancel') }}\n            </sw-button>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_shipping_price_matrix_delete_modal_confirm %}\n            <sw-button\n                variant=\"danger\"\n                size=\"small\"\n                @click=\"onConfirmDeleteShippingPrice\"\n            >\n                {{ $tc('sw-settings-shipping.priceMatrix.buttonDelete') }}\n            </sw-button>\n            {% endblock %}\n        </template>\n        {% endblock %}\n    </sw-modal>\n    {% endblock %}\n</sw-card>\n{% endblock %}\n","import template from './sw-settings-shipping-price-matrix.html.twig';\nimport './sw-settings-shipping-price-matrix.scss';\n\nconst {\n    Mixin,\n    Context,\n    Data: { Criteria },\n} = Cicada;\nconst { cloneDeep } = Cicada.Utils.object;\nconst { mapState, mapGetters } = Cicada.Component.getComponentHelper();\n\n/**\n * @package checkout\n */\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'feature',\n    ],\n\n    emits: [\n        'duplicate-price-matrix',\n        'delete-price-matrix',\n    ],\n\n    mixins: [\n        Mixin.getByName('placeholder'),\n        Mixin.getByName('notification'),\n    ],\n\n    props: {\n        priceGroup: {\n            type: Object,\n            required: true,\n        },\n\n        disabled: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n    },\n\n    data() {\n        return {\n            calculationTypes: [\n                {\n                    label: this.$tc('sw-settings-shipping.priceMatrix.calculationLineItemCount'),\n                    value: 1,\n                },\n                {\n                    label: this.$tc('sw-settings-shipping.priceMatrix.calculationPrice'),\n                    value: 2,\n                },\n                {\n                    label: this.$tc('sw-settings-shipping.priceMatrix.calculationWeight'),\n                    value: 3,\n                },\n                {\n                    label: this.$tc('sw-settings-shipping.priceMatrix.calculationVolume'),\n                    value: 4,\n                },\n            ],\n            showDeleteModal: false,\n            isLoading: false,\n            ruleColumns: [],\n            showAllPrices: true,\n        };\n    },\n\n    computed: {\n        ...mapState('swShippingDetail', [\n            'shippingMethod',\n            'currencies',\n            'restrictedRuleIds',\n        ]),\n\n        ...mapGetters('swShippingDetail', [\n            'defaultCurrency',\n            /** @deprecated tag:v6.7.0 - usedRules will be removed, use restrictedRuleIds instead */\n            'usedRules',\n            'unrestrictedPriceMatrixExists',\n            'newPriceMatrixExists',\n        ]),\n\n        ruleRepository() {\n            return this.repositoryFactory.create('rule');\n        },\n\n        shippingPriceRepository() {\n            return this.repositoryFactory.create('shipping_method_price');\n        },\n\n        labelQuantityStart() {\n            const calculationType = {\n                1: 'sw-settings-shipping.priceMatrix.columnQuantityStart',\n                2: 'sw-settings-shipping.priceMatrix.columnPriceStart',\n                3: 'sw-settings-shipping.priceMatrix.columnWeightStart',\n                4: 'sw-settings-shipping.priceMatrix.columnVolumeStart',\n            };\n\n            return calculationType[this.priceGroup.calculation] || 'sw-settings-shipping.priceMatrix.columnQuantityStart';\n        },\n\n        labelQuantityEnd() {\n            const calculationType = {\n                1: 'sw-settings-shipping.priceMatrix.columnQuantityEnd',\n                2: 'sw-settings-shipping.priceMatrix.columnPriceEnd',\n                3: 'sw-settings-shipping.priceMatrix.columnWeightEnd',\n                4: 'sw-settings-shipping.priceMatrix.columnVolumeEnd',\n            };\n\n            return calculationType[this.priceGroup.calculation] || 'sw-settings-shipping.priceMatrix.columnQuantityEnd';\n        },\n\n        numberFieldType() {\n            const calculationType = {\n                1: 'int',\n                2: 'float',\n                3: 'float',\n                4: 'float',\n            };\n\n            return calculationType[this.priceGroup.calculation] || 'float';\n        },\n\n        confirmDeleteText() {\n            const name = this.priceGroup.rule ? this.priceGroup.rule.name : '';\n            return this.$tc('sw-settings-shipping.priceMatrix.textDeleteConfirm', Number(!!this.priceGroup.rule), {\n                name: name,\n            });\n        },\n\n        currencyColumns() {\n            return this.currencies.map((currency, index) => {\n                let label = currency.translated.name || currency.name;\n                label = `${label} ${this.$tc('sw-settings-shipping.priceMatrix.labelGrossNet')}`;\n                return {\n                    property: `price-${currency.isoCode}`,\n                    label: label,\n                    visible: index === 0,\n                    allowResize: true,\n                    primary: !!currency.isSystemDefault,\n                    rawData: false,\n                    width: '200px',\n                };\n            });\n        },\n\n        showDataGrid() {\n            return (\n                !!this.priceGroup.calculation ||\n                this.priceGroup.prices.some((shippingPrice) => shippingPrice.calculationRuleId)\n            );\n        },\n\n        disableDeleteButton() {\n            return this.priceGroup.prices.length <= 1;\n        },\n\n        ruleFilterCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addSorting(Criteria.sort('name', 'ASC', false)).addFilter(\n                Criteria.multi('OR', [\n                    Criteria.contains('rule.moduleTypes.types', 'price'),\n                    Criteria.equals('rule.moduleTypes', null),\n                ]),\n            );\n\n            if (!Cicada.Feature.isActive('v6.7.0.0')) {\n                criteria.addAssociation('conditions');\n            }\n\n            return criteria;\n        },\n\n        shippingRuleFilterCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addFilter(\n                Criteria.multi('OR', [\n                    Criteria.contains('rule.moduleTypes.types', 'shipping'),\n                    Criteria.equals('rule.moduleTypes', null),\n                ]),\n            );\n\n            if (!Cicada.Feature.isActive('v6.7.0.0')) {\n                criteria.addAssociation('conditions');\n            }\n\n            return criteria;\n        },\n\n        isRuleMatrix() {\n            return !this.priceGroup.calculation;\n        },\n\n        usedCalculationRules() {\n            const rules = [];\n            if (!this.isRuleMatrix) {\n                return rules;\n            }\n\n            this.priceGroup.prices.forEach((shippingPrice) => {\n                if (!rules.includes(shippingPrice.calculationRuleId)) {\n                    rules.push(shippingPrice.calculationRuleId);\n                }\n            });\n\n            return rules;\n        },\n\n        mainRulePlaceholder() {\n            if (this.priceGroup.isNew) {\n                return this.$tc('sw-settings-shipping.priceMatrix.chooseOrCreateRule');\n            }\n\n            return this.$tc('sw-settings-shipping.priceMatrix.noRestriction');\n        },\n\n        cardTitle() {\n            if (!this.priceGroup.rule && !this.priceGroup.isNew) {\n                return this.$tc('sw-settings-shipping.priceMatrix.noRestriction');\n            }\n\n            return this.priceGroup.rule ? this.priceGroup.rule.name : this.$tc('sw-settings-shipping.priceMatrix.titleCard');\n        },\n\n        prices() {\n            return this.showAllPrices ? this.priceGroup.prices : [this.priceGroup.prices[0]];\n        },\n    },\n\n    watch: {\n        isRuleMatrix() {\n            this.createdComponent();\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.ruleColumns = [];\n            this.showAllPrices = this.priceGroup.prices.length <= 1;\n\n            if (this.isRuleMatrix) {\n                this.ruleColumns.push({\n                    property: 'calculationRule',\n                    label: 'sw-settings-shipping.priceMatrix.columnCalculationRule',\n                    allowResize: true,\n                    primary: true,\n                    rawData: true,\n                    width: '250px',\n                });\n            } else {\n                this.ruleColumns.push({\n                    property: 'quantityStart',\n                    label: this.labelQuantityStart,\n                    allowResize: true,\n                    primary: true,\n                    rawData: true,\n                    width: '130px',\n                });\n                this.ruleColumns.push({\n                    property: 'quantityEnd',\n                    label: this.labelQuantityEnd,\n                    allowResize: true,\n                    rawData: true,\n                    primary: true,\n                    width: '130px',\n                });\n            }\n\n            this.ruleColumns.push(...this.currencyColumns);\n        },\n\n        onAddNewShippingPrice() {\n            this.updateShowAllPrices();\n            const refPrice = this.priceGroup.prices[this.priceGroup.prices.length - 1];\n\n            const newShippingPrice = this.shippingPriceRepository.create(Context.api);\n            newShippingPrice.shippingMethodId = this.shippingMethod.id;\n            newShippingPrice.ruleId = this.priceGroup.ruleId;\n            newShippingPrice.currencyPrice = cloneDeep(refPrice.currencyPrice);\n\n            if (refPrice._inNewMatrix) {\n                newShippingPrice._inNewMatrix = true;\n            }\n\n            if (this.isRuleMatrix) {\n                this.shippingMethod.prices.push(newShippingPrice);\n                return;\n            }\n\n            if (!refPrice.quantityEnd) {\n                refPrice.quantityEnd = refPrice.quantityStart;\n            }\n            newShippingPrice.calculation = refPrice.calculation;\n\n            // If the calculation type is \"quantity\" always increase by one, otherwise use end as start\n            if (this.priceGroup.calculation === 1) {\n                newShippingPrice.quantityStart = refPrice.quantityEnd + 1 > 1 ? refPrice.quantityEnd + 1 : 2;\n            } else {\n                newShippingPrice.quantityStart = refPrice.quantityEnd;\n            }\n\n            newShippingPrice.quantityEnd = null;\n\n            this.shippingMethod.prices.push(newShippingPrice);\n        },\n\n        onSaveMainRule(ruleId) {\n            // RuleId can not set to null if there is already an unrestricted rule\n            if (!ruleId && this.unrestrictedPriceMatrixExists && this.priceGroup.ruleId !== ruleId) {\n                this.createNotificationError({\n                    message: this.$tc('sw-settings-shipping.priceMatrix.unrestrictedRuleAlreadyExistsMessage'),\n                });\n                return;\n            }\n\n            this.ruleRepository.get(ruleId, Context.api).then((rule) => {\n                this.priceGroup.prices.forEach((shippingPrice) => {\n                    shippingPrice.ruleId = ruleId;\n                    shippingPrice.rule = rule;\n                    // Remove \"_inNewMatrix\" flag, since a rule is now assigned.\n                    if (shippingPrice._inNewMatrix) {\n                        delete shippingPrice._inNewMatrix;\n                    }\n                });\n            });\n        },\n\n        onSaveCustomShippingRule(ruleId, shippingPrice) {\n            // If shippingPrice is empty, the first(and only) price of this priceGroup is used - occurs\n            // when the priceGroup is new and the user has chosen a custom rule for this group.\n            if (!shippingPrice) {\n                shippingPrice = this.priceGroup.prices[0];\n            }\n\n            // Next tick is necessary because otherwise the modal can not be removed from the dom, since it is moved\n            // to the body and Vue can't keep track of it if the parent component is removed (by isLoading)\n            this.$nextTick(() => {\n                this.isLoading = true;\n            });\n            this.ruleRepository.get(ruleId, Context.api).then((rule) => {\n                shippingPrice.calculationRuleId = ruleId;\n                shippingPrice.calculationRule = rule;\n                this.isLoading = false;\n            });\n        },\n\n        onCalculationChange(calculation) {\n            this.priceGroup.prices.forEach((shippingPrice) => {\n                shippingPrice.calculation = Number(calculation);\n                shippingPrice.ruleId = this.priceGroup.ruleId;\n            });\n        },\n\n        onDeletePriceMatrix() {\n            this.showDeleteModal = true;\n        },\n\n        onConfirmDeleteShippingPrice() {\n            this.showDeleteModal = false;\n            this.$nextTick(() => {\n                this.$emit('delete-price-matrix', this.priceGroup);\n            });\n        },\n\n        onCloseDeleteModal() {\n            this.showDeleteModal = false;\n        },\n\n        onDeleteShippingPrice(shippingPrice) {\n            // if it is the only item in the priceGroup\n            if (this.priceGroup.prices.length <= 1) {\n                this.createNotificationInfo({\n                    message: this.$tc('sw-settings-shipping.priceMatrix.deletionNotPossibleMessage'),\n                });\n\n                return;\n            }\n\n            // get actual rule index\n            const actualShippingPriceIndex = this.priceGroup.prices.indexOf(shippingPrice);\n\n            // if it is the last item\n            if (typeof shippingPrice.quantityEnd === 'undefined' || shippingPrice.quantityEnd === null) {\n                // get previous rule\n                const previousRule = this.priceGroup.prices[actualShippingPriceIndex - 1];\n\n                // set the quantityEnd from the previous rule to null\n                previousRule.quantityEnd = null;\n            } else {\n                // get next rule\n                const nextRule = this.priceGroup.prices[actualShippingPriceIndex + 1];\n\n                // set the quantityStart from the next rule to the quantityStart from the actual rule\n                nextRule.quantityStart = shippingPrice.quantityStart;\n            }\n\n            // delete rule\n            this.shippingMethod.prices.remove(shippingPrice.id);\n        },\n\n        convertDefaultPriceToCurrencyPrice(item, currency) {\n            if (!item.currencyPrice) {\n                this.initCurrencyPrice(item);\n            }\n\n            const defaultPrice = item.currencyPrice.find((price) => {\n                return price.currencyId === this.defaultCurrency.id;\n            });\n\n            return this.convertPrice(defaultPrice, currency);\n        },\n\n        /**\n         * Initialises the currencyPrice field with the default currency\n         */\n        initCurrencyPrice(shippingPrice) {\n            shippingPrice.currencyPrice = [\n                {\n                    currencyId: this.defaultCurrency.id,\n                    gross: 0,\n                    linked: false,\n                    net: 0,\n                },\n            ];\n        },\n\n        getPrice(shippingPrice, currency) {\n            const currencyPrice = this.getPriceOfCurrency(shippingPrice, currency);\n            if (currencyPrice) {\n                return currencyPrice;\n            }\n\n            return null;\n        },\n\n        setPrice(shippingPrice, currency, value) {\n            if (!value) {\n                shippingPrice.currencyPrice = shippingPrice.currencyPrice.filter((price) => {\n                    return price.currencyId !== currency.id;\n                });\n                return;\n            }\n\n            const price = {\n                currencyId: currency.id,\n                gross: value.gross,\n                linked: false,\n                net: value.net,\n            };\n            shippingPrice.currencyPrice.push(price);\n        },\n\n        getPriceOfCurrency(priceArray, currency) {\n            if (!priceArray.currencyPrice) {\n                this.initCurrencyPrice(priceArray);\n            }\n\n            return priceArray.currencyPrice.find((price) => {\n                return price.currencyId === currency.id;\n            });\n        },\n\n        convertPrice(value, currency) {\n            return {\n                net: value.net * currency.factor,\n                gross: value.gross * currency.factor,\n                currencyId: currency.id,\n                linked: false,\n            };\n        },\n\n        onQuantityEndChange(price) {\n            // when not last price\n            if (this.priceGroup.prices.indexOf(price) + 1 !== this.priceGroup.prices.length) {\n                return;\n            }\n\n            this.onAddNewShippingPrice();\n        },\n\n        updateShowAllPrices() {\n            this.showAllPrices = true;\n        },\n    },\n};\n"],"names":["template","Mixin","Context","Criteria","cloneDeep","mapState","mapGetters","index","name","currency","label","shippingPrice","criteria","rules","refPrice","newShippingPrice","ruleId","rule","calculation","actualShippingPriceIndex","previousRule","nextRule","item","defaultPrice","price","currencyPrice","value","priceArray"],"mappings":"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"}