{"version":3,"file":"index-DrsvNlGr.js","sources":["../../../app/administration/src/module/sw-category/component/sw-landing-page-tree/sw-landing-page-tree.html.twig","../../../app/administration/src/module/sw-category/component/sw-landing-page-tree/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_landing_page_tree %}\n<div class=\"sw-landing-page-tree\">\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_landing_page_tree_inner %}\n    <sw-tree\n        v-if=\"!isLoadingInitialData\"\n        ref=\"landingPageTree\"\n        class=\"sw-landing-page-tree__inner\"\n        :items=\"landingPages\"\n        :sortable=\"false || undefined\"\n        :searchable=\"false\"\n        :translation-context=\"translationContext\"\n        :on-change-route=\"changeLandingPage\"\n        :disable-context-menu=\"disableContextMenu\"\n        :allow-delete-categories=\"allowDelete || undefined\"\n        :allow-create-categories=\"false\"\n        :active-tree-item-id=\"landingPageId\"\n        @batch-delete=\"deleteCheckedItems\"\n        @delete-element=\"onDeleteLandingPage\"\n        @editing-end=\"syncLandingPages\"\n        @checked-elements-count=\"checkedElementsCount\"\n    >\n\n        <template #headline>\n            <span></span>\n        </template>\n\n        <template\n            #items=\"{\n                treeItems,\n                sortable,\n                draggedItem,\n                newElementId,\n                checkItem,\n                translationContext,\n                onChangeRoute,\n                disableContextMenu\n            }\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_landing_page_tree_items %}\n            <sw-tree-item\n                v-for=\"item in treeItems\"\n                :key=\"item.id\"\n                :item=\"item\"\n                :should-show-active-state=\"true\"\n                :allow-duplicate=\"true\"\n                :allow-new-categories=\"false || undefined\"\n                :allow-delete-categories=\"allowDelete || undefined\"\n                :active=\"item.active\"\n                :translation-context=\"translationContext\"\n                :on-change-route=\"onChangeRoute\"\n                :sortable=\"sortable || undefined\"\n                :dragged-item=\"draggedItem\"\n                :disable-context-menu=\"disableContextMenu\"\n                :display-checkbox=\"allowEdit || undefined\"\n                :context-menu-tooltip-text=\"contextMenuTooltipText\"\n                :new-element-id=\"newElementId\"\n                :get-item-url=\"getLandingPageUrl\"\n                @check-item=\"checkItem\"\n            >\n                <template #grip>\n                    <span></span>\n                </template>\n\n                <template\n                    #actions=\"{\n                        onDuplicate,\n                        onChangeRoute,\n                        deleteElement,\n                        toolTip\n                    }\"\n                >\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_landing_page_tree_items_actions %}\n                    <sw-context-button\n                        v-tooltip=\"toolTip\"\n                        class=\"sw-tree-item__context_button\"\n                        :disabled=\"disableContextMenu || undefined\"\n                    >\n\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_landing_page_tree_items_actions_edit %}\n                        <sw-context-menu-item @click=\"onChangeRoute(item)\">\n                            {{ $tc('global.default.edit') }}\n                        </sw-context-menu-item>\n                        {% endblock %}\n\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_landing_page_tree_items_actions_duplicate %}\n                        <sw-context-menu-item\n                            class=\"sw-context-menu__duplicate-action\"\n                            @click=\"onDuplicate(item)\"\n                        >\n                            {{ $tc(`global.default.duplicate`) }}\n                        </sw-context-menu-item>\n                        {% endblock %}\n\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_landing_page_tree_items_actions_delete %}\n                        <sw-context-menu-item\n                            class=\"sw-context-menu__group-button-delete\"\n                            variant=\"danger\"\n                            @click=\"deleteElement(item)\"\n                        >\n                            {{ $tc('global.default.delete') }}\n                        </sw-context-menu-item>\n                        {% endblock %}\n\n                    </sw-context-button>\n                    {% endblock %}\n\n                </template>\n            </sw-tree-item>\n            {% endblock %}\n\n        </template>\n    </sw-tree>\n    {% endblock %}\n\n    <div v-else>\n        <sw-skeleton variant=\"tree-item\" />\n        <sw-skeleton variant=\"tree-item\" />\n        <sw-skeleton variant=\"tree-item\" />\n        <sw-skeleton variant=\"tree-item\" />\n        <sw-skeleton variant=\"tree-item\" />\n        <sw-skeleton variant=\"tree-item\" />\n        <sw-skeleton variant=\"tree-item\" />\n    </div>\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_landing_page_tree_action %}\n    <div class=\"sw-landing-page-tree__add-button\">\n        <sw-button\n            class=\"sw-landing-page-tree__add-button-button\"\n            :router-link=\"newLandingPageUrl()\"\n            size=\"small\"\n            variant=\"ghost\"\n            :disabled=\"disableContextMenu || !acl.can('landing_page.creator') || undefined\"\n        >\n            {{ $tc('sw-landing-page.general.buttonCreate') }}\n        </sw-button>\n    </div>\n    {% endblock %}\n\n</div>\n{% endblock %}\n","import template from './sw-landing-page-tree.html.twig';\nimport './sw-landing-page-tree.scss';\n\nconst { Criteria } = Cicada.Data;\nconst { mapState } = Cicada.Component.getComponentHelper();\n\n/**\n * @package discovery\n */\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'syncService',\n        'acl',\n    ],\n\n    emits: [\n        'landing-page-checked-elements-count',\n        'unsaved-changes',\n    ],\n\n    mixins: [\n        'notification',\n    ],\n\n    props: {\n        landingPageId: {\n            type: String,\n            required: false,\n            default: null,\n        },\n\n        currentLanguageId: {\n            type: String,\n            required: true,\n        },\n\n        allowEdit: {\n            type: Boolean,\n            required: false,\n            // eslint-disable-next-line vue/no-boolean-default\n            default: true,\n        },\n\n        allowCreate: {\n            type: Boolean,\n            required: false,\n            // eslint-disable-next-line vue/no-boolean-default\n            default: true,\n        },\n\n        allowDelete: {\n            type: Boolean,\n            required: false,\n            // eslint-disable-next-line vue/no-boolean-default\n            default: true,\n        },\n    },\n\n    data() {\n        return {\n            loadedLandingPages: {},\n            translationContext: 'sw-landing-page',\n            linkContext: 'sw.category.landingPageDetail',\n            isLoadingInitialData: true,\n        };\n    },\n\n    computed: {\n        ...mapState('swCategoryDetail', [\n            'landingPagesToDelete',\n        ]),\n\n        cmsLandingPageCriteria() {\n            const criteria = new Criteria(1, 500);\n            criteria.addSorting(Criteria.sort('name'));\n\n            return criteria;\n        },\n\n        landingPage() {\n            return Cicada.State.get('swCategoryDetail').landingPage;\n        },\n\n        landingPageRepository() {\n            return this.repositoryFactory.create('landing_page');\n        },\n\n        landingPages() {\n            return Object.values(this.loadedLandingPages);\n        },\n\n        disableContextMenu() {\n            if (!this.allowEdit) {\n                return true;\n            }\n\n            return this.currentLanguageId !== Cicada.Context.api.systemLanguageId;\n        },\n\n        contextMenuTooltipText() {\n            if (!this.allowEdit) {\n                return this.$tc('sw-privileges.tooltip.warning');\n            }\n\n            return null;\n        },\n    },\n\n    watch: {\n        landingPagesToDelete(value) {\n            if (value === undefined) {\n                return;\n            }\n\n            this.$refs.landingPageTree.onDeleteElements(value);\n\n            Cicada.State.commit('swCategoryDetail/setLandingPagesToDelete', {\n                landingPagesToDelete: undefined,\n            });\n        },\n\n        landingPage(newVal, oldVal) {\n            // load data when path is available\n            if (!oldVal && this.isLoadingInitialData) {\n                this.loadLandingPages();\n                return;\n            }\n\n            // back to index\n            if (newVal === null) {\n                return;\n            }\n\n            // reload after save\n            if (oldVal && this.landingPageId !== 'create' && newVal.id === oldVal.id) {\n                this.landingPageRepository.get(newVal.id).then((newLandingPage) => {\n                    this.$set(this.loadedLandingPages, newLandingPage.id, newLandingPage);\n                });\n            }\n        },\n\n        currentLanguageId() {\n            this.isLoadingInitialData = true;\n            this.loadedLandingPages = {};\n\n            this.loadLandingPages().finally(() => {\n                this.isLoadingInitialData = false;\n            });\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.loadLandingPages()\n                .catch(() => {\n                    this.createNotificationError({\n                        message: this.$tc('global.notification.unspecifiedSaveErrorMessage'),\n                    });\n                })\n                .finally(() => {\n                    this.isLoadingInitialData = false;\n                });\n        },\n\n        loadLandingPages() {\n            return this.landingPageRepository.search(this.cmsLandingPageCriteria).then((result) => {\n                this.addLandingPages(result);\n            });\n        },\n\n        checkedElementsCount(count) {\n            this.$emit('landing-page-checked-elements-count', count);\n        },\n\n        deleteCheckedItems(checkedItems) {\n            const ids = Object.keys(checkedItems);\n            this.landingPageRepository.syncDeleted(ids).then(() => {\n                ids.forEach((id) => this.removeFromStore(id));\n            });\n        },\n\n        onDeleteLandingPage({ data: landingPage }) {\n            if (landingPage.isNew()) {\n                if (this.isCompatEnabled('INSTANCE_DELETE')) {\n                    this.$delete(this.loadedLandingPages, landingPage.id);\n                } else {\n                    delete this.loadedLandingPages[landingPage.id];\n                }\n                return Promise.resolve();\n            }\n\n            return this.landingPageRepository.delete(landingPage.id).then(() => {\n                this.removeFromStore(landingPage.id);\n\n                if (landingPage.id === this.landingPageId) {\n                    this.$router.push({ name: 'sw.category.index' });\n                }\n            });\n        },\n\n        changeLandingPage(landingPage) {\n            const route = {\n                name: 'sw.category.landingPageDetail',\n                params: { id: landingPage.id },\n            };\n\n            if (this.landingPage && this.landingPageRepository.hasChanges(this.landingPage)) {\n                this.$emit('unsaved-changes', route);\n            } else {\n                this.$router.push(route);\n            }\n        },\n\n        duplicateElement(contextItem) {\n            const behavior = {\n                cloneChildren: false,\n                overwrites: {\n                    name: `${contextItem.data.name} ${this.$tc('global.default.copy')}`,\n                    url: `${contextItem.data.url}-${this.$tc('global.default.copy')}`,\n                    active: false,\n                },\n            };\n\n            this.landingPageRepository\n                .clone(contextItem.id, behavior, Cicada.Context.api)\n                .then((clone) => {\n                    const criteria = new Criteria(1, 25);\n                    criteria.setIds([clone.id]);\n                    this.landingPageRepository.search(criteria).then((landingPages) => {\n                        landingPages.forEach((element) => {\n                            element.childCount = 0;\n                            element.parentId = null;\n                        });\n\n                        this.addLandingPages(landingPages);\n                    });\n                })\n                .catch(() => {\n                    this.createNotificationError({\n                        message: this.$tc('global.notification.unspecifiedSaveErrorMessage'),\n                    });\n                });\n        },\n\n        createNewElement(contextItem, parentId, name = '') {\n            const newLandingPage = this.createNewLandingPage(name);\n            this.addLandingPage(newLandingPage);\n            return newLandingPage;\n        },\n\n        syncLandingPages() {\n            return this.landingPageRepository.sync(this.landingPages);\n        },\n\n        createNewLandingPage(name) {\n            const newLandingPage = this.landingPageRepository.create();\n\n            newLandingPage.name = name;\n            newLandingPage.active = false;\n\n            newLandingPage.save = () => {\n                return this.landingPageRepository.save(newLandingPage).then(() => {\n                    const criteria = new Criteria(1, 25);\n                    criteria.setIds([newLandingPage.id].filter((id) => id !== null));\n                    this.landingPageRepository.search(criteria).then((landingPages) => {\n                        this.addLandingPages(landingPages);\n                    });\n                });\n            };\n\n            return newLandingPage;\n        },\n\n        addLandingPage(landingPage) {\n            if (!landingPage) {\n                return;\n            }\n\n            this.loadedLandingPages = {\n                ...this.loadedLandingPages,\n                [landingPage.id]: landingPage,\n            };\n        },\n\n        addLandingPages(landingPages) {\n            if (!landingPages) {\n                return;\n            }\n\n            const existingLandingPageEntries = Object.entries(this.loadedLandingPages || {});\n            const newLandingPageEntries = landingPages.map((landingPage) => {\n                return [\n                    landingPage.id,\n                    landingPage,\n                ];\n            });\n\n            this.loadedLandingPages = Object.fromEntries([\n                ...existingLandingPageEntries,\n                ...newLandingPageEntries,\n            ]);\n        },\n\n        removeFromStore(id) {\n            this.loadedLandingPages = Object.fromEntries(\n                Object.entries(this.loadedLandingPages || {}).filter(([key]) => {\n                    return key !== id;\n                }),\n            );\n        },\n\n        getLandingPageUrl(landingPage) {\n            return this.$router.resolve({\n                name: this.linkContext,\n                params: { id: landingPage.id },\n            }).href;\n        },\n\n        newLandingPageUrl() {\n            return {\n                name: 'sw.category.landingPageDetail',\n                params: { id: 'create' },\n            };\n        },\n    },\n};\n"],"names":["template","Criteria","mapState","index","criteria","value","newVal","oldVal","newLandingPage","result","count","checkedItems","ids","id","landingPage","route","contextItem","behavior","clone","landingPages","element","parentId","name","existingLandingPageEntries","newLandingPageEntries","key"],"mappings":"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"}