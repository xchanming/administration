{"version":3,"file":"index-CFYKp-9l.js","sources":["../../../app/administration/src/module/sw-settings-seo/component/sw-seo-url/state.js","../../../app/administration/src/module/sw-settings-seo/component/sw-seo-url/sw-seo-url.html.twig","../../../app/administration/src/module/sw-settings-seo/component/sw-seo-url/index.js"],"sourcesContent":["/**\n * @package buyers-experience\n * @deprecated tag:v6.7.0 - Will be replaced with Pinia store\n */\n\n// Store\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    namespaced: true,\n\n    state() {\n        return {\n            salesChannelCollection: null,\n            seoUrlCollection: null,\n            originalSeoUrls: [],\n            defaultSeoUrl: null,\n            currentSeoUrl: null,\n        };\n    },\n\n    mutations: {\n        setSeoUrlCollection(state, seoUrlCollection) {\n            state.seoUrlCollection = seoUrlCollection;\n        },\n\n        setOriginalSeoUrls(state, originalSeoUrls) {\n            state.originalSeoUrls = originalSeoUrls;\n        },\n\n        setCurrentSeoUrl(state, currentSeoUrl) {\n            state.currentSeoUrl = currentSeoUrl;\n        },\n\n        setDefaultSeoUrl(state, defaultSeoUrl) {\n            state.defaultSeoUrl = defaultSeoUrl;\n        },\n\n        setSalesChannelCollection(state, salesChannelCollection) {\n            state.salesChannelCollection = salesChannelCollection;\n        },\n    },\n\n    getters: {\n        isLoading: (state) => {\n            return state.loading;\n        },\n\n        getNewOrModifiedUrls: (state) => {\n            return () => {\n                const seoUrls = [];\n\n                state.seoUrlCollection.forEach((seoUrl) => {\n                    if (seoUrl.seoPathInfo === null) {\n                        return;\n                    }\n\n                    const originalSeoUrl = state.originalSeoUrls.find((url) => {\n                        return url.id === seoUrl.id;\n                    });\n\n                    if (originalSeoUrl && originalSeoUrl.seoPathInfo === seoUrl.seoPathInfo) {\n                        return;\n                    }\n\n                    if (!originalSeoUrl && !seoUrl.seoPathInfo) {\n                        return;\n                    }\n\n                    seoUrls.push(seoUrl);\n                });\n\n                return seoUrls;\n            };\n        },\n    },\n};\n","<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_seo_url %}\n<div class=\"sw-seo-url\">\n    <sw-card\n        class=\"sw-seo-url__card\"\n        position-identifier=\"sw-seo-url\"\n        :title=\"$tc('sw-seo-url.titleCard')\"\n        :is-loading=\"isLoading\"\n    >\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_seo_url_card %}\n        <template v-if=\"showEmptySeoUrlError\">\n            {{ $tc('sw-seo-url.textEmptySeoUrls') }}\n        </template>\n\n        <template v-else>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_seo_url_card_seo_path %}\n            <sw-inherit-wrapper\n                v-model:value=\"currentSeoUrl.seoPathInfo\"\n                :has-parent=\"currentSalesChannelId !== null && !isHeadlessSalesChannel && hasDefaultTemplate\"\n                :inherited-value=\"(currentSeoUrl.salesChannelId !== null && !isHeadlessSalesChannel) ? defaultSeoUrl.seoPathInfo : null\"\n            >\n\n                <template #content=\"props\">\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_seo_url_card_seo_path_edit %}\n                    <sw-text-field\n                        :map-inheritance=\"props\"\n                        :value=\"props.currentValue\"\n                        :disabled=\"props.isInherited || isHeadlessSalesChannel || !allowInput\"\n                        :disable-inheritance-toggle=\"isHeadlessSalesChannel\"\n                        :label=\"$tc('sw-seo-url.labelSeoPathInfo')\"\n                        :help-text=\"seoUrlHelptext\"\n                        @update:value=\"props.updateCurrentValue\"\n                    />\n                    {% endblock %}\n                </template>\n\n            </sw-inherit-wrapper>\n            {% endblock %}\n        </template>\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_seo_url_card_toolbar %}\n        <template\n            v-if=\"!showEmptySeoUrlError\"\n            #toolbar\n        >\n            <sw-sales-channel-switch\n                ref=\"salesChannelSwitch\"\n                :disabled=\"disabled || undefined\"\n                :label=\"$tc('sw-seo-url.labelSalesChannelSelect')\"\n                @change-sales-channel-id=\"onSalesChannelChanged\"\n            />\n        </template>\n        {% endblock %}\n\n        <div\n            v-if=\"hasAdditionalSeoSlot\"\n            class=\"sw-seo-url__card-seo-additional\"\n        >\n            <slot\n                name=\"seo-additional\"\n                v-bind=\"{currentSalesChannelId}\"\n            >\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_seo_url_additional %}{% endblock %}\n            </slot>\n        </div>\n\n        {% endblock %}\n    </sw-card>\n</div>\n{% endblock %}\n","/**\n * @package buyers-experience\n */\n\nimport swSeoUrlState from './state';\nimport template from './sw-seo-url.html.twig';\n\nconst Criteria = Cicada.Data.Criteria;\nconst EntityCollection = Cicada.Data.EntityCollection;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: ['repositoryFactory'],\n\n    emits: ['on-change-sales-channel'],\n\n    mixins: [],\n\n    props: {\n        salesChannelId: {\n            type: String,\n            required: false,\n            default: null,\n        },\n\n        urls: {\n            type: Array,\n            required: false,\n            default() {\n                return [];\n            },\n        },\n\n        isLoading: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n\n        hasDefaultTemplate: {\n            type: Boolean,\n            required: false,\n            // eslint-disable-next-line vue/no-boolean-default\n            default: true,\n        },\n\n        disabled: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n\n        resultLimit: {\n            type: Number,\n            required: false,\n            default: 25,\n        },\n    },\n\n    data() {\n        return {\n            currentSalesChannelId: this.salesChannelId,\n            showEmptySeoUrlError: false,\n        };\n    },\n\n    computed: {\n        seoUrlCollection() {\n            return Cicada.State.get('swSeoUrl').seoUrlCollection;\n        },\n\n        currentSeoUrl() {\n            if (!Cicada.State.get('swSeoUrl')) {\n                return {};\n            }\n\n            return Cicada.State.get('swSeoUrl').currentSeoUrl;\n        },\n\n        defaultSeoUrl() {\n            return Cicada.State.get('swSeoUrl').defaultSeoUrl;\n        },\n\n        seoUrlRepository() {\n            return this.repositoryFactory.create('seo_url');\n        },\n\n        salesChannelRepository() {\n            return this.repositoryFactory.create('sales_channel');\n        },\n\n        isHeadlessSalesChannel() {\n            if (!Cicada.State.get('swSeoUrl')) {\n                return true;\n            }\n\n            if (Cicada.State.get('swSeoUrl').salesChannelCollection === null) {\n                return true;\n            }\n\n            const salesChannel = Cicada.State.get('swSeoUrl').salesChannelCollection.find((entry) => {\n                return entry.id === this.currentSalesChannelId;\n            });\n\n            // from Defaults.php\n            return this.currentSalesChannelId !== null && salesChannel?.typeId === 'f183ee5650cf4bdb8a774337575067a6';\n        },\n\n        seoUrlHelptext() {\n            return this.isHeadlessSalesChannel ? this.$tc('sw-seo-url.textSeoUrlsDisallowedForHeadless') : null;\n        },\n\n        hasAdditionalSeoSlot() {\n            return this.$slots.hasOwnProperty('seo-additional');\n        },\n\n        allowInput() {\n            return this.hasDefaultTemplate || this.currentSalesChannelId !== null;\n        },\n    },\n\n    watch: {\n        urls() {\n            this.initSeoUrlCollection();\n            this.refreshCurrentSeoUrl();\n        },\n    },\n\n    beforeCreate() {\n        // register a new module only if doesn't exist\n        if (!Cicada.State.list().includes('swSeoUrl')) {\n            Cicada.State.registerModule('swSeoUrl', swSeoUrlState);\n        }\n    },\n\n    created() {\n        if (this.isCompatEnabled('INSTANCE_EVENT_EMITTER')) {\n            this.$root.$on('seo-url-save-finish', this.clearDefaultSeoUrls);\n        } else {\n            Cicada.Utils.EventBus.on('sw-product-detail-save-finish', this.clearDefaultSeoUrls);\n        }\n\n        this.createdComponent();\n    },\n\n    beforeUnmount() {\n        if (this.isCompatEnabled('INSTANCE_EVENT_EMITTER')) {\n            this.$root.$off('seo-url-save-finish', this.clearDefaultSeoUrls);\n        } else {\n            Cicada.Utils.EventBus.off('sw-product-detail-save-finish', this.clearDefaultSeoUrls);\n        }\n\n        Cicada.State.unregisterModule('swSeoUrl');\n    },\n\n    methods: {\n        createdComponent() {\n            this.initSalesChannelCollection();\n            this.initSeoUrlCollection();\n            if (!this.showEmptySeoUrlError) {\n                this.refreshCurrentSeoUrl();\n            }\n        },\n\n        initSalesChannelCollection() {\n            const salesChannelCriteria = new Criteria(1, this.resultLimit);\n            salesChannelCriteria.addAssociation('type');\n\n            this.salesChannelRepository.search(salesChannelCriteria).then((salesChannelCollection) => {\n                Cicada.State.commit('swSeoUrl/setSalesChannelCollection', salesChannelCollection);\n            });\n        },\n\n        initSeoUrlCollection() {\n            this.showEmptySeoUrlError = false;\n            const seoUrlCollection = new EntityCollection(\n                this.seoUrlRepository.route,\n                this.seoUrlRepository.schema.entity,\n                Cicada.Context.api,\n                new Criteria(1, this.resultLimit),\n            );\n\n            const defaultSeoUrlData = this.urls.find((entityData) => {\n                return entityData.salesChannelId === null;\n            });\n\n            if (defaultSeoUrlData === undefined && (this.hasDefaultTemplate || this.urls.length <= 0)) {\n                this.showEmptySeoUrlError = true;\n            }\n\n            const defaultSeoUrlEntity = this.seoUrlRepository.create();\n            Object.assign(defaultSeoUrlEntity, defaultSeoUrlData);\n            seoUrlCollection.add(defaultSeoUrlEntity);\n            Cicada.State.commit('swSeoUrl/setDefaultSeoUrl', defaultSeoUrlEntity);\n\n            this.urls.forEach((entityData) => {\n                const entity = this.seoUrlRepository.create();\n                Object.assign(entity, entityData);\n\n                seoUrlCollection.add(entity);\n            });\n\n            if (!Cicada.State.get('swSeoUrl').defaultSeoUrl) {\n                this.showEmptySeoUrlError = true;\n            }\n\n            Cicada.State.commit('swSeoUrl/setSeoUrlCollection', seoUrlCollection);\n            Cicada.State.commit('swSeoUrl/setOriginalSeoUrls', this.urls);\n            this.clearDefaultSeoUrls();\n        },\n\n        clearDefaultSeoUrls() {\n            this.seoUrlCollection.forEach((entity) => {\n                if (entity.id === this.defaultSeoUrl.id) {\n                    return;\n                }\n\n                if (entity.seoPathInfo === this.defaultSeoUrl.seoPathInfo) {\n                    entity.seoPathInfo = null;\n                }\n            });\n        },\n\n        refreshCurrentSeoUrl() {\n            const actualLanguageId = Cicada.Context.api.languageId;\n\n            const currentSeoUrl = this.seoUrlCollection.find((entity) => {\n                return entity.languageId === actualLanguageId && entity.salesChannelId === this.currentSalesChannelId;\n            });\n\n            if (!currentSeoUrl) {\n                const entity = this.seoUrlRepository.create();\n                // Fetch any seo url as template, since we need to know foreignKey, pathInfo and the routeName\n                const seoUrl =\n                    this.seoUrlCollection.find((item) => {\n                        return item.pathInfo && item.routeName && item.foreignKey;\n                    }) || {};\n\n                entity.foreignKey = this.defaultSeoUrl?.foreignKey ?? seoUrl.foreignKey;\n                entity.isCanonical = true;\n                entity.languageId = actualLanguageId;\n                entity.salesChannelId = this.currentSalesChannelId;\n                entity.routeName = this.defaultSeoUrl?.routeName ?? seoUrl.routeName;\n                entity.pathInfo = this.defaultSeoUrl?.pathInfo ?? seoUrl.pathInfo;\n                entity.isModified = true;\n\n                this.seoUrlCollection.add(entity);\n\n                Cicada.State.commit('swSeoUrl/setCurrentSeoUrl', entity);\n\n                return;\n            }\n\n            Cicada.State.commit('swSeoUrl/setCurrentSeoUrl', currentSeoUrl);\n        },\n        onSalesChannelChanged(salesChannelId) {\n            this.currentSalesChannelId = salesChannelId;\n            this.$emit('on-change-sales-channel', salesChannelId);\n            this.refreshCurrentSeoUrl();\n        },\n    },\n};\n"],"names":["swSeoUrlState","state","seoUrlCollection","originalSeoUrls","currentSeoUrl","defaultSeoUrl","salesChannelCollection","seoUrls","seoUrl","originalSeoUrl","url","template","Criteria","EntityCollection","index","salesChannel","entry","salesChannelCriteria","defaultSeoUrlData","entityData","defaultSeoUrlEntity","entity","_a","_b","_c","actualLanguageId","item","salesChannelId"],"mappings":"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"}