import{e as l}from"./extension-error-handler.service-2kuyx48j.js";const c=`{% block sw_extension_card_base_activation_switch %} {% parent %} <sw-extension-deactivation-modal v-if="showDeactivationModal" :extension-name="label" :is-licensed="license !== null" :is-loading="isLoading" @modal-close="closeDeactivationModal" @extension-deactivate="closeModalAndDeactivateExtension" /> {% endblock %} {% block sw_extension_card_base_info_content %} {% parent %} <section v-if="priceInfo && extension.storeLicense.variant === 'rent'"> <span class="sw-extension-card-bought__info-price"> {{ priceInfo }} </span> </section> <section v-if="subscriptionExpiredText"> <span class="sw-extension-card-bought__info-subscription-expiry" :class="subscriptionExpiredTextClasses" > <sw-icon v-if="isExpiredTestPhase || isExpiredRent" name="solid-exclamation-circle" size="14" small /> {{ subscriptionExpiredText }} </span> </section> {% endblock %} {% block sw_extension_card_base_context_menu_actions %} <sw-context-menu-item v-if="detailLink" class="sw-extension-card-bought__detail-link" :router-link="detailLink" > {{ $tc('sw-extension-store.component.sw-extension-card-base.contextMenu.seeDetailsLabel') }} </sw-context-menu-item> <sw-context-menu-item v-if="isInstalled && extension.storeLicense" class="sw-extension-card-bought__rate-link" @click="openRatingModal" > {{ $tc('sw-extension-store.component.sw-extension-card-base.contextMenu.rateLabel') }} </sw-context-menu-item> {% parent %} {% endblock %} {% block sw_extension_card_base_modals %} {% parent %} <sw-extension-rating-modal v-if="showRatingModal" :extension="extension" @modal-close="closeRatingModal" /> <sw-modal v-if="showExtensionInstallationFailedModal" :title="extension.label" variant="small" class="sw-extension-card-bought__installation-failed-modal" @modal-close="closeInstallationFailedNotification" > <sw-extension-adding-failed :extension-name="extension.name" :title="installationFailedError && installationFailedError.title" :detail="installationFailedError && installationFailedError.message" :documentation-link="installationFailedError && installationFailedError.parameters && installationFailedError.parameters.documentationLink" @close="closeInstallationFailedNotification" /> </sw-modal> {% endblock %}`,x={template:c,mixins:["sw-extension-error"],props:{extension:{type:Object,required:!1,default:null}},data(){return{showDeactivationModal:!1,showRatingModal:!1,showExtensionInstallationFailedModal:!1,installationFailedError:null,removePluginData:!1}},computed:{extensionCardClasses(){return{"sw-extension-card-bought":!0,...this.$super("extensionCardClasses")}},priceInfo(){var e,t;return((t=(e=this.extension)==null?void 0:e.storeLicense)==null?void 0:t.paymentText)??""},detailLink(){return{name:"sw.extension.store.detail",params:{id:String(this.extension.storeExtension?this.extension.storeExtension.id:this.extension.id)}}},subscriptionExpiredText(){var i,s,n,a,o,r;const e=((s=(i=this.extension)==null?void 0:i.storeLicense)==null?void 0:s.expirationDate)??null;if(e===null)return null;const t=new Date(e).toLocaleDateString();return((a=(n=this.extension)==null?void 0:n.storeLicense)==null?void 0:a.variant)==="test"&&!((r=(o=this.extension)==null?void 0:o.storeLicense)!=null&&r.expired)?this.$t("sw-extension-store.component.sw-extension-card-bought.testPhaseWillExpireAt",{date:t}):this.isExpiredTestPhase?this.$t("sw-extension-store.component.sw-extension-card-bought.testPhaseExpiredAt",{date:t}):this.isExpiredRent?this.$t("sw-extension-store.component.sw-extension-card-bought.rentExpiredAt",{date:t}):this.$t("sw-extension-store.component.sw-extension-card-bought.rentWillExpireAt",{date:t})},isExpiredRent(){var e,t,i,s;return((t=(e=this.extension)==null?void 0:e.storeLicense)==null?void 0:t.variant)==="rent"&&((s=(i=this.extension)==null?void 0:i.storeLicense)==null?void 0:s.expired)},isExpiredTestPhase(){var e,t,i,s;return((t=(e=this.extension)==null?void 0:e.storeLicense)==null?void 0:t.variant)==="test"&&((s=(i=this.extension)==null?void 0:i.storeLicense)==null?void 0:s.expired)},subscriptionExpiredTextClasses(){return{"is--expired-test-phase":this.isExpiredTestPhase,"is--expired-rent":this.isExpiredRent}},showContextMenu(){return this.detailLink||this.isInstalled&&this.extension.storeLicense?!0:this.$super("showContextMenu")}},methods:{async changeExtensionStatus(){if(this.isActive){await this.activateExtension();return}if(!this.license||this.license.variant!==this.shopwareExtensionService.EXTENSION_VARIANT_TYPES.RENT){await this.deactivateExtension();return}this.showDeactivationModal=!0,this.$nextTick(()=>{this.extension.active=!this.extension.active})},async activateExtension(){try{this.isLoading=!0,await this.shopwareExtensionService.activateExtension(this.extension.name,this.extension.type),this.extension.active=!0,this.clearCacheAndReloadPage()}catch(e){this.extension.active=!1,this.showExtensionErrors(e)}finally{this.isLoading=!1}},async deactivateExtension(){try{this.isLoading=!0,await this.shopwareExtensionService.deactivateExtension(this.extension.name,this.extension.type),this.extension.active=!1,this.clearCacheAndReloadPage()}catch(e){this.extension.active=!0,this.showExtensionErrors(e)}finally{this.isLoading=!1}},closeDeactivationModal(){this.showDeactivationModal=!1},async closeModalAndDeactivateExtension(){await this.deactivateExtension(),this.showDeactivationModal=!1},async installExtension(){var e;this.isLoading=!0;try{this.extension.source==="store"&&await this.extensionStoreActionService.downloadExtension(this.extension.name),await this.shopwareExtensionService.installExtension(this.extension.name,this.extension.type),await this.clearCacheAndReloadPage()}catch(t){this.showExtensionErrors(t);const i=(e=l.mapErrors(t.response.data.errors))==null?void 0:e[0];i.parameters?this.installationFailedError=i:this.installationFailedError={title:this.$tc(i.title),message:this.$tc(i.message)},this.showExtensionInstallationFailedModal=!0}finally{this.isLoading=!1}},async installAndActivateExtension(){var e;this.isLoading=!0;try{this.extension.source==="store"&&await this.extensionStoreActionService.downloadExtension(this.extension.name),await this.shopwareExtensionService.installExtension(this.extension.name,this.extension.type),await this.shopwareExtensionService.activateExtension(this.extension.name,this.extension.type),await this.clearCacheAndReloadPage()}catch(t){this.showExtensionErrors(t);const i=(e=l.mapErrors(t.response.data.errors))==null?void 0:e[0];i.parameters?this.installationFailedError=i:this.installationFailedError={title:this.$tc(i.title),message:this.$tc(i.message)},this.showExtensionInstallationFailedModal=!0}finally{this.isLoading=!1}},async cancelAndRemoveExtension(){try{this.closeRemovalModal(),this.isLoading=!0,this.extension.storeLicense.expirationDate||await this.shopwareExtensionService.cancelLicense(this.extension.storeLicense.id),await this.shopwareExtensionService.removeExtension(this.extension.name,this.extension.type),this.$nextTick(()=>{this.emitUpdateList()})}catch(e){this.showExtensionErrors(e)}finally{this.isLoading=!1}},openRatingModal(){this.showRatingModal=!0},closeRatingModal(){this.showRatingModal=!1},closeInstallationFailedNotification(){this.showExtensionInstallationFailedModal=!1}}};export{x as default};
