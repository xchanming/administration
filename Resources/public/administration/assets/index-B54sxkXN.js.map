{"version":3,"file":"index-B54sxkXN.js","sources":["../../../app/administration/src/module/sw-product/view/sw-product-detail-layout/sw-product-detail-layout.html.twig","../../../app/administration/src/module/sw-product/view/sw-product-detail-layout/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_product_detail_layout %}\n<div v-if=\"isLoading\">\n    <sw-skeleton variant=\"detail-bold\" />\n    <sw-skeleton />\n</div>\n\n<div\n    v-else\n    class=\"sw-product-detail-layout\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_detail_layout_assignment %}\n    <sw-card\n        position-identifier=\"sw-product-detail-layout-assignment\"\n        :title=\"$tc('sw-product.layout.title')\"\n        :subtitle=\"$tc('sw-product.layout.subtitle')\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_layout_content %}\n        <sw-product-layout-assignment\n            :cms-page=\"currentPage\"\n            @modal-layout-open=\"onOpenLayoutModal\"\n            @button-edit-click=\"onOpenInPageBuilder\"\n            @button-delete-click=\"onResetLayout\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_layout_modal %}\n        <sw-cms-layout-modal\n            v-if=\"showLayoutModal\"\n            :headline=\"$tc('sw-product.layoutAssignment.subtitle')\"\n            :pre-selection=\"currentPage\"\n            :cms-page-types=\"['product_detail']\"\n            @modal-layout-select=\"onSelectLayout\"\n            @modal-close=\"onCloseLayoutModal\"\n        />\n        {% endblock %}\n    </sw-card>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_detail_layout_cms_config %}\n    <template v-if=\"acl.can('product.editor') && currentPage\">\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_layout_cms_config_form %}\n        <sw-cms-page-form\n            v-if=\"showCmsForm\"\n            :page=\"currentPage\"\n            :element-update=\"elementUpdate\"\n        />\n\n        <sw-card\n            v-else\n            class=\"sw-product-detail-layout__no-config\"\n            position-identifier=\"sw-product-detail-layout-no-config\"\n            :is-loading=\"isConfigLoading\"\n        >\n            <p>{{ $tc('sw-product.layout.textNoConfig') }}</p>\n        </sw-card>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_layout_cms_content_info %}\n        <sw-card\n            hero\n            position-identifier=\"sw-product-detail-layout-cms-info\"\n        >\n            <p class=\"sw-product-detail-layout__content-info\">\n                {{ $tc('sw-product.layout.textContentInfo') }}\n            </p>\n        </sw-card>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</div>\n{% endblock %}\n","/*\n * @package inventory\n */\n\nimport template from './sw-product-detail-layout.html.twig';\nimport './sw-product-detail-layout.scss';\n\nconst { Component, State, Context, Utils } = Cicada;\nconst { Criteria } = Cicada.Data;\nconst { mapState, mapGetters } = Component.getComponentHelper();\nconst { cloneDeep, merge, get } = Utils.object;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'cmsService',\n        'feature',\n        'acl',\n    ],\n\n    data() {\n        return {\n            showLayoutModal: false,\n            isConfigLoading: false,\n        };\n    },\n\n    computed: {\n        cmsPageRepository() {\n            return this.repositoryFactory.create('cms_page');\n        },\n\n        cmsPageId() {\n            return get(this.product, 'cmsPageId', null);\n        },\n\n        showCmsForm() {\n            return (!this.isLoading || !this.isConfigLoading) && !this.currentPage.locked;\n        },\n\n        ...mapState('swProductDetail', [\n            'product',\n        ]),\n\n        ...mapGetters('swProductDetail', [\n            'isLoading',\n        ]),\n\n        cmsPageCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addAssociation('previewMedia');\n            criteria.addAssociation('sections');\n            criteria.getAssociation('sections').addSorting(Criteria.sort('position'));\n\n            criteria.addAssociation('sections.blocks');\n            criteria.getAssociation('sections.blocks').addSorting(Criteria.sort('position', 'ASC')).addAssociation('slots');\n\n            return criteria;\n        },\n\n        languageId() {\n            return Cicada.Context.api.languageId;\n        },\n\n        currentPage() {\n            return Cicada.Store.get('cmsPage').currentPage;\n        },\n\n        cmsPageState() {\n            return Cicada.Store.get('cmsPage');\n        },\n    },\n\n    watch: {\n        cmsPageId() {\n            this.cmsPageState.resetCmsPageState();\n            this.handleGetCmsPage();\n        },\n\n        product: {\n            deep: true,\n            handler(value) {\n                if (!value) {\n                    return;\n                }\n\n                this.updateCmsPageDataMapping();\n            },\n        },\n\n        languageId() {\n            this.cmsPageState.resetCmsPageState();\n            this.handleGetCmsPage();\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            // Keep current layout configuration if page sections exist\n            const sections = this.currentPage?.sections ?? [];\n\n            if (sections.length) {\n                return;\n            }\n\n            this.handleGetCmsPage();\n        },\n\n        onOpenLayoutModal() {\n            if (!this.acl.can('product.editor')) {\n                return;\n            }\n\n            this.showLayoutModal = true;\n        },\n\n        onCloseLayoutModal() {\n            this.showLayoutModal = false;\n        },\n\n        onOpenInPageBuilder() {\n            if (!this.currentPage) {\n                this.$router.push({ name: 'sw.cms.create' });\n            } else {\n                this.$router.push({\n                    name: 'sw.cms.detail',\n                    params: { id: this.currentPage.id },\n                });\n            }\n        },\n\n        onSelectLayout(cmsPageId) {\n            if (!this.product) {\n                return;\n            }\n\n            this.product.cmsPageId = cmsPageId;\n            this.product.slotConfig = null;\n            State.commit('swProductDetail/setProduct', this.product);\n        },\n\n        handleGetCmsPage() {\n            if (!this.cmsPageId) {\n                return;\n            }\n\n            this.isConfigLoading = true;\n\n            this.cmsPageRepository.get(this.cmsPageId, Context.api, this.cmsPageCriteria).then((cmsPage) => {\n                if (this.product.slotConfig && cmsPage) {\n                    cmsPage.sections.forEach((section) => {\n                        section.blocks.forEach((block) => {\n                            block.slots.forEach((slot) => {\n                                if (!this.product.slotConfig[slot.id]) {\n                                    return;\n                                }\n\n                                slot.config = slot.config || {};\n                                merge(slot.config, cloneDeep(this.product.slotConfig[slot.id]));\n                            });\n                        });\n                    });\n                }\n\n                this.cmsPageState.setCurrentPage(cmsPage);\n                this.updateCmsPageDataMapping();\n                this.isConfigLoading = false;\n            });\n        },\n\n        updateCmsPageDataMapping() {\n            this.cmsPageState.setCurrentMappingEntity('product');\n            this.cmsPageState.setCurrentMappingTypes(this.cmsService.getEntityMappingTypes('product'));\n            this.cmsPageState.setCurrentDemoEntity(this.product);\n        },\n\n        onResetLayout() {\n            this.onSelectLayout(null);\n        },\n\n        elementUpdate(element) {\n            const slotContent = this.product.slotConfig[element.id]?.content;\n            if (slotContent && slotContent.value) {\n                slotContent.value = element.config.content.value;\n            }\n        },\n    },\n};\n"],"names":["template","Component","State","Context","Utils","Criteria","mapState","mapGetters","cloneDeep","merge","get","index","criteria","value","_a","cmsPageId","cmsPage","section","block","slot","element","slotContent"],"mappings":"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"}