const o='{% block sw_extension_app_module_page %} <sw-page class="sw-extension-app-module-page" :show-smart-bar="showSmartBar" > <template v-if="!suspend" #smart-bar-header > <h2>{{ heading }}</h2> </template> <template #content> <template v-if="!suspend && signedIframeSrc"> <iframe v-show="appLoaded" id="app-content" class="sw-extension-app-module-page__app-content" referrerpolicy="origin-when-cross-origin" :src="signedIframeSrc" :title="heading" ></iframe> <template v-if="!appLoaded"> <template v-if="timedOut"> <sw-extension-app-module-error-page /> </template> <template v-else> <sw-loader /> </template> </template> </template> </template> </sw-page> {% endblock %}',{Context:s}=Shopware,l=Shopware.Component.wrapComponentConfig({template:o,inject:["acl","extensionSdkService"],props:{appName:{type:String,required:!0},moduleName:{type:String,required:!1,default:null}},data(){return{appLoaded:!1,timedOut:!1,timedOutTimeout:null,signedIframeSrc:void 0}},computed:{currentLocale(){return Shopware.Store.get("session").currentLocale},fallbackLocale(){return s.app.fallbackLocale},appDefinition(){return Shopware.Store.get("shopwareApps").apps.find(e=>e.name===this.appName)??null},moduleDefinition(){return this.appDefinition?this.moduleName?this.appDefinition.modules.find(e=>e.name===this.moduleName)??null:this.appDefinition.mainModule??null:null},showSmartBar(){var t;const{hiddenSmartBars:e}=Shopware.Store.get("extensionSdkModules");return this.moduleName?!e.includes(this.moduleName):(((t=this.appDefinition)==null?void 0:t.modules)??[]).some(n=>!e.includes(n.name))},suspend(){return!this.appDefinition||!this.moduleDefinition},heading(){if(!this.appDefinition)return null;const e=this.translate(this.appDefinition.label);if(!this.moduleDefinition||!this.moduleDefinition.label)return e;const t=this.translate(this.moduleDefinition.label);return[e,t].filter(i=>!!i).join(" - ")},entryPoint(){var e;return this.suspend?null:((e=this.moduleDefinition)==null?void 0:e.source)??null},origin(){if(!this.entryPoint)return null;try{return new URL(this.entryPoint).origin}catch{return null}},loadedMessage(){return"sw-app-loaded"}},watch:{entryPoint(){this.appLoaded=!1,this.timedOut=!1},appLoaded:{immediate:!0,handler(e){this.timedOutTimeout!==null&&clearTimeout(this.timedOutTimeout),this.timedOutTimeout=null,e||(this.timedOutTimeout=window.setTimeout(()=>{this.appLoaded||(this.timedOut=!0)},5e3))}},moduleDefinition:{immediate:!0,deep:!0,handler(){var n;const e=(n=this.moduleDefinition)==null?void 0:n.source;if(!e)return;const t=new URL(e),i=t.origin+t.pathname;this.extensionSdkService.signIframeSrc(this.appName,i).then(a=>{const r=a==null?void 0:a.uri;r&&(this.signedIframeSrc=r)}).catch(()=>{})}}},mounted(){window.addEventListener("message",this.onContentLoaded)},beforeUnmount(){window.removeEventListener("message",this.onContentLoaded)},created(){this.createdComponent()},methods:{createdComponent(){this.acl.can(`app.${this.appName}`)||this.$router.push({name:"sw.privilege.error.index"})},translate(e){return this.currentLocale&&e[this.currentLocale]?e[this.currentLocale]:this.fallbackLocale&&e[this.fallbackLocale]?e[this.fallbackLocale]:null},onContentLoaded(e){e.origin===this.origin&&e.data===this.loadedMessage&&(this.appLoaded=!0)}}});export{l as default};
