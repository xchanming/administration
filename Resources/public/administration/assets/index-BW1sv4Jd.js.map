{"version":3,"file":"index-BW1sv4Jd.js","sources":["../../../app/administration/src/app/asyncComponent/media/sw-media-field/sw-media-field.html.twig","../../../app/administration/src/app/asyncComponent/media/sw-media-field/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_media_field %}\n<div class=\"sw-media-field\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_media_field_label %}\n    <!-- eslint-disable-next-line vuejs-accessibility/label-has-for -->\n    <label\n        v-if=\"showLabel\"\n        class=\"sw-media-field__label\"\n    >\n        <slot name=\"label\">\n            {{ label }}\n        </slot>\n    </label>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_media_field_input %}\n    <div\n        class=\"sw-media-field__input-container\"\n        :class=\"mediaFieldClasses\"\n    >\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_media_field_preview %}\n        <sw-media-media-item\n            v-if=\"mediaEntity\"\n            class=\"sw-media-field__media-list-item sw-media-field__input\"\n            :item=\"mediaEntity\"\n            :is-list=\"true\"\n            :show-context-menu-button=\"false\"\n            :editable=\"false\"\n        />\n        <div\n            v-else\n            class=\"sw-media-field__empty-preview sw-media-field__input\"\n        ></div>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_media_field_toggle_button %}\n        <sw-button\n            class=\"sw-media-field__toggle-button\"\n            square\n            :disabled=\"disabled\"\n            @click=\"onTogglePicker\"\n        >\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_media_field_media_icon %}\n            <sw-icon name=\"regular-image\" />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_media_field_media_popover %}\n            <sw-popover\n                v-if=\"showPicker\"\n                :z-index=\"1000\"\n                popover-class=\"sw-media-field__expanded-content\"\n                class=\"sw-media-field__popover\"\n            >\n                <div @click.stop>\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_media_field_action_bar %}\n                    <div class=\"sw-media-field__actions_bar\">\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_media_field_action_bar_button_toggle %}\n                        <sw-button\n                            class=\"sw-media-field__action-button\"\n                            @click=\"toggleUploadField\"\n                        >\n                            <sw-icon\n                                class=\"sw-media-field__icon-add\"\n                                name=\"regular-plus\"\n                                small\n                            />\n                            {{ toggleButtonLabel }}\n                        </sw-button>\n                        {% endblock %}\n\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_media_field_action_bar_button_unlink %}\n                        <sw-button\n                            v-if=\"mediaId\"\n                            class=\"sw-media-field__action-button is--remove\"\n                            @click=\"removeLink\"\n                        >\n                            <sw-icon\n                                class=\"sw-media-field__icon-remove\"\n                                name=\"regular-times-circle-s\"\n                                small\n                            />\n                            {{ $tc('global.sw-media-field.labelUnlink') }}\n                        </sw-button>\n                        {% endblock %}\n                    </div>\n                    {% endblock %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_media_field_upload_component %}\n                    <sw-upload-listener\n                        :upload-tag=\"uploadTag\"\n                        auto-upload\n                        @media-upload-finish=\"exposeNewId\"\n                    />\n\n                    <sw-media-upload-v2\n                        v-if=\"showUploadField\"\n                        variant=\"regular\"\n                        :file-accept=\"fileAccept\"\n                        :default-folder=\"defaultFolder\"\n                        :allow-multi-select=\"false\"\n                        :upload-tag=\"uploadTag\"\n                        :disabled=\"disabled\"\n                    />\n                    {% endblock %}\n\n                    <div\n                        v-else\n                        class=\"sw-media-field__media-selection\"\n                    >\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_media_field_search_field %}\n                        <sw-simple-search-field\n                            v-model:value=\"searchTerm\"\n                            @search-term-change=\"onSearchTermChange\"\n                        />\n                        {% endblock %}\n\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_media_field_media_list %}\n                        <sw-loader\n                            v-if=\"isLoadingSuggestions\"\n                            class=\"sw-media-field__picker-loader\"\n                        />\n\n                        <ul\n                            v-else\n                            class=\"sw-media-field__suggestion-list\"\n                        >\n                            <li\n                                v-for=\"suggestion in suggestedItems\"\n                                :key=\"suggestion.id\"\n                                class=\"sw-media-field__suggestion-list-entry\"\n                            >\n                                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                                {% block sw_media_field_suggestion_preview %}\n                                <sw-media-media-item\n                                    class=\"sw-media-field__media-list-item\"\n                                    :item=\"suggestion\"\n                                    :is-list=\"true\"\n                                    :show-context-menu-button=\"false\"\n                                    @media-item-click=\"mediaItemChanged(suggestion.id)\"\n                                />\n                                {% endblock %}\n                            </li>\n                        </ul>\n                        {% endblock %}\n\n                        <sw-pagination\n                            v-bind=\"{ page, limit, total }\"\n                            :total-visible=\"4\"\n                            :steps=\"[5]\"\n                            @page-change=\"onPageChange\"\n                        />\n                    </div>\n                </div>\n            </sw-popover>\n            {% endblock %}\n        </sw-button>\n        {% endblock %}\n    </div>\n    {% endblock %}\n</div>\n{% endblock %}\n","import template from './sw-media-field.html.twig';\nimport './sw-media-field.scss';\n\nconst { Context, Utils } = Cicada;\nconst { Criteria } = Cicada.Data;\n\n/**\n * @status ready\n * @description The <u>sw-media-field</u> component is used to bind your\n * @package content\n * @example-type code-only\n * @component-example\n * <sw-media-field v-model=\"manufacturer.mediaId\"></sw-media-field>\n */\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'feature',\n    ],\n\n    emits: ['update:value'],\n\n    props: {\n        // need to be \"value\" instead of \"modelValue\" because of the compat build\n        value: {\n            type: String,\n            required: false,\n            default: null,\n        },\n\n        disabled: {\n            type: Boolean,\n            default: false,\n            required: false,\n        },\n\n        label: {\n            type: String,\n            required: false,\n            default: null,\n        },\n\n        defaultFolder: {\n            type: String,\n            required: false,\n            validator(value) {\n                return value.length > 0;\n            },\n            default: null,\n        },\n\n        fileAccept: {\n            type: String,\n            required: false,\n            default: '*/*',\n        },\n    },\n\n    data() {\n        return {\n            searchTerm: '',\n            mediaEntity: null,\n            showPicker: false,\n            showUploadField: false,\n            suggestedItems: [],\n            isLoadingSuggestions: false,\n            pickerClasses: {},\n            uploadTag: Utils.createId(),\n            page: 1,\n            limit: 5,\n            total: 0,\n        };\n    },\n\n    computed: {\n        mediaId: {\n            get() {\n                return this.value;\n            },\n            set(newValue) {\n                this.$emit('update:value', newValue);\n            },\n        },\n\n        mediaRepository() {\n            return this.repositoryFactory.create('media');\n        },\n        mediaFieldClasses() {\n            return {\n                'is--active': this.showPicker,\n            };\n        },\n\n        toggleButtonLabel() {\n            return this.showUploadField\n                ? this.$tc('global.sw-media-field.labelToggleSearchExisting')\n                : this.$tc('global.sw-media-field.labelToggleUploadNew');\n        },\n\n        suggestionCriteria() {\n            const criteria = new Criteria(this.page, this.limit);\n\n            criteria.addFilter(Criteria.not('AND', [Criteria.equals('uploadedAt', null)]));\n\n            if (this.searchTerm) {\n                criteria.addFilter(\n                    Criteria.multi('OR', [\n                        Criteria.contains('fileName', this.searchTerm),\n                        Criteria.contains('fileExtension', this.searchTerm),\n                    ]),\n                );\n            }\n\n            if (this.defaultFolder) {\n                criteria.addFilter(Criteria.equals('mediaFolder.defaultFolder.entity', this.defaultFolder));\n            }\n\n            return criteria;\n        },\n    },\n\n    watch: {\n        mediaId(newValue) {\n            this.fetchItem(newValue);\n            this.$emit('update:value', newValue);\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.fetchItem();\n        },\n\n        onSearchTermChange(searchTerm) {\n            this.searchTerm = searchTerm;\n            this.page = 1;\n            this.fetchSuggestions();\n        },\n\n        async fetchItem(id = this.mediaId) {\n            if (!id) {\n                this.mediaEntity = null;\n                return;\n            }\n            this.mediaEntity = await this.mediaRepository.get(id, Context.api);\n        },\n\n        async fetchSuggestions() {\n            this.isLoadingSuggestions = true;\n\n            try {\n                this.suggestedItems = await this.mediaRepository.search(this.suggestionCriteria, Context.api);\n                this.total = this.suggestedItems.total;\n            } catch (e) {\n                throw new Error(e);\n            } finally {\n                this.isLoadingSuggestions = false;\n            }\n        },\n\n        onTogglePicker() {\n            this.page = 1;\n            this.limit = 5;\n            this.total = 0;\n            this.showPicker = !this.showPicker;\n\n            if (this.showPicker) {\n                this.showUploadField = false;\n                this.computePickerPositionAndStyle();\n                this.fetchSuggestions();\n            }\n        },\n\n        mediaItemChanged(newMediaId) {\n            this.$emit('update:value', newMediaId);\n            this.onTogglePicker();\n        },\n\n        removeLink() {\n            this.$emit('update:value', null);\n        },\n\n        computePickerPositionAndStyle() {\n            if (!this.$el) {\n                this.pickerClasses = {};\n                return;\n            }\n\n            const clientRect = this.$el.getBoundingClientRect();\n            this.pickerClasses = {\n                top: `${clientRect.height + 5}px`,\n            };\n        },\n\n        toggleUploadField() {\n            this.showUploadField = !this.showUploadField;\n        },\n\n        exposeNewId({ targetId }) {\n            this.$emit('update:value', targetId);\n            this.showUploadField = false;\n            this.showPicker = false;\n        },\n\n        showLabel() {\n            return !!this.label || !!this.$slots.label || !!this.$scopedSlots?.label?.();\n        },\n\n        onPageChange({ page, limit }) {\n            this.page = page;\n            this.limit = limit;\n\n            this.fetchSuggestions();\n        },\n    },\n};\n"],"names":["template","Context","Utils","Criteria","index","value","newValue","criteria","searchTerm","id","newMediaId","clientRect","targetId","_a","_b","page","limit"],"mappings":"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"}