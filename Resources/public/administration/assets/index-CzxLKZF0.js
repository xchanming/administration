const r='{% block sw_text_editor_toolbar %} <div class="sw-text-editor-toolbar" :style="[position, arrowPosition]" :class="classes" role="menu" tabindex="0" @click="handleToolbarClick" > {% block sw_text_editor_toolbar_buttons %} {% block sw_text_editor_toolbar_buttons_left %} <div v-if="leftButtons.length > 0" class="sw-text-editor-buttons is--left" > <sw-text-editor-toolbar-button v-for="button in leftButtons" :key="button.type" :is-inline-edit="isInlineEdit" :button-config="setButtonValues(button)" :disabled="isDisabled(button)" @button-click="onButtonClick" @menu-toggle="onToggleMenu" /> </div> {% endblock %} {% block sw_text_editor_toolbar_buttons_middle %} <div v-if="middleButtons.length > 0" class="sw-text-editor-buttons is--middle" > <sw-text-editor-toolbar-button v-for="button in middleButtons" :key="button.type" :is-inline-edit="isInlineEdit" :button-config="setButtonValues(button)" :disabled="isDisabled(button)" @button-click="onButtonClick" @menu-toggle="onToggleMenu" /> </div> {% endblock %} {% block sw_text_editor_toolbar_buttons_right %} <div v-if="rightButtons.length > 0" class="sw-text-editor-buttons is--right" > <sw-text-editor-toolbar-button v-for="button in rightButtons" :key="button.type" :is-inline-edit="isInlineEdit" :button-config="setButtonValues(button)" :disabled="isDisabled(button)" @button-click="onButtonClick" @menu-toggle="onToggleMenu" /> </div> {% endblock %} {% block sw_text_editor_toolbar_slot %} <slot name="itemsSlot"></slot> {% endblock %} {% endblock %} </div> {% endblock %}',{Component:d,Utils:c}=Cicada;d.register("sw-text-editor-toolbar",{template:r,compatConfig:Cicada.compatConfig,emits:["created-el","destroyed-el","remove-link","text-style-change","table-edit","on-set-link"],props:{parentIsActive:{type:Boolean,required:!1,default:!1},isInlineEdit:{type:Boolean,required:!1,default:!1},selection:{required:!1,default:null},buttonConfig:{type:Array,required:!0},isCodeEdit:{type:Boolean,required:!1,default:!1},isTableEdit:{type:Boolean,required:!1,default:!1}},data(){return{position:{},range:null,arrowPosition:{"--left":"49%"},activeTags:[],currentColor:null,currentLink:null,leftButtons:[],middleButtons:[],rightButtons:[],tableEdit:!1,scrollEventHandler:void 0}},computed:{classes(){return{"is--boxedEdit":!this.isInlineEdit}}},watch:{isTableEdit:{handler(){this.tableEdit=this.isTableEdit,this.$nextTick(()=>{this.setActiveTags()})}},position:{handler(e){e.top.replace("px","")<0&&this.closeExpandedMenu()}}},created(){this.createdComponent()},mounted(){this.mountedComponent()},unmounted(){this.destroyedComponent()},methods:{createdComponent(){this.setButtonPositions(),this.setActiveTags()},mountedComponent(){this.isInlineEdit&&(document.querySelector("body").appendChild(this.$el),this.scrollEventHandler=c.throttle(()=>{this.setToolbarPosition()},16),document.addEventListener("scroll",this.scrollEventHandler,!0),this.$device.onResize({listener:this.setToolbarPosition})),document.addEventListener("mouseup",this.onMouseUp),this.setToolbarPosition(),this.$emit("created-el",this.$el),this.$nextTick(()=>{this.isOverlayingLeft()})},isOverlayingLeft(){if(!this.isInlineEdit)return;const e=this.$el,t=document.querySelector(".sw-admin-menu");if(!t)return;const i=t.offsetLeft+t.offsetWidth;if(e.offsetLeft<i){this.position.left=`${i+4}px`,this.position.right="unset";const o=8,s=this.range.getBoundingClientRect();let n=s.right-s.width/2;n-=i+o,this.arrowPosition["--left"]=`${n}px`,this.arrowPosition["--right"]="unset"}},destroyedComponent(){var e,t;this.closeExpandedMenu(),document.removeEventListener("scroll",this.scrollEventListener,!0),document.removeEventListener("mouseup",this.onMouseUp),(t=(e=this.$el)==null?void 0:e.parentElement)!=null&&t.contains(this.$el)&&this.$el.parentElement.removeChild(this.$el),this.$emit("destroyed-el")},onMouseUp(e){const t=[];let i=e.target;for(;i;)t.push(i),i=i.parentNode;if(!t.some(o=>{var s;return(s=o.classList)==null?void 0:s.contains("sw-popover__wrapper")})){if(!t.includes(this.$el)){!this.isInlineEdit&&this.selection?this.setActiveTags():this.activeTags.length>0&&(this.activeTags=[]),this.closeExpandedMenu();return}t.indexOf(this.$el)>-1||!this.parentIsActive||this.setToolbarPosition()}},setToolbarPosition(){var l,a;if(!this.selection)return;if(!this.isInlineEdit){this.setSelectionRange();return}this.setSelectionRange();const e=(a=(l=this.range)==null?void 0:l.getBoundingClientRect)==null?void 0:a.call(l);if(!e)return;let t=window.pageYOffset;t+=e.top-(this.$el.clientHeight+8);const o=e.left+e.width/2+4,s=this.$el.clientWidth/2,n=o-s;this.position={left:`${n}px`,top:`${t}px`}},setSelectionRange(){this.selection.anchorNode&&this.selection.rangeCount>0&&(this.range=this.selection.getRangeAt(0))},setButtonValues(e){var t,i,o,s;return this.isCodeEdit&&e.type!=="codeSwitch"||(e.children&&(typeof e.expanded>"u"&&(this.isCompatEnabled("INSTANCE_SET")?this.$set(e,"expanded",!1):e.expanded=!1),e.children.forEach(n=>{this.isCompatEnabled("INSTANCE_SET")?this.$set(n,"active",!!this.activeTags.includes(n.tag)):n.active=!!this.activeTags.includes(n.tag)})),e.type==="foreColor"&&this.currentColor&&(e.value=this.currentColor,this.currentColor=null),e.type==="link"&&(e.value=((t=this.currentLink)==null?void 0:t.url)??"",e.newTab=((i=this.currentLink)==null?void 0:i.newTab)??!1,e.displayAsButton=((o=this.currentLink)==null?void 0:o.displayAsButton)??!1,e.buttonVariant=((s=this.currentLink)==null?void 0:s.buttonVariant)??"primary"),this.isCompatEnabled("INSTANCE_SET")?this.$set(e,"active",!!this.activeTags.includes(e.tag)):e.active=!!this.activeTags.includes(e.tag)),e},isDisabled(e){return this.isCodeEdit?e.type!=="codeSwitch":!1},handleToolbarClick(e){e.target.classList.contains("sw-text-editor-toolbar")&&this.keepSelection()},onButtonClick(e,t=null){if(e.type==="link"){this.handleTextStyleChangeLink(e);return}if(e.type==="linkRemove"&&this.$emit("remove-link"),e.type==="foreColor"&&this.keepSelection(!0),e.children||this.closeExpandedMenu(),t&&t.children.forEach(i=>{i.active=!1}),this.keepSelection(),e.handler){e.handler(e,t),e.expanded=!1;return}this.$emit("text-style-change",e.type,e.value),this.isInlineEdit&&this.setToolbarPosition(),this.$nextTick(()=>{this.setActiveTags(),e.active=!!this.activeTags.includes(e.tag)})},closeExpandedMenu(){this.buttonConfig.forEach(e=>{e.expanded&&e.type!=="codeSwitch"&&(e.expanded=!1)})},setActiveTags(){if(this.currentColor=null,this.currentLink=null,!this.selection||!this.selection.anchorNode)return;let e=this.selection.anchorNode.parentNode;for(this.activeTags=[];e.tagName!=="DIV";){if(e.tagName==="FONT"&&(this.currentColor=e.color),e.tagName==="A"){const t=e.classList.contains("btn-secondary")?"secondary":"primary",i=e.classList.contains("btn-sm")?"-sm":"";this.currentLink={url:e.getAttribute("href"),newTab:e.target==="_blank",displayAsButton:e.classList.contains("btn"),buttonVariant:`${t}${i}`}}e.tagName==="TABLE"&&(this.tableEdit||(this.tableEdit=!0,this.$emit("table-edit",this.tableEdit))),this.activeTags.push(e.tagName.toLowerCase()),e=e.parentNode}this.tableEdit&&!this.activeTags.includes("table")&&(this.tableEdit=!1,this.$emit("table-edit",this.tableEdit))},setButtonPositions(){this.buttonConfig.forEach(e=>{!e.position||e.position==="left"?this.leftButtons.push(e):e.position==="middle"?this.middleButtons.push(e):e.position==="right"&&this.rightButtons.push(e)})},handleTextStyleChangeLink(e){let t="_self";if(e.newTab&&(t="_blank"),this.keepSelection(!0),e.value){if(!this.selection||this.selection.rangeCount<1){e.expanded=!1;return}this.$emit("on-set-link",e.value,t,e.displayAsButton,e.buttonVariant),this.range=document.getSelection().getRangeAt(0),this.range.setStart(this.range.startContainer,0),e.expanded=!1}},keepSelection(e){this.selection&&(e||this.setSelectionRange(),this.selection.removeAllRanges(),this.selection.addRange(this.range))},onToggleMenu(e,t){this.keepSelection(),this.buttonConfig.forEach(i=>{i===t||i.type==="codeSwitch"||i.expanded&&(i.expanded=!1)}),t.expanded=!t.expanded}}});
//# sourceMappingURL=index-CzxLKZF0.js.map
