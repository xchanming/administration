{"version":3,"file":"index-CxNycaw6.js","sources":["../../../app/administration/src/module/sw-import-export/component/sw-import-export-importer/sw-import-export-importer.html.twig","../../../app/administration/src/module/sw-import-export/component/sw-import-export-importer/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_import_export_importer %}\n<div class=\"sw-import-export-importer\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_importer_upload_csv_label %}\n    <h2>{{ $tc('sw-import-export.importer.uploadCsvLabel') }}</h2>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_importer_warning_block %}\n    <p><span v-html=\"$tc('sw-import-export.importer.warningBlock')\"></span></p>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_importer_file_input %}\n    <sw-file-input\n        :key=\"isLoading\"\n        v-model:value=\"importFile\"\n    >\n        <template #caption-label>\n            {{ $tc('sw-import-export.importer.labelUploadCaption') }}\n        </template>\n    </sw-file-input>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_importer_select_profile_label %}\n    <h2>{{ $tc('sw-import-export.importer.selectProfileLabel') }}</h2>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_importer_profile_select %}\n    <sw-entity-single-select\n        class=\"sw-import-export-importer__profile-select\"\n        :disabled=\"isLoading\"\n        :label=\"$tc('sw-import-export.importer.profileLabel')\"\n        entity=\"import_export_profile\"\n        label-property=\"label\"\n        :criteria=\"profileCriteria\"\n        :value=\"selectedProfileId\"\n        required\n        @update:value=\"onProfileSelect\"\n    />\n    {% endblock %}\n\n    <template v-if=\"selectedProfile && selectedProfile.sourceEntity === 'product'\">\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_importer_profile_select_product_variants_switch %}\n        <sw-switch-field\n            v-model:value=\"config.includeVariants\"\n            class=\"sw-import-export-importer__variants-switch-field\"\n            :label=\"$tc('sw-import-export.importer.importVariants')\"\n        />\n        {% endblock %}\n    </template>\n\n    <template v-if=\"showProductVariantsInfo\">\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_importer_product_variants_warning %}\n        <sw-alert\n            variant=\"warning\"\n            class=\"sw-import-export-importer__variants-warning\"\n        >\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_import_export_importer_product_variants_warning_text %}\n            <p>\n                <span v-html=\"$tc('sw-import-export.importer.variantsWarning')\"></span>\n            </p>\n            <p>\n                <a\n                    href=\"#\"\n                    class=\"sw-import-export-importer__link\"\n                    @click.prevent=\"setImportModalProfile('product_configurator_setting')\"\n                >\n                    {{ $tc('sw-import-export.importer.directImportVariantsLabel') }}\n                </a>\n                <br>\n                <a\n                    href=\"#\"\n                    class=\"sw-import-export-importer__link\"\n                    @click.prevent=\"setImportModalProfile('property_group_option')\"\n                >\n                    {{ $tc('sw-import-export.importer.directImportPropertiesLabel') }}\n                </a>\n            </p>\n            {% endblock %}\n        </sw-alert>\n        {% endblock %}\n    </template>\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_importer_modal %}\n    <sw-modal\n        v-if=\"importModalProfile\"\n        :title=\"$tc('sw-import-export.importer.importLabel')\"\n        @modal-close=\"setImportModalProfile(null)\"\n    >\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_importer_modal_exporter %}\n        <sw-import-export-importer\n            :source-entity=\"importModalProfile\"\n            @import-started=\"$emit('import-started', $event)\"\n        />\n        {% endblock %}\n\n        <template #modal-footer>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_import_export_importer_modal_footer %}\n            <sw-button\n                size=\"small\"\n                @click=\"setImportModalProfile(null)\"\n            >\n                {{ $tc('sw-import-export.importer.close') }}\n            </sw-button>\n            {% endblock %}\n        </template>\n    </sw-modal>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_importer_progress %}\n    <sw-import-export-progress\n        activity-type=\"import\"\n        :disable-button=\"disableImporting\"\n        @process-start=\"onStartProcess\"\n        @process-start-dryrun=\"onStartDryRunProcess\"\n    />\n    {% endblock %}\n</div>\n{% endblock %}\n","/**\n * @package services-settings\n */\nimport template from './sw-import-export-importer.html.twig';\nimport './sw-import-export-importer.scss';\n\nconst { Mixin } = Cicada;\nconst { Criteria } = Cicada.Data;\n\n/**\n * @private\n */\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'importExport',\n        'repositoryFactory',\n        'feature',\n    ],\n\n    emits: ['import-started'],\n\n    mixins: [\n        Mixin.getByName('notification'),\n    ],\n\n    props: {\n        sourceEntity: {\n            type: String,\n            required: false,\n            default: '',\n        },\n    },\n\n    data() {\n        return {\n            selectedProfileId: null,\n            selectedProfile: null,\n            config: {},\n            isLoading: false,\n            importFile: null,\n            importModalProfile: null,\n        };\n    },\n\n    computed: {\n        profileCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addSorting(Criteria.sort('label'));\n\n            if (this.sourceEntity.length > 0) {\n                criteria.addFilter(Criteria.equals('sourceEntity', this.sourceEntity));\n            }\n            criteria.addFilter(Criteria.not('AND', [Criteria.equals('type', 'export')]));\n\n            return criteria;\n        },\n\n        logRepository() {\n            return this.repositoryFactory.create('import_export_log');\n        },\n\n        disableImporting() {\n            return this.isLoading || this.selectedProfileId === null || this.importFile === null;\n        },\n\n        showProductVariantsInfo() {\n            return (\n                this.selectedProfile &&\n                this.selectedProfile.sourceEntity === 'product' &&\n                this.config &&\n                this.config.includeVariants\n            );\n        },\n\n        logCriteria() {\n            const criteria = new Criteria(1, 25);\n\n            criteria.addAssociation('invalidRecordsLog');\n            criteria.addAssociation('file');\n\n            return criteria;\n        },\n    },\n\n    methods: {\n        onProfileSelect(profileId, profile) {\n            this.selectedProfileId = profileId;\n            this.selectedProfile = profile;\n        },\n\n        onStartProcess(dryRun = false) {\n            this.isLoading = true;\n\n            const profile = this.selectedProfileId;\n\n            this.importExport\n                .import(profile, this.importFile, this.handleProgress, this.config, dryRun)\n                .then(() => {\n                    this.importFile = null;\n                })\n                .catch((error) => {\n                    if (!error.response || !error.response.data || !error.response.data.errors) {\n                        this.createNotificationError({\n                            message: error.message,\n                        });\n                    } else {\n                        error.response.data.errors.forEach((singleError) => {\n                            this.createNotificationError({\n                                message: `${singleError.code}: ${singleError.detail}`,\n                            });\n                        });\n                    }\n\n                    this.isLoading = false;\n                });\n        },\n\n        onStartDryRunProcess() {\n            this.onStartProcess(true);\n        },\n\n        handleProgress(log) {\n            this.createNotificationInfo({\n                message: this.$tc('sw-import-export.importer.messageImportStarted'),\n            });\n\n            this.isLoading = false;\n            this.$emit('import-started', log);\n        },\n\n        setImportModalProfile(profileName) {\n            this.importModalProfile = profileName;\n        },\n    },\n};\n"],"names":["template","Mixin","Criteria","index","criteria","profileId","profile","dryRun","error","singleError","log","profileName"],"mappings":"AAAA,MAAeA,EAAA,6iGCMT,CAAE,MAAAC,CAAO,EAAG,OACZ,CAAE,SAAAC,CAAQ,EAAK,OAAO,KAKbC,EAAA,CACX,SAAAH,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,eACA,oBACA,SACH,EAED,MAAO,CAAC,gBAAgB,EAExB,OAAQ,CACJC,EAAM,UAAU,cAAc,CACjC,EAED,MAAO,CACH,aAAc,CACV,KAAM,OACN,SAAU,GACV,QAAS,EACZ,CACJ,EAED,MAAO,CACH,MAAO,CACH,kBAAmB,KACnB,gBAAiB,KACjB,OAAQ,CAAE,EACV,UAAW,GACX,WAAY,KACZ,mBAAoB,IAChC,CACK,EAED,SAAU,CACN,iBAAkB,CACd,MAAMG,EAAW,IAAIF,EAAS,EAAG,EAAE,EACnC,OAAAE,EAAS,WAAWF,EAAS,KAAK,OAAO,CAAC,EAEtC,KAAK,aAAa,OAAS,GAC3BE,EAAS,UAAUF,EAAS,OAAO,eAAgB,KAAK,YAAY,CAAC,EAEzEE,EAAS,UAAUF,EAAS,IAAI,MAAO,CAACA,EAAS,OAAO,OAAQ,QAAQ,CAAC,CAAC,CAAC,EAEpEE,CACV,EAED,eAAgB,CACZ,OAAO,KAAK,kBAAkB,OAAO,mBAAmB,CAC3D,EAED,kBAAmB,CACf,OAAO,KAAK,WAAa,KAAK,oBAAsB,MAAQ,KAAK,aAAe,IACnF,EAED,yBAA0B,CACtB,OACI,KAAK,iBACL,KAAK,gBAAgB,eAAiB,WACtC,KAAK,QACL,KAAK,OAAO,eAEnB,EAED,aAAc,CACV,MAAMA,EAAW,IAAIF,EAAS,EAAG,EAAE,EAEnC,OAAAE,EAAS,eAAe,mBAAmB,EAC3CA,EAAS,eAAe,MAAM,EAEvBA,CACV,CACJ,EAED,QAAS,CACL,gBAAgBC,EAAWC,EAAS,CAChC,KAAK,kBAAoBD,EACzB,KAAK,gBAAkBC,CAC1B,EAED,eAAeC,EAAS,GAAO,CAC3B,KAAK,UAAY,GAEjB,MAAMD,EAAU,KAAK,kBAErB,KAAK,aACA,OAAOA,EAAS,KAAK,WAAY,KAAK,eAAgB,KAAK,OAAQC,CAAM,EACzE,KAAK,IAAM,CACR,KAAK,WAAa,IACtC,CAAiB,EACA,MAAOC,GAAU,CACV,CAACA,EAAM,UAAY,CAACA,EAAM,SAAS,MAAQ,CAACA,EAAM,SAAS,KAAK,OAChE,KAAK,wBAAwB,CACzB,QAASA,EAAM,OAC3C,CAAyB,EAEDA,EAAM,SAAS,KAAK,OAAO,QAASC,GAAgB,CAChD,KAAK,wBAAwB,CACzB,QAAS,GAAGA,EAAY,IAAI,KAAKA,EAAY,MAAM,EACnF,CAA6B,CAC7B,CAAyB,EAGL,KAAK,UAAY,EACrC,CAAiB,CACR,EAED,sBAAuB,CACnB,KAAK,eAAe,EAAI,CAC3B,EAED,eAAeC,EAAK,CAChB,KAAK,uBAAuB,CACxB,QAAS,KAAK,IAAI,gDAAgD,CAClF,CAAa,EAED,KAAK,UAAY,GACjB,KAAK,MAAM,iBAAkBA,CAAG,CACnC,EAED,sBAAsBC,EAAa,CAC/B,KAAK,mBAAqBA,CAC7B,CACJ,CACL"}