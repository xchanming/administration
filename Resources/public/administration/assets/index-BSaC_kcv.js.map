{"version":3,"file":"index-BSaC_kcv.js","sources":["../../../app/administration/src/module/sw-order/component/sw-order-create-initial-modal/sw-order-create-initial-modal.html.twig","../../../app/administration/src/module/sw-order/component/sw-order-create-initial-modal/index.ts"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_order_create_modal %}\n<sw-modal\n    class=\"sw-order-create-initial-modal\"\n    :closable=\"false\"\n    :title=\"$tc('sw-order.initialModal.titleNewOrder')\"\n    variant=\"large\"\n    @modal-close=\"onCloseModal\"\n>\n    <template #default>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_order_create_modal_tabs %}\n        <sw-tabs\n            class=\"sw-order-create-initial-modal__tabs\"\n            default-item=\"customer\"\n            position-identifier=\"sw-order-create-initial-modal\"\n        >\n            <template #default=\"{ active }\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_order_create_modal_tabs_customer %}\n                <sw-tabs-item\n                    class=\"sw-order-create-initial-modal__tab-customer\"\n                    name=\"customer\"\n                    :active-tab=\"active\"\n                >\n                    {{ $tc('sw-order.initialModal.tabCustomer') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_order_create_modal_tabs_products %}\n                <sw-tabs-item\n                    class=\"sw-order-create-initial-modal__tab-product\"\n                    name=\"products\"\n                    :active-tab=\"active\"\n                    :disabled=\"!customer || undefined\"\n                >\n                    {{ $tc('sw-order.initialModal.tabProducts') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_order_create_modal_tabs_options %}\n                <sw-tabs-item\n                    class=\"sw-order-create-initial-modal__tab-options\"\n                    name=\"options\"\n                    :active-tab=\"active\"\n                    :disabled=\"!customer || undefined\"\n                >\n                    {{ $tc('sw-order.initialModal.tabOptions') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_order_create_modal_tabs_extension %}{% endblock %}\n            </template>\n\n            <template #content=\"{ active }\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_order_create_modal_tabs_content %}\n                <div class=\"sw-order-create-initial-modal__content\">\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_order_create_modal_tabs_content_customer %}\n                    <sw-order-customer-grid\n                        v-show=\"active === 'customer'\"\n                    />\n                    {% endblock %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_order_create_modal_tabs_content_products %}\n                    <sw-order-line-items-grid-sales-channel\n                        v-show=\"active === 'products'\"\n                        :is-loading=\"isProductGridLoading\"\n                        :sales-channel-id=\"salesChannelId\"\n                        :cart=\"cart\"\n                        :currency=\"currency\"\n                        :is-customer-active=\"isCustomerActive\"\n                        @on-save-item=\"onSaveItem\"\n                        @on-remove-items=\"onRemoveItems\"\n                    />\n                    {% endblock %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_order_create_modal_tabs_content_options %}\n                    <sw-order-create-options\n                        v-if=\"active === 'options'\"\n                        :disabled=\"!customer || undefined\"\n                        :disabled-auto-promotion=\"disabledAutoPromotion\"\n                        :promotion-codes=\"promotionCodes\"\n                        :context=\"context\"\n                        @promotions-change=\"updatePromotion\"\n                        @auto-promotion-toggle=\"updateAutoPromotionToggle\"\n                        @shipping-cost-change=\"updateShippingCost\"\n                    />\n                    {% endblock %}\n                </div>\n                {% endblock %}\n            </template>\n        </sw-tabs>\n        {% endblock %}\n    </template>\n\n    <template #modal-footer>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_order_create_modal_footer_modal_footer_cancel %}\n        <sw-button\n            class=\"sw-order-create-initial-modal__button-cancel\"\n            size=\"small\"\n            @click=\"onCloseModal\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_order_create_modal_footer_modal_footer_preview_order %}\n        <sw-button\n            class=\"sw-order-create-initial-modal__button-preview\"\n            size=\"small\"\n            variant=\"primary\"\n            :disabled=\"!customer || undefined\"\n            :is-loading=\"isLoading\"\n            @click=\"onPreviewOrder\"\n        >\n            {{ $tc('sw-order.initialModal.buttonPreviewOrder') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n\n</sw-modal>\n{% endblock %}\n","import type { Entity } from '@cicada-ag/meteor-admin-sdk/es/_internals/data/Entity';\nimport template from './sw-order-create-initial-modal.html.twig';\nimport './sw-order-create-initial-modal.scss';\n\nimport type { Cart, LineItem, SalesChannelContext, ContextSwitchParameters, CartDelivery } from '../../order.types';\n\nimport { LineItemType } from '../../order.types';\n\nconst { Component, State, Mixin, Service } = Cicada;\n\ninterface PromotionCodeItem {\n    type: string;\n    referencedId: string;\n}\n\n/**\n * @package checkout\n */\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default Component.wrapComponentConfig({\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    mixins: [\n        Mixin.getByName('notification'),\n        Mixin.getByName('cart-notification'),\n    ],\n\n    data(): {\n        isLoading: boolean;\n        isProductGridLoading: boolean;\n        disabledAutoPromotion: boolean;\n        promotionCodes: string[];\n        productItems: LineItem[];\n        context: ContextSwitchParameters;\n        shippingCosts: number | null;\n    } {\n        return {\n            productItems: [],\n            promotionCodes: [],\n            isLoading: false,\n            isProductGridLoading: false,\n            disabledAutoPromotion: false,\n            shippingCosts: null,\n            context: {\n                currencyId: '',\n                paymentMethodId: '',\n                shippingMethodId: '',\n                languageId: '',\n                billingAddressId: '',\n                shippingAddressId: '',\n            },\n        };\n    },\n\n    computed: {\n        salesChannelId(): string {\n            return this.customer?.salesChannelId ?? '';\n        },\n\n        salesChannelContext(): SalesChannelContext {\n            return State.get('swOrder').context;\n        },\n\n        currency(): Entity<'currency'> {\n            return this.salesChannelContext.currency;\n        },\n\n        cart(): Cart {\n            return State.get('swOrder').cart;\n        },\n\n        customer(): Entity<'customer'> | null {\n            return State.get('swOrder').customer;\n        },\n\n        isCustomerActive(): boolean {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-return,@typescript-eslint/no-unsafe-member-access\n            return State.getters['swOrder/isCustomerActive'];\n        },\n\n        promotionCodeItems(): PromotionCodeItem[] {\n            return this.promotionCodes.map((code) => {\n                return {\n                    type: LineItemType.PROMOTION,\n                    referencedId: code,\n                };\n            });\n        },\n\n        cartDelivery(): CartDelivery | null {\n            return this.cart?.deliveries[0] as CartDelivery | null;\n        },\n    },\n\n    watch: {\n        salesChannelContext(value: SalesChannelContext): void {\n            // Update context after switching customer successfully\n            this.context = {\n                ...this.context,\n                currencyId: value.context.currencyId,\n                languageId: value.context.languageIdChain[0],\n                shippingMethodId: value.shippingMethod.id,\n                paymentMethodId: value.paymentMethod.id,\n                // eslint-disable-next-line max-len\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment,@typescript-eslint/no-unsafe-member-access\n                billingAddressId: value.customer?.activeBillingAddress?.id ?? '',\n                // eslint-disable-next-line max-len\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment,@typescript-eslint/no-unsafe-member-access\n                shippingAddressId: value.customer?.activeShippingAddress?.id ?? '',\n            };\n        },\n    },\n\n    methods: {\n        onCloseModal(): void {\n            if (!this.customer || !this.cart.token) {\n                this.$emit('modal-close');\n                return;\n            }\n\n            void this.cancelCart().then(() => {\n                this.$emit('modal-close');\n            });\n        },\n\n        async onPreviewOrder(): Promise<void> {\n            const promises = [];\n\n            this.isLoading = true;\n\n            promises.push(this.updateOrderContext());\n\n            if (this.disabledAutoPromotion) {\n                promises.push(this.disableAutoAppliedPromotions());\n            }\n\n            if (this.promotionCodes.length) {\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n                promises.push(this.addPromotionCodes());\n            }\n\n            if (this.shippingCosts !== null && this.shippingCosts !== this.cartDelivery?.shippingCosts?.totalPrice) {\n                promises.push(this.modifyShippingCost(this.shippingCosts));\n            }\n\n            try {\n                const responses = await Promise.all(promises);\n                if (responses) {\n                    this.$emit('order-preview');\n                }\n            } finally {\n                this.isLoading = false;\n            }\n        },\n\n        async onSaveItem(item: LineItem): Promise<void> {\n            this.isProductGridLoading = true;\n\n            try {\n                await State.dispatch('swOrder/saveLineItem', {\n                    salesChannelId: this.salesChannelId,\n                    contextToken: this.cart.token,\n                    item,\n                });\n            } finally {\n                this.isProductGridLoading = false;\n            }\n        },\n\n        addPromotionCodes(): Promise<void> {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n            return State.dispatch('swOrder/saveMultipleLineItems', {\n                salesChannelId: this.customer?.salesChannelId,\n                contextToken: this.cart.token,\n                items: this.promotionCodeItems,\n            });\n        },\n\n        updatePromotion(promotions: string[]): void {\n            this.promotionCodes = promotions;\n        },\n\n        async onRemoveItems(lineItemKeys: string[]): Promise<void> {\n            this.isProductGridLoading = true;\n\n            try {\n                await State.dispatch('swOrder/removeLineItems', {\n                    salesChannelId: this.salesChannelId,\n                    contextToken: this.cart.token,\n                    lineItemKeys: lineItemKeys,\n                });\n            } finally {\n                this.isProductGridLoading = false;\n            }\n        },\n\n        updateAutoPromotionToggle(value: boolean): void {\n            this.disabledAutoPromotion = value;\n        },\n\n        updateShippingCost(value: number): void {\n            this.shippingCosts = value;\n        },\n\n        updateOrderContext(): Promise<void> {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n            return State.dispatch('swOrder/updateOrderContext', {\n                context: this.context,\n                salesChannelId: this.salesChannelId,\n                contextToken: this.cart.token,\n            });\n        },\n\n        disableAutoAppliedPromotions(): Promise<void> {\n            const additionalParams = { salesChannelId: this.salesChannelId };\n\n            return Service('cartStoreService')\n                .disableAutomaticPromotions(this.cart.token, additionalParams)\n                .then(() => {\n                    State.commit('swOrder/setDisabledAutoPromotion', true);\n                });\n        },\n\n        modifyShippingCost(amount: number): Promise<void> {\n            if (!this.cartDelivery) {\n                return Promise.resolve();\n            }\n\n            const positiveAmount = Math.abs(amount);\n            this.cartDelivery.shippingCosts.unitPrice = positiveAmount;\n            this.cartDelivery.shippingCosts.totalPrice = positiveAmount;\n\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n            return State.dispatch('swOrder/modifyShippingCosts', {\n                salesChannelId: this.customer?.salesChannelId,\n                contextToken: this.cart.token,\n                shippingCosts: this.cartDelivery?.shippingCosts,\n            });\n        },\n\n        cancelCart(): Promise<void> {\n            return State.dispatch('swOrder/cancelCart', {\n                salesChannelId: this.salesChannelId,\n                contextToken: this.cart.token,\n            }).then(() => {\n                this.$emit('modal-close');\n            });\n        },\n    },\n});\n"],"names":["template","Component","State","Mixin","Service","index","_a","code","LineItemType","value","_b","_d","_c","promises","item","promotions","lineItemKeys","additionalParams","amount","positiveAmount"],"mappings":"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"}