import{m as d}from"./main.vite-CEuAX8cl.js";import"./administration-DCOj2uiN.js";import"./channel-oRk5-XZJ.js";const l=`{% block sw_settings_shipping_detail %} <sw-page class="sw-settings-shipping-detail"> {% block sw_settings_shipping_detail_header %} <template #smart-bar-header> <h2>{{ placeholder(shippingMethod, 'name', $tc('sw-settings-shipping.detail.textHeadline')) }}</h2> </template> {% endblock %} {% block sw_settings_shipping_detail_actions %} <template #smart-bar-actions> {% block sw_settings_shipping_detail_actions_abort %} <sw-button v-tooltip.bottom="tooltipCancel" :disabled="isLoading || undefined" @click="onCancel" > {{ $tc('global.default.cancel') }} </sw-button> {% endblock %} {% block sw_settings_shipping_detail_actions_save %} <sw-button-process v-model:processSuccess="isSaveSuccessful" v-tooltip.bottom="tooltipSave" class="sw-settings-shipping-method-detail__save-action" :is-loading="isProcessLoading" :disabled="isProcessLoading || !acl.can('shipping.editor') || undefined" variant="primary" @click.prevent="onSave" > {{ $tc('sw-settings-shipping.detail.buttonSave') }} </sw-button-process> {% endblock %} </template> {% endblock %} {% block sw_settings_shipping_detail_language_switch %} <template #language-switch> <sw-language-switch :disabled="isNewShippingMethod || undefined" :save-changes-function="saveOnLanguageChange" :abort-change-function="abortOnLanguageChange" @on-change="onChangeLanguage" /> </template> {% endblock %} {% block sw_settings_shipping_detail_content %} <template #content> <sw-card-view> <template v-if="isLoading"> <sw-skeleton variant="detail-bold" /> <sw-skeleton /> </template> <template v-else> {% block sw_settings_shipping_detail_content_language_info %} <sw-language-info :is-new-entity="isNewShippingMethod" :entity-description="placeholder(shippingMethod, 'name', $tc('sw-settings-shipping.detail.textHeadline'))" /> {% endblock %} {% block sw_settings_shipping_detail_base %} <sw-card position-identifier="sw-settings-shipping-detail-base" :title="$tc('sw-settings-shipping.detail.labelBasicInfo')" :is-loading="isLoading" > <sw-container columns="3fr 3fr 1fr" gap="0px 30px" > {% block sw_settings_shipping_detail_base_content_field_name %} <sw-text-field v-model:value="shippingMethod.name" name="sw-field--shippingMethod-name" required :disabled="!acl.can('shipping.editor') || undefined" :error="shippingMethodNameError" :label="$tc('sw-settings-shipping.detail.labelName')" :placeholder="placeholder(shippingMethod, 'name', $tc('sw-settings-shipping.detail.placeholderName'))" /> {% endblock %} {% block sw_settings_shipping_detail_content_field_technical_name %} <sw-text-field v-model:value="shippingMethod.technicalName" name="sw-field--shippingMethod-technicalName" class="sw-settings-shipping-detail__field-technical-name" :required="feature.isActive('v6.7.0.0')" :disabled="!acl.can('shipping.editor') || undefined" :label="$tc('sw-settings-shipping.detail.labelTechnicalName')" :placeholder="placeholder(shippingMethod, 'technicalName', $tc('sw-settings-shipping.detail.placeholderTechnicalName'))" :error="shippingMethodTechnicalNameError" :help-text="$tc('sw-settings-shipping.detail.helpTextTechnicalName')" :class="!shippingMethod.technicalName ? 'has--warning' : ''" > {# @deprecated tag:v6.7.0 - Hint can be removed: with technical names now required, the hint is no longer needed. Also remove the snippet and dynamic class has--warning #} <template #hint> <span v-if="!shippingMethod.technicalName">{{ $tc('sw-settings-shipping.detail.hintTextTechnicalName') }}</span> </template> </sw-text-field> {% endblock %} {% block sw_settings_shipping_detail_base_content_field_position %} <sw-number-field v-model:value="shippingMethod.position" name="sw-field--shippingMethod-position" class="sw-settings-shipping-detail__field-position" :disabled="!acl.can('shipping.editor') || undefined" :label="$tc('sw-settings-shipping.detail.labelPosition')" :placeholder="$tc('sw-settings-shipping.detail.placeholderPosition')" /> {% endblock %} {% block sw_settings_shipping_detail_base_content_field_active %} <sw-switch-field v-model:value="shippingMethod.active" name="sw-field--shippingMethod-active" bordered :disabled="!acl.can('shipping.editor') || undefined" :label="$tc('sw-settings-shipping.detail.labelActive')" /> {% endblock %} </sw-container> <sw-container columns="repeat(auto-fit, minmax(250px, 1fr))" gap="0px 30px" > {% block sw_settings_shipping_detail_base_content_field_description %} <sw-textarea-field v-model:value="shippingMethod.description" name="sw-field--shippingMethod-description" :value="shippingMethod.description" class="sw-settings-shipping-detail__description" :disabled="!acl.can('shipping.editor') || undefined" :label="$tc('sw-settings-shipping.detail.labelDescription')" :placeholder="placeholder(shippingMethod, 'description', $tc('sw-settings-shipping.detail.placeholderDescription'))" /> {% endblock %} {% block sw_settings_shipping_detail_base_content_media_upload %} <sw-upload-listener :upload-tag="uploadTag" auto-upload @media-upload-finish="setMediaItem" /> <sw-media-upload-v2 v-if="!isLoading" :upload-tag="uploadTag" :source="logoMediaItem" class="sw-settings-shipping-detail__logo-image-upload" :allow-multi-select="false" variant="regular" :disabled="!acl.can('shipping.editor') || undefined" :label="$tc('sw-settings-shipping.detail.labelLogoUpload')" :default-folder="shippingMethod.getEntityName()" @media-drop="onDropMedia" @media-upload-sidebar-open="openMediaSidebar" @media-upload-remove-image="onUnlinkLogo" /> {% endblock %} </sw-container> {% block sw_settings_shipping_detail_base_content_field_delivery_time %} <sw-entity-single-select v-model:value="shippingMethod.deliveryTimeId" name="sw-field--shippingMethod-deliveryTimeId" class="sw-settings-shipping-detail__delivery-time" entity="delivery_time" :disabled="!acl.can('shipping.editor') || undefined" :criteria="deliveryTimeCriteria" :label="$tc('sw-settings-shipping.detail.labelDeliveryTime')" :placeholder="$tc('sw-settings-shipping.detail.placeholderDeliveryTime')" :error="shippingMethodDeliveryTimeIdError" show-clearable-button required /> {% endblock %} {% block sw_settings_shipping_detail_base_content_tracking_url_field %} <sw-text-field v-model:value="shippingMethod.trackingUrl" name="sw-field--shippingMethod-trackingUrl" :disabled="!acl.can('shipping.editor') || undefined" :label="$tc('sw-settings-shipping.detail.labelTrackingUrl')" :placeholder="placeholder(shippingMethod, 'trackingUrl', $tc('sw-settings-shipping.detail.placeholderTrackingUrl'))" :help-text="$tc('sw-settings-shipping.detail.helpTextTrackingUrl')" /> {% endblock %} {% block sw_settings_shipping_detail_base_content_tags_field %} <sw-entity-tag-select v-if="!isLoading" v-model:entityCollection="shippingMethod.tags" :disabled="!acl.can('shipping.editor') || undefined" :placeholder="$tc('sw-product.categoryForm.placeholderTags')" /> {% endblock %} </sw-card> {% endblock %} {% block sw_settings_shipping_detail_top_ruleshippingPriceStore %} <sw-card position-identifier="sw-settings-shipping-detail-condition-container" class="sw-settings-shipping-detail__condition_container" :title="$tc('sw-settings-shipping.detail.topRule')" > {% block sw_settings_shipping_detail_top_rule_select %} <sw-select-rule-create :rule-id="shippingMethod.availabilityRuleId" :rule-filter="ruleFilter" :disabled="!acl.can('shipping.editor') || undefined" :error="shippingMethodAvailabilityRuleIdError" :label="$tc('sw-settings-shipping.detail.topRule')" class="sw-settings-shipping-detail__top-rule" rule-aware-group-key="shippingMethods" @save-rule="onSaveRule" /> {% endblock %} </sw-card> {% endblock %} {% block sw_settings_shipping_detail_tax_cost %} <sw-settings-shipping-tax-cost v-if="!isLoading" :disabled="!acl.can('shipping.editor') || undefined" /> {% endblock %} <sw-skeleton v-else /> {% block sw_settings_shipping_detail_price_matrices %} <sw-settings-shipping-price-matrices v-if="!isLoading" ref="priceMatrices" :disabled="!acl.can('shipping.editor') || undefined" /> {% endblock %} <sw-skeleton v-else /> {% block sw_settings_shipping_detail_custom_field_sets %} <sw-card v-if="showCustomFields" position-identifier="sw-settings-shipping-detail-custom-fields" :title="$tc('sw-settings-custom-field.general.mainMenuItemGeneral')" :is-loading="isLoading" > <sw-custom-field-set-renderer :entity="shippingMethod" :disabled="!acl.can('shipping.editor') || undefined" :sets="customFieldSets" /> </sw-card> {% endblock %} </template> </sw-card-view> </template> {% endblock %} <template #sidebar> {% block sw_settings_shipping_detail_sidebar %} <sw-sidebar :propagate-width="true"> {% block sw_setting_shipping_detail_sidebar_media_item %} <sw-sidebar-media-item ref="mediaSidebarItem"> <template #context-menu-items="media" > <sw-context-menu-item @click="setMediaFromSidebar(media.mediaItem)"> {{ $tc('sw-settings-shipping.sidebar.labelUseAsLogo') }} </sw-context-menu-item> </template> </sw-sidebar-media-item> {% endblock %} </sw-sidebar> {% endblock %} </template> </sw-page> {% endblock %}`,r={namespaced:!0,state(){return{shippingMethod:{},currencies:[],restrictedRuleIds:[]}},mutations:{setShippingMethod(e,i){e.shippingMethod=i},setCurrencies(e,i){e.currencies=i},setRestrictedRuleIds(e,i){e.restrictedRuleIds=i}},getters:{shippingPriceGroups(e){if(!e.shippingMethod.prices)return{};const i={};return e.shippingMethod.prices.forEach(t=>{let n=t.ruleId;t._inNewMatrix&&(n="new"),i[n]||(i[n]={isNew:n==="new",ruleId:t.ruleId,rule:t.rule,calculation:t.calculation,prices:[]}),i[n].prices.push(t)}),i},defaultCurrency(e){return e.currencies.find(i=>i.isSystemDefault)},usedRules(e,i){return Object.keys(i.shippingPriceGroups)},unrestrictedPriceMatrixExists(e){return e.shippingMethod.prices.some(i=>i.ruleId===null)},newPriceMatrixExists(e,i){return i.shippingPriceGroups.hasOwnProperty("new")}}},{Mixin:o,Context:a}=Cicada,{mapState:p,mapGetters:c}=Cicada.Component.getComponentHelper(),{Criteria:s}=Cicada.Data,{warn:h}=Cicada.Utils.debug,_={template:l,compatConfig:Cicada.compatConfig,inject:["ruleConditionDataProviderService","repositoryFactory","acl","customFieldDataProviderService","feature"],mixins:[o.getByName("notification"),o.getByName("placeholder")],shortcuts:{"SYSTEMKEY+S":"onSave",ESCAPE:"onCancel"},props:{shippingMethodId:{type:String,required:!1,default:null}},data(){return{logoMediaItem:null,uploadTag:"sw-shipping-method-upload-tag",isSaveSuccessful:!1,isProcessLoading:!1,isLoading:!1,currenciesLoading:!1,customFieldSets:[]}},metaInfo(){return{title:this.$createTitle(this.identifier)}},computed:{...p("swShippingDetail",["shippingMethod","currencies","restrictedRuleIds"]),...c("swShippingDetail",["usedRules"]),...d("shippingMethod",["name","technicalName","deliveryTimeId","availabilityRuleId"]),identifier(){return this.placeholder(this.shippingMethod,"name")},shippingMethodRepository(){return this.repositoryFactory.create("shipping_method")},shippingMethodPricesRepository(){return this.repositoryFactory.create("shipping_method_price")},currencyRepository(){return this.repositoryFactory.create("currency")},isNewShippingMethod(){return Object.keys(this.shippingMethod).length>0&&this.shippingMethod.isNew()},mediaRepository(){return this.repositoryFactory.create("media")},deliveryTimeRepository(){return this.repositoryFactory.create("delivery_time")},deliveryTimeCriteria(){const e=new s(1,25);return e.addSorting(s.sort("unit")),e.addSorting(s.sort("name")),e},tooltipSave(){return{message:`${this.$device.getSystemKey()} + S`,appearance:"light"}},tooltipCancel(){return{message:"ESC",appearance:"light"}},ruleFilter(){const e=new s(1,25);return e.addFilter(s.multi("OR",[s.contains("rule.moduleTypes.types","shipping"),s.equals("rule.moduleTypes",null)])),e.addAssociation("conditions"),e},shippingMethodCriteria(){const e=new s(1,25);return e.addAssociation("tags"),e.getAssociation("prices").addAssociation("rule").addSorting(s.sort("quantityStart")),Cicada.Feature.isActive("v6.7.0.0")||e.getAssociation("prices").addAssociation("calculationRule"),e},showCustomFields(){return this.customFieldSets&&this.customFieldSets.length>0}},watch:{"shippingMethod.mediaId"(){this.shippingMethod.mediaId&&this.setMediaItem({targetId:this.shippingMethod.mediaId})},shippingMethodId(){this.createdComponent()}},beforeCreate(){Cicada.State.registerModule("swShippingDetail",r)},created(){this.createdComponent()},beforeUnmount(){Cicada.State.unregisterModule("swShippingDetail")},methods:{createdComponent(){if(this.shippingMethodId)this.loadEntityData();else{Cicada.State.commit("context/resetLanguageToDefault");const e=this.shippingMethodRepository.create(),i=this.shippingMethodPricesRepository.create();i.calculation=1,i.quantityStart=1,i.shippingMethodId=e.id,i.ruleId=null,e.prices.add(i),Cicada.State.commit("swShippingDetail/setShippingMethod",e)}this.loadCurrencies()},onSaveRule(e){this.shippingMethod.availabilityRuleId=e},loadCurrencies(){this.currenciesLoading=!0,this.currencyRepository.search(new s(1,500),a.api).then(e=>{Cicada.State.commit("swShippingDetail/setCurrencies",this.sortCurrencies(e)),this.currenciesLoading=!1})},loadEntityData(){this.shippingMethodId&&(this.isLoading=!0,this.shippingMethodRepository.get(this.shippingMethodId,Cicada.Context.api,this.shippingMethodCriteria).then(e=>{Cicada.State.commit("swShippingDetail/setShippingMethod",e),this.ruleConditionDataProviderService.getRestrictedRules("shippingMethodPrices").then(i=>{Cicada.State.commit("swShippingDetail/setRestrictedRuleIds",this.usedRules.concat(i))}),this.loadCustomFieldSets().then(()=>{this.isLoading=!1})}))},loadCustomFieldSets(){return this.customFieldDataProviderService.getCustomFieldSets("shipping_method").then(e=>{this.customFieldSets=e})},abortOnLanguageChange(){return this.shippingMethodRepository.hasChanges(this.shippingMethod)},saveOnLanguageChange(){return this.onSave()},onChangeLanguage(){this.loadEntityData()},onSave(){return this.filterIncompletePrices(),this.isSaveSuccessful=!1,this.isProcessLoading=!0,this.shippingMethodRepository.save(this.shippingMethod,a.api).then(()=>{this.isSaveSuccessful=!0,this.shippingMethodId||this.$router.push({name:"sw.settings.shipping.detail",params:{id:this.shippingMethod.id}}),this.$refs.mediaSidebarItem.getList(),this.loadEntityData()}).catch(e=>{throw this.onError(e),h(this._name,e.message,e.response),this.isProcessLoading=!1,e}).finally(()=>{this.isProcessLoading=!1})},onError(e){let i=null;try{i=e.response.data.errors[0].detail}catch{i=""}this.createNotificationError({title:this.$tc("global.default.error"),message:`${this.$tc("sw-settings-shipping.detail.messageSaveError",0,{name:this.shippingMethod.name})} ${i}`})},filterIncompletePrices(){this.getIncompletePrices().forEach(e=>{this.shippingMethod.prices.remove(e.id)})},getIncompletePrices(){return this.shippingMethod.prices.filter(e=>!e.calculation&&!e.calculationRuleId||e._inNewMatrix)},onCancel(){this.$router.push({name:"sw.settings.shipping.index"})},setMediaItem({targetId:e}){this.mediaRepository.get(e,a.api).then(i=>{this.logoMediaItem=i}),this.shippingMethod.mediaId=e},onDropMedia(e){this.setMediaItem({targetId:e.id})},setMediaFromSidebar(e){this.logoMediaItem=e,this.shippingMethod.mediaId=e.id},onUnlinkLogo(){this.logoMediaItem=null,this.shippingMethod.mediaId=null},openMediaSidebar(){this.$refs.mediaSidebarItem.openContent()},sortCurrencies(e){return e.sort((i,t)=>i.isSystemDefault?-1:t.isSystemDefault?1:i.translated.name<t.translated.name?-1:i.translated.name>t.translated.name?1:0),e}}};export{_ as default};
//# sourceMappingURL=index-BE3fMoVS.js.map
