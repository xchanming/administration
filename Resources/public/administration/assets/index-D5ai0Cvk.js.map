{"version":3,"file":"index-D5ai0Cvk.js","sources":["../../../app/administration/src/module/sw-cms/page/sw-cms-create/sw-cms-create.html.twig","../../../app/administration/src/module/sw-cms/page/sw-cms-create/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_cms_detail_toolbar_language_switch %}\n<!-- eslint-disable-next-line vue/valid-v-slot -->\n<template #language-switch>\n    <sw-language-switch disabled />\n</template>\n{% endblock %}\n\n<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_cms_detail_toolbar_actions_sales_channel %}\n{% endblock %}\n\n<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_cms_detail_toolbar_actions_save %}\n<sw-button-process\n    v-tooltip.bottom=\"tooltipSave\"\n    class=\"sw-cms-detail__save-action\"\n    :is-loading=\"isLoading\"\n    :process-success=\"isSaveSuccessful\"\n    :disabled=\"true\"\n    variant=\"primary\"\n>\n    {{ $tc('sw-cms.detail.label.buttonSave') }}\n</sw-button-process>\n{% endblock %}\n\n<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_cms_detail_stage_container %}\n<sw-cms-create-wizard\n    :page=\"page\"\n    @on-section-select=\"onAddSection($event, 0)\"\n    @wizard-complete=\"onWizardComplete\"\n/>\n{% endblock %}\n","import template from './sw-cms-create.html.twig';\n\nconst { Mixin } = Cicada;\nconst utils = Cicada.Utils;\n\n/**\n * @private\n * @package discovery\n */\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    mixins: [\n        Mixin.getByName('placeholder'),\n    ],\n\n    data() {\n        return {\n            wizardComplete: false,\n        };\n    },\n\n    beforeRouteEnter(to, from, next) {\n        if (to.name.includes('sw.cms.create') && !to.params.id) {\n            to.params.id = utils.createId();\n        }\n\n        next();\n    },\n\n    computed: {\n        pageHasSections() {\n            return this.page.sections.length > 0 && this.wizardComplete;\n        },\n\n        categoryRepository() {\n            return this.repositoryFactory.create('category');\n        },\n    },\n\n    methods: {\n        createdComponent() {\n            Cicada.Store.get('adminMenu').collapseSidebar();\n\n            const isSystemDefaultLanguage = Cicada.State.getters['context/isSystemDefaultLanguage'];\n            if (!isSystemDefaultLanguage) {\n                Cicada.State.commit('context/resetLanguageToDefault');\n                this.$store.commit('cmsPageState/setIsSystemDefaultLanguage', isSystemDefaultLanguage);\n            }\n\n            this.page = this.pageRepository.create();\n            this.page.sections = new Cicada.Data.EntityCollection(\n                `/cms-page/${this.page.id}/sections`,\n                'cms_section',\n                Cicada.Context.api,\n            );\n        },\n\n        async onSave() {\n            this.isSaveSuccessful = false;\n\n            if ((this.isSystemDefaultLanguage && !this.page.name) || !this.page.type) {\n                this.createNotificationWarning({\n                    message: this.$tc('sw-cms.detail.notification.messageMissingFields'),\n                });\n\n                return Promise.reject();\n            }\n\n            this.page = await this.assignToEntity(this.page);\n\n            this.deleteEntityAndRequiredConfigKey(this.page.sections);\n\n            this.isLoading = true;\n\n            return this.pageRepository\n                .save(this.page)\n                .then(() => {\n                    this.isLoading = false;\n                    this.isSaveSuccessful = true;\n\n                    this.$router.push({\n                        name: 'sw.cms.detail',\n                        params: { id: this.page.id },\n                    });\n                })\n                .catch((exception) => {\n                    this.isLoading = false;\n\n                    this.createNotificationError({\n                        message: exception.message,\n                    });\n\n                    return Promise.reject(exception);\n                });\n        },\n\n        async assignToEntity(page) {\n            const { type, id } = this.$route.params;\n\n            if (!id || !type) {\n                return page;\n            }\n\n            try {\n                if (type === 'category') {\n                    const category = await this.categoryRepository.get(id);\n\n                    if (category) {\n                        page.categories.push(category);\n                    }\n                }\n\n                if (type.startsWith('ce_') || type.startsWith('custom_entity_')) {\n                    const customEntityRepository = this.repositoryFactory.create(type);\n                    const entity = await customEntityRepository.get(id);\n\n                    if (entity) {\n                        page.extensions[`${utils.string.camelCase(type)}SwCmsPage`].push(entity);\n                    }\n                }\n            } catch (e) {\n                this.createNotificationError({\n                    message: this.$tc('sw-cms.create.notification.assignToEntityError'),\n                });\n            }\n\n            return page;\n        },\n\n        onWizardComplete() {\n            if (this.page.type === 'product_list' || this.page.type === 'product_detail') {\n                this.onPageTypeChange(this.page.type);\n            }\n\n            this.wizardComplete = true;\n            this.onSave();\n        },\n    },\n};\n"],"names":["template","Mixin","utils","index","to","from","next","isSystemDefaultLanguage","exception","page","type","id","category","entity"],"mappings":"AAAA,MAAeA,EAAA,urBCET,CAAE,MAAAC,CAAO,EAAG,OACZC,EAAQ,OAAO,MAMNC,EAAA,CACX,SAAAH,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJC,EAAM,UAAU,aAAa,CAChC,EAED,MAAO,CACH,MAAO,CACH,eAAgB,EAC5B,CACK,EAED,iBAAiBG,EAAIC,EAAMC,EAAM,CACzBF,EAAG,KAAK,SAAS,eAAe,GAAK,CAACA,EAAG,OAAO,KAChDA,EAAG,OAAO,GAAKF,EAAM,SAAQ,GAGjCI,GACH,EAED,SAAU,CACN,iBAAkB,CACd,OAAO,KAAK,KAAK,SAAS,OAAS,GAAK,KAAK,cAChD,EAED,oBAAqB,CACjB,OAAO,KAAK,kBAAkB,OAAO,UAAU,CAClD,CACJ,EAED,QAAS,CACL,kBAAmB,CACf,OAAO,MAAM,IAAI,WAAW,EAAE,gBAAe,EAE7C,MAAMC,EAA0B,OAAO,MAAM,QAAQ,iCAAiC,EACjFA,IACD,OAAO,MAAM,OAAO,gCAAgC,EACpD,KAAK,OAAO,OAAO,0CAA2CA,CAAuB,GAGzF,KAAK,KAAO,KAAK,eAAe,OAAM,EACtC,KAAK,KAAK,SAAW,IAAI,OAAO,KAAK,iBACjC,aAAa,KAAK,KAAK,EAAE,YACzB,cACA,OAAO,QAAQ,GAC/B,CACS,EAED,MAAM,QAAS,CAGX,OAFA,KAAK,iBAAmB,GAEnB,KAAK,yBAA2B,CAAC,KAAK,KAAK,MAAS,CAAC,KAAK,KAAK,MAChE,KAAK,0BAA0B,CAC3B,QAAS,KAAK,IAAI,iDAAiD,CACvF,CAAiB,EAEM,QAAQ,WAGnB,KAAK,KAAO,MAAM,KAAK,eAAe,KAAK,IAAI,EAE/C,KAAK,iCAAiC,KAAK,KAAK,QAAQ,EAExD,KAAK,UAAY,GAEV,KAAK,eACP,KAAK,KAAK,IAAI,EACd,KAAK,IAAM,CACR,KAAK,UAAY,GACjB,KAAK,iBAAmB,GAExB,KAAK,QAAQ,KAAK,CACd,KAAM,gBACN,OAAQ,CAAE,GAAI,KAAK,KAAK,EAAI,CACpD,CAAqB,CACrB,CAAiB,EACA,MAAOC,IACJ,KAAK,UAAY,GAEjB,KAAK,wBAAwB,CACzB,QAASA,EAAU,OAC3C,CAAqB,EAEM,QAAQ,OAAOA,CAAS,EAClC,EACR,EAED,MAAM,eAAeC,EAAM,CACvB,KAAM,CAAE,KAAAC,EAAM,GAAAC,CAAE,EAAK,KAAK,OAAO,OAEjC,GAAI,CAACA,GAAM,CAACD,EACR,OAAOD,EAGX,GAAI,CACA,GAAIC,IAAS,WAAY,CACrB,MAAME,EAAW,MAAM,KAAK,mBAAmB,IAAID,CAAE,EAEjDC,GACAH,EAAK,WAAW,KAAKG,CAAQ,CAEpC,CAED,GAAIF,EAAK,WAAW,KAAK,GAAKA,EAAK,WAAW,gBAAgB,EAAG,CAE7D,MAAMG,EAAS,MADgB,KAAK,kBAAkB,OAAOH,CAAI,EACrB,IAAIC,CAAE,EAE9CE,GACAJ,EAAK,WAAW,GAAGP,EAAM,OAAO,UAAUQ,CAAI,CAAC,WAAW,EAAE,KAAKG,CAAM,CAE9E,CACJ,MAAW,CACR,KAAK,wBAAwB,CACzB,QAAS,KAAK,IAAI,gDAAgD,CACtF,CAAiB,CACJ,CAED,OAAOJ,CACV,EAED,kBAAmB,EACX,KAAK,KAAK,OAAS,gBAAkB,KAAK,KAAK,OAAS,mBACxD,KAAK,iBAAiB,KAAK,KAAK,IAAI,EAGxC,KAAK,eAAiB,GACtB,KAAK,OAAM,CACd,CACJ,CACL"}