const r=`{% block sw_data_grid_slot_pagination %} <sw-pagination v-bind="{ page, limit, total }" :total-visible="7" @page-change="paginate" /> {% endblock %} {% block sw_data_grid_slot_actions %} <slot name="more-actions" v-bind="{ item }" ></slot> <slot name="delete-action" :item="item" > <sw-context-menu-item v-tooltip.bottom="tooltipDelete" class="sw-one-to-many-grid__delete-action" variant="danger" :disabled="!allowDelete || undefined" @click="deleteItem(item.id)" > {{ $tc('global.default.delete') }} </sw-context-menu-item> </slot> {% endblock %}`,{Component:s}=Shopware,{Criteria:o}=Shopware.Data;s.extend("sw-one-to-many-grid","sw-data-grid",{template:r,inject:["repositoryFactory"],emits:["load-finish","delete-item-failed","items-delete-finish","column-sort"],props:{collection:{required:!0,type:Array},localMode:{type:Boolean,default:!0},dataSource:{type:[Array,Object],required:!1},allowDelete:{type:Boolean,required:!1,default:!0},tooltipDelete:{type:Object,required:!1,default(){return{message:"",disabled:!0}}}},data(){return{page:1,limit:25,total:0,intial:!0,initial:!0}},watch:{collection:{handler(){this.initial||this.load()},deep:!0}},methods:{createdComponent(){return this.$super("createdComponent"),this.applyResult(this.collection),this.intial=!1,this.initial=!1,this.localMode||(this.repository=this.repositoryFactory.create(this.collection.entity,this.collection.source),Array.isArray(this.records)&&this.records.length>0)?Promise.resolve():this.load()},applyResult(t){this.result=t,(!this.collection||!this.initial)&&(this.records=t),t.total?this.total=t.total:this.total=t.length,t.criteria&&(this.page=t.criteria.page||this.page,this.limit=t.criteria.limit||this.limit)},save(t){return this.localMode?Promise.resolve():this.repository.save(t,this.result.context).then(()=>this.load())},revert(){return this.localMode?Promise.resolve():this.load()},load(){return this.localMode?Promise.resolve():this.repository.search(this.result.criteria,this.result.context).then(t=>{this.applyResult(t),this.$emit("load-finish")})},deleteItem(t){return this.localMode?(this.collection.remove(t),Promise.resolve()):this.repository.delete(t,this.result.context).then(()=>(this.resetSelection(),this.load())).catch(e=>{this.$emit("delete-item-failed",{id:t,errorResponse:e})})},deleteItems(){const t=Object.values(this.selection);if(this.localMode)return t.forEach(i=>{this.collection.remove(i.id)}),this.resetSelection(),Promise.resolve();this.isBulkLoading=!0;const e=t.map(i=>i.id);return this.repository.syncDeleted(e,this.result.context).then(()=>{this.resetSelection(),this.load()}).catch(()=>this.deleteItemsFinish())},deleteItemsFinish(){return this.resetSelection(),this.isBulkLoading=!1,this.showBulkDeleteModal=!1,this.$emit("items-delete-finish"),this.load()},sort(t){if(this.localMode)return this.$emit("column-sort",t),Promise.resolve();this.result.criteria.resetSorting();let e="ASC";return this.currentSortBy===t.dataIndex&&this.currentSortDirection===e&&(e="DESC"),this.result.criteria.addSorting(o.sort(t.dataIndex,e,!!t.naturalSorting)),this.currentSortBy=t.dataIndex,this.currentSortDirection=e,this.currentNaturalSorting=!!t.naturalSorting,this.load()},paginate(t){return this.localMode?Promise.resolve():(this.result.criteria.setPage(t.page),this.result.criteria.setLimit(t.limit),this.load())}}});
