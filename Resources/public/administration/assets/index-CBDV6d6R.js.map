{"version":3,"file":"index-CBDV6d6R.js","sources":["../../../app/administration/src/module/sw-settings-search/page/sw-settings-search/sw-settings-search.html.twig","../../../app/administration/src/module/sw-settings-search/page/sw-settings-search/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_settings_search_index %}\n<sw-page class=\"sw-settings-search\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_search_smart_bar_header %}\n    <template #smart-bar-header>\n        <h2>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_search_smart_bar_header_title_text %}\n            {{ $tc('sw-settings.index.title') }}\n            <sw-icon\n                name=\"regular-chevron-right-xs\"\n                small\n            />\n            {{ $tc('sw-settings-search.general.mainMenuItemGeneral') }}\n            {% endblock %}\n        </h2>\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_search_language_switch %}\n    <template #language-switch>\n        <sw-language-switch @on-change=\"onChangeLanguage\" />\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_search_smart_bar_actions %}\n    <template #smart-bar-actions>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_search_smart_bar_actions_save %}\n        <sw-button-process\n            v-tooltip.bottom=\"tooltipSave\"\n            class=\"sw-settings-search__button-save\"\n            variant=\"primary\"\n            :disabled=\"!allowSave\"\n            :is-loading=\"isLoading\"\n            :process-success=\"isSaveSuccessful\"\n            @update:process-success=\"saveFinish\"\n            @click.prevent=\"onSaveSearchSettings\"\n        >\n            {{ $tc('global.default.save') }}\n        </sw-button-process>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_search_content %}\n    <template #content>\n        <sw-card-view>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_search_tabs_header %}\n            <sw-tabs position-identifier=\"sw-settings-search-header\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_setting_search_tabs_general %}\n                <sw-tabs-item\n                    v-bind=\"$props\"\n                    class=\"sw-settings-search__general-tab\"\n                    :route=\"{ name: 'sw.settings.search.index.general' }\"\n                    @click=\"onTabChange\"\n                >\n                    {{ $tc('sw-settings-search.page.generalTab') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_setting_search_tabs_live_search %}\n                <sw-tabs-item\n                    v-bind=\"$props\"\n                    class=\"sw-settings-search__live-search-tab\"\n                    :route=\"{ name: 'sw.settings.search.index.liveSearch' }\"\n                >\n                    {{ $tc('sw-settings-search.page.liveSearchTab') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_setting_search_tabs_after %}{% endblock %}\n            </sw-tabs>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_search_tabs_content %}\n            <template v-if=\"isLoading\">\n                <sw-skeleton />\n                <sw-skeleton />\n            </template>\n\n            {# v-show is used here as underlying components influence the loading state and v-if would destroy this behaviour #}\n            <router-view\n                v-show=\"!isLoading\"\n                v-slot=\"{ Component }\"\n            >\n                <component\n                    :is=\"Component\"\n                    :is-loading=\"isLoading\"\n                    :product-search-configs=\"productSearchConfigs\"\n                    :current-sales-channel-id=\"currentSalesChannelId\"\n                    :search-terms=\"searchTerms\"\n                    :search-results=\"searchResults\"\n                    @edit-change=\"onEditChanged\"\n                    @sales-channel-change=\"onSalesChannelChanged\"\n                    @live-search-results-change=\"onLiveSearchResultsChanged\"\n                    @excluded-search-terms-load=\"getProductSearchConfigs\"\n                />\n            </router-view>\n            {% endblock %}\n        </sw-card-view>\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_search_discard_model %}\n        <sw-confirm-modal\n            v-if=\"isDisplayingLeavePageWarning\"\n            class=\"sw_settings_search_leave_modal\"\n            type=\"yesno\"\n            :text=\"$tc('sw-settings-search.textLeaveConfirm')\"\n            @confirm=\"onConfirmLeave\"\n            @close=\"onCloseLeaveModal\"\n            @cancel=\"onCancelLeaveModal\"\n        />\n        {% endblock %}\n\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n","/**\n * @package buyers-experience\n */\nimport template from './sw-settings-search.html.twig';\n\nconst { Mixin } = Cicada;\nconst { EntityCollection, Criteria } = Cicada.Data;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n    ],\n\n    mixins: [Mixin.getByName('notification')],\n\n    shortcuts: {\n        'SYSTEMKEY+S': {\n            active() {\n                return this.allowSave;\n            },\n            method: 'onSaveSearchSettings',\n        },\n        ESCAPE: 'onCancel',\n    },\n\n    data: () => {\n        return {\n            productSearchConfigs: {\n                andLogic: true,\n                minSearchLength: 2,\n            },\n            isLoading: false,\n            currentSalesChannelId: null,\n            searchTerms: '',\n            searchResults: null,\n            defaultConfig: null,\n            isSaveSuccessful: false,\n            nextRoute: null,\n            isDisplayingLeavePageWarning: false,\n            leaveConfirmation: false,\n            isEditing: false,\n        };\n    },\n\n    computed: {\n        productSearchRepository() {\n            return this.repositoryFactory.create('product_search_config');\n        },\n\n        productSearchFieldRepository() {\n            return this.repositoryFactory.create('product_search_config_field');\n        },\n\n        productSearchConfigsCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addAssociation('configFields');\n            criteria.addFilter(Criteria.equals('languageId', Cicada.Context.api.languageId));\n            return criteria;\n        },\n\n        productDefaultConfigsCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addAssociation('configFields');\n            criteria.addFilter(Criteria.equals('languageId', Cicada.Context.api.systemLanguageId));\n            return criteria;\n        },\n\n        allowSave() {\n            return this.acl.can('product_search_config.editor') || this.acl.can('product_search_config.creator');\n        },\n\n        tooltipSave() {\n            if (!this.allowSave) {\n                return {\n                    message: this.$tc('sw-privileges.tooltip.warning'),\n                    disabled: this.allowSave,\n                    showOnDisabledElements: true,\n                };\n            }\n\n            const systemKey = this.$device.getSystemKey();\n\n            return {\n                message: `${systemKey} + S`,\n                appearance: 'light',\n            };\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    beforeRouteUpdate(to, from, next) {\n        this.unsavedDataLeaveHandler(to, from, next);\n    },\n\n    beforeRouteLeave(to, from, next) {\n        this.unsavedDataLeaveHandler(to, from, next);\n    },\n\n    methods: {\n        createdComponent() {\n            this.getDefaultSearchConfig();\n            this.getProductSearchConfigs();\n        },\n\n        getProductSearchConfigs() {\n            this.isLoading = true;\n            this.productSearchRepository\n                .search(this.productSearchConfigsCriteria)\n                .then((items) => {\n                    if (!items.total) {\n                        this.onSaveDefaultSearchConfig();\n                    } else {\n                        this.productSearchConfigs = items.first();\n                    }\n                })\n                .catch((err) => {\n                    this.createNotificationError({\n                        message: err.message,\n                    });\n                })\n                .finally(() => {\n                    this.isLoading = false;\n                });\n        },\n\n        getDefaultSearchConfig() {\n            this.productSearchRepository\n                .search(this.productDefaultConfigsCriteria)\n                .then((items) => {\n                    this.defaultConfig = items.first();\n                })\n                .catch((err) => {\n                    this.createNotificationError({\n                        message: err.message,\n                    });\n                });\n        },\n\n        createDefaultSearchConfig() {\n            const defaultConfig = this.productSearchRepository.create();\n            defaultConfig.andLogic = this.defaultConfig.andLogic;\n            defaultConfig.minSearchLength = this.defaultConfig.minSearchLength;\n            defaultConfig.excludedTerms = [];\n            defaultConfig.languageId = Cicada.Context.api.languageId;\n            return defaultConfig;\n        },\n\n        createConfigFields() {\n            if (!this.defaultConfig || !this.defaultConfig.configFields.length) {\n                return null;\n            }\n\n            const configFieldCollection = new EntityCollection(\n                this.productSearchFieldRepository.route,\n                this.productSearchFieldRepository.entityName,\n                Cicada.Context.api,\n            );\n            this.defaultConfig.configFields.forEach((item) => {\n                const newConfigField = this.productSearchFieldRepository.create();\n                newConfigField.field = item.field;\n                newConfigField.ranking = item.ranking;\n                newConfigField.searchable = item.searchable;\n                newConfigField.tokenize = item.tokenize;\n                newConfigField.customFieldId = null;\n                newConfigField.searchConfigId = this.productSearchConfigs.id;\n                configFieldCollection.add(newConfigField);\n            });\n            return configFieldCollection;\n        },\n\n        onSaveDefaultSearchConfig() {\n            this.productSearchConfigs = this.createDefaultSearchConfig();\n            this.productSearchConfigs.configFields = this.createConfigFields();\n            this.productSearchRepository\n                .save(this.productSearchConfigs)\n                .then(() => {\n                    this.getProductSearchConfigs();\n                })\n                .catch(() => {\n                    this.createNotificationError({\n                        message: this.$tc('sw-settings-search.notification.saveError'),\n                    });\n                });\n        },\n\n        onChangeLanguage() {\n            this.getDefaultSearchConfig();\n            this.getProductSearchConfigs();\n        },\n\n        onTabChange() {\n            this.getProductSearchConfigs();\n        },\n\n        onSaveSearchSettings() {\n            this.isLoading = true;\n            this.productSearchRepository\n                .save(this.productSearchConfigs)\n                .then(() => {\n                    this.createNotificationSuccess({\n                        message: this.$tc('sw-settings-search.notification.saveSuccess'),\n                    });\n                    this.getProductSearchConfigs();\n                    this.isSaveSuccessful = true;\n                })\n                .catch(() => {\n                    this.createNotificationError({\n                        message: this.$tc('sw-settings-search.notification.saveError'),\n                    });\n                })\n                .finally(() => {\n                    this.isLoading = false;\n                    this.isEditing = false;\n                });\n        },\n\n        saveFinish() {\n            this.isSaveSuccessful = false;\n        },\n\n        fetchSalesChannels() {\n            this.salesChannelRepository.search(new Criteria(1, 25)).then((response) => {\n                this.salesChannels = response;\n            });\n        },\n\n        unsavedDataLeaveHandler(to, from, next) {\n            if (this.leaveConfirmation) {\n                this.leaveConfirmation = false;\n                next();\n\n                return;\n            }\n\n            if (this.isEditing) {\n                this.isDisplayingLeavePageWarning = true;\n                this.nextRoute = to;\n                next(false);\n            } else {\n                next();\n            }\n        },\n\n        onSalesChannelChanged(salesChannelId) {\n            this.currentSalesChannelId = salesChannelId;\n        },\n\n        onLiveSearchResultsChanged({ searchTerms, searchResults }) {\n            this.searchTerms = searchTerms;\n            this.searchResults = searchResults;\n        },\n\n        onEditChanged(isEditing) {\n            this.isEditing = isEditing;\n        },\n\n        onConfirmLeave() {\n            this.leaveConfirmation = true;\n            this.isDisplayingLeavePageWarning = false;\n            this.isEditing = false;\n\n            this.$nextTick(() => {\n                this.$router.push({\n                    name: this.nextRoute.name,\n                    params: this.nextRoute.params,\n                });\n            });\n        },\n\n        onCloseLeaveModal() {\n            this.isDisplayingLeavePageWarning = false;\n        },\n\n        onCancelLeaveModal() {\n            this.isDisplayingLeavePageWarning = false;\n        },\n    },\n};\n"],"names":["template","Mixin","EntityCollection","Criteria","index","criteria","to","from","next","items","err","defaultConfig","configFieldCollection","item","newConfigField","response","salesChannelId","searchTerms","searchResults","isEditing"],"mappings":"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"}