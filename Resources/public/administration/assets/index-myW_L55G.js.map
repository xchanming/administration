{"version":3,"file":"index-myW_L55G.js","sources":["../../../app/administration/src/module/sw-settings-search/component/sw-settings-search-excluded-search-terms/sw-settings-search-excluded-search-terms.html.twig","../../../app/administration/src/module/sw-settings-search/component/sw-settings-search-excluded-search-terms/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_settings_search_excluded_search_terms %}\n<sw-card\n    :title=\"$tc('sw-settings-search.generalTab.labelExcludedSearchTerms')\"\n    class=\"sw-settings-search-excluded-search-terms\"\n    position-identifier=\"sw-settings-search-excluded-search-terms\"\n>\n    <template #grid>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_search_excluded_search_terms_empty_state %}\n        <sw-empty-state\n            v-if=\"showEmptyState\"\n            :title=\"$tc('sw-settings-search.generalTab.textEmptyStateExcludedSearchTerms')\"\n            :show-description=\"false\"\n            :has-action-slot=\"true\"\n            :absolute=\"false\"\n            class=\"sw-empty-state\"\n        >\n            <template #icon>\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_search_excluded_search_terms_empty_state_image %}\n                <img\n                    :src=\"assetFilter('administration/static/img/empty-states/settings-empty-state.svg')\"\n                    :alt=\"$tc('sw-settings-search.generalTab.textEmptyStateExcludedSearchTerms')\"\n                >\n                {% endblock %}\n            </template>\n\n            <template #actions>\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_search_excluded_search_terms_empty_state_action %}\n                <sw-button\n                    class=\"sw-settings-search-excluded-search-terms__action-add\"\n                    variant=\"ghost\"\n                    size=\"small\"\n                    :disabled=\"!acl.can('product_search_config.creator')\"\n                    @click=\"addExcludedSearchTerms\"\n                >\n                    {{ $tc('sw-settings-search.generalTab.buttonAddExcludedSearch') }}\n                </sw-button>\n                {% endblock %}\n            </template>\n        </sw-empty-state>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_search_excluded_search_terms_grid %}\n        <div v-if=\"!showEmptyState\">\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_search_excluded_search_terms_header_bar %}\n            <sw-container\n                class=\"sw-settings-search-excluded-search-terms__header-bar\"\n                columns=\"1fr auto\"\n                gap=\"10px\"\n                align=\"center\"\n            >\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_search_excluded_search_terms_filter %}\n                <sw-card-filter\n                    ref=\"itemFilter\"\n                    :placeholder=\"$tc('sw-settings-search.generalTab.textPlaceholderTermsFilter')\"\n                    @sw-card-filter-term-change=\"onSearchTermChange\"\n                />\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_search_excluded_search_terms_actions %}\n                <div class=\"sw-settings-search-excluded-search-terms-group-actions\">\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_settings_search_excluded_search_terms_add_button %}\n                    <sw-button\n                        class=\"sw-settings-search-excluded-search-terms__insert-button\"\n                        variant=\"ghost\"\n                        size=\"small\"\n                        :disabled=\"!acl.can('product_search_config.creator')\"\n                        @click=\"onInsertTerm\"\n                    >\n                        {{ $tc('sw-settings-search.generalTab.buttonAddExcludedSearchTerms') }}\n                    </sw-button>\n                    {% endblock %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_settings_search_excluded_search_terms_reset_button %}\n                    <sw-button\n                        class=\"sw-settings-search-excluded-search-terms__reset-button\"\n                        size=\"small\"\n                        :disabled=\"!acl.can('product_search_config.creator')\"\n                        :is-loading=\"isLoading\"\n                        @click=\"onResetExcludedSearchTermDefault\"\n                    >\n                        {{ $tc('sw-settings-search.generalTab.buttonResetDefault') }}\n                    </sw-button>\n                    {% endblock %}\n                </div>\n                {% endblock %}\n            </sw-container>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_search_excluded_search_terms_grid_list %}\n            <sw-container>\n                <sw-data-grid\n                    v-if=\"items.length !== 0\"\n                    ref=\"dataGrid\"\n                    :data-source=\"items\"\n                    :allow-inline-edit=\"acl.can('product_search_config.editor')\"\n                    :is-loading=\"isLoading || isExcludedTermsLoading\"\n                    :columns=\"getSearchableGeneralColumns\"\n                    class=\"sw-settings-search__grid sw-settings-search-excluded-search-terms_grid\"\n                    @inline-edit-save=\"onSaveEdit\"\n                    @inline-edit-cancel=\"onCancelEdit\"\n                    @select-item=\"selectionChanged\"\n                >\n                    <template #bulk>\n                        <sw-button\n                            variant=\"danger\"\n                            size=\"small\"\n                            :disabled=\"!acl.can('product_search_config.deleter')\"\n                            @click=\"onBulkDeleteExcludedTerm()\"\n                        >\n                            {{ $tc('global.default.delete') }}\n                        </sw-button>\n                    </template>\n\n                    <template #actions=\"{ item }\">\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_search_excluded_terms_column_actions %}\n                        <sw-context-menu-item\n                            variant=\"danger\"\n                            :disabled=\"!acl.can('product_search_config.deleter')\"\n                            @click=\"onDeleteExcludedTerm([item])\"\n                        >\n                            {{ $tc('global.default.delete') }}\n                        </sw-context-menu-item>\n                        {% endblock %}\n                    </template>\n\n                    <template #pagination>\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_search_excluded_terms_list_pagination %}\n                        <sw-pagination\n                            :page=\"page\"\n                            :limit=\"limit\"\n                            :total=\"total\"\n                            :total-visible=\"7\"\n                            @page-change=\"onPagePagination\"\n                        />\n                        {% endblock %}\n                    </template>\n                </sw-data-grid>\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_search_excliuded_terms_no_results %}\n                <div v-if=\"items.length === 0\">\n                    <p class=\"sw-settings-search__no-data-results\">\n                        {{ $tc('sw-settings-search.generalTab.labelExcludedSearchTermsNoResults') }}\n                    </p>\n                </div>\n                {% endblock %}\n            </sw-container>\n            {% endblock %}\n        </div>\n        {% endblock %}\n    </template>\n</sw-card>\n{% endblock %}\n","/**\n * @package buyers-experience\n */\nimport template from './sw-settings-search-excluded-search-terms.html.twig';\nimport './sw-settings-search-excluded-search-terms.scss';\n\nconst { Mixin } = Cicada;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'excludedSearchTermService',\n        'repositoryFactory',\n        'acl',\n    ],\n\n    emits: [\n        'edit-change',\n        'data-load',\n    ],\n\n    mixins: [\n        Mixin.getByName('notification'),\n    ],\n\n    props: {\n        searchConfigs: {\n            type: Object,\n            required: false,\n            default: null,\n        },\n\n        isExcludedTermsLoading: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n    },\n\n    data() {\n        return {\n            items: [],\n            originalItems: [],\n            showEmptyState: false,\n            page: 1,\n            limit: 10,\n            total: 0,\n            searchTerm: '',\n            isLoading: false,\n            isAddingItem: false,\n            responseMessage: '',\n        };\n    },\n\n    computed: {\n        searchRepository() {\n            return this.repositoryFactory.create('product_search_config');\n        },\n\n        getSearchableGeneralColumns() {\n            return [\n                {\n                    property: 'value',\n                    label: 'sw-settings-search.generalTab.textColumnSearchTerm',\n                    inlineEdit: 'string',\n                    sortable: false,\n                },\n            ];\n        },\n\n        assetFilter() {\n            return Cicada.Filter.getByName('asset');\n        },\n    },\n\n    watch: {\n        searchConfigs() {\n            this.createdComponent();\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.isLoading = true;\n            if (\n                this.searchConfigs.excludedTerms === undefined ||\n                this.searchConfigs.excludedTerms === null ||\n                this.searchConfigs.excludedTerms.length <= 0\n            ) {\n                this.resetData();\n                this.showEmptyState = true;\n                this.isLoading = false;\n                return;\n            }\n            this.originalItems = this.searchConfigs.excludedTerms;\n            this.renderComponent();\n        },\n\n        resetData() {\n            this.originalItems = [];\n            this.items = [];\n            this.page = 1;\n            this.total = 0;\n        },\n\n        addExcludedSearchTerms() {\n            this.showEmptyState = false;\n        },\n\n        onInsertTerm() {\n            this.isAddingItem = true;\n            this.searchTerm = '';\n            this.$refs.itemFilter.term = '';\n            this.page = 1;\n            this.renderComponent();\n\n            this.items.unshift({ id: null, value: '' });\n            this.$refs.dataGrid.onDbClickCell(this.items[0]);\n            this.$emit('edit-change', true);\n        },\n\n        renderComponent() {\n            if (this.originalItems.length <= 0) {\n                this.isLoading = false;\n                this.items = [];\n                return;\n            }\n            const all = this.filterItems();\n            this.total = all.length;\n            if (this.total <= 0) {\n                this.items = [];\n                this.showEmptyState = false;\n                this.isLoading = false;\n                return;\n            }\n\n            this.items = this.sliceItems(all);\n            if (this.items.length <= 0) {\n                this.page -= 1;\n                this.renderComponent();\n            }\n            this.showEmptyState = false;\n            this.isLoading = false;\n        },\n\n        filterItems() {\n            return this.originalItems.filter((term) => {\n                return term.search(this.searchTerm) >= 0;\n            });\n        },\n\n        sliceItems(items) {\n            const offset = (this.page - 1) * this.limit;\n            return items.slice(offset, offset + this.limit).map((item, index) => {\n                return { id: index, value: item };\n            });\n        },\n\n        onPagePagination(params) {\n            this.page = params.page;\n            this.limit = params.limit;\n            this.isAddingItem = false;\n            this.renderComponent();\n        },\n\n        onDeleteExcludedTerm(terms) {\n            this.responseMessage = this.$tc('sw-settings-search.notification.deleteExcludedTermSuccess');\n            this.isLoading = true;\n            const values = terms\n                .filter((term) => {\n                    return term.value !== '';\n                })\n                .map((term) => term.value);\n            if (values.length <= 0) {\n                this.renderComponent();\n                return;\n            }\n            this.originalItems = this.originalItems.filter((item) => {\n                return !values.find((term) => term === item);\n            });\n            this.saveConfig();\n        },\n\n        onSearchTermChange(searchTerm) {\n            this.page = 1;\n            this.searchTerm = searchTerm;\n            if (searchTerm === '' && this.isAddingItem) {\n                return;\n            }\n            this.isAddingItem = false;\n            this.renderComponent();\n        },\n\n        selectionChanged(selection) {\n            this.selection = selection;\n        },\n\n        onSaveEdit(term) {\n            this.isLoading = true;\n            // Make sure value is not null\n            if (term.value === '') {\n                this.createNotificationError({\n                    message: this.$tc('sw-settings-search.notification.excludedTermRequired'),\n                });\n                this.renderComponent();\n                return;\n            }\n\n            // Make sure value not exists\n            const originTerm = this.getOriginItem(term);\n            const isExists = this.originalItems.find((item) => {\n                return item === term.value && item !== originTerm;\n            });\n            if (isExists) {\n                this.createNotificationError({\n                    message: this.$tc('sw-settings-search.notification.excludedTermAlreadyExists'),\n                });\n                this.renderComponent();\n                return;\n            }\n\n            if (this.isAddingItem) {\n                this.responseMessage = this.$tc('sw-settings-search.notification.createExcludedTermSuccess');\n                this.originalItems.unshift(term.value);\n                this.saveConfig();\n                return;\n            }\n\n            this.responseMessage = this.$tc('sw-settings-search.notification.updateExcludedTermSuccess');\n            this.originalItems[term.id] = term.value;\n            this.saveConfig();\n        },\n\n        getOriginItem(term) {\n            const all = this.filterItems();\n            const items = this.sliceItems(all);\n            const found = items.find((item) => item.id === term.id);\n\n            if (found) {\n                return found.value;\n            }\n            return null;\n        },\n\n        onCancelEdit() {\n            this.renderComponent();\n            this.$emit('edit-change', false);\n        },\n\n        onBulkDeleteExcludedTerm() {\n            this.onDeleteExcludedTerm(Object.values(this.selection));\n        },\n\n        saveConfig() {\n            this.searchConfigs.excludedTerms = this.originalItems;\n\n            return this.searchRepository\n                .save(this.searchConfigs)\n                .then(() => {\n                    this.createNotificationSuccess({\n                        message: this.responseMessage,\n                    });\n                    this.isAddingItem = false;\n                    this.renderComponent();\n                    this.$emit('edit-change', false);\n                })\n                .catch((error) => {\n                    this.createNotificationError({\n                        message: error,\n                    });\n                })\n                .finally(() => {\n                    this.isLoading = false;\n                });\n        },\n\n        onResetExcludedSearchTermDefault() {\n            this.excludedSearchTermService\n                .resetExcludedSearchTerm()\n                .then(() => {\n                    this.createNotificationSuccess({\n                        message: this.$tc('sw-settings-search.notification.resetToDefaultExcludedTermSuccess'),\n                    });\n                    this.$emit('data-load');\n                })\n                .catch(() => {\n                    this.createNotificationError({\n                        message: this.$tc('sw-settings-search.notification.resetToDefaultExcludedTermError'),\n                    });\n                });\n        },\n    },\n};\n"],"names":["template","Mixin","index","all","term","items","offset","item","params","terms","values","searchTerm","selection","originTerm","found","error"],"mappings":"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"}