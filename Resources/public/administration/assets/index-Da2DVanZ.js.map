{"version":3,"file":"index-Da2DVanZ.js","sources":["../../../app/administration/src/module/sw-promotion-v2/component/sw-promotion-v2-cart-condition-form/sw-promotion-v2-cart-condition-form.html.twig","../../../app/administration/src/module/sw-promotion-v2/component/sw-promotion-v2-cart-condition-form/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_promotion_v2_cart_condition_form %}\n<div class=\"sw-promotion-v2-cart-condition-form\">\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_cart_condition_form_rules_field %}\n    <sw-promotion-v2-rule-select\n        v-if=\"promotion\"\n        v-model:collection=\"promotion.cartRules\"\n        class=\"sw-promotion-v2-cart-condition-form__rule-select-cart\"\n        :local-mode=\"promotion.isNew()\"\n        :criteria=\"ruleFilter\"\n        :label=\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelCartConditionSelect')\"\n        :placeholder=\"$tc('sw-promotion-v2.detail.conditions.preConditions.placeholderCartConditionSelect')\"\n        :rule-scope=\"['checkout', 'global', 'lineItem']\"\n        rule-aware-group-key=\"cartPromotions\"\n        :disabled=\"isEditingDisabled\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_cart_condition_form_use_setgroups_field %}\n    <sw-switch-field\n        v-model:value=\"promotion.useSetGroups\"\n        class=\"sw-promotion-v2-cart-condition-form__use-setgroups\"\n        :disabled=\"!acl.can('promotion.editor')\"\n        :label=\"$tc('sw-promotion-v2.detail.conditions.setgroups.switchGroupsEnabled')\"\n    />\n    {% endblock %}\n\n    <template v-if=\"promotion.useSetGroups\">\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_cart_condition_setgroup_card %}\n        <sw-card\n            v-for=\"(group, index) in promotion.setgroups\"\n            :id=\"`sw-promotion-v2-cart-condition-form__setgroup-card-${index + 1}`\"\n            :key=\"group.id\"\n            position-identifier=\"sw-promotion-cart-condition-setgroup\"\n            class=\"sw-promotion-v2-cart-condition-form__setgroup-card\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_cart_condition_setgroup_card_context_action %}\n            <template #context-actions>\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_promotion_v2_cart_condition_setgroup_card_context_action_duplicate %}\n                <sw-context-menu-item\n                    :disabled=\"isEditingDisabled\"\n                    @click=\"duplicateSetGroup(group)\"\n                >\n                    {{ $tc('global.default.duplicate') }}\n                </sw-context-menu-item>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_promotion_v2_cart_condition_setgroup_card_context_action_delete %}\n                <sw-context-menu-item\n                    v-tooltip=\"{\n                        message: $tc('sw-privileges.tooltip.warning'),\n                        disabled: acl.can('promotion.editor'),\n                        showOnDisabledElements: true\n                    }\"\n                    variant=\"danger\"\n                    :disabled=\"isEditingDisabled\"\n                    @click=\"deleteSetGroup(group)\"\n                >\n                    {{ $tc('global.default.delete') }}\n                </sw-context-menu-item>\n                {% endblock %}\n\n            </template>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_cart_condition_setgroup_card_title %}\n            <div class=\"sw-promotion-v2-cart-condition-form__setgroup-card-title\">\n                {{ $tc('sw-promotion-v2.detail.conditions.setgroups.titleName') }} {{ index + 1 }}\n            </div>\n            {% endblock %}\n\n            <sw-container\n                columns=\"1fr 1fr\"\n                gap=\"0px 30px\"\n            >\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_promotion_v2_cart_condition_setgroup_mode_field %}\n                <sw-select-field\n                    v-model:value=\"group.packagerKey\"\n                    class=\"sw-promotion-v2-cart-condition-form__setgroup-mode\"\n                    :label=\"$tc('sw-promotion-v2.detail.conditions.setgroups.labelMode')\"\n                    :disabled=\"isEditingDisabled\"\n                >\n                    <option\n                        v-for=\"packager in packagers\"\n                        :key=\"packager.key\"\n                        :value=\"packager.key\"\n                    >\n                        {{ packager.name }}\n                    </option>\n                </sw-select-field>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_promotion_v2_cart_condition_setgroup_value_field %}\n                <sw-number-field\n                    v-model:value=\"group.value\"\n                    class=\"sw-promotion-v2-cart-condition-form__setgroup-value\"\n                    :label=\"$tc('sw-promotion-v2.detail.conditions.setgroups.labelValue')\"\n                    :disabled=\"isEditingDisabled\"\n                />\n                {% endblock %}\n\n            </sw-container>\n\n            <sw-container\n                columns=\"1fr 1fr\"\n                gap=\"0px 30px\"\n            >\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_promotion_v2_cart_condition_setgroup_sorting_field %}\n                <sw-select-field\n                    v-model:value=\"group.sorterKey\"\n                    class=\"sw-promotion-v2-cart-condition-form__setgroup-sorting\"\n                    :label=\"$tc('sw-promotion-v2.detail.conditions.setgroups.labelSorting')\"\n                    :disabled=\"isEditingDisabled\"\n                >\n                    <option\n                        v-for=\"sorter in sorters\"\n                        :key=\"sorter.key\"\n                        :value=\"sorter.key\"\n                    >\n                        {{ sorter.name }}\n                    </option>\n                </sw-select-field>\n                {% endblock %}\n\n            </sw-container>\n\n            <sw-container\n                columns=\"1fr\"\n                gap=\"0px 30px\"\n            >\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_promotion_v2_cart_condition_setgroup_rules_field %}\n                <sw-promotion-v2-rule-select\n                    v-model:collection=\"group.setGroupRules\"\n                    class=\"sw-promotion-v2-cart-condition-form__setgroup-rules\"\n                    :label=\"$tc('sw-promotion-v2.detail.conditions.setgroups.labelRules')\"\n                    :placeholder=\"$tc('sw-promotion-v2.detail.conditions.setgroups.placeholder')\"\n                    :criteria=\"ruleFilter\"\n                    :rule-scope=\"['checkout', 'global', 'lineItem']\"\n                    :disabled=\"isEditingDisabled\"\n                    rule-aware-group-key=\"promotionSetGroups\"\n                />\n                {% endblock %}\n\n            </sw-container>\n        </sw-card>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_cart_condition_add_group_button %}\n        <div class=\"sw-promotion-v2-cart-condition-form__add-group-button-container\">\n            <sw-button\n                variant=\"ghost\"\n                class=\"sw-promotion-v2-cart-condition-form__add-group-button\"\n                :disabled=\"isEditingDisabled\"\n                @click=\"addSetGroup\"\n            >\n                {{ $tc('sw-promotion-v2.detail.conditions.setgroups.buttonAddGroup') }}\n            </sw-button>\n        </div>\n        {% endblock %}\n\n    </template>\n</div>\n{% endblock %}\n","/**\n * @package checkout\n */\nimport './sw-promotion-v2-cart-condition-form.scss';\nimport template from './sw-promotion-v2-cart-condition-form.html.twig';\n\nconst { Criteria } = Cicada.Data;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n        'promotionSyncService',\n        'feature',\n    ],\n\n    props: {\n        promotion: {\n            type: Object,\n            required: false,\n            default: null,\n        },\n\n        restrictedRules: {\n            type: Array,\n            required: false,\n            default() {\n                return [];\n            },\n        },\n    },\n    data() {\n        return {\n            packagerKeys: [],\n            sorterKeys: [],\n        };\n    },\n    computed: {\n        promotionGroupRepository() {\n            return this.repositoryFactory.create('promotion_setgroup');\n        },\n\n        ruleFilter() {\n            const criteria = new Criteria(1, 25);\n\n            criteria.addAssociation('conditions').addSorting(Criteria.sort('name', 'ASC', false));\n\n            return criteria;\n        },\n\n        packagers() {\n            const result = [];\n\n            this.packagerKeys.forEach((keyValue) => {\n                result.push({\n                    key: keyValue,\n                    name: this.$tc(`sw-promotion-v2.detail.conditions.setgroups.packager.${keyValue}`),\n                });\n            });\n            return result;\n        },\n\n        sorters() {\n            const result = [];\n\n            this.sorterKeys.forEach((keyValue) => {\n                result.push({\n                    key: keyValue,\n                    name: this.$tc(`sw-promotion-v2.detail.conditions.setgroups.sorter.${keyValue}`),\n                });\n            });\n\n            return result;\n        },\n\n        isEditingDisabled() {\n            return this.promotion === null || !this.acl.can('promotion.editor');\n        },\n    },\n\n    watch: {\n        promotion() {\n            this.loadSetGroups();\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            if (this.promotion) {\n                this.loadSetGroups();\n            }\n\n            this.promotionSyncService.loadPackagers().then((keys) => {\n                this.packagerKeys = keys;\n            });\n\n            this.promotionSyncService.loadSorters().then((keys) => {\n                this.sorterKeys = keys;\n            });\n        },\n\n        loadSetGroups() {\n            const criteria = new Criteria(1, 25);\n            criteria.addFilter(Criteria.equals('promotionId', this.promotion.id));\n\n            this.promotionGroupRepository.search(criteria).then((groups) => {\n                this.promotion.setgroups = groups;\n            });\n        },\n\n        addSetGroup() {\n            const newGroup = this.promotionGroupRepository.create();\n            newGroup.promotionId = this.promotion.id;\n            newGroup.value = 2;\n            newGroup.packagerKey = 'COUNT';\n            newGroup.sorterKey = 'PRICE_ASC';\n\n            this.promotion.setgroups.push(newGroup);\n        },\n\n        duplicateSetGroup(group) {\n            const newGroup = this.promotionGroupRepository.create();\n            newGroup.promotionId = group.promotionId;\n            newGroup.value = group.value;\n            newGroup.packagerKey = group.packagerKey;\n            newGroup.sorterKey = group.sorterKey;\n\n            this.promotion.setgroups.push(newGroup);\n        },\n\n        deleteSetGroup(group) {\n            // add to delete list for the save process\n            const deleteIds = Cicada.State.get('swPromotionDetail').setGroupIdsDelete;\n            deleteIds.push(group.id);\n            Cicada.State.commit('swPromotionDetail/setSetGroupIdsDelete', deleteIds);\n\n            // remove also from entity for the view rendering\n            this.promotion.setgroups = this.promotion.setgroups.filter((setGroup) => {\n                return setGroup.id !== group.id;\n            });\n        },\n    },\n};\n"],"names":["template","Criteria","index","criteria","result","keyValue","keys","groups","newGroup","group","deleteIds","setGroup"],"mappings":"AAAA,MAAeA,EAAA,oiJCMT,CAAE,SAAAC,CAAQ,EAAK,OAAO,KAGbC,EAAA,CACX,SAAAF,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,oBACA,MACA,uBACA,SACH,EAED,MAAO,CACH,UAAW,CACP,KAAM,OACN,SAAU,GACV,QAAS,IACZ,EAED,gBAAiB,CACb,KAAM,MACN,SAAU,GACV,SAAU,CACN,MAAO,EACV,CACJ,CACJ,EACD,MAAO,CACH,MAAO,CACH,aAAc,CAAE,EAChB,WAAY,CAAE,CAC1B,CACK,EACD,SAAU,CACN,0BAA2B,CACvB,OAAO,KAAK,kBAAkB,OAAO,oBAAoB,CAC5D,EAED,YAAa,CACT,MAAMG,EAAW,IAAIF,EAAS,EAAG,EAAE,EAEnC,OAAAE,EAAS,eAAe,YAAY,EAAE,WAAWF,EAAS,KAAK,OAAQ,MAAO,EAAK,CAAC,EAE7EE,CACV,EAED,WAAY,CACR,MAAMC,EAAS,CAAA,EAEf,YAAK,aAAa,QAASC,GAAa,CACpCD,EAAO,KAAK,CACR,IAAKC,EACL,KAAM,KAAK,IAAI,wDAAwDA,CAAQ,EAAE,CACrG,CAAiB,CACjB,CAAa,EACMD,CACV,EAED,SAAU,CACN,MAAMA,EAAS,CAAA,EAEf,YAAK,WAAW,QAASC,GAAa,CAClCD,EAAO,KAAK,CACR,IAAKC,EACL,KAAM,KAAK,IAAI,sDAAsDA,CAAQ,EAAE,CACnG,CAAiB,CACjB,CAAa,EAEMD,CACV,EAED,mBAAoB,CAChB,OAAO,KAAK,YAAc,MAAQ,CAAC,KAAK,IAAI,IAAI,kBAAkB,CACrE,CACJ,EAED,MAAO,CACH,WAAY,CACR,KAAK,cAAa,CACrB,CACJ,EAED,SAAU,CACN,KAAK,iBAAgB,CACxB,EAED,QAAS,CACL,kBAAmB,CACX,KAAK,WACL,KAAK,cAAa,EAGtB,KAAK,qBAAqB,cAAe,EAAC,KAAME,GAAS,CACrD,KAAK,aAAeA,CACpC,CAAa,EAED,KAAK,qBAAqB,YAAa,EAAC,KAAMA,GAAS,CACnD,KAAK,WAAaA,CAClC,CAAa,CACJ,EAED,eAAgB,CACZ,MAAMH,EAAW,IAAIF,EAAS,EAAG,EAAE,EACnCE,EAAS,UAAUF,EAAS,OAAO,cAAe,KAAK,UAAU,EAAE,CAAC,EAEpE,KAAK,yBAAyB,OAAOE,CAAQ,EAAE,KAAMI,GAAW,CAC5D,KAAK,UAAU,UAAYA,CAC3C,CAAa,CACJ,EAED,aAAc,CACV,MAAMC,EAAW,KAAK,yBAAyB,OAAM,EACrDA,EAAS,YAAc,KAAK,UAAU,GACtCA,EAAS,MAAQ,EACjBA,EAAS,YAAc,QACvBA,EAAS,UAAY,YAErB,KAAK,UAAU,UAAU,KAAKA,CAAQ,CACzC,EAED,kBAAkBC,EAAO,CACrB,MAAMD,EAAW,KAAK,yBAAyB,OAAM,EACrDA,EAAS,YAAcC,EAAM,YAC7BD,EAAS,MAAQC,EAAM,MACvBD,EAAS,YAAcC,EAAM,YAC7BD,EAAS,UAAYC,EAAM,UAE3B,KAAK,UAAU,UAAU,KAAKD,CAAQ,CACzC,EAED,eAAeC,EAAO,CAElB,MAAMC,EAAY,OAAO,MAAM,IAAI,mBAAmB,EAAE,kBACxDA,EAAU,KAAKD,EAAM,EAAE,EACvB,OAAO,MAAM,OAAO,yCAA0CC,CAAS,EAGvE,KAAK,UAAU,UAAY,KAAK,UAAU,UAAU,OAAQC,GACjDA,EAAS,KAAOF,EAAM,EAChC,CACJ,CACJ,CACL"}