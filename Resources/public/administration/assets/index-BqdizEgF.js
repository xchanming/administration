const o=`{% block sw_cms_element_product_listing_config %} <div class="sw-cms-el-config-product-listing"> <sw-tabs position-identifier="sw-cms-element-config-product-listing" default-item="content" > <template #default="{ active }"> <sw-tabs-item class="sw-cms-el-config-product-listing__tab-content" name="content" :active-tab="active" > {{ $tc('sw-cms.elements.general.config.tab.content') }} </sw-tabs-item> <sw-tabs-item class="sw-cms-el-config-product-listing__tab-sorting" name="sorting" :active-tab="active" > {{ $tc('sw-cms.elements.productListing.config.tab.sorting') }} </sw-tabs-item> <sw-tabs-item class="sw-cms-el-config-product-listing__tab-filter" name="filter" :active-tab="active" > {{ $tc('sw-cms.elements.productListing.config.tab.filter') }} </sw-tabs-item> </template> <template #content="{ active }" > <template v-if="active === 'content'"> {% block sw_cms_element_product_listing_config_layout_select %} <sw-select-field v-model:value="element.config.boxLayout.value" :label="$tc('sw-cms.elements.productBox.config.label.layoutType')" > {% block sw_cms_element_product_listing_config_layout_select_options %} <option value="standard"> {{ $tc('sw-cms.elements.productBox.config.label.layoutTypeStandard') }} </option> <option value="image"> {{ $tc('sw-cms.elements.productBox.config.label.layoutTypeImage') }} </option> <option value="minimal"> {{ $tc('sw-cms.elements.productBox.config.label.layoutTypeMinimal') }} </option> {% endblock %} </sw-select-field> {% endblock %} {% block sw_cms_element_product_listing_config_info %} <mt-banner variant="info"> {{ $tc('sw-cms.elements.general.config.infoText.listingElement') }} </mt-banner> {% endblock %} </template> <template v-if="active === 'sorting'"> {% block sw_cms_element_product_listing_config_show_sorting %} <sw-switch-field v-model:value="element.config.showSorting.value" :label="$tc('sw-cms.elements.productListing.config.sorting.labelShowSorting')" /> {% endblock %} {% block sw_cms_element_product_listing_config_use_default_sorting %} <sw-switch-field v-model:value="element.config.useCustomSorting.value" :label="$tc('sw-cms.elements.productListing.config.sorting.labelUseCustomSortings')" :help-text="$tc('sw-cms.elements.productListing.config.sorting.helpTextUseCustomSortings')" class="sw-cms-el-config-product-listing-custom-sortings" /> {% endblock %} {% block sw_cms_element_product_listing_config_default_sorting %} <sw-entity-single-select v-if="showSortingGrid" class="sw-cms-element-config-product-listing__sorting-default-select" entity="product_sorting" label-property="label" show-clearable-button :value="defaultSorting.id" :label="$tc('sw-cms.elements.productListing.config.sorting.labelDefaultSorting')" :help-text="$tc('sw-cms.elements.productListing.config.sorting.helpTextDefaultSorting')" :criteria="allProductSortingsCriteria" :placeholder="$tc('sw-cms.elements.productListing.config.sorting.placeholderDefaultProductSorting')" @option-select="onDefaultSortingChange" /> {% endblock %} {% block sw_cms_element_product_listing_config_available_sortings %} <sw-entity-multi-select v-if="showSortingGrid" v-model:entity-collection="productSortings" class="sw-cms-el-config-product-listing-config-sorting-grid__select" :label="$tc('sw-cms.elements.productListing.config.sorting.labelProductSortings')" label-property="label" :criteria="allProductSortingsCriteria" :hide-labels="true" :placeholder="$tc('sw-cms.elements.productListing.config.sorting.placeHolderProductSortings')" > <template #result-item="{ item, index, labelProperty, valueProperty, searchTerm, highlightSearchTerm, isSelected, addItem, getKey }"> <slot name="result-item" v-bind="{ item, index, labelProperty, valueProperty: 'id', searchTerm, highlightSearchTerm, isSelected, addItem, getKey }" > <sw-select-result v-tooltip="{ showDelay: 300, message: $tc('sw-cms.elements.productListing.config.sorting.defaultSortingInUse'), disabled: !isDefaultSorting(item) }" :selected="isSelected(item)" :disabled="isDefaultSorting(item)" v-bind="{ item, index }" @item-select="addItem" > {% block sw_entity_multi_select_base_results_list_result_label %} <slot name="result-label-property" v-bind="{ item, index, labelProperty, valueProperty: 'id', searchTerm, highlightSearchTerm, getKey }" > <sw-highlight-text v-if="highlightSearchTerm" :text="getKey(item,labelProperty) || getKey(item, \`translated.\${labelProperty}\`)" :search-term="searchTerm" /> <template v-else> {{ getKey(item,labelProperty) || getKey(item, \`translated.\${labelProperty}\`) }} </template> </slot> {% endblock %} </sw-select-result> </slot> </template> </sw-entity-multi-select> {% endblock %} {% block sw_cms_element_product_listing_config_sorting_grid %} <sw-cms-el-config-product-listing-config-sorting-grid v-if="showSortingGrid" :product-sortings="productSortings" :default-sorting="defaultSorting" /> {% endblock %} </template> <template v-if="active === 'filter'"> {% block sw_cms_element_product_listing_config_filter_info %} <mt-banner variant="info"> {{ $tc('sw-cms.elements.productListing.config.filter.infoText') }} </mt-banner> {% endblock %} {% block sw_cms_element_product_listing_config_filter_by_wrapper %} <sw-container columns="1fr 1fr" gap="0px 30px" > {% block sw_cms_element_product_listing_config_filter_by_manufacturer %} <sw-switch-field v-model:value="filterByManufacturer" :label="$tc('sw-cms.elements.productListing.config.filter.labelFilterByManufacturer')" /> {% endblock %} {% block sw_cms_element_product_listing_config_filter_by_rating %} <sw-switch-field v-model:value="filterByRating" :label="$tc('sw-cms.elements.productListing.config.filter.labelFilterByRating')" /> {% endblock %} {% block sw_cms_element_product_listing_config_filter_by_price %} <sw-switch-field v-model:value="filterByPrice" :label="$tc('sw-cms.elements.productListing.config.filter.labelFilterByPrice')" /> {% endblock %} {% block sw_cms_element_product_listing_config_filter_for_free_shipping %} <sw-switch-field v-model:value="filterByFreeShipping" :label="$tc('sw-cms.elements.productListing.config.filter.labelFilterForFreeShipping')" /> {% endblock %} </sw-container> {% endblock %} {% block sw_cms_element_product_listing_config_filter_properties_wrapper %} <div> {% block sw_cms_element_product_listing_config_filter_spacer %} <hr class="spacer"> {% endblock %} {% block sw_cms_element_product_listing_config_filter_properties_as_filter %} {% block sw_cms_element_product_listing_config_filter_properties_as_filter_switch %} <sw-switch-field v-model:value="filterByProperties" :label="$tc('sw-cms.elements.productListing.config.filter.labelUseFilterByProperties')" :help-text="$tc('sw-cms.elements.productListing.config.filter.helpTextUseFilterByProperties')" /> {% endblock %} {% block sw_cms_element_product_listing_config_filter_properties_as_filter_info_text %} <div class="sw-cms-el-config-product-listing-filter_properties_as_filter__description-text" v-html="$tc('sw-cms.elements.productListing.config.filter.descriptionTextUseFilterByProperties')" ></div> {% endblock %} {% endblock %} {% block sw_cms_element_product_listing_config_filter_property_search %} <sw-simple-search-field v-model:value="filterPropertiesTerm" class="sw-cms-element-product-listing-config-filter-property-search" variant="form" :disabled="showFilterGrid" @search-term-change="onFilterProperties" /> {% endblock %} {% block sw_cms_element_product_listing_config_filter_property_grid %} <div v-if="showPropertySelection" class="sw-cms-el-config-product-listing-property-grid" :class="gridClasses" > <sw-data-grid :data-source="properties" :columns="gridColumns" :compact-mode="true" :allow-inline-edit="false" :show-actions="false" :show-selection="false" plain-appearance > <template #column-status="{ item, column }"> {% block sw_cms_element_product_listing_config_filter_property_grid_column_status %} <sw-switch-field :disabled="column.disabled" :value="item.active" @update:value="propertyStatusChanged($event, item.id)" /> {% endblock %} </template> <template #pagination> {% block sw_cms_element_product_listing_config_filter_property_grid_pagination %} <sw-pagination v-if="!disabled" :page="propertiesPage" :limit="propertiesLimit" :total="propertiesTotal" :auto-hide="false" :steps="[]" @page-change="onPropertiesPageChange" /> {% endblock %} </template> </sw-data-grid> </div> {% endblock %} {% block sw_cms_element_product_listing_config_filter_empty_state %} <sw-empty-state v-else :absolute="false" :title="$tc('sw-cms.elements.productListing.config.filter.gridEmptyStateLabel')" :subline="$tc('sw-cms.elements.productListing.config.filter.gridEmptyStateHint')" > <template #icon> <img :src="assetFilter('/administration/static/img/empty-states/products-empty-state.svg')" alt="$tc('sw-cms.elements.productListing.config.filter.gridEmptyStateLabel')" > </template> </sw-empty-state> {% endblock %} </div> {% endblock %} </template> </template> </sw-tabs> </div> {% endblock %}`,{Mixin:n}=Shopware,{Criteria:i,EntityCollection:c}=Shopware.Data,a={template:o,inject:["repositoryFactory","feature"],mixins:[n.getByName("cms-element")],data(){return{productSortings:[],defaultSorting:{},filters:[],filterPropertiesTerm:"",properties:[],propertiesPage:1,propertiesLimit:6,propertiesTotal:0}},computed:{showSortingGrid(){return this.element.config.useCustomSorting.value},showFilterGrid(){return!this.filterByProperties},productSortingRepository(){return this.repositoryFactory.create("product_sorting")},propertyRepository(){return this.repositoryFactory.create("property_group")},productSortingsCriteria(){const e=new i(1,25);return e.addFilter(i.equalsAny("id",[...Object.keys(this.productSortingsConfigValue)])),e.addSorting(i.sort("priority","desc")),e},propertyCriteria(){const e=new i(this.propertiesPage,this.propertiesLimit);return e.setTerm(this.filterPropertiesTerm),e.addSorting(i.sort("name","ASC",!1)),e.addFilter(i.equals("filterable",!0)),e},allProductSortingsCriteria(){const e=new i(1,25);return e.addFilter(i.equals("locked",!1)),e},excludedDefaultSortingCriteria(){const e=new i(1,25);return this.defaultSorting.id&&e.addFilter(i.not("AND",[i.equals("id",this.defaultSorting.id)])),e.addFilter(i.equals("locked",!1)),e},productSortingsConfigValue(){return this.element.config.availableSortings.value},filterByManufacturer:{get(){return this.isActiveFilter("manufacturer-filter")},set(e){this.updateFilters("manufacturer-filter",e)}},filterByRating:{get(){return this.isActiveFilter("rating-filter")},set(e){this.updateFilters("rating-filter",e)}},filterByPrice:{get(){return this.isActiveFilter("price-filter")},set(e){this.updateFilters("price-filter",e)}},filterByFreeShipping:{get(){return this.isActiveFilter("shipping-free-filter")},set(e){this.updateFilters("shipping-free-filter",e)}},filterByProperties:{get(){return!this.isActiveFilter("property-filter")},set(e){this.updateFilters("property-filter",!e),this.sortProperties(this.properties)}},showPropertySelection(){return!this.properties.length<1},gridColumns(){return[{property:"status",label:"sw-cms.elements.productListing.config.filter.gridHeaderStatus",disabled:this.showFilterGrid,width:"70px"},{property:"name",label:"sw-cms.elements.productListing.config.filter.gridHeaderName"}]},gridClasses(){return{"is--disabled":this.showFilterGrid}},assetFilter(){return Shopware.Filter.getByName("asset")}},watch:{productSortings:{handler(){this.element.config.availableSortings.value=this.transformProductSortings()},deep:!0},defaultSorting(){Object.keys(this.defaultSorting).length===0?this.element.config.defaultSorting.value="":this.element.config.defaultSorting.value=this.defaultSorting.id}},created(){this.createdComponent()},methods:{createdComponent(){this.initElementConfig("product-listing"),Object.keys(this.productSortingsConfigValue).length===0?this.productSortings=new c(this.productSortingRepository.route,this.productSortingRepository.schema.entity,Shopware.Context.api,this.productSortingsCriteria):this.fetchProductSortings().then(e=>{this.productSortings=e}),this.initDefaultSorting(),this.unpackFilters(),this.loadFilterableProperties()},fetchProductSortings(){return this.productSortingRepository.search(this.productSortingsCriteria).then(e=>this.updateValuesFromConfig(e))},updateValuesFromConfig(e){return Object.entries(this.productSortingsConfigValue).forEach(([t,r])=>{const s=e.find(l=>l.id===t);s&&(s.priority=r)}),e},transformProductSortings(){if(this.productSortings.length===0)return[];const e={};return this.productSortings.forEach(t=>{e[t.id]=t.priority}),e},initDefaultSorting(){const e=this.element.config.defaultSorting.value;if(e!==""){const t=new i(1,25);t.addFilter(i.equals("id",e)),this.productSortingRepository.search(t).then(r=>{this.defaultSorting=r.first()||{}})}},loadFilterableProperties(){return this.propertyRepository.search(this.propertyCriteria).then(e=>{this.propertiesTotal=e.total,this.properties=this.sortProperties(e)})},sortProperties(e){return e.forEach(t=>{if(!this.filterByProperties){t.active=!0;return}t.active=this.element.config.propertyWhitelist.value.includes(t.id)}),e.sort((t,r)=>t.active===r.active||!t.active==!r.active?0:t.active?-1:1),e},onDefaultSortingChange(e,t){if(!t){this.defaultSorting={};return}this.productSortings.has(t.id)||this.productSortings.add(t),this.defaultSorting=t},isDefaultSorting(e){return this.defaultSorting.id===e.id},isActiveFilter(e){return this.filters.includes(e)},updateFilters(e,t){t?this.filters=[...this.filters,e]:this.filters=this.filters.reduce((r,s)=>s===e?r:[...r,s],[]),this.element.config.filters.value=this.filters.join()},unpackFilters(){if(this.element.config.filters===void 0)return;const e=this.element.config.filters.value;e===null||e===""||(this.filters=e.split(","))},onFilterProperties(){return this.propertiesPage=1,this.loadFilterableProperties()},onPropertiesPageChange({limit:e,page:t}){return this.propertiesLimit=e,this.propertiesPage=t,this.loadFilterableProperties()},propertyStatusChanged(e,t){const r=this.element.config.propertyWhitelist.value;if(e){this.element.config.propertyWhitelist.value=[...r,t];return}this.element.config.propertyWhitelist.value=r.reduce((s,l)=>l===t?s:[...s,l],[])}}};export{a as default};
