const x=`{% block sw_flow_trigger %} <div class="sw-flow-trigger" :class="swFlowTriggerClasses" > {% block sw_flow_trigger_select_field %} <div class="sw-flow-trigger__select-toolbar"> <sw-contextual-field v-tooltip="{ message: getEventName(eventName), disabled: !eventName || isUnknownTrigger, }" class="sw-flow-trigger__search-field" :required="!isTemplate" :label="$tc('sw-flow.detail.trigger.name')" :disabled="disabled" :error="flowEventNameError" > <template #sw-field-input="{ identification, disabled, error, size, setFocusClass, removeFocusClass }"> {% block sw_flow_trigger_select_field_input %} <input ref="searchInput" v-model="searchTerm" type="text" class="sw-flow-trigger__input-field" :placeholder="triggerNamePlaceholder" :disabled="disabled" @focus="openDropdown({ setFocusClass, removeFocusClass });" > {% endblock %} {% block sw_flow_trigger_loader %} <sw-loader v-if="isLoading" class="sw-flow-trigger__loader" size="16px" /> {% endblock %} {% block sw_flow_trigger_dropdown_icon %} <sw-icon class="sw-flow-trigger__dropdown-icon" name="regular-chevron-down-xs" size="10px" @click="openDropdown({ setFocusClass, removeFocusClass });" /> {% endblock %} </template> </sw-contextual-field> </div> {% endblock %} {% block sw_flow_trigger_select_transition %} <transition name="sw-flow-trigger__fade-down"> {% block sw_flow_trigger_event_selection %} <div v-if="isExpanded" class="sw-flow-trigger__event-selection" > {% block sw_flow_trigger_container %} <sw-container class="sw-flow-trigger__event-container"> {% block sw_flow_trigger_select_tree %} <sw-tree v-if="showTreeView" ref="flowTriggerTree" :active-tree-item-id="eventName" route-params-active-element-id="eventName" :sortable="false" :items="eventTree" :searchable="false" :disable-context-menu="true" :on-change-route="changeTrigger" bind-items-to-folder > {% block sw_flow_trigger_tree_headline %} <template #headline> <span></span> </template> {% endblock %} {% block sw_flow_trigger_tree_search %} <template #search> <span></span> </template> {% endblock %} <template #items="{ treeItems, sortable, disableContextMenu, onChangeRoute, newElementId, checkItem }" > <sw-tree-item v-for="item in treeItems" :key="item.id" should-focus :active-focus-id="selectedTreeItem.id" :sortable="sortable" :item="item" :on-change-route="onChangeRoute" :display-checkbox="false" @check-item="checkItem" > {% block sw_flow_trigger_tree_item_actions %} <template #actions> <span></span> </template> {% endblock %} </sw-tree-item> </template> </sw-tree> {% endblock %} {% block sw_flow_trigger_search_list %} <ul v-else-if="searchResult.length > 0 && searchTerm.length > 0" class="sw-flow-trigger__search-results" > {% block sw_flow_trigger_search_list_item %} <li v-for="item in searchResult" :key="item.id" class="sw-flow-trigger__search-result" :class="{ 'is--focus': isSearchResultInFocus(item)}" role="button" tabindex="0" @click="onClickSearchItem(item)" @keydown.enter="onClickSearchItem(item)" > {% block sw_flow_trigger_search_list_item_icon %} <div class="sw-flow-trigger__search-result-icon"> <sw-icon name="regular-circle-xxs" size="18" /> </div> {% endblock %} {% block sw_flow_trigger_search_list_item_name %} <span class="sw-flow-trigger__search-result-name"> {% block sw_flow_trigger_search_list_item_name_highlight %} <sw-highlight-text :search-term="searchTerm" :text="getEventName(item.name)" /> {% endblock %} </span> {% endblock %} </li> {% endblock %} </ul> {% endblock %} {% block sw_flow_trigger_search_empty %} <p v-else class="sw-flow-trigger__empty" > {{ $tc('sw-flow.detail.trigger.textNoEvent') }} </p> {% endblock %} </sw-container> {% endblock %} </div> {% endblock %} </transition> {% endblock %} {% block sw_flow_event_change_confirm_modal %} <sw-flow-event-change-confirm-modal v-if="showConfirmModal" @modal-confirm="onConfirm" @modal-close="onCloseConfirm" /> {% endblock %} </div> {% endblock %}`,{Component:F,State:w}=Cicada,{mapPropertyErrors:R,mapState:D,mapGetters:L}=F.getComponentHelper(),S=Cicada.Utils,{camelCase:$,capitalizeString:A}=Cicada.Utils.string,{isEmpty:y}=S.types,B={template:x,compatConfig:Cicada.compatConfig,inject:["repositoryFactory","businessEventService"],emits:["option-select"],props:{overlay:{type:Boolean,required:!1,default:!0},disabled:{type:Boolean,required:!1,default:!1},eventName:{type:String,required:!0},isUnknownTrigger:{type:Boolean,required:!1,default:!1}},data(){return{isExpanded:!1,isLoading:!1,searchTerm:"",searchResult:[],searchResultFocusItem:{},selectedTreeItem:{},setInputFocusClass:null,removeInputFocusClass:null,showConfirmModal:!1,triggerSelect:{}}},computed:{swFlowTriggerClasses(){return{overlay:this.overlay}},formatEventName(){return this.eventName?this.getEventName(this.eventName):this.eventName},showTreeView(){return this.eventTree.length>=0&&(this.searchTerm.length<=0||this.searchTerm===this.formatEventName)},eventTree(){return this.getEventTree(this.triggerEvents)},isTemplate(){var t;return((t=this.$route.query)==null?void 0:t.type)==="template"},triggerNamePlaceholder(){return this.isUnknownTrigger?this.$tc("sw-flow.detail.trigger.unknownTriggerPlaceholder"):this.$tc("sw-flow.detail.trigger.placeholder")},...D("swFlowState",["flow","triggerEvents"]),...L("swFlowState",["isSequenceEmpty"]),...R("flow",["eventName"])},watch:{eventName:{immediate:!0,handler(t){t&&(this.$route.params.eventName=t,this.searchTerm=this.getEventName(t))}},searchTerm(t){if(!t||t===this.formatEventName)return;const e=t.split(/[\W_]+/gi);this.searchResult=this.triggerEvents.filter(r=>{const s=this.getEventName(r.name).toLowerCase();return e.every(i=>s.includes(i.toLowerCase()))}),this.searchResult.length>0&&(this.searchResultFocusItem=this.searchResult[0])},selectedTreeItem(t){t!=null&&t.id&&S.debounce(()=>{const e=this.findTreeItemVNodeById(t.id).$el;if(!e)return;let r=0,s=!1,i=e;for(;!s&&i;)i.classList.contains("sw-tree__content")?s=!0:(r+=i.offsetTop,i=i.offsetParent);i==null||i.scrollTo({top:r-i.clientHeight/2-50,behavior:"smooth"})},50)()}},created(){this.createdComponent()},beforeUnmount(){this.beforeDestroyComponent()},methods:{createdComponent(){document.addEventListener("click",this.handleClickEvent),document.addEventListener("keydown",this.handleGeneralKeyEvents),this.isLoading=!0,Cicada.State.dispatch("swFlowState/fetchTriggerActions"),w.commit("swFlowState/setTriggerEvent",this.getDataByEvent(this.eventName)),w.dispatch("swFlowState/setRestrictedRules",this.eventName),this.isLoading=!1},beforeDestroyComponent(){document.removeEventListener("click",this.handleClickEvent),document.removeEventListener("keydown",this.handleGeneralKeyEvents)},handleClickEvent(t){const e=t.target;if(!e.closest(".sw-tree-item .is--no-children.is--disabled")){if(e.closest(".sw-tree-item .is--no-children .sw-tree-item__content")||e.closest(".sw-flow-trigger__search-result")){this.closeDropdown();return}if(e.closest(".sw-flow-trigger")===null){if(e.closest("svg"))return;this.closeDropdown(),this.searchTerm!==this.formatEventName&&(this.searchTerm=this.formatEventName)}}},handleGeneralKeyEvents(t){var r;if(t.type!=="keydown"||!this.isExpanded)return;switch(t.key.toLowerCase()){case"tab":case"escape":{this.closeDropdown();break}case"arrowdown":case"arrowleft":case"arrowright":case"arrowup":{this.handleArrowKeyEvents(t);break}case"enter":{if(this.searchTerm.length>0&&this.searchTerm!==this.formatEventName)this.onClickSearchItem(this.searchResultFocusItem),this.closeDropdown();else{if(((r=this.selectedTreeItem)==null?void 0:r.childCount)>0)return;this.changeTrigger(this.selectedTreeItem),this.closeDropdown()}break}}},handleArrowKeyEvents(t){var i,n,o,l,a,c,g,p;const e=t.key.toLowerCase();if(this.searchTerm.length>0&&this.searchTerm!==this.formatEventName){switch(e){case"arrowdown":{t.preventDefault(),this.changeSearchSelection("next");break}case"arrowup":{t.preventDefault(),this.changeSearchSelection("previous");break}}return}const r=this.findTreeItemVNodeById(),s=this.isCompatEnabled("INSTANCE_CHILDREN")?r==null?void 0:r.item:(n=(i=r==null?void 0:r.component)==null?void 0:i.proxy)==null?void 0:n.item;switch(e){case"arrowdown":{if(s!=null&&s.id){if(this.isCompatEnabled("INSTANCE_CHILDREN")?r==null?void 0:r.opened:(l=(o=r==null?void 0:r.component)==null?void 0:o.proxy)==null?void 0:l.opened){const f=this.getFirstChildById(s==null?void 0:s.id);f&&(this.selectedTreeItem=f);break}let m=this.getSibling(!0,s);if(m){this.selectedTreeItem=m;break}if(m=this.getClosestSiblingAncestor(s==null?void 0:s.parentId),m){this.selectedTreeItem=m;break}}break}case"arrowup":{if(s!=null&&s.id){const h=this.findTreeItemVNodeById(s==null?void 0:s.parentId);if((this.isCompatEnabled("INSTANCE_CHILDREN")?(a=h==null?void 0:h.item)==null?void 0:a.children[0].id:(p=(g=(c=h==null?void 0:h.component)==null?void 0:c.proxy)==null?void 0:g.item)==null?void 0:p.children[0].id)===(s==null?void 0:s.id)){const u=this.isCompatEnabled("INSTANCE_CHILDREN")?h.item:h.component.proxy.item;u&&(this.selectedTreeItem=u);break}const f=this.getSibling(!1,s);f&&(this.selectedTreeItem=this.getClosestSiblingDescendant(f))}break}case"arrowright":{this.toggleSelectedTreeItem(!0);break}case"arrowleft":{if(!this.toggleSelectedTreeItem(!1)){const m=this.findTreeItemVNodeById(s==null?void 0:s.parentId);if(m){const f=this.isCompatEnabled("INSTANCE_CHILDREN")?m.item:m.component.proxy.item;this.selectedTreeItem=f}}break}}},getClosestSiblingAncestor(t){var i,n,o,l;const e=this.findTreeItemVNodeById(t),r=this.getSibling(!0,e.item);if(r)return r;const s=this.isCompatEnabled("INSTANCE_CHILDREN")?(i=e==null?void 0:e.item)==null?void 0:i.parentId:(l=(o=(n=e==null?void 0:e.component)==null?void 0:n.proxy)==null?void 0:o.item)==null?void 0:l.parentId;return s?this.getClosestSiblingAncestor(s):null},getClosestSiblingDescendant(t){const e=this.findTreeItemVNodeById(t.id);if(e.opened&&e.item.childCount>0){const r=e.item.children.length-1,s=e.item.children[r];return s.childCount===0?s:this.getClosestSiblingDescendant(s)}return t},getFirstChildById(t,e=this.$refs.flowTriggerTree.treeItems){const r=e.find(s=>s.id===t);if(r)return r.children[0];for(let s=0;s<e.length;s+=1){const i=this.getFirstChildById(t,e[s].children);if(i)return i}return null},getSibling(t,e,r=this.$refs.flowTriggerTree.treeItems){if(!e)return null;let s=null;const i=r.indexOf(e);if(i<0?s=null:s=t?r[i+1]:r[i-1],s)return s;for(let n=0;n<r.length;n+=1){const o=this.getSibling(t,e,r[n].children);if(o)return o}return null},changeSearchSelection(t="next"){const e=t==="previous"?-1:1,r=this.searchResult.indexOf(this.searchResultFocusItem),s=this.searchResult[r+e];typeof s<"u"&&(this.searchResultFocusItem=s)},toggleSelectedTreeItem(t){var r,s,i,n;const e=this.findTreeItemVNodeById();if(this.isCompatEnabled("INSTANCE_CHILDREN")){if(e!=null&&e.openTreeItem&&e.opened!==t)return e.openTreeItem(),!0}else if(!this.isCompatEnabled("INSTANCE_CHILDREN")&&((s=(r=e==null?void 0:e.component)==null?void 0:r.proxy)!=null&&s.openTreeItem)&&((n=(i=e==null?void 0:e.component)==null?void 0:i.proxy)==null?void 0:n.opened)!==t)return e.component.proxy.openTreeItem(),!0;return!1},findTreeItemVNodeById(t=this.selectedTreeItem.id,e=this.isCompatEnabled("INSTANCE_CHILDREN")?(s=>(s=(r=>(r=this.$refs)==null?void 0:r.flowTriggerTree)())==null?void 0:s.$children)():(o=>(o=(n=>(n=(i=>(i=this.$refs.flowTriggerTree)==null?void 0:i.$)())==null?void 0:n.subTree)())==null?void 0:o.children)()){var c,g,p,h,m,f,u,C,b;let l=!1;if(!e||(Array.isArray(e)?l=e.find(d=>{var _,v,T,E,I,N,k;if(this.isCompatEnabled("INSTANCE_CHILDREN")){if((_=d==null?void 0:d.item)!=null&&_.id)return d.item.id===t}else if(!this.isCompatEnabled("INSTANCE_CHILDREN")&&((E=(T=(v=d.component)==null?void 0:v.proxy)==null?void 0:T.item)!=null&&E.id))return((k=(N=(I=d.component)==null?void 0:I.proxy)==null?void 0:N.item)==null?void 0:k.id)===t;return!1}):this.isCompatEnabled("INSTANCE_CHILDREN")&&((c=e==null?void 0:e.item)!=null&&c.id)?l=e.item.id===t:!this.isCompatEnabled("INSTANCE_CHILDREN")&&((h=(p=(g=e.component)==null?void 0:g.proxy)==null?void 0:p.item)!=null&&h.id)&&(l=((u=(f=(m=e.component)==null?void 0:m.proxy)==null?void 0:f.item)==null?void 0:u.id)===t),l))return l;let a=!1;for(let d=0;d<e.length;d+=1)if(e[d]){if(this.isCompatEnabled("INSTANCE_CHILDREN"))a=this.findTreeItemVNodeById(t,e[d].$children);else{const _=e[d].component?(b=(C=e[d].component)==null?void 0:C.subTree)==null?void 0:b.children:e[d].children;a=this.findTreeItemVNodeById(t,_??null)}if(a)break}return a},openDropdown({setFocusClass:t,removeFocusClass:e}){this.setInputFocusClass=t,this.removeInputFocusClass=e,this.setInputFocusClass(),this.isExpanded=!0,!this.isLoading&&this.$nextTick().then(()=>{if(this.searchTerm===this.formatEventName){const r=this.eventTree.find(s=>s.id===this.eventName);this.selectedTreeItem=r||this.eventTree[0]}})},closeDropdown(){this.removeInputFocusClass&&this.removeInputFocusClass(),this.isExpanded=!1},changeTrigger(t){if(!(t!=null&&t.disabled||(t==null?void 0:t.childCount)>0))if(this.isSequenceEmpty){const{id:e}=t.data;w.commit("swFlowState/setTriggerEvent",this.getDataByEvent(e)),w.dispatch("swFlowState/setRestrictedRules",e),this.$emit("option-select",e)}else this.showConfirmModal=this.flow.eventName!==t.id,this.triggerSelect=this.getDataByEvent(t.id)},onConfirm(){w.commit("swFlowState/setTriggerEvent",this.triggerSelect),w.dispatch("swFlowState/setRestrictedRules",this.triggerSelect.name),this.$emit("option-select",this.triggerSelect.name)},onCloseConfirm(){this.showConfirmModal=!1,this.triggerSelect={}},getLastEventName({parentId:t=null,id:e}){const[r]=t?e.split(".").reverse():[e];return this.getEventNameTranslated(r)},getDataByEvent(t){return this.triggerEvents.find(e=>e.name===t)},hasOnlyStopFlow(t){return(this.triggerEvents.find(r=>r.name===t).aware||[]).length===0},getEventTree(t){const e={};t.forEach(s=>{const i=s.name.split(".");if(i.length===0)return;const n=(o,l,a)=>{const c=l[o],g=l[o+1];a[c]=a[c]||{id:c,parentId:null,children:{}},g&&(a[c].children[g]=a[c].children[g]||{id:`${a[c].id}.${g}`,parentId:a[c].id,children:{}},n(o+1,l,a[c].children))};n(0,i,e)});const r=(s,i=[])=>(s.forEach(n=>{const o=n.children?Object.values(n.children):[];i.push({id:n.id,name:this.getLastEventName(n),childCount:o.length,parentId:n.parentId,disabled:y(n.children)&&this.hasOnlyStopFlow(n.id),disabledToolTipText:y(n.children)&&this.hasOnlyStopFlow(n.id)?this.$tc("sw-flow.detail.trigger.textHint"):null}),o.length>0&&(i=r(o,i))}),i);return r(Object.values(e))},getBreadcrumb(t){return t?t.split(".").map(r=>A(r)).join(" / ").replace(/_|-/g," "):""},onClickSearchItem(t){this.searchTerm=this.formatEventName,this.searchResult=[],this.isSequenceEmpty?(this.$emit("option-select",t.name),w.commit("swFlowState/setTriggerEvent",t),w.dispatch("swFlowState/setRestrictedRules",t.name)):(this.showConfirmModal=!0,this.triggerSelect=t)},getEventName(t){return this.isUnknownTrigger?"":t&&t.split(".").map(r=>this.getEventNameTranslated(r)).join(" / ")},isSearchResultInFocus(t){return t.name===this.searchResultFocusItem.name},getEventNameTranslated(t){const e=$(t),r=[`sw-flow-app.triggers-app.${e}`,`sw-flow-custom-event.event-tree.${e}`,`sw-flow.triggers.${e}`].find(s=>this.$te(s));return r?this.$tc(r):t.replace(/_|-/g," ")}}};export{B as default};
//# sourceMappingURL=index-CwAn3KOx.js.map
