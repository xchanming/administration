import{C as c}from"./index-Bf-oW9e8.js";import"./administration-DCOj2uiN.js";import"./main.vite-CEuAX8cl.js";import"./channel-oRk5-XZJ.js";import"./user-config.class-C-zJul6z.js";const m=`{% block sw_cms_detail %} <sw-page class="sw-cms-detail" :show-search-bar="false" :show-smart-bar="false" > {% block sw_cms_detail_content %} <template #content> <div class="sw-cms-detail__content"> {% block sw_cms_detail_toolbar %} <sw-cms-toolbar> {% block sw_cms_detail_toolbar_language_switch %} <template #language-switch> <sw-language-switch :disabled="isLoading || page.locked || undefined" :allow-edit="acl.can('cms.editor')" :save-changes-function="saveOnLanguageChange" :abort-change-function="abortOnLanguageChange" @on-change="onChangeLanguage" /> </template> {% endblock %} {% block sw_cms_detail_toolbar_title %} <template #title> <div class="sw-cms-detail__page-info"> {% block sw_cms_detail_toolbar_back_button %} <a class="sw-cms-detail__back-btn" role="link" tabindex="0" :aria-label="$tc('global.default.back')" @click="onClickBack" @keyup.enter="onClickBack" > <sw-icon name="regular-times" /> </a> {% endblock %} {% block sw_cms_detail_toolbar_page_name %} <h2 class="sw-cms-detail__page-name"> {{ placeholder(page, 'name') }} </h2> {% endblock %} {% block sw_cms_detail_toolbar_page_type %} <div v-if="page.type" class="sw-cms-detail__page-type" > {{ $tc(pageType?.title ?? '') }} </div> {% endblock %} <div v-if="isDefaultLayout" class="sw-cms-detail__page-defaults" > {{ $tc('sw-cms.detail.label.defaultLayout') }} </div> </div> </template> {% endblock %} {% block sw_cms_detail_toolbar_device_actions %} <template #tools> <div v-if="pageHasSections" class="sw-cms-detail__device-actions" > {% block sw_cms_detail_toolbar_device_actions_mobile %} <sw-icon name="regular-mobile" :class="{ 'is--active': currentDeviceView === 'mobile' }" @click="onDeviceViewChange('mobile')" /> {% endblock %} {% block sw_cms_detail_toolbar_device_actions_tablet_landscape %} <sw-icon name="regular-tablet" :class="{ 'is--active': currentDeviceView === 'tablet-landscape' }" @click="onDeviceViewChange('tablet-landscape')" /> {% endblock %} {% block sw_cms_detail_toolbar_device_actions_desktop %} <sw-icon name="regular-desktop" :class="{ 'is--active': currentDeviceView === 'desktop' }" @click="onDeviceViewChange('desktop')" /> {% endblock %} {% block sw_cms_detail_toolbar_device_actions_form %} <sw-icon name="regular-bars-square" :class="{ 'is--active': currentDeviceView === 'form', 'is--disabled': !acl.can('cms.editor') }" @click="onDeviceViewChange('form')" /> {% endblock %} </div> </template> {% endblock %} {% block sw_cms_detail_toolbar_actions %} <template #actions> <div class="sw-cms-detail__actions"> {% block sw_cms_detail_toolbar_actions_save %} <sw-button-process v-tooltip.bottom="tooltipSave" class="sw-cms-detail__save-action" :is-loading="isLoading" :process-success="isSaveSuccessful" :disabled="isLoading || page.locked || !acl.can('cms.editor') || undefined" variant="primary" @update:process-success="saveFinish" @click="onSave" > {{ $tc('sw-cms.detail.label.buttonSave') }} </sw-button-process> {% endblock %} </div> </template> {% endblock %} </sw-cms-toolbar> {% endblock %} {% block sw_cms_detail_stage_container %} <div class="sw-cms-detail__stage-container"> <sw-overlay v-if="page.locked" /> {% block sw_cms_detail_loader %} <sw-loader v-if="isLoading" /> {% endblock %} {% block sw_cms_detail_stage_form_view %} <div v-if="currentDeviceView === 'form'" class="sw-cms-detail__page-form" > {% block sw_cms_detail_page_notification %} <div v-if="page.locked" class="sw-cms-detail__page-notification" > <sw-alert class="sw-cms-detail__page-notification-alert" variant="info" > {{ $tc('sw-cms.detail.label.lockedNotification') }} </sw-alert> </div> {% endblock %} <sw-cms-page-form v-if="!isLoading" :page="page" /> </div> {% endblock %} {% block sw_cms_detail_stage_wrapper %} <div v-else class="sw-cms-detail__stage" > {% block sw_cms_detail_toolbar_notification %} {% block sw_cms_detail_toolbar_notification_errors %} <div v-if="hasPageErrors" class="sw-cms-detail__page-notification" > <sw-alert class="sw-cms-detail__page-notification-alert is--error" variant="error" > {{ $tc('sw-cms.detail.notification.errorCollectionText') }} <li v-for="(error, index) in pageErrors" :key="index" > {{ error.detail }} </li> </sw-alert> </div> {% endblock %} {% block sw_cms_detail_toolbar_notification_warnings %} <div v-if="validationWarnings.length > 0" class="sw-cms-detail__page-notification" > <sw-alert class="sw-cms-detail__page-notification-alert is--warning" variant="warning" > {{ $tc('sw-cms.detail.notification.warningCollectionText') }} <li v-for="(warning, index) in validationWarnings" :key="index" > {{ warning }} </li> </sw-alert> </div> {% endblock %} {% block sw_cms_detail_toolbar_notification_infos %} <div v-if="page.locked" class="sw-cms-detail__page-notification is--info" > <sw-alert class="sw-cms-detail__page-notification-alert" variant="info" > {{ $tc('sw-cms.detail.label.lockedNotification') }} </sw-alert> </div> {% endblock %} {% endblock %} {% block sw_cms_detail_stage_empty_stage %} <div v-if="!isLoading && !pageHasSections" class="sw-cms-detail__empty-stage" > {% block sw_cms_detail_stage_empty_stade_content %} <div class="sw-cms-detail__empty-stage-content"> <h2 class="sw-cms-detail__empty-stage-headline"> {{ $tc('sw-cms.detail.label.headlineEmptyState') }} </h2> <p class="sw-cms-detail__empty-stage-claim"> {{ $tc('sw-cms.detail.label.claimEmptyState') }} </p> <sw-cms-stage-add-section :key="0" :disabled="!acl.can('cms.editor') || undefined" :force-choose="true" @stage-section-add="onAddSection($event, 0, true)" /> </div> {% endblock %} </div> {% endblock %} {% block sw_cms_detail_stage %} <div v-else :id="\`page-\${page.id}\`" class="sw-cms-stage" :class="cmsStageClasses" > {% block sw_cms_detail_stage_add_first_section %} <sw-cms-stage-add-section :key="0" :disabled="!acl.can('cms.editor') || undefined" @stage-section-add="onAddSection($event, 0, true)" /> {% endblock %} {% block sw_cms_detail_stage_content %} <template v-if="!isLoading"> <template v-for="(section, index) in page.sections" :key="section.id" > {% block sw_cms_detail_stage_content_section %} <sw-cms-section class="sw-cms-stage-section" :page="page" :section="section" :active="selectedSection !== null && selectedSection.id === section.id" :disabled="!acl.can('cms.editor') || undefined" @page-config-open="pageConfigOpen" @block-duplicate="onBlockDuplicate" /> {% endblock %} </template> </template> {% endblock %} {% block sw_cms_detail_stage_add_last_section %} <sw-cms-stage-add-section :key="page.sections.length + 1" :disabled="!acl.can('cms.editor') || undefined" @stage-section-add="onAddSection($event, page.sections.length, true)" /> {% endblock %} </div> {% endblock %} </div> {% endblock %} {% block sw_cms_detail_sidebar %} <sw-cms-sidebar ref="cmsSidebar" :page="page" :demo-entity="currentMappingEntity" :demo-entity-id-prop="demoEntityId" :disabled="!acl.can('cms.editor') || undefined" :is-default-layout="isDefaultLayout" @demo-entity-change="onDemoEntityChange" @block-duplicate="onBlockDuplicate" @section-duplicate="onSectionDuplicate" @block-stage-drop="onPageUpdate" @page-type-change="onPageTypeChange" @page-update="onPageUpdate" @page-save="onPageSave" @open-layout-assignment="onOpenLayoutAssignment" @open-layout-set-as-default="onOpenLayoutSetAsDefault" /> {% endblock %} {% block sw_cms_detail_layout_assignment_modal %} <sw-cms-layout-assignment-modal v-if="showLayoutAssignmentModal" :page="page" @modal-close="closeLayoutAssignmentModal" /> {% endblock %} <sw-confirm-modal v-if="showLayoutSetAsDefaultModal" class="sw-cms-detail__confirm-set-as-default-modal" :title="$tc('sw-cms.components.setDefaultLayoutModal.title')" :text="$tc('sw-cms.components.setDefaultLayoutModal.infoText', page.type === 'product_detail')" @confirm="onConfirmLayoutSetAsDefault" @cancel="onCloseLayoutSetAsDefault" @close="onCloseLayoutSetAsDefault" /> {% block sw_cms_detail_missing_element_modal %} <sw-cms-missing-element-modal v-if="showMissingElementModal" :missing-elements="missingElements" @modal-close="onCloseMissingElementModal" @modal-save="onSaveMissingElementModal" @modal-dont-remind-change="onChangeDontRemindCheckbox" /> {% endblock %} </div> {% endblock %} </div> </template> {% endblock %} </sw-page> {% endblock %}`,{Component:u,Mixin:r,Utils:h}=Cicada,{mapPropertyErrors:f}=u.getComponentHelper(),{CicadaError:y}=Cicada.Classes,{debounce:_}=Cicada.Utils,{cloneDeep:d,getObjectDiff:b}=Cicada.Utils.object,{warn:g}=Cicada.Utils.debug,{Criteria:n}=Cicada.Data,w=800,P={template:m,compatConfig:Cicada.compatConfig,inject:["repositoryFactory","entityFactory","entityHydrator","loginService","cmsService","cmsDataResolverService","acl","appCmsService","systemConfigApiService","cmsPageTypeService"],mixins:[r.getByName("cms-state"),r.getByName("notification"),r.getByName("placeholder")],shortcuts:{"SYSTEMKEY+S":"onSave"},data(){return{pageId:null,pageOrigin:null,page:{sections:[]},salesChannels:[],isLoading:!1,isSaveSuccessful:!1,currentSalesChannelKey:null,selectedBlockSectionId:null,currentMappingEntity:null,currentMappingEntityRepo:null,demoEntityId:null,validationWarnings:[],productDetailBlocks:[{type:"cross-selling",elements:[{slot:"content",type:"cross-selling",config:{}}]},{type:"product-description-reviews",elements:[{slot:"content",type:"product-description-reviews",config:{}}]},{type:"gallery-buybox",elements:[{slot:"left",type:"image-gallery",config:{}},{slot:"right",type:"buy-box",config:{}}]},{type:"product-heading",elements:[{slot:"left",type:"product-name",config:{}},{slot:"right",type:"manufacturer-logo",config:{}}]}],showLayoutAssignmentModal:!1,showLayoutSetAsDefaultModal:!1,isDefaultLayout:!1,showMissingElementModal:!1,missingElements:[]}},metaInfo(){return{title:this.$createTitle(this.identifier)}},computed:{identifier(){return this.placeholder(this.page,"name")},pageRepository(){return this.repositoryFactory.create("cms_page")},sectionRepository(){return this.repositoryFactory.create("cms_section")},blockRepository(){return this.repositoryFactory.create("cms_block")},slotRepository(){return this.repositoryFactory.create("cms_slot")},salesChannelRepository(){return this.repositoryFactory.create("sales_channel")},defaultFolderRepository(){return this.repositoryFactory.create("media_default_folder")},cmsBlocks(){return this.cmsService.getCmsBlockRegistry()},productRepository(){return this.repositoryFactory.create("product")},cmsStageClasses(){return[`is--${this.currentDeviceView}`]},cmsPageTypeSettings(){const e=c.TYPE_MAPPING_ENTITIES;return e.hasOwnProperty(this.page.type)?e[this.page.type]:{entity:null,mode:"static"}},blockConfigDefaults(){return{name:null,marginBottom:null,marginTop:null,marginLeft:null,marginRight:null,sizingMode:"boxed",visibility:{desktop:!0,tablet:!0,mobile:!0}}},tooltipSave(){return this.acl.can("cms.editor")?{message:`${this.$device.getSystemKey()} + S`,appearance:"light"}:{message:this.$tc("sw-privileges.tooltip.warning"),disabled:this.acl.can("cms.editor"),showOnDisabledElements:!0}},addBlockTitle(){return this.isSystemDefaultLanguage?this.$tc("sw-cms.detail.sidebar.titleBlockOverview"):this.$tc("sw-cms.general.disabledAddingBlocksToolTip")},pageHasSections(){return this.page.sections.length>0},loadPageCriteria(){const e=new n(1,1),t=n.sort("position","ASC",!0);return e.getAssociation("sections").addSorting(t).addAssociation("backgroundMedia").getAssociation("blocks").addSorting(t).addAssociation("backgroundMedia").addAssociation("slots"),e.getAssociation("categories").setPage(1).setLimit(25),e.getAssociation("landingPages").setLimit(25),e.getAssociation("products").setLimit(25),e.getAssociation("products.manufacturer").setLimit(25),e},demoProductCriteria(){const e=new n(1,25);return e.addAssociation("media"),e.addAssociation("deliveryTime"),e.addAssociation("manufacturer.media"),e.addAssociation("cover"),e},currentDeviceView(){return this.cmsPageState.currentCmsDeviceView},isProductPage(){return this.page.type===c.PAGE_TYPES.PRODUCT_DETAIL},requiredFieldErrors(){return[this.pageNameError].filter(e=>!!e)},pageErrors(){return[this.requiredFieldErrors.find(e=>!!e),this.pageSectionsError,this.pageBlocksError,this.pageSlotsError,this.pageSlotConfigError].filter(e=>!!e)},hasPageErrors(){return this.pageErrors.length>0},pageType(){this.cmsPageTypeService.getType(this.page.type)},layoutVersionContext(){return Cicada.Context.api},...f("page",["name","sections","blocks","slots","slotConfig"])},created(){this.createdComponent()},beforeUnmount(){this.beforeDestroyedComponent()},methods:{createdComponent(){Cicada.ExtensionAPI.publishData({id:"sw-cms-detail__page",path:"page",scope:this}),Cicada.Store.get("adminMenu").collapseSidebar();const e=Cicada.State.getters["context/isSystemDefaultLanguage"];if(this.cmsPageState.setIsSystemDefaultLanguage(e),this.resetCmsPageState(),this.$route.params.id){this.pageId=this.$route.params.id,this.isLoading=!0;const t="8A243080F92E4C719546314B577CF82B";Cicada.State.commit("cicadaApps/setSelectedIds",[this.pageId]);const s=new n(1,25);s.addFilter(n.equals("typeId",t)),this.salesChannelRepository.search(s).then(i=>{this.salesChannels=i,this.salesChannels.length>0&&(this.currentSalesChannelKey=this.salesChannels[0].id,this.loadPage(this.pageId))})}this.setPageContext()},setPageContext(){this.getDefaultFolderId().then(e=>{this.cmsPageState.setDefaultMediaFolderId(e)})},resetCmsPageState(){this.cmsPageState.resetCmsPageState()},getDefaultFolderId(){const e=new n(1,1);return e.addAssociation("folder"),e.addFilter(n.equals("entity",this.cmsPageState.pageEntityName)),this.defaultFolderRepository.search(e).then(t=>{var i;const s=t.first();return(i=s.folder)!=null&&i.id?s.folder.id:null})},beforeDestroyedComponent(){const e=this.cmsPageState;e.removeCurrentPage(),e.removeSelectedBlock(),e.removeSelectedSection()},loadPage(e){return this.isLoading=!0,this.pageRepository.get(e,Cicada.Context.api,this.loadPageCriteria).then(t=>{this.page={sections:[]},this.page=t,this.cmsPageState.setCurrentPageType(t.type),this.acl.can("system_config:read")&&this.setDefaultLayout(),this.cmsDataResolverService.resolve(this.page).then(()=>{if(this.updateSectionAndBlockPositions(),this.cmsPageState.setCurrentPage(this.page),this.updateDataMapping(),this.pageOrigin=d(this.page),this.selectedBlock){const s=this.selectedBlock.id,i=this.selectedBlock.sectionId;this.page.sections.forEach(a=>{a.id===i&&a.blocks.forEach(o=>{o.id===s&&this.setSelectedBlock(i,o)})})}Cicada.ExtensionAPI.publishData({id:"sw-cms-detail__page",path:"page",scope:this}),this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.createNotificationError({title:s.message,message:s.response}),g(this._name,s.message,s.response)})}).catch(t=>{this.isLoading=!1,this.createNotificationError({title:t.message,message:t.response.statusText}),g(this._name,t.message,t.response)})},updateDataMapping(){const e=this.cmsPageTypeSettings.entity;if(!e){this.cmsPageState.removeCurrentMappingEntity(),this.cmsPageState.removeCurrentMappingTypes(),this.cmsPageState.removeCurrentDemoEntity(),this.cmsPageState.removeCurrentDemoProducts(),this.currentMappingEntity=null,this.currentMappingEntityRepo=null,this.demoEntityId=null;return}this.cmsPageState.currentMappingEntity!==e&&(this.cmsPageState.setCurrentMappingEntity(e),this.cmsPageState.setCurrentMappingTypes(this.cmsService.getEntityMappingTypes(e)),this.currentMappingEntity=e,this.currentMappingEntityRepo=this.repositoryFactory.create(e),this.onDemoEntityChange())},onDeviceViewChange(e){e==="form"&&!this.acl.can("cms.editor")||(this.cmsPageState.setCurrentCmsDeviceView(e),e==="form"&&this.setSelectedBlock(null,null))},setSelectedBlock(e,t=null){this.selectedBlockSectionId=e,this.cmsPageState.setBlock(t)},onChangeLanguage(){return this.isLoading=!0,this.salesChannelRepository.search(new n(1,25)).then(e=>{this.salesChannels=e;const t=Cicada.State.getters["context/isSystemDefaultLanguage"];return this.cmsPageState.setIsSystemDefaultLanguage(t),this.loadPage(this.pageId)})},abortOnLanguageChange(){return Object.keys(b(this.page,this.pageOrigin)).length>0},saveOnLanguageChange(){return this.onSave()},async loadDemoProduct(e){const t=n.fromCriteria(this.demoProductCriteria);t.setLimit(1),e&&t.setIds([e]);const s={...Cicada.Context.api,inheritance:!0},i=await this.productRepository.search(t,s);this.cmsPageState.setCurrentDemoEntity(i[0])},async loadDemoCategory(e){const t=new n(1,1);t.addAssociation("media"),e&&t.setIds([e]);const i=(await this.repositoryFactory.create("category").search(t))[0];this.demoEntityId=i.id,this.cmsPageState.setCurrentDemoEntity(i),this.loadDemoCategoryProducts(i)},async loadDemoCategoryProducts(e){const t=n.fromCriteria(this.demoProductCriteria);t.setLimit(8),t.addFilter(n.equals("categoriesRo.id",e.id)),t.addFilter(n.equals("parentId",null));const s=await this.productRepository.search(t);this.cmsPageState.setCurrentDemoProducts(s)},onDemoEntityChange(e){var i;const t=(i=this.cmsPageTypeSettings)==null?void 0:i.entity,s=this.cmsPageState;if(s.removeCurrentDemoEntity(),s.removeCurrentDemoProducts(),t==="product"){e&&this.loadDemoProduct(e);return}t==="category"&&this.loadDemoCategory(e)},onAddSection(e,t,s=!1){if(!e||t==="undefined")return;const i=this.sectionRepository.create();i.type=e,i.sizingMode="boxed",i.position=t,i.pageId=this.page.id,i.visibility={desktop:!0,tablet:!0,mobile:!0},this.page.sections.splice(t,0,i),this.updateSectionAndBlockPositions(),s&&this.onSave()},onCloseBlockConfig(){this.cmsPageState.removeSelectedItem()},pageConfigOpen(e=null){const t=this.$refs.cmsSidebar.$refs;if(e==="blocks"){if(!this.isSystemDefaultLanguage)return;t.blockSelectionSidebar.openContent();return}if(e==="itemConfig"){t.itemConfigSidebar.openContent();return}t.pageConfigSidebar.openContent()},saveFinish(){this.isSaveSuccessful=!1},onPageSave(e=!1){if(this.onPageUpdate(),e){this.debouncedPageSave();return}this.onSave()},debouncedPageSave:_(function(){this.onSave()},w),onSave(){return this.isSaveSuccessful=!1,this.pageIsValid()?this.onSaveEntity():(this.createNotificationError({message:this.$tc("sw-cms.detail.notification.pageInvalid")}),Promise.reject())},onSaveEntity(){return this.isLoading=!0,this.deleteEntityAndRequiredConfigKey(this.page.sections),this.pageRepository.save(this.page,Cicada.Context.api,!1).then(()=>(this.isLoading=!1,this.isSaveSuccessful=!0,this.loadPage(this.page.id))).catch(e=>(this.isLoading=!1,this.createNotificationError({message:e.message}),Promise.reject(e)))},addError({property:e=null,payload:t={},code:s=c.REQUIRED_FIELD_ERROR_CODE,message:i=""}={}){const a=`cms_page.${this.page.id}.${e}`,o=new y({code:s,detail:i,meta:{parameters:t}});Cicada.State.commit("error/addApiError",{expression:a,error:o})},getError(e){return Cicada.State.getters["error/getApiError"](this.page,e)},getSlotValidations(){const e={},t=[];return this.page.sections.forEach(s=>{s.blocks.forEach(i=>{i.backgroundMedia=null,i.slots.forEach(a=>{if(this.page.type===c.PAGE_TYPES.PRODUCT_DETAIL&&this.isProductPageElement(a)){const o=h.string.camelCase(a.type);e.hasOwnProperty(o)?(e[o].count+=1,e[o].blockIds.push(i.id),e[o].slotIds.push(a.id)):e[o]={type:o,count:1,blockIds:[i.id],slotIds:[a.id]};return}t.push(...this.checkRequiredSlotConfigField(a,i))})})}),{requiredMissingSlotConfigs:t,uniqueSlotCount:e}},pageIsValid(){localStorage.getItem("cmsMissingElementDontRemind")==="true"&&(this.cmsMissingElementDontRemind=!0),this.validationWarnings=[],Cicada.State.dispatch("error/resetApiErrors");const e=[this.missingFieldsValidation(),this.listingPageValidation(),this.pageSectionCountValidation(),this.slotValidation()].every(t=>t);return!this.cmsMissingElementDontRemind&&e&&this.validationWarnings.length>0&&(this.showMissingElementModal=!0),e},missingFieldsValidation(){return(!this.isSystemDefaultLanguage||this.page.name)&&this.page.type?!0:(this.addError({property:"name",message:this.$tc("sw-cms.detail.notification.messageMissingFields")}),!1)},listingPageValidation(){return this.page.type!==c.PAGE_TYPES.LISTING?!0:this.page.sections.some(t=>t.blocks.some(s=>s.type==="product-listing"))?(this.cmsBlocks["product-listing"].hidden=!0,!0):(this.addError({property:"blocks",code:"listingBlockNotFound",message:this.$tc("sw-cms.detail.notification.messageMissingProductListing")}),this.cmsBlocks["product-listing"].hidden=!1,!1)},pageSectionCountValidation(){return this.page.sections.length>=1?!0:(this.addError({property:"sections",code:"noSectionsFound",message:this.$tc("sw-cms.detail.notification.messageMissingSections")}),!1)},slotValidation(){let e=!0;const{requiredMissingSlotConfigs:t,uniqueSlotCount:s}=this.getSlotValidations(),i=[],a=[];if(this.page.type===c.PAGE_TYPES.PRODUCT_DETAIL){if(c.UNIQUE_SLOTS.forEach(o=>{var l;((l=s==null?void 0:s[o])==null?void 0:l.count)>1?(s[o].label=this.$tc(`sw-cms.elements.${o}.label`),i.push({...s[o]}),e=!1):s!=null&&s[o]||a.push(this.$tc(`sw-cms.elements.${o}.label`))}),i.length>0){const o=c.UNIQUE_SLOTS.map(p=>this.$tc(`sw-cms.elements.${p}.label`)).join(", "),l=this.$tc("sw-cms.detail.notification.messageRedundantElements",0,{names:o});this.addError({property:"slots",code:"uniqueSlotsOnlyOnce",message:l,payload:{elements:i}})}a.length>0&&this.validationWarnings.push(...a)}return t.length>0&&(this.addError({property:"slotConfig",code:"requiredConfigMissing",message:this.$tc("sw-cms.detail.notification.messageMissingBlockFields"),payload:{elements:t}}),e=!1),e},deleteEntityAndRequiredConfigKey(e){e.forEach(t=>{t.blocks.forEach(s=>{s.slots.forEach(i=>{Object.values(i.config).forEach(a=>{a.entity&&delete a.entity,a.hasOwnProperty("required")&&delete a.required})})})})},checkRequiredSlotConfigField(e,t){return Object.keys(e.config).reduce((s,i)=>{const a={...e.config[i]};return a.required&&(a.value===null||a.value.length<1)&&(a.name=`${e.type}.${i}`,a.blockId=t.id,s.push(a)),s},[])},updateSectionAndBlockPositions(){this.page.sections.forEach((e,t)=>{e.position=t,this.updateBlockPositions(e)})},updateBlockPositions(e){e.blocks.forEach((t,s)=>{t.position=s})},onPageUpdate(){this.updateSectionAndBlockPositions(),this.updateDataMapping()},async onBlockDuplicate(e,{position:t=0}){const s={overwrites:{position:e.position+1},cloneChildren:!0},{id:i}=await this.blockRepository.clone(e.id,s,this.layoutVersionContext),a=await this.blockRepository.get(i,this.layoutVersionContext),o=this.page.sections[t];o.blocks.splice(a.position,0,a),this.updateBlockPositions(o),this.onSave()},async onSectionDuplicate(e){const t={overwrites:{position:e.position+1},cloneChildren:!0},{id:s}=await this.sectionRepository.clone(e.id,t,this.layoutVersionContext),i=await this.sectionRepository.get(s,this.layoutVersionContext);this.page.sections.splice(i.position,0,i),this.updateSectionAndBlockPositions(e),this.onSave()},onPageTypeChange(e){typeof e=="string"&&(this.cmsPageState.setCurrentPageType(e),this.page.type=e),this.page.type===c.PAGE_TYPES.LISTING?this.processProductListingType():this.page.sections.forEach(t=>{t.blocks.forEach(s=>{s.type==="product-listing"&&t.blocks.remove(s.id)})}),this.page.type===c.PAGE_TYPES.PRODUCT_DETAIL&&this.processProductDetailType(),this.checkSlotMappings(),this.onPageUpdate()},processProductListingType(){const e=this.blockRepository.create(),t=[{blockId:e.id,slot:"content",type:"product-listing",config:{}}];this.processBlock(e,"product-listing"),this.processElements(e,t)},processProductDetailType(){this.productDetailBlocks.forEach(e=>{const t=this.blockRepository.create();e.elements.forEach(s=>{s.blockId=t.id}),this.processBlock(t,e.type),this.processElements(t,e.elements)})},processBlock(e,t){let i=this.cmsBlocks[t].defaultConfig;this.isProductPage&&i&&(i={...i,marginLeft:"0",marginRight:"0",marginTop:t==="gallery-buybox"||t==="product-description-reviews"?"20px":"0",marginBottom:t==="product-heading"||t==="product-description-reviews"?"20px":"0"}),e.type=t,e.position=0,e.sectionId=this.page.sections[0].id,e.sectionPosition="main",Object.assign(e,d(this.blockConfigDefaults),d(i||{}))},processElements(e,t){t.forEach(s=>{const i=this.slotRepository.create();i.blockId=s.blockId,i.slot=s.slot,i.type=s.type,i.config=s.config,e.slots.push(i)}),this.page.sections[0].blocks.splice(0,0,e)},checkSlotMappings(){this.page.sections.forEach(e=>{e.blocks.forEach(t=>{t.slots.forEach(s=>{Object.keys(s.config).forEach(i=>{var a;((a=s.config[i])==null?void 0:a.source)==="mapped"&&s.config[i].value.split(".")[0]!==this.demoEntity&&(s.config[i].value=null,s.config[i].source="static")})})})})},isProductPageElement(e){return c.UNIQUE_SLOTS_KEBAB.includes(e.type)},onOpenLayoutAssignment(){this.openLayoutAssignmentModal()},openLayoutAssignmentModal(){this.showLayoutAssignmentModal=!0},closeLayoutAssignmentModal(e=!1){this.showLayoutAssignmentModal=!1,e&&this.$nextTick(()=>{this.onSaveEntity()})},onOpenLayoutSetAsDefault(){this.showLayoutSetAsDefaultModal=!0},onCloseLayoutSetAsDefault(){this.showLayoutSetAsDefaultModal=!1},async onConfirmLayoutSetAsDefault(){let e="category_cms_page";this.page.type==="product_detail"&&(e="product_cms_page"),await this.systemConfigApiService.saveValues({[`core.cms.default_${e}`]:this.pageId}),this.isDefaultLayout=!0,this.showLayoutSetAsDefaultModal=!1},async setDefaultLayout(){const e=await this.systemConfigApiService.getValues("core.cms"),t=e["core.cms.default_category_cms_page"],s=e["core.cms.default_product_cms_page"];this.page.versionId===Cicada.Context.api.liveVersionId&&[t,s].includes(this.pageId)&&(this.isDefaultLayout=!0)},onCloseMissingElementModal(){this.showMissingElementModal=!1,this.cmsMissingElementDontRemind=!1,this.$nextTick(()=>{this.loadPage(this.pageId)})},onSaveMissingElementModal(){this.cmsMissingElementDontRemind&&localStorage.setItem("cmsMissingElementDontRemind",!0),this.showMissingElementModal=!1,this.$nextTick(()=>{this.onSaveEntity()})},onChangeDontRemindCheckbox(){this.cmsMissingElementDontRemind=!this.cmsMissingElementDontRemind},async onClickBack(){window.history.length>2?await this.$router.back():await this.$router.push({name:"sw.cms.index"})}}};export{P as default};
//# sourceMappingURL=index-SA6S8_AZ.js.map
