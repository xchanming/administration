{"version":3,"file":"index-CezzjGaT.js","sources":["../../../app/administration/src/app/component/form/sw-maintain-currencies-modal/sw-maintain-currencies-modal.html.twig","../../../app/administration/src/app/component/form/sw-maintain-currencies-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_maintain_currencies_modal %}\n<sw-modal\n    class=\"sw-maintain-currencies-modal\"\n    :title=\"$tc('sw-maintain-currencies-modal.title')\"\n    @modal-close=\"onCancel\"\n>\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_maintain_currencies_modal_grid %}\n    <sw-data-grid\n        :data-source=\"currencyCollection\"\n        :columns=\"maintainCurrencyColumns\"\n        :show-selection=\"false\"\n        :compact-mode=\"false\"\n        :show-actions=\"false\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_maintain_currencies_modal_grid_column_name %}\n        <template\n            #column-name=\"{ item }\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_maintain_currencies_modal_grid_column_name_inherit_field %}\n            <sw-inheritance-switch\n                v-if=\"!item.isSystemDefault\"\n                class=\"sw-price-form__inherited-icon\"\n                :is-inherited=\"isCurrencyInherited(item)\"\n                @inheritance-restore=\"onInheritanceRestore(item.id)\"\n                @inheritance-remove=\"onInheritanceRemove(item)\"\n            />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_maintain_currencies_modal_grid_column_name_item_name %}\n            <p>{{ item.translated.name || item.name }}</p>\n            {% endblock %}\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_maintain_currencies_modal_grid_column_price %}\n        <template #column-label-price>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_maintain_currencies_modal_grid_column_price_field_label %}\n            <div class=\"sw-maintain-currencies-modal__price-label-wrapper\">\n                <div class=\"sw-maintain-currencies-modal__price-label\">\n                    {{ $tc('sw-maintain-currencies-modal.columnPrice') }}\n                </div>\n                <div\n                    v-if=\"!hideListPrices\"\n                    class=\"sw-maintain-currencies-modal__list-price-label\"\n                >\n                    {{ $tc('sw-maintain-currencies-modal.columnListPriceHeader') }}\n                </div>\n                <div\n                    v-if=\"!hideRegulationPrices\"\n                    class=\"sw-maintain-currencies-modal__reference-price-label\"\n                >\n                    {{ $tc('sw-maintain-currencies-modal.columnReferencePriceHeader') }}\n                </div>\n            </div>\n            {% endblock %}\n        </template>\n\n        <template\n            #column-price=\"{ item }\"\n        >\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_maintain_currencies_modal_grid_column_price_field %}\n            <sw-list-price-field\n                :price=\"prices\"\n                :default-price=\"defaultPrice\"\n                :tax-rate=\"taxRate\"\n                :label=\"false\"\n                :disable-suffix=\"true\"\n                :hide-list-prices=\"hideListPrices\"\n                :hide-regulation-prices=\"hideRegulationPrices\"\n                hide-purchase-prices\n                :disabled=\"disabled\"\n                enable-inheritance\n                :currency=\"item\"\n            />\n            {% endblock %}\n        </template>\n        {% endblock %}\n    </sw-data-grid>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_maintain_currencies_modal_footer %}\n    <template #modal-footer>\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_maintain_currencies_modal_footer_button_cancel %}\n        <sw-button\n            size=\"small\"\n            @click=\"onCancel\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_maintain_currencies_modal_footer_button_apply %}\n        <sw-button\n            variant=\"primary\"\n            size=\"small\"\n            @click=\"onApply\"\n        >\n            {{ $tc('global.default.apply') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n","/**\n * @package admin\n */\n\nimport template from './sw-maintain-currencies-modal.html.twig';\nimport './sw-maintain-currencies-modal.scss';\n\nconst { Component } = Cicada;\nconst { Criteria } = Cicada.Data;\n\n/**\n * @private\n */\nComponent.register('sw-maintain-currencies-modal', {\n    template,\n    inject: ['repositoryFactory'],\n\n    compatConfig: Cicada.compatConfig,\n\n    emits: [\n        'update-prices',\n        'modal-close',\n    ],\n\n    props: {\n        currencies: {\n            type: Array,\n            default() {\n                return [];\n            },\n            required: false,\n        },\n\n        prices: {\n            type: Array,\n            required: true,\n        },\n\n        defaultPrice: {\n            type: Object,\n            required: true,\n        },\n\n        taxRate: {\n            type: Object,\n            required: true,\n        },\n\n        // eslint-disable-next-line vue/require-prop-types\n        hideListPrices: {\n            required: false,\n            default: false,\n        },\n\n        hideRegulationPrices: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n\n        disabled: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n    },\n\n    data() {\n        return {\n            currencyCollection: [],\n            clonePrices: null,\n        };\n    },\n\n    computed: {\n        maintainCurrencyColumns() {\n            return [\n                {\n                    property: 'name',\n                    label: '',\n                    visible: true,\n                    allowResize: false,\n                    primary: true,\n                    rawData: false,\n                    width: '150px',\n                },\n                {\n                    property: 'price',\n                    label: 'sw-maintain-currencies-modal.columnPrice',\n                    visible: true,\n                    allowResize: false,\n                    primary: true,\n                    rawData: false,\n                },\n            ];\n        },\n    },\n\n    watch: {\n        currencies: function currenciesChanged() {\n            this.createdComponent();\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            if (this.currencies.length > 0) {\n                this.updateCurrencyCollectionFromCurrencies();\n            } else {\n                this.loadCurrencies();\n            }\n\n            this.clonePrices = Cicada.Utils.object.cloneDeep(this.prices);\n        },\n\n        loadCurrencies() {\n            this.repositoryFactory\n                .create('currency')\n                .search(new Criteria(1, 25))\n                .then((response) => {\n                    this.currencyCollection = response;\n                    this.sortCurrencies();\n                });\n        },\n\n        updateCurrencyCollectionFromCurrencies() {\n            if (this.currencyCollection.length > 0) {\n                const isSame = this.currencies.every((c) => this.currencyCollection.some((_c) => c.id === _c.id));\n\n                if (!isSame) {\n                    this.currencyCollection = this.currencies;\n                    this.sortCurrencies();\n                }\n            } else {\n                this.currencyCollection = this.currencies;\n                this.sortCurrencies();\n            }\n        },\n\n        sortCurrencies() {\n            this.currencyCollection.sort((a, b) => {\n                if (a.isSystemDefault) {\n                    return -1;\n                }\n                if (b.isSystemDefault) {\n                    return +1;\n                }\n                if (a.translated.name < b.translated.name) {\n                    return -1;\n                }\n                if (a.translated.name > b.translated.name) {\n                    return 1;\n                }\n                return 0;\n            });\n        },\n\n        convertPrice(value, currency) {\n            const calculatedPrice = value * currency.factor;\n            const priceRounded = calculatedPrice.toFixed(currency.decimalPrecision);\n\n            return Number(priceRounded);\n        },\n\n        isCurrencyInherited(currency) {\n            const priceForCurrency = this.prices.find((price) => {\n                return price.currencyId === currency.id;\n            });\n\n            return !priceForCurrency;\n        },\n\n        onInheritanceRestore(currencyId) {\n            // create entry for currency in prices\n            const indexOfPrice = this.prices.findIndex((price) => {\n                return price.currencyId === currencyId;\n            });\n\n            this.$emit('update-prices', indexOfPrice);\n\n            this.createdComponent();\n        },\n\n        onInheritanceRemove(currency) {\n            const price = {\n                currencyId: currency.id,\n                gross: this.convertPrice(this.defaultPrice.gross, currency),\n                linked: this.defaultPrice.linked,\n                net: this.convertPrice(this.defaultPrice.net, currency),\n                listPrice: null,\n            };\n\n            if (this.defaultPrice.listPrice) {\n                price.listPrice = {\n                    currencyId: currency.id,\n                    gross: this.convertPrice(this.defaultPrice.listPrice.gross, currency),\n                    linked: this.defaultPrice.listPrice.linked,\n                    net: this.convertPrice(this.defaultPrice.listPrice.net, currency),\n                };\n            }\n\n            if (this.isCompatEnabled('INSTANCE_SET')) {\n                // create new entry for currency in prices\n                this.$set(this.prices, this.prices.length, price);\n            } else {\n                // eslint-disable-next-line vue/no-mutating-props\n                this.prices[this.prices.length] = price;\n            }\n\n            this.createdComponent();\n        },\n\n        onCancel() {\n            this.$emit('modal-close', this.clonePrices);\n        },\n\n        onApply() {\n            this.$emit('modal-close', this.prices);\n        },\n    },\n});\n"],"names":["template","Component","Criteria","response","c","_c","a","b","value","currency","priceRounded","price","currencyId","indexOfPrice"],"mappings":"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"}