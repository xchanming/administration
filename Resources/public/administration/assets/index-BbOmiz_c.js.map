{"version":3,"file":"index-BbOmiz_c.js","sources":["../../../app/administration/src/module/sw-promotion-v2/page/sw-promotion-v2-detail/sw-promotion-v2-detail.html.twig","../../../app/administration/src/module/sw-promotion-v2/page/sw-promotion-v2-detail/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_promotion_v2_detail %}\n<sw-page class=\"sw-promotion-v2-detail\">\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_detail_header %}\n    <template #smart-bar-header>\n        <h2>{{ placeholder(promotion, 'name', $tc('sw-promotion-v2.detail.header.titleEdit')) }}</h2>\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_detail_actions %}\n    <template #smart-bar-actions>\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_detail_actions_abort %}\n        <sw-button\n            v-tooltip.bottom=\"tooltipCancel\"\n            class=\"sw-promotion-v2-detail__cancel-action\"\n            :disabled=\"promotion !== null && promotion.isLoading || undefined\"\n            @click=\"onCancel\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_detail_actions_save %}\n        <sw-button-process\n            v-model:processSuccess=\"isSaveSuccessful\"\n            v-tooltip.bottom=\"tooltipSave\"\n            class=\"sw-promotion-v2-detail__save-action\"\n            variant=\"primary\"\n            :is-loading=\"isLoading\"\n            :disabled=\"isLoading || !acl.can('promotion.editor') || undefined\"\n            :process-success=\"isSaveSuccessful\"\n            @update:process-success=\"saveFinish\"\n            @click.prevent=\"onSave\"\n        >\n            {{ $tc('global.default.save') }}\n        </sw-button-process>\n        {% endblock %}\n\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_detail_language_switch %}\n    <template #language-switch>\n        <sw-language-switch\n            :disabled=\"!promotionId || undefined\"\n            @on-change=\"onChangeLanguage\"\n        />\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_detail_content %}\n    <template #content>\n        <sw-card-view>\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_content_language_info %}\n            <sw-language-info\n                :entity-description=\"placeholder(promotion, 'name', $tc('sw-promotion-v2.detail.header.titleCreate'))\"\n                :is-new-entity=\"!promotionId\"\n            />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_content_tabs %}\n            <sw-tabs\n                v-if=\"!isCreateMode\"\n                class=\"sw-promotion-v2-detail-page__tabs\"\n                position-identifier=\"sw-promotion-detail\"\n            >\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_promotion_v2_detail_content_tabs_general %}\n                <sw-tabs-item\n                    :route=\"{ name: 'sw.promotion.v2.detail.base', params: { id: $route.params.id } }\"\n                    :title=\"$tc('sw-promotion-v2.detail.tabs.tabGeneral')\"\n                    :has-error=\"swPromotionV2DetailBaseError\"\n                    :disabled=\"!promotionId || undefined\"\n                >\n                    {{ $tc('sw-promotion-v2.detail.tabs.tabGeneral') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_promotion_v2_detail_content_tabs_conditions %}\n                <sw-tabs-item\n                    :route=\"{ name: 'sw.promotion.v2.detail.conditions', params: { id: $route.params.id } }\"\n                    :title=\"$tc('sw-promotion-v2.detail.tabs.tabConditions')\"\n                    :disabled=\"!promotionId || undefined\"\n                >\n                    {{ $tc('sw-promotion-v2.detail.tabs.tabConditions') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_promotion_v2_detail_content_tabs_discounts %}\n                <sw-tabs-item\n                    :route=\"{ name: 'sw.promotion.v2.detail.discounts', params: { id: $route.params.id } }\"\n                    :title=\"$tc('sw-promotion-v2.detail.tabs.tabDiscounts')\"\n                    :disabled=\"!promotionId || undefined\"\n                >\n                    {{ $tc('sw-promotion-v2.detail.tabs.tabDiscounts') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n            </sw-tabs>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_content_view %}\n            <div\n                v-if=\"isLoading && !promotion\"\n                class=\"sw-promotion-v2-detail__content-view-skeleton\"\n            >\n                <sw-skeleton />\n                <sw-skeleton />\n            </div>\n\n            <template v-else>\n                <router-view v-slot=\"{ Component }\">\n                    <component\n                        :is=\"Component\"\n                        :promotion=\"promotion\"\n                        :is-create-mode=\"isCreateMode\"\n                        @clean-up-codes=\"onCleanUpCodes\"\n                        @generate-individual-codes-finish=\"onGenerateIndividualCodesFinish\"\n                        @delete-individual-codes-finish=\"onDeleteIndividualCodesFinish\"\n                    />\n                </router-view>\n            </template>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_change_code_type_modal %}\n            <sw-modal\n                v-if=\"!!showCodeTypeChangeModal\"\n                class=\"sw-promotion-v2-detail__change-modal\"\n                :title=\"$tc('sw-promotion-v2.detail.codeChangeModal.title')\"\n                @modal-close=\"onCloseCodeTypeChangeModal\"\n            >\n\n                {{ $tc('sw-promotion-v2.detail.codeChangeModal.text') }}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_promotion_v2_detail_change_code_type_modal_footer %}\n                <template #modal-footer>\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_promotion_v2_detail_change_code_type_modal_footer_cancel_action %}\n                    <sw-button\n                        class=\"sw-promotion-v2-detail__change-modal-cancel-action\"\n                        size=\"small\"\n                        @click=\"onCloseCodeTypeChangeModal\"\n                    >\n                        {{ $tc('global.default.cancel') }}\n                    </sw-button>\n                    {% endblock %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_promotion_v2_detail_change_code_type_modal_footer_confirm_action %}\n                    <sw-button\n                        class=\"sw-promotion-v2-detail__change-modal-confirm-action\"\n                        size=\"small\"\n                        variant=\"primary\"\n                        @click=\"onConfirmSave\"\n                    >\n                        {{ $tc('global.default.confirm') }}\n                    </sw-button>\n                    {% endblock %}\n\n                </template>\n                {% endblock %}\n\n            </sw-modal>\n            {% endblock %}\n\n        </sw-card-view>\n    </template>\n    {% endblock %}\n\n</sw-page>\n{% endblock %}\n","/**\n * @package checkout\n */\nimport template from './sw-promotion-v2-detail.html.twig';\nimport errorConfig from './error-config.json';\n\nconst { Mixin } = Cicada;\nconst { Criteria } = Cicada.Data;\nconst { mapPageErrors } = Cicada.Component.getComponentHelper();\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n    ],\n\n    mixins: [\n        'notification',\n        'placeholder',\n        Mixin.getByName('discard-detail-page-changes')('promotion'),\n    ],\n\n    shortcuts: {\n        'SYSTEMKEY+S': {\n            active() {\n                return this.acl.can('promotion.editor');\n            },\n            method: 'onSave',\n        },\n        ESCAPE: 'onCancel',\n    },\n\n    props: {\n        promotionId: {\n            type: String,\n            required: false,\n            default() {\n                return null;\n            },\n        },\n    },\n\n    data() {\n        return {\n            isLoading: false,\n            promotion: null,\n            cleanUpIndividualCodes: false,\n            cleanUpFixedCode: false,\n            showCodeTypeChangeModal: false,\n            isSaveSuccessful: false,\n            saveCallbacks: [],\n        };\n    },\n\n    metaInfo() {\n        return {\n            title: this.$createTitle(this.identifier),\n        };\n    },\n\n    computed: {\n        identifier() {\n            return this.placeholder(this.promotion, 'name');\n        },\n\n        promotionRepository() {\n            return this.repositoryFactory.create('promotion');\n        },\n\n        isCreateMode() {\n            return this.$route.name === 'sw.promotion.v2.create.base';\n        },\n\n        promotionCriteria() {\n            const criteria = new Criteria(1, 1)\n                .addAssociation('discounts.promotionDiscountPrices')\n                .addAssociation('discounts.discountRules')\n                .addAssociation('salesChannels');\n\n            criteria.getAssociation('discounts').addSorting(Criteria.sort('createdAt', 'ASC'));\n\n            criteria.getAssociation('individualCodes').setLimit(25);\n\n            return criteria;\n        },\n\n        tooltipSave() {\n            if (!this.acl.can('promotion.editor')) {\n                return {\n                    message: this.$tc('sw-privileges.tooltip.warning'),\n                    showOnDisabledElements: true,\n                };\n            }\n\n            const systemKey = this.$device.getSystemKey();\n\n            return {\n                message: `${systemKey} + S`,\n                appearance: 'light',\n            };\n        },\n\n        tooltipCancel() {\n            return {\n                message: 'ESC',\n                appearance: 'light',\n            };\n        },\n\n        promotionGroupRepository() {\n            return this.repositoryFactory.create('promotion_setgroup');\n        },\n\n        ...mapPageErrors(errorConfig),\n    },\n\n    watch: {\n        promotionId() {\n            this.createdComponent();\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            Cicada.ExtensionAPI.publishData({\n                id: 'sw-promotion-detail__promotion',\n                path: 'promotion',\n                scope: this,\n            });\n            this.isLoading = true;\n\n            if (!this.promotionId) {\n                // set language to system language\n                if (!Cicada.State.getters['context/isSystemDefaultLanguage']) {\n                    Cicada.State.commit('context/resetLanguageToDefault');\n                }\n\n                this.promotion = this.promotionRepository.create();\n                this.isLoading = false;\n\n                return;\n            }\n\n            this.loadEntityData();\n        },\n\n        loadEntityData() {\n            if (!this.promotionId) {\n                return Promise.resolve();\n            }\n\n            return this.promotionRepository\n                .get(this.promotionId, Cicada.Context.api, this.promotionCriteria)\n                .then((promotion) => {\n                    if (promotion === null) {\n                        return;\n                    }\n\n                    this.promotion = promotion;\n\n                    if (!this.promotion || !this.promotion.discounts || this.promotion.length < 1) {\n                        return;\n                    }\n\n                    // Needed to enrich the VueX state below\n                    this.promotion.hasOrders = promotion.orderCount !== null ? promotion.orderCount > 0 : false;\n\n                    Cicada.State.commit('swPromotionDetail/setPromotion', this.promotion);\n                })\n                .finally(() => {\n                    this.isLoading = false;\n                });\n        },\n\n        onChangeLanguage() {\n            this.loadEntityData();\n        },\n\n        onSave() {\n            if (!this.promotionId) {\n                this.savePromotion();\n\n                return;\n            }\n\n            if (\n                ![\n                    this.cleanUpIndividualCodes,\n                    this.cleanUpFixedCode,\n                ].some((check) => check)\n            ) {\n                this.savePromotion();\n\n                return;\n            }\n\n            this.showCodeTypeChangeModal = true;\n        },\n\n        onConfirmSave() {\n            this.onCloseCodeTypeChangeModal();\n            this.savePromotion();\n        },\n\n        onCloseCodeTypeChangeModal() {\n            this.showCodeTypeChangeModal = false;\n        },\n\n        /**\n         * @deprecated tag:v6.7.0 - Will be removed. Use `savePromotion` instead\n         */\n        createPromotion() {\n            return this.savePromotion();\n        },\n\n        async savePromotion() {\n            this.isLoading = true;\n\n            if (this.cleanUpIndividualCodes === true) {\n                this.promotion.individualCodes = this.promotion.individualCodes.filter(() => false);\n            }\n\n            if (this.cleanUpFixedCode === true) {\n                this.promotion.code = '';\n            }\n\n            if (this.promotion.discounts) {\n                this.promotion.discounts.forEach((discount) => {\n                    if (discount.type === 'free') {\n                        Object.assign(discount, {\n                            type: 'percentage',\n                            value: 100,\n                            applierKey: 'SELECT',\n                        });\n                    }\n                });\n            }\n\n            try {\n                await this.promotionRepository.save(this.promotion);\n                await this.savePromotionSetGroups();\n\n                Cicada.State.commit('swPromotionDetail/setSetGroupIdsDelete', []);\n                this.isSaveSuccessful = true;\n                await this.loadEntityData();\n\n                if (this.isCreateMode) {\n                    this.$router.push({\n                        name: 'sw.promotion.v2.detail',\n                        params: { id: this.promotion.id },\n                    });\n                }\n            } catch (e) {\n                this.isLoading = false;\n                this.createNotificationError({\n                    message: this.$tc('global.notification.notificationSaveErrorMessage', 0, {\n                        entityName: this.promotion.name,\n                    }),\n                });\n            } finally {\n                this.cleanUpCodes(false, false);\n            }\n        },\n\n        savePromotionSetGroups() {\n            const setGroupIdsDelete = Cicada.State.get('swPromotionDetail').setGroupIdsDelete;\n\n            if (setGroupIdsDelete !== null) {\n                const deletePromises = setGroupIdsDelete.map((groupId) => {\n                    return this.promotionGroupRepository.delete(groupId);\n                });\n\n                return Promise.all(deletePromises);\n            }\n\n            return Promise.resolve();\n        },\n\n        saveFinish() {\n            this.isSaveSuccessful = false;\n        },\n\n        onCancel() {\n            this.$router.push({ name: 'sw.promotion.v2.index' });\n        },\n\n        onCleanUpCodes(cleanUpIndividual, cleanUpFixed) {\n            this.cleanUpCodes(cleanUpIndividual, cleanUpFixed);\n        },\n\n        cleanUpCodes(cleanUpIndividual, cleanUpFixed) {\n            this.cleanUpIndividualCodes = cleanUpIndividual;\n            this.cleanUpFixedCode = cleanUpFixed;\n        },\n\n        onGenerateIndividualCodesFinish() {\n            this.savePromotion();\n        },\n\n        onDeleteIndividualCodesFinish() {\n            this.savePromotion();\n        },\n    },\n};\n"],"names":["template","Mixin","Criteria","mapPageErrors","index","criteria","errorConfig","promotion","check","discount","setGroupIdsDelete","deletePromises","groupId","cleanUpIndividual","cleanUpFixed"],"mappings":"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"}