{"version":3,"file":"index-BJIIe8DX.js","sources":["../../../app/administration/src/module/sw-settings-mailer/page/sw-settings-mailer/sw-settings-mailer.html.twig","../../../app/administration/src/module/sw-settings-mailer/page/sw-settings-mailer/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_settings_mailer_index %}\n<sw-page class=\"sw-settings-mailer\">\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_mailer_smart_bar_header %}\n    <template #smart-bar-header>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_mailer_smart_bar_header_title %}\n        <h2>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_mailer_smart_bar_header_title_text %}\n            {{ $tc('sw-settings.index.title') }}\n            <sw-icon\n                name=\"regular-chevron-right-xs\"\n                small\n            />\n            {{ $tc('sw-settings-mailer.general.textHeadline') }}\n            {% endblock %}\n        </h2>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_mailer_smart_bar_actions %}\n    <template #smart-bar-actions>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_mailer_actions_save %}\n        <sw-button-process\n            :is-loading=\"isLoading\"\n            :process-success=\"isSaveSuccessful\"\n            variant=\"primary\"\n            @update:process-success=\"onSaveFinish\"\n            @click=\"saveMailerSettings\"\n        >\n            {{ $tc('sw-settings-mailer.general.buttonSave') }}\n        </sw-button-process>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_mailer_content %}\n    <template #content>\n        <sw-card-view>\n            <sw-skeleton v-if=\"isLoading\" />\n\n            <sw-card\n                v-else\n                position-identifier=\"sw-settings-mailer-configuration\"\n                :is-loading=\"isLoading\"\n                :title=\"$tc('sw-settings-mailer.mailer-configuration.card-title')\"\n            >\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_mailer_first_configuration %}\n                <div\n                    v-if=\"isFirstConfiguration\"\n                    class=\"sw-settings-mailer__first-configuration\"\n                >\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_settings_mailer_first_configuration_headline %}\n                    <h4 class=\"sw-settings-mailer__headline\">\n                        <strong>\n                            {{ $tc('sw-settings-mailer.first-configuration.headline') }}\n                        </strong>\n                    </h4>\n                    {% endblock %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_settings_mailer_first_configuration_description %}\n                    <p>\n                        {{ $tc('sw-settings-mailer.first-configuration.description') }}\n                    </p>\n                    {% endblock %}\n                </div>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_mailer_headline_agent %}\n                <p class=\"sw-settings-mailer__headline\">\n                    {{ $tc('sw-settings-mailer.mailer-configuration.agent') }}\n                </p>\n                {% endblock %}\n\n                <div class=\"sw-settings-mailer__radio-selection\">\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_settings_mailer_agent_options %}\n                    <sw-select-field\n                        v-model:value=\"mailerSettings['core.mailerSettings.emailAgent']\"\n                    >\n                        <option value=\"local\">\n                            {{ $tc('sw-settings-mailer.mailer-configuration.local-agent') }}\n                        </option>\n                        <option value=\"smtp\">\n                            {{ $tc('sw-settings-mailer.mailer-configuration.smtp-server') }}\n                        </option>\n                        <option value=\"smtp+oauth\">\n                            {{ $tc('sw-settings-mailer.mailer-configuration.smtp-server-oauth') }}\n                        </option>\n                        <option value=\"\">\n                            {{ $tc('sw-settings-mailer.mailer-configuration.env-file') }}\n                        </option>\n                    </sw-select-field>\n\n                    <sw-radio-field\n                        v-if=\"mailerSettings['core.mailerSettings.emailAgent'] === 'local'\"\n                        v-model:value=\"mailerSettings['core.mailerSettings.sendMailOptions']\"\n                        :options=\"emailSendmailOptions\"\n                    />\n                    {% endblock %}\n                </div>\n\n                <sw-switch-field\n                    v-if=\"!isSmtpMode\"\n                    v-model:value=\"mailerSettings['core.mailerSettings.disableDelivery']\"\n                    size=\"small\"\n                    :label=\"$tc('sw-settings-mailer.card-smtp.disable-delivery')\"\n                />\n            </sw-card>\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_mailer_smtp %}\n            <sw-card\n                v-if=\"isSmtpMode\"\n                position-identifier=\"sw-settings-mailer-smtp-settings\"\n                :is-loading=\"isLoading\"\n                title=\"SMTP server\"\n                class=\"sw-settings-mailer__input-fields\"\n            >\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_mailer_smtp_settings %}\n                <sw-settings-mailer-smtp\n                    :mailer-settings=\"mailerSettings\"\n                    :host-error=\"smtpHostError\"\n                    :port-error=\"smtpPortError\"\n                    @host-changed=\"resetSmtpHostError\"\n                    @port-changed=\"resetSmtpPortError\"\n                />\n                {% endblock %}\n\n            </sw-card>\n            {% endblock %}\n        </sw-card-view>\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n","/**\n * @package services-settings\n */\nimport template from './sw-settings-mailer.html.twig';\nimport './sw-settings-mailer.scss';\n\nconst defaultMailerSettings = {\n    'core.mailerSettings.emailAgent': null,\n    'core.mailerSettings.host': null,\n    'core.mailerSettings.port': null,\n    'core.mailerSettings.username': null,\n    'core.mailerSettings.password': null,\n    'core.mailerSettings.encryption': 'null',\n    'core.mailerSettings.senderAddress': null,\n    'core.mailerSettings.deliveryAddress': null,\n    'core.mailerSettings.disableDelivery': false,\n};\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: ['systemConfigApiService'],\n\n    mixins: ['notification'],\n\n    data() {\n        return {\n            isLoading: true,\n            isSaveSuccessful: false,\n            isFirstConfiguration: false,\n            mailerSettings: { ...defaultMailerSettings },\n            smtpHostError: null,\n            smtpPortError: null,\n        };\n    },\n\n    metaInfo() {\n        return {\n            title: this.$createTitle(),\n        };\n    },\n\n    computed: {\n        emailSendmailOptions() {\n            return [\n                {\n                    value: '-bs',\n                    name: this.$tc('sw-settings-mailer.sendmail.sync'),\n                },\n                {\n                    value: '-t -i',\n                    name: this.$tc('sw-settings-mailer.sendmail.async'),\n                },\n            ];\n        },\n\n        isSmtpMode() {\n            return [\n                'smtp',\n                'smtp+oauth',\n            ].includes(this.mailerSettings['core.mailerSettings.emailAgent']);\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        async createdComponent() {\n            await this.loadPageContent();\n        },\n\n        async loadPageContent() {\n            await this.loadMailerSettings();\n            this.checkFirstConfiguration();\n        },\n\n        async loadMailerSettings() {\n            this.isLoading = true;\n            this.mailerSettings = await this.systemConfigApiService.getValues('core.mailerSettings');\n\n            // Default when config is empty\n            if (Object.keys(this.mailerSettings).length === 0) {\n                this.mailerSettings = {\n                    'core.mailerSettings.emailAgent': '',\n                    'core.mailerSettings.sendMailOptions': '-t -i',\n                };\n            }\n\n            this.isLoading = false;\n        },\n\n        async saveMailerSettings() {\n            this.isLoading = true;\n\n            // Inputs cannot return null\n            if (this.mailerSettings['core.mailerSettings.emailAgent'] === '') {\n                this.mailerSettings['core.mailerSettings.emailAgent'] = null;\n            }\n\n            // Validate smtp configuration\n            if (this.isSmtpMode) {\n                this.validateSmtpConfiguration();\n            }\n\n            // SMTP configuration invalid stop save and propagate error notification\n            if (this.smtpHostError !== null || this.smtpPortError !== null) {\n                this.createNotificationError({\n                    title: this.$tc('global.default.error'),\n                    message: this.$tc('sw-settings-mailer.card-smtp.error.notificationMessage'),\n                });\n\n                this.isLoading = false;\n\n                return;\n            }\n\n            // Reset mailerSettings as local would take over certain values\n            if (this.mailerSettings['core.mailerSettings.emailAgent'] === 'local') {\n                this.mailerSettings = {\n                    ...defaultMailerSettings,\n                    'core.mailerSettings.emailAgent': 'local',\n                };\n            }\n\n            await this.systemConfigApiService.saveValues(this.mailerSettings);\n            this.isLoading = false;\n        },\n\n        async onSaveFinish() {\n            await this.loadPageContent();\n        },\n\n        checkFirstConfiguration() {\n            this.isFirstConfiguration = !this.mailerSettings['core.mailerSettings.emailAgent'];\n        },\n\n        validateSmtpConfiguration() {\n            this.smtpHostError = !this.mailerSettings['core.mailerSettings.host']\n                ? {\n                      detail: this.$tc('global.error-codes.c1051bb4-d103-4f74-8988-acbcafc7fdc3'),\n                  }\n                : null;\n\n            this.smtpPortError =\n                typeof this.mailerSettings['core.mailerSettings.port'] !== 'number'\n                    ? {\n                          detail: this.$tc('global.error-codes.c1051bb4-d103-4f74-8988-acbcafc7fdc3'),\n                      }\n                    : null;\n        },\n\n        resetSmtpHostError() {\n            this.smtpHostError = null;\n        },\n\n        resetSmtpPortError() {\n            this.smtpPortError = null;\n        },\n    },\n};\n"],"names":["template","defaultMailerSettings","index"],"mappings":"AAAA,MAAeA,EAAA,0yGCMTC,EAAwB,CAC1B,iCAAkC,KAClC,2BAA4B,KAC5B,2BAA4B,KAC5B,+BAAgC,KAChC,+BAAgC,KAChC,iCAAkC,OAClC,oCAAqC,KACrC,sCAAuC,KACvC,sCAAuC,EAC3C,EAGeC,EAAA,CACX,SAAAF,EAEA,aAAc,OAAO,aAErB,OAAQ,CAAC,wBAAwB,EAEjC,OAAQ,CAAC,cAAc,EAEvB,MAAO,CACH,MAAO,CACH,UAAW,GACX,iBAAkB,GAClB,qBAAsB,GACtB,eAAgB,CAAE,GAAGC,CAAuB,EAC5C,cAAe,KACf,cAAe,IAC3B,CACK,EAED,UAAW,CACP,MAAO,CACH,MAAO,KAAK,aAAc,CACtC,CACK,EAED,SAAU,CACN,sBAAuB,CACnB,MAAO,CACH,CACI,MAAO,MACP,KAAM,KAAK,IAAI,kCAAkC,CACpD,EACD,CACI,MAAO,QACP,KAAM,KAAK,IAAI,mCAAmC,CACrD,CACjB,CACS,EAED,YAAa,CACT,MAAO,CACH,OACA,YACH,EAAC,SAAS,KAAK,eAAe,gCAAgC,CAAC,CACnE,CACJ,EAED,SAAU,CACN,KAAK,iBAAgB,CACxB,EAED,QAAS,CACL,MAAM,kBAAmB,CACrB,MAAM,KAAK,iBACd,EAED,MAAM,iBAAkB,CACpB,MAAM,KAAK,qBACX,KAAK,wBAAuB,CAC/B,EAED,MAAM,oBAAqB,CACvB,KAAK,UAAY,GACjB,KAAK,eAAiB,MAAM,KAAK,uBAAuB,UAAU,qBAAqB,EAGnF,OAAO,KAAK,KAAK,cAAc,EAAE,SAAW,IAC5C,KAAK,eAAiB,CAClB,iCAAkC,GAClC,sCAAuC,OAC3D,GAGY,KAAK,UAAY,EACpB,EAED,MAAM,oBAAqB,CAcvB,GAbA,KAAK,UAAY,GAGb,KAAK,eAAe,gCAAgC,IAAM,KAC1D,KAAK,eAAe,gCAAgC,EAAI,MAIxD,KAAK,YACL,KAAK,0BAAyB,EAI9B,KAAK,gBAAkB,MAAQ,KAAK,gBAAkB,KAAM,CAC5D,KAAK,wBAAwB,CACzB,MAAO,KAAK,IAAI,sBAAsB,EACtC,QAAS,KAAK,IAAI,wDAAwD,CAC9F,CAAiB,EAED,KAAK,UAAY,GAEjB,MACH,CAGG,KAAK,eAAe,gCAAgC,IAAM,UAC1D,KAAK,eAAiB,CAClB,GAAGA,EACH,iCAAkC,OACtD,GAGY,MAAM,KAAK,uBAAuB,WAAW,KAAK,cAAc,EAChE,KAAK,UAAY,EACpB,EAED,MAAM,cAAe,CACjB,MAAM,KAAK,iBACd,EAED,yBAA0B,CACtB,KAAK,qBAAuB,CAAC,KAAK,eAAe,gCAAgC,CACpF,EAED,2BAA4B,CACxB,KAAK,cAAiB,KAAK,eAAe,0BAA0B,EAI9D,KAHA,CACI,OAAQ,KAAK,IAAI,yDAAyD,CAC7E,EAGP,KAAK,cACD,OAAO,KAAK,eAAe,0BAA0B,GAAM,SACrD,CACI,OAAQ,KAAK,IAAI,yDAAyD,CAC7E,EACD,IACb,EAED,oBAAqB,CACjB,KAAK,cAAgB,IACxB,EAED,oBAAqB,CACjB,KAAK,cAAgB,IACxB,CACJ,CACL"}