{"version":3,"file":"index-CRzmX8ms.js","sources":["../../../app/administration/src/module/sw-import-export/component/sw-import-export-edit-profile-modal/sw-import-export-edit-profile-modal.html.twig","../../../app/administration/src/module/sw-import-export/component/sw-import-export-edit-profile-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_import_export_edit_profile_modal %}\n<div class=\"sw-import-export-edit-profile-modal\">\n    <sw-modal\n        v-if=\"show && profile\"\n        class=\"sw-import-export-edit-profile-modal\"\n        :title=\"modalTitle\"\n        variant=\"full\"\n        @modal-close=\"$emit('profile-close')\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_edit_profile_modal_alert %}\n        <sw-alert\n            v-if=\"profile.systemDefault\"\n            variant=\"info\"\n        >\n            {{ $tc('sw-import-export.profile.systemDefaultInfoText') }}\n        </sw-alert>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_edit_profile_modal_tabs %}\n        <sw-tabs\n            position-identifier=\"sw-import-export-edit-profile-modal\"\n            :small=\"false\"\n            default-item=\"general\"\n        >\n\n            <template #default=\"{ active }\">\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_import_export_edit_profile_modal_tabs_general %}\n                <sw-tabs-item\n                    :title=\"$tc('sw-import-export.profile.generalTab')\"\n                    :active-tab=\"active\"\n                    name=\"general\"\n                >\n                    {{ $tc('sw-import-export.profile.generalTab') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_import_export_edit_profile_modal_tabs_field_mappings %}\n                <sw-tabs-item\n                    :title=\"$tc('sw-import-export.profile.mappingsTab')\"\n                    :active-tab=\"active\"\n                    name=\"mappings\"\n                >\n                    {{ $tc('sw-import-export.profile.mappingsTab') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_import_export_edit_profile_modal_tabs_field_advanced %}\n                <sw-tabs-item\n                    v-if=\"profile.type !== 'export' && profile.config.updateEntities !== false\"\n                    :title=\"$tc('sw-import-export.profile.advancedTab')\"\n                    :active-tab=\"active\"\n                    name=\"advanced\"\n                >\n                    {{ $tc('sw-import-export.profile.advancedTab') }}\n                </sw-tabs-item>\n                {% endblock %}\n            </template>\n\n            <template #content=\"{ active }\">\n                <template v-if=\"active === 'general'\">\n                    <sw-import-export-edit-profile-general :profile=\"profile\" />\n\n                    <sw-import-export-edit-profile-field-indicators :profile=\"profile\" />\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_import_export_edit_profile_modal_tabs_general_import_settings %}\n                    <sw-import-export-edit-profile-import-settings :profile=\"profile\" />\n                    {% endblock %}\n                </template>\n\n                <template v-if=\"active === 'mappings'\">\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_import_export_edit_profile_modal_tabs_mappings %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_import_export_edit_profile_modal_tabs_mappings_text %}\n                    <p class=\"sw-import-export-edit-profile-modal__text\">\n                        {{ $tc('sw-import-export.profile.mappingDescription') }}\n                    </p>\n                    {% endblock %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_import_export_edit_profile_modal_tabs_mappings_mapping %}\n                    <sw-import-export-edit-profile-modal-mapping\n                        :profile=\"profile\"\n                        :system-required-fields=\"systemRequiredFields\"\n                        @update-mapping=\"updateMapping\"\n                    />\n                    {% endblock %}\n                    {% endblock %}\n                </template>\n\n                <template v-if=\"active === 'advanced' && profile.type !== 'export' && profile.config.updateEntities !== false\">\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_import_export_edit_profile_modal_tabs_advanced %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_import_export_edit_profile_modal_tabs_advanced_text %}\n                    <p class=\"sw-import-export-edit-profile-modal__text\">\n                        {{ $tc('sw-import-export.profile.advancedDescription') }}\n                    </p>\n                    {% endblock %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_import_export_edit_profile_modal_tabs_advanced_identifiers %}\n                    <sw-import-export-edit-profile-modal-identifiers\n                        :profile=\"profile\"\n                    />\n                    {% endblock %}\n                    {% endblock %}\n                </template>\n\n                <template v-if=\"active === 'fieldIndicators'\">\n                    <p class=\"sw-import-export-edit-profile-modal__text\">\n                        {{ $tc('sw-import-export.profile.csvDescriptionBlock') }}\n                    </p>\n                </template>\n            </template>\n        </sw-tabs>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_edit_profile_modal_footer %}\n        <template #modal-footer>\n            <sw-button\n                size=\"small\"\n                @click=\"$emit('profile-close')\"\n            >\n                {{ $tc('global.default.cancel') }}\n            </sw-button>\n            <template v-if=\"profile.systemDefault\">\n                <sw-button\n                    class=\"sw-import-export-edit-profile-modal__save-action\"\n                    size=\"small\"\n                    variant=\"primary\"\n                    @click=\"$emit('profile-close')\"\n                >\n                    {{ $tc('sw-import-export.profile.closeProfileLabel') }}\n                </sw-button>\n            </template>\n            <template v-else>\n                <sw-button\n                    class=\"sw-import-export-edit-profile-modal__save-action\"\n                    size=\"small\"\n                    :disabled=\"!profile.sourceEntity\n                        || profile.sourceEntity.length <= 0\n                        || !profile.type\"\n                    variant=\"primary\"\n                    @click=\"saveProfile\"\n                >\n                    {{ saveLabelSnippet }}\n                </sw-button>\n            </template>\n        </template>\n        {% endblock %}\n    </sw-modal>\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_edit_profile_violation_modal %}\n    <sw-modal\n        v-if=\"showValidationError\"\n        :title=\"$tc('global.default.error')\"\n        class=\"sw-import-export-edit-profile-modal__violation-modal\"\n        @modal-close=\"resetViolations\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_edit_profile_violation_modal_message %}\n        <p>{{ $tc('sw-import-export.profile.violationMessage') }}</p>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_edit_profile_violation_modal_required_fields %}\n        <ul>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_import_export_edit_profile_violation_modal_required_field %}\n            <li\n                v-for=\"requiredField in missingRequiredFields\"\n                :key=\"requiredField\"\n            >\n                {{ requiredField }}\n            </li>\n            {% endblock %}\n        </ul>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_edit_profile_violation_modal_footer %}\n        <template #modal-footer>\n            <sw-button\n                size=\"small\"\n                @click=\"resetViolations\"\n            >\n                {{ $tc('sw-import-export.profile.closeViolation') }}\n            </sw-button>\n        </template>\n        {% endblock %}\n    </sw-modal>\n    {% endblock %}\n</div>\n{% endblock %}\n","/**\n * @package services-settings\n */\nimport template from './sw-import-export-edit-profile-modal.html.twig';\nimport './sw-import-export-edit-profile-modal.scss';\n\nconst { Mixin } = Cicada;\nconst { Criteria } = Cicada.Data;\nconst { mapPropertyErrors } = Cicada.Component.getComponentHelper();\n\n/**\n * @private\n */\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'feature',\n        'importExportProfileMapping',\n        'importExportUpdateByMapping',\n    ],\n\n    emits: [\n        'profile-close',\n        'profile-save',\n    ],\n\n    mixins: [Mixin.getByName('notification')],\n\n    props: {\n        profile: {\n            type: Object,\n            required: false,\n            default() {\n                return {};\n            },\n        },\n        show: {\n            type: Boolean,\n            required: false,\n            // eslint-disable-next-line vue/no-boolean-default\n            default() {\n                return true;\n            },\n        },\n    },\n\n    data() {\n        return {\n            missingRequiredFields: [],\n            systemRequiredFields: {},\n        };\n    },\n\n    computed: {\n        ...mapPropertyErrors('profile', [\n            'name',\n            'sourceEntity',\n            'delimiter',\n            'enclosure',\n            'type',\n        ]),\n\n        isNew() {\n            if (!this.profile || !this.profile.isNew) {\n                return false;\n            }\n\n            return this.profile.isNew();\n        },\n\n        modalTitle() {\n            return this.isNew\n                ? this.$tc('sw-import-export.profile.newProfileLabel')\n                : this.$tc('sw-import-export.profile.editProfileLabel');\n        },\n\n        saveLabelSnippet() {\n            return this.isNew\n                ? this.$tc('sw-import-export.profile.addProfileLabel')\n                : this.$tc('sw-import-export.profile.saveProfileLabel');\n        },\n\n        showValidationError() {\n            return this.missingRequiredFields.length > 0;\n        },\n\n        profileRepository() {\n            return this.repositoryFactory.create('import_export_profile');\n        },\n    },\n\n    watch: {\n        'profile.sourceEntity': {\n            handler(value) {\n                if (value) {\n                    this.loadSystemRequiredFieldsForEntity(value);\n                }\n            },\n        },\n        'profile.mapping': {\n            handler() {\n                this.importExportUpdateByMapping.removeUnusedMappings(this.profile);\n            },\n        },\n    },\n\n    methods: {\n        saveProfile() {\n            this.getParentProfileSelected().then((parentProfile) => {\n                this.checkValidation(parentProfile);\n\n                if (this.missingRequiredFields.length === 0) {\n                    this.$emit('profile-save');\n                }\n            });\n        },\n\n        updateMapping(newProfile) {\n            this.profile.mapping = newProfile;\n        },\n\n        getParentProfileSelected() {\n            const criteria = new Criteria(1, 25);\n            criteria.addFilter(Criteria.equals('sourceEntity', this.profile.sourceEntity));\n            criteria.addFilter(Criteria.equals('systemDefault', true));\n\n            return this.profileRepository\n                .search(criteria)\n                .then((results) => {\n                    if (results.total > 0) {\n                        return results[0];\n                    }\n\n                    return null;\n                })\n                .catch(() => {\n                    this.createNotificationError({\n                        message: this.$tc('sw-import-export.profile.messageSearchParentProfileError'),\n                    });\n                });\n        },\n\n        checkValidation(parentProfile) {\n            // Skip validation for only export profiles\n            if (this.profile.type === 'export') {\n                return;\n            }\n\n            const parentMapping = parentProfile ? parentProfile.mapping : [];\n            const isOnlyUpdateProfile =\n                this.profile.config.createEntities === false && this.profile.config.updateEntities === true;\n            const validationErrors = this.importExportProfileMapping.validate(\n                this.profile.sourceEntity,\n                this.profile.mapping,\n                parentMapping,\n                isOnlyUpdateProfile,\n            );\n\n            if (validationErrors.missingRequiredFields.length > 0) {\n                this.missingRequiredFields = validationErrors.missingRequiredFields;\n            }\n        },\n\n        resetViolations() {\n            this.missingRequiredFields = [];\n        },\n\n        loadSystemRequiredFieldsForEntity(entityName) {\n            this.systemRequiredFields = this.importExportProfileMapping.getSystemRequiredFields(entityName);\n        },\n    },\n};\n"],"names":["template","Mixin","Criteria","mapPropertyErrors","index","value","parentProfile","newProfile","criteria","results","parentMapping","isOnlyUpdateProfile","validationErrors","entityName"],"mappings":"AAAA,MAAeA,EAAA,uxJCMT,CAAE,MAAAC,CAAO,EAAG,OACZ,CAAE,SAAAC,CAAQ,EAAK,OAAO,KACtB,CAAE,kBAAAC,CAAiB,EAAK,OAAO,UAAU,mBAAkB,EAKlDC,EAAA,CACX,SAAAJ,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,oBACA,UACA,6BACA,6BACH,EAED,MAAO,CACH,gBACA,cACH,EAED,OAAQ,CAACC,EAAM,UAAU,cAAc,CAAC,EAExC,MAAO,CACH,QAAS,CACL,KAAM,OACN,SAAU,GACV,SAAU,CACN,MAAO,EACV,CACJ,EACD,KAAM,CACF,KAAM,QACN,SAAU,GAEV,SAAU,CACN,MAAO,EACV,CACJ,CACJ,EAED,MAAO,CACH,MAAO,CACH,sBAAuB,CAAE,EACzB,qBAAsB,CAAE,CACpC,CACK,EAED,SAAU,CACN,GAAGE,EAAkB,UAAW,CAC5B,OACA,eACA,YACA,YACA,MACZ,CAAS,EAED,OAAQ,CACJ,MAAI,CAAC,KAAK,SAAW,CAAC,KAAK,QAAQ,MACxB,GAGJ,KAAK,QAAQ,OACvB,EAED,YAAa,CACT,OAAO,KAAK,MACN,KAAK,IAAI,0CAA0C,EACnD,KAAK,IAAI,2CAA2C,CAC7D,EAED,kBAAmB,CACf,OAAO,KAAK,MACN,KAAK,IAAI,0CAA0C,EACnD,KAAK,IAAI,2CAA2C,CAC7D,EAED,qBAAsB,CAClB,OAAO,KAAK,sBAAsB,OAAS,CAC9C,EAED,mBAAoB,CAChB,OAAO,KAAK,kBAAkB,OAAO,uBAAuB,CAC/D,CACJ,EAED,MAAO,CACH,uBAAwB,CACpB,QAAQE,EAAO,CACPA,GACA,KAAK,kCAAkCA,CAAK,CAEnD,CACJ,EACD,kBAAmB,CACf,SAAU,CACN,KAAK,4BAA4B,qBAAqB,KAAK,OAAO,CACrE,CACJ,CACJ,EAED,QAAS,CACL,aAAc,CACV,KAAK,yBAAwB,EAAG,KAAMC,GAAkB,CACpD,KAAK,gBAAgBA,CAAa,EAE9B,KAAK,sBAAsB,SAAW,GACtC,KAAK,MAAM,cAAc,CAE7C,CAAa,CACJ,EAED,cAAcC,EAAY,CACtB,KAAK,QAAQ,QAAUA,CAC1B,EAED,0BAA2B,CACvB,MAAMC,EAAW,IAAIN,EAAS,EAAG,EAAE,EACnC,OAAAM,EAAS,UAAUN,EAAS,OAAO,eAAgB,KAAK,QAAQ,YAAY,CAAC,EAC7EM,EAAS,UAAUN,EAAS,OAAO,gBAAiB,EAAI,CAAC,EAElD,KAAK,kBACP,OAAOM,CAAQ,EACf,KAAMC,GACCA,EAAQ,MAAQ,EACTA,EAAQ,CAAC,EAGb,IACV,EACA,MAAM,IAAM,CACT,KAAK,wBAAwB,CACzB,QAAS,KAAK,IAAI,0DAA0D,CACpG,CAAqB,CACrB,CAAiB,CACR,EAED,gBAAgBH,EAAe,CAE3B,GAAI,KAAK,QAAQ,OAAS,SACtB,OAGJ,MAAMI,EAAgBJ,EAAgBA,EAAc,QAAU,CAAA,EACxDK,EACF,KAAK,QAAQ,OAAO,iBAAmB,IAAS,KAAK,QAAQ,OAAO,iBAAmB,GACrFC,EAAmB,KAAK,2BAA2B,SACrD,KAAK,QAAQ,aACb,KAAK,QAAQ,QACbF,EACAC,CAChB,EAEgBC,EAAiB,sBAAsB,OAAS,IAChD,KAAK,sBAAwBA,EAAiB,sBAErD,EAED,iBAAkB,CACd,KAAK,sBAAwB,EAChC,EAED,kCAAkCC,EAAY,CAC1C,KAAK,qBAAuB,KAAK,2BAA2B,wBAAwBA,CAAU,CACjG,CACJ,CACL"}