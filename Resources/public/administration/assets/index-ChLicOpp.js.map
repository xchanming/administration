{"version":3,"file":"index-ChLicOpp.js","sources":["../../../app/administration/src/app/component/form/select/entity/sw-entity-tag-select/index.js"],"sourcesContent":["const { Component } = Cicada;\nconst { Criteria } = Cicada.Data;\n\n/**\n * @private\n */\nComponent.extend('sw-entity-tag-select', 'sw-entity-multi-select', {\n    data() {\n        return {\n            tagExists: true,\n        };\n    },\n\n    methods: {\n        resetActiveItem(position = 0) {\n            this.$refs.swSelectResultList.setActiveItemIndex(position);\n        },\n\n        search(searchTerm) {\n            // Remove earlier \"Add Tag\" elements\n            this.filterSearchGeneratedTags();\n\n            Promise.all([\n                this.checkTagExists(this.searchTerm),\n                this.$super('search', searchTerm),\n            ]).then(() => {\n                // Add the \"Add Tag\" Element if no tag exists\n                if (!this.tagExists) {\n                    // Create dummy entity with id -1\n                    const newTag = this.repository.create(this.entityCollection.context, -1);\n                    newTag.name = this.$tc('global.sw-tag-field.listItemAdd', 0, { term: this.searchTerm });\n\n                    this.resultCollection.unshift(newTag);\n                    // Reset active item position, so that the \"Add Tag\" element gets focus\n                    this.$nextTick(this.resetActiveItem);\n                }\n            });\n        },\n\n        addItem(item) {\n            if (item.id === -1) {\n                if (this.isLoading) {\n                    return;\n                }\n\n                this.createNewTag();\n            } else {\n                this.$super('addItem', item);\n            }\n        },\n\n        createNewTag() {\n            const item = this.repository.create(this.entityCollection.context);\n            item.name = this.searchTerm;\n            this.isLoading = true;\n            this.repository\n                .save(item, this.entityCollection.context)\n                .then(() => {\n                    this.addItem(item);\n\n                    // Reset criteria and all parameter to get a clean new result after an item has been added\n                    this.criteria.setPage(1);\n                    this.criteria.setLimit(this.resultLimit);\n                    this.criteria.setTerm('');\n                    this.searchTerm = '';\n                    this.resultCollection = null;\n\n                    return this.loadData();\n                })\n                .then(() => {\n                    this.resetActiveItem();\n                })\n                .finally(() => {\n                    this.isLoading = false;\n                });\n        },\n\n        checkTagExists(term) {\n            if (term.trim().length === 0) {\n                this.tagExists = true;\n                return Promise.resolve();\n            }\n\n            const criteria = new Criteria(1, 25);\n            criteria.addFilter(Criteria.equals('name', term));\n\n            return this.repository.search(criteria, this.context).then((response) => {\n                this.tagExists = response.total > 0;\n            });\n        },\n\n        filterSearchGeneratedTags() {\n            this.resultCollection = this.resultCollection.filter((entity) => {\n                return entity.id !== -1;\n            });\n        },\n    },\n});\n"],"names":["Component","Criteria","position","searchTerm","newTag","item","term","criteria","response","entity"],"mappings":"AAAA,KAAM,CAAE,UAAAA,CAAW,EAAG,OAChB,CAAE,SAAAC,CAAQ,EAAK,OAAO,KAK5BD,EAAU,OAAO,uBAAwB,yBAA0B,CAC/D,MAAO,CACH,MAAO,CACH,UAAW,EACvB,CACK,EAED,QAAS,CACL,gBAAgBE,EAAW,EAAG,CAC1B,KAAK,MAAM,mBAAmB,mBAAmBA,CAAQ,CAC5D,EAED,OAAOC,EAAY,CAEf,KAAK,0BAAyB,EAE9B,QAAQ,IAAI,CACR,KAAK,eAAe,KAAK,UAAU,EACnC,KAAK,OAAO,SAAUA,CAAU,CAChD,CAAa,EAAE,KAAK,IAAM,CAEV,GAAI,CAAC,KAAK,UAAW,CAEjB,MAAMC,EAAS,KAAK,WAAW,OAAO,KAAK,iBAAiB,QAAS,EAAE,EACvEA,EAAO,KAAO,KAAK,IAAI,kCAAmC,EAAG,CAAE,KAAM,KAAK,UAAU,CAAE,EAEtF,KAAK,iBAAiB,QAAQA,CAAM,EAEpC,KAAK,UAAU,KAAK,eAAe,CACtC,CACjB,CAAa,CACJ,EAED,QAAQC,EAAM,CACV,GAAIA,EAAK,KAAO,GAAI,CAChB,GAAI,KAAK,UACL,OAGJ,KAAK,aAAY,CACjC,MACgB,KAAK,OAAO,UAAWA,CAAI,CAElC,EAED,cAAe,CACX,MAAMA,EAAO,KAAK,WAAW,OAAO,KAAK,iBAAiB,OAAO,EACjEA,EAAK,KAAO,KAAK,WACjB,KAAK,UAAY,GACjB,KAAK,WACA,KAAKA,EAAM,KAAK,iBAAiB,OAAO,EACxC,KAAK,KACF,KAAK,QAAQA,CAAI,EAGjB,KAAK,SAAS,QAAQ,CAAC,EACvB,KAAK,SAAS,SAAS,KAAK,WAAW,EACvC,KAAK,SAAS,QAAQ,EAAE,EACxB,KAAK,WAAa,GAClB,KAAK,iBAAmB,KAEjB,KAAK,WACf,EACA,KAAK,IAAM,CACR,KAAK,gBAAe,CACxC,CAAiB,EACA,QAAQ,IAAM,CACX,KAAK,UAAY,EACrC,CAAiB,CACR,EAED,eAAeC,EAAM,CACjB,GAAIA,EAAK,OAAO,SAAW,EACvB,YAAK,UAAY,GACV,QAAQ,UAGnB,MAAMC,EAAW,IAAIN,EAAS,EAAG,EAAE,EACnC,OAAAM,EAAS,UAAUN,EAAS,OAAO,OAAQK,CAAI,CAAC,EAEzC,KAAK,WAAW,OAAOC,EAAU,KAAK,OAAO,EAAE,KAAMC,GAAa,CACrE,KAAK,UAAYA,EAAS,MAAQ,CAClD,CAAa,CACJ,EAED,2BAA4B,CACxB,KAAK,iBAAmB,KAAK,iBAAiB,OAAQC,GAC3CA,EAAO,KAAO,EACxB,CACJ,CACJ,CACL,CAAC"}