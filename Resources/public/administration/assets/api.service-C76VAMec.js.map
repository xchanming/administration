{"version":3,"file":"api.service-C76VAMec.js","sources":["../../../app/administration/src/core/service/api.service.ts"],"sourcesContent":["/**\n * @package admin\n */\n\nimport parseJsonApi from 'src/core/service/jsonapi-parser.service';\nimport type { AxiosInstance, AxiosResponse } from 'axios';\nimport type { LoginService } from './login.service';\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport type BasicHeaders = {\n    Accept: string;\n    Authorization: string;\n    'Content-Type': string;\n    [key: string]: string;\n};\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport type ApiResponse<T> = T extends null | undefined ? AxiosResponse<T> : T;\n\n/**\n * ApiService class which provides the common methods for our REST API\n * @class\n */\nclass ApiService {\n    client: AxiosInstance = {} as AxiosInstance;\n\n    loginService: LoginService;\n\n    endpoint = '';\n\n    type = 'application/vnd.api+json';\n\n    name = '';\n\n    constructor(\n        httpClient: AxiosInstance,\n        loginService: LoginService,\n        apiEndpoint: string,\n        contentType = 'application/vnd.api+json',\n    ) {\n        this.httpClient = httpClient;\n        this.loginService = loginService;\n        this.apiEndpoint = apiEndpoint;\n        this.contentType = contentType;\n    }\n\n    /**\n     * Returns the URI to the API endpoint\n     */\n    getApiBasePath(id?: string | number, prefix = ''): string {\n        let url = '';\n\n        if (prefix?.length) {\n            url += `${prefix}/`;\n        }\n\n        if ((id && typeof id === 'number') || (typeof id === 'string' && id.length > 0)) {\n            return `${url}${this.apiEndpoint}/${id}`;\n        }\n\n        return `${url}${this.apiEndpoint}`;\n    }\n\n    /**\n     * Get the basic headers for a request.\n     */\n    getBasicHeaders(additionalHeaders = {}): BasicHeaders {\n        let languageIdHeader = {};\n        // eslint-disable-next-line no-restricted-globals\n        if (self?.Cicada && typeof Cicada.Context?.api?.languageId === 'string') {\n            languageIdHeader = {\n                'sw-language-id': Cicada.Context.api.languageId,\n            };\n        }\n\n        const basicHeaders = {\n            Accept: this.contentType,\n            Authorization: `Bearer ${this.loginService.getToken()}`,\n            'Content-Type': 'application/json',\n            ...languageIdHeader,\n        };\n\n        return { ...basicHeaders, ...additionalHeaders };\n    }\n\n    /**\n     * Basic response handling.\n     * Converts the JSON api data when the specific content type is set.\n     */\n    static handleResponse<T = unknown>(response: AxiosResponse<T>): ApiResponse<T> {\n        if (response.data === null || response.data === undefined) {\n            return response as ApiResponse<T>;\n        }\n\n        const headers = response.headers as { 'content-type'?: string } | null | undefined;\n\n        if (typeof headers === 'object' && headers !== null && headers['content-type'] === 'application/vnd.api+json') {\n            return ApiService.parseJsonApiData<ApiResponse<T>>(response.data);\n        }\n\n        return response.data as ApiResponse<T>;\n    }\n\n    /**\n     * Parses a JSON api data structure to a simplified object.\n     */\n    static parseJsonApiData<T = unknown>(data: string | object): T {\n        return parseJsonApi(data) as T;\n    }\n\n    static getVersionHeader(versionId: string): { 'sw-version-id': string } {\n        return { 'sw-version-id': versionId };\n    }\n\n    static makeQueryParams(paramDictionary = {} as { [key: string]: string | number }): string {\n        const params = Object.keys(paramDictionary)\n            .filter((key) => typeof paramDictionary[key] === 'string')\n            .map((key) => `${key}=${paramDictionary[key]}`);\n\n        if (!params.length) {\n            return '';\n        }\n\n        return `?${params.join('&')}`;\n    }\n\n    /**\n     * Getter for the API end point\n     */\n    get apiEndpoint(): string {\n        return this.endpoint;\n    }\n\n    /**\n     * Setter for the API end point\n     */\n    set apiEndpoint(endpoint: string) {\n        this.endpoint = endpoint;\n    }\n\n    /**\n     * Getter for the http client\n     */\n    get httpClient(): AxiosInstance {\n        return this.client;\n    }\n\n    /**\n     * Setter for the http client\n     */\n    set httpClient(client) {\n        this.client = client;\n    }\n\n    get contentType(): string {\n        return this.type;\n    }\n\n    set contentType(contentType) {\n        this.type = contentType;\n    }\n}\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default ApiService;\n"],"names":["ApiService","httpClient","loginService","apiEndpoint","contentType","id","prefix","url","additionalHeaders","languageIdHeader","_b","_a","response","headers","data","parseJsonApi","versionId","paramDictionary","params","key","endpoint","client"],"mappings":"0CAuBA,MAAMA,CAAW,CAWb,YACIC,EACAC,EACAC,EACAC,EAAc,2BAChB,CAfF,KAAA,OAAwB,GAIb,KAAA,SAAA,GAEJ,KAAA,KAAA,2BAEA,KAAA,KAAA,GAQH,KAAK,WAAaH,EAClB,KAAK,aAAeC,EACpB,KAAK,YAAcC,EACnB,KAAK,YAAcC,CACvB,CAKA,eAAeC,EAAsBC,EAAS,GAAY,CACtD,IAAIC,EAAM,GAML,OAJDD,GAAA,MAAAA,EAAQ,SACRC,GAAO,GAAGD,CAAM,KAGfD,GAAM,OAAOA,GAAO,UAAc,OAAOA,GAAO,UAAYA,EAAG,OAAS,EAClE,GAAGE,CAAG,GAAG,KAAK,WAAW,IAAIF,CAAE,GAGnC,GAAGE,CAAG,GAAG,KAAK,WAAW,EACpC,CAKA,gBAAgBC,EAAoB,GAAkB,SAClD,IAAIC,EAAmB,CAAA,EAEvB,OAAI,iBAAM,QAAU,QAAOC,GAAAC,EAAA,OAAO,UAAP,YAAAA,EAAgB,MAAhB,YAAAD,EAAqB,aAAe,WACxCD,EAAA,CACf,iBAAkB,OAAO,QAAQ,IAAI,UAAA,GAWtC,CAAE,GAPY,CACjB,OAAQ,KAAK,YACb,cAAe,UAAU,KAAK,aAAa,SAAU,CAAA,GACrD,eAAgB,mBAChB,GAAGA,CAAA,EAGmB,GAAGD,EACjC,CAMA,OAAO,eAA4BI,EAA4C,CAC3E,GAAIA,EAAS,OAAS,MAAQA,EAAS,OAAS,OACrC,OAAAA,EAGX,MAAMC,EAAUD,EAAS,QAErB,OAAA,OAAOC,GAAY,UAAYA,IAAY,MAAQA,EAAQ,cAAc,IAAM,2BACxEb,EAAW,iBAAiCY,EAAS,IAAI,EAG7DA,EAAS,IACpB,CAKA,OAAO,iBAA8BE,EAA0B,CAC3D,OAAOC,EAAaD,CAAI,CAC5B,CAEA,OAAO,iBAAiBE,EAAgD,CAC7D,MAAA,CAAE,gBAAiBA,EAC9B,CAEA,OAAO,gBAAgBC,EAAkB,GAAkD,CACjF,MAAAC,EAAS,OAAO,KAAKD,CAAe,EACrC,OAAQE,GAAQ,OAAOF,EAAgBE,CAAG,GAAM,QAAQ,EACxD,IAAKA,GAAQ,GAAGA,CAAG,IAAIF,EAAgBE,CAAG,CAAC,EAAE,EAE9C,OAACD,EAAO,OAIL,IAAIA,EAAO,KAAK,GAAG,CAAC,GAHhB,EAIf,CAKA,IAAI,aAAsB,CACtB,OAAO,KAAK,QAChB,CAKA,IAAI,YAAYE,EAAkB,CAC9B,KAAK,SAAWA,CACpB,CAKA,IAAI,YAA4B,CAC5B,OAAO,KAAK,MAChB,CAKA,IAAI,WAAWC,EAAQ,CACnB,KAAK,OAASA,CAClB,CAEA,IAAI,aAAsB,CACtB,OAAO,KAAK,IAChB,CAEA,IAAI,YAAYjB,EAAa,CACzB,KAAK,KAAOA,CAChB,CACJ"}