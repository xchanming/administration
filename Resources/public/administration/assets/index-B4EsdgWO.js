const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-32FXR465.js","assets/index-D9lDzHRE.css","assets/index-CWKalLLa.js","assets/index-DnUceSLW.css","assets/index-DRDP3Ux9.js","assets/index-D6cWZzEC.css","assets/index-mBX5xTt3.js","assets/index-BfYnF1XK.css","assets/index-Rn1pILO0.js","assets/index-CbJ5uoJV.css","assets/index-b7UayEQ8.js","assets/index-BmuzFe2N.css","assets/index-CurtEJnX.js","assets/index-CZdYCxXE.css","assets/index-BP0u_-Tt.js","assets/index-CAOiPWML.css","assets/index-DQ3gJEnU.js","assets/index-D6vjOMVZ.css","assets/index-C1zzzrIU.js","assets/index-B5PfroSC.css","assets/index-DNN0b8C6.js","assets/main-DGszniXu.js","assets/channel-Cvr-E4M4.js","assets/administration-CcAM5iN0.js","assets/administration-W4Hd5vBj.css","assets/main-mYCLmm7W.css","assets/index-CvCOfDVR.css","assets/index-Cd8wlPlt.js","assets/index-ybtBht3-.css","assets/index-iYwqL1tR.js","assets/index-CJq7z4OL.css","assets/index-AGm2J6bq.js","assets/index-BmnZrzAC.css","assets/index-BRpiFLYg.js","assets/string.utils-B0MdTyu7.js","assets/camelCase-FN5n0J2F.js","assets/index-YHVk0LUL.css","assets/index-CGJDKSST.js","assets/index-D5pDRlEV.css","assets/index-D-Oaetc5.js","assets/_baseIteratee-BDDcCv4P.js","assets/_baseUniq-DJKU6o6f.js","assets/index-BE3xEz5J.css","assets/index-ClUU3gQf.js","assets/index-CKWmEzOe.css","assets/index-Jiprk1Cr.js","assets/index-B3upe1e5.css","assets/index-DrNU323n.js","assets/index-DGWkZeXZ.css","assets/index-7PK6VC5g.js","assets/index-CgA4Gdl7.css"])))=>i.map(i=>d[i]);
import{_ as a}from"./administration-CcAM5iN0.js";import{A as c}from"./api.service-DUFBkRAb.js";import"./channel-Cvr-E4M4.js";class g extends c{constructor(e,t,r="import-export"){super(e,t,r),this.onProgressStartedListener=[],this.name="importExportService",this.httpClient=e}async export(e,t,r){const i=new Date;i.setDate(i.getDate()+30);const n=await this.httpClient.post("/_action/import-export/prepare",{profileId:e,config:r,expireDate:i.toDateString()},{headers:this.getBasicHeaders()});return this.trackProgress(n,t)}async getDownloadUrl(e){const t=await this.httpClient.post(`/_action/import-export/file/prepare-download/${e}`,{},{headers:this.getBasicHeaders()});return`${Shopware.Context.api.apiPath||""}/_action/${this.getApiBasePath()}/file/download?fileId=${e}&accessToken=${t.data.accessToken}`}async getTemplateFileDownloadUrl(e){const t=await this.httpClient.post(`/_action/import-export/prepare-template-file-download?profileId=${e}`,{},{headers:this.getBasicHeaders()});return`${Shopware.Context.api.apiPath||""}/_action/${this.getApiBasePath()}/file/download?fileId=${t.data.fileId}&accessToken=${t.data.accessToken}`}getMappingFromTemplate(e,t,r=";",i='"'){const n=new FormData;return n.append("file",e),n.append("sourceEntity",t),n.append("delimiter",r),n.append("enclosure",i),this.httpClient.post("/_action/import-export/mapping-from-template",n,{headers:this.getBasicHeaders()}).then(s=>s.data?Promise.resolve(s.data):Promise.reject(new Error("Empty response data")))}async import(e,t,r,i={},n=!1){const s=new Date;s.setDate(s.getDate()+30);const o=new FormData;t&&o.append("file",t),o.append("profileId",e),o.append("expireDate",s.toDateString()),n&&o.append("dryRun","true"),Object.entries(i).forEach(([d,l])=>{o.append(`config[${d}]`,JSON.stringify(l))});const p=await this.httpClient.post("/_action/import-export/prepare",o,{headers:this.getBasicHeaders({"Content-Type":"multipart/form-data"})});return this.trackProgress(p,r)}async trackProgress(e,t){return await this.httpClient.post("/_action/import-export/process",{logId:e.data.log.id},{headers:this.getBasicHeaders()}),t.call(this,e.data.log),this.onProgressStartedListener.forEach(r=>{r.call(this)}),e}addOnProgressStartedListener(e){this.onProgressStartedListener.push(e)}cancel(e){return this.httpClient.post(`/_action/${this.getApiBasePath()}/cancel`,{logId:e},{headers:this.getBasicHeaders()}).then(c.handleResponse.bind(this))}}class _{constructor(e){this.EntityDefinition=e}validate(e,t,r=[],i=!1){const n=this.convertMappingKeys(t),s=this.convertMappingKeys(r),o=this.EntityDefinition.getRequiredFields(e);let p=[];if(Object.keys(o).forEach(d=>{d==="translations"||d==="price"||s.length>0&&!s.some(m=>d===m)||n.includes(d)||p.push(d)}),i){const l=this.EntityDefinition.get(e).getPrimaryKeyFields();p=p.filter(m=>l[m]!==void 0)}return{missingRequiredFields:p}}convertMappingKeys(e){const t=e.map(r=>r.key);return t.forEach(r=>{const i=r.split(".");i.includes("translations")&&t.push(i.slice(2).join(""));const n=r.split(".id");n.length===2&&i.length===2&&t.push(`${n[0]}Id`)}),t}getSystemRequiredFields(e,t=1){const r=this.EntityDefinition.get(e);return this._getSystemRequiredFieldsForEntityCreation(r,t)}_getSystemRequiredFieldsForEntityCreation(e,t=1,r="",i={}){let n={};return t<=0||i[e.getEntity()]!==void 0||r.endsWith("translations.DEFAULT.language.")||(i[e.getEntity()]=e.getEntity(),e.forEachField((s,o,p)=>{n={...n,...this._handleField(s,o,p,t,r,i)}})),n}_handleField(e,t,r,i,n,s){let o={};if(e.type==="association"&&e.relation==="many_to_one"&&r[e.localField].flags.required===!0)return o={...o,...this._handleAssociation(e,t,r,i,n,s)},o;if(e.flags.required!==!0||t==="createdAt"||t.toLowerCase().includes("versionid")||e.flags.translatable===!0||e.type==="uuid"&&t!=="id")return o;if(t==="translations"&&e.type==="association"&&e.flags.required===!0)return o={...o,...this._getSystemRequiredFieldsForEntityCreation(this.EntityDefinition.get(e.entity),i,`${n}${t}.DEFAULT.`,s)},o;if(t==="price"&&e.type==="json_object")return o={...o,...this._addPriceFields(n,t)},o;const p=`${n}${t}`;return o[p]=p,o}_handleAssociation(e,t,r,i,n,s){const o={},p=`${n}${t}.`;if(s[e.entity]===void 0&&!p.endsWith("translations.DEFAULT.language.")){const l=`${p}${e.referenceField}`;o[l]=l}const d=this._getSystemRequiredFieldsForEntityCreation(this.EntityDefinition.get(e.entity),i-1,p,s);return{...o,...d}}_addPriceFields(e,t){const r={},i=`${e}${t}.DEFAULT.net`;r[i]=i;const n=`${e}${t}.DEFAULT.gross`;return r[n]=n,r}}class h{constructor(e){this.EntityDefinition=e}getEntity(e,t){const r=t.split("."),i=[];let n=this.EntityDefinition.get(e),s=!1,o=null,p=n.entity;return r.forEach(d=>{const l=n.properties[d];if(!l||d==="translations")return;if(l.flags.runtime===!0){n={entity:null};return}const m=l.entity;s=this.EntityDefinition.has(m),s&&(n=this.EntityDefinition.get(m),i.push(d),o=l.relation,p=d)}),{entity:n.entity,path:i.join("."),relation:o,name:p}}getSelected(e,t){const r=this.EntityDefinition.get(e),i=Object.keys(r.getPrimaryKeyFields())[0];if(!Array.isArray(t))return i;const n=this.getUpdateByMappingByEntity(e,t);return n?n.mappedKey:i}updateMapping(e,t,r){if(!t){this.removeUpdateByMappingByEntity(r,e.updateBy);return}if(!Array.isArray(e.updateBy)){e.updateBy=[{entityName:r,mappedKey:t}];return}const i=this.getUpdateByMappingByEntity(r,e.updateBy);if(!i){e.updateBy.push({entityName:r,mappedKey:t});return}i.mappedKey=t}getUpdateByMappingByEntity(e,t){const r=t.filter(i=>i.entityName===e);return r.length?r[0]:null}removeUpdateByMappingByEntity(e,t){if(!Array.isArray(t))return;const r=this.getUpdateByMappingByEntity(e,t);if(!r)return;const i=t.indexOf(r);i>-1&&t.splice(i,1)}removeUnusedMappings(e){if(!e||!Array.isArray(e.updateBy))return;if(!Array.isArray(e.mapping)||!e.mapping.length){e.updateBy=[];return}const t={};e.mapping.forEach(i=>{const{entity:n,path:s,relation:o}=this.getEntity(e.sourceEntity,i.key);if(o==="many_to_many"){t[n]=!0;return}t.hasOwnProperty(n)||(t[n]=[]);const p=s!==""?i.key.replace(new RegExp(`^(${s}.)`),""):i.key;t[n].push(p)}),e.updateBy.filter(i=>!t.hasOwnProperty(i.entityName)||Array.isArray(t[i.entityName])&&!t[i.entityName].includes(i.mappedKey)).forEach(i=>{this.removeUpdateByMappingByEntity(i.entityName,e.updateBy)})}}Shopware.Service("privileges").addPrivilegeMappingEntry({category:"additional_permissions",parent:null,key:"system",roles:{import_export:{privileges:["import_export_log:read","import_export_file:read","import_export_file:create","user:read","import_export_profile:read","import_export_profile:create","import_export_profile:delete","currency:read"],dependencies:[]}}});Shopware.Service().register("importExport",()=>new g(Shopware.Application.getContainer("init").httpClient,Shopware.Service("loginService")));Shopware.Service().register("importExportProfileMapping",()=>new _(Shopware.EntityDefinition));Shopware.Service().register("importExportUpdateByMapping",()=>new h(Shopware.EntityDefinition));Shopware.Component.register("sw-import-export",()=>a(()=>import("./index-32FXR465.js"),__vite__mapDeps([0,1])));Shopware.Component.register("sw-import-export-exporter",()=>a(()=>import("./index-CWKalLLa.js"),__vite__mapDeps([2,3])));Shopware.Component.register("sw-import-export-importer",()=>a(()=>import("./index-DRDP3Ux9.js"),__vite__mapDeps([4,5])));Shopware.Component.register("sw-import-export-activity",()=>a(()=>import("./index-mBX5xTt3.js"),__vite__mapDeps([6,7])));Shopware.Component.register("sw-import-export-activity-log-info-modal",()=>a(()=>import("./index-Rn1pILO0.js"),__vite__mapDeps([8,9])));Shopware.Component.register("sw-import-export-activity-result-modal",()=>a(()=>import("./index-b7UayEQ8.js"),__vite__mapDeps([10,11])));Shopware.Component.register("sw-import-export-edit-profile-modal",()=>a(()=>import("./index-CurtEJnX.js"),__vite__mapDeps([12,13])));Shopware.Component.register("sw-import-export-edit-profile-modal-mapping",()=>a(()=>import("./index-BP0u_-Tt.js"),__vite__mapDeps([14,15])));Shopware.Component.register("sw-import-export-edit-profile-modal-identifiers",()=>a(()=>import("./index-DQ3gJEnU.js"),__vite__mapDeps([16,17])));Shopware.Component.register("sw-import-export-entity-path-select",()=>a(()=>import("./index-C1zzzrIU.js"),__vite__mapDeps([18,19])));Shopware.Component.register("sw-import-export-edit-profile-field-indicators",()=>a(()=>import("./index-DNN0b8C6.js"),__vite__mapDeps([20,21,22,23,24,25,26])));Shopware.Component.register("sw-import-export-edit-profile-import-settings",()=>a(()=>import("./index-Cd8wlPlt.js"),__vite__mapDeps([27,28])));Shopware.Component.register("sw-import-export-edit-profile-general",()=>a(()=>import("./index-iYwqL1tR.js"),__vite__mapDeps([29,21,22,23,24,25,30])));Shopware.Component.register("sw-import-export-new-profile-wizard",()=>a(()=>import("./index-AGm2J6bq.js"),__vite__mapDeps([31,32])));Shopware.Component.register("sw-import-export-new-profile-wizard-general-page",()=>a(()=>import("./index-BRpiFLYg.js"),__vite__mapDeps([33,34,22,35,36])));Shopware.Component.register("sw-import-export-new-profile-wizard-csv-page",()=>a(()=>import("./index-CGJDKSST.js"),__vite__mapDeps([37,38])));Shopware.Component.register("sw-import-export-new-profile-wizard-mapping-page",()=>a(()=>import("./index-D-Oaetc5.js"),__vite__mapDeps([39,22,40,41,42])));Shopware.Component.register("sw-import-export-view-import",()=>a(()=>import("./index-ClUU3gQf.js"),__vite__mapDeps([43,44])));Shopware.Component.register("sw-import-export-view-export",()=>a(()=>import("./index-Jiprk1Cr.js"),__vite__mapDeps([45,46])));Shopware.Component.register("sw-import-export-view-profiles",()=>a(()=>import("./index-DrNU323n.js"),__vite__mapDeps([47,48])));Shopware.Component.register("sw-import-export-progress",()=>a(()=>import("./index-7PK6VC5g.js"),__vite__mapDeps([49,50])));Shopware.Module.register("sw-import-export",{type:"core",name:"ImportExport",title:"sw-import-export.general.mainMenuItemGeneral",description:"sw-import-export.general.descriptionTextModule",version:"1.0.0",targetVersion:"1.0.0",color:"#9AA8B5",icon:"regular-cog",entity:"import_export_profile",routePrefixPath:"sw/import-export",routes:{index:{component:"sw-import-export",path:"index",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"},redirect:{name:"sw.import.export.index.import"},children:{import:{component:"sw-import-export-view-import",path:"import",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"}},export:{component:"sw-import-export-view-export",path:"export",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"}},profiles:{component:"sw-import-export-view-profiles",path:"profiles",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"}}}}},settingsItem:{group:"automation",to:"sw.import.export.index",icon:"regular-database",privilege:"system.import_export"}});
