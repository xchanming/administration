{"version":3,"file":"index-C4WrJ_zl.js","sources":["../../../app/administration/src/module/sw-extension/page/sw-extension-app-module-page/sw-extension-app-module-page.html.twig","../../../app/administration/src/module/sw-extension/page/sw-extension-app-module-page/index.ts"],"sourcesContent":["<sw-page\n    class=\"sw-extension-app-module-page\"\n    :show-smart-bar=\"showSmartBar\"\n>\n    <template\n        v-if=\"!suspend\"\n        #smart-bar-header\n    >\n        <h2>{{ heading }}</h2>\n    </template>\n\n    <template #content>\n        <template v-if=\"!suspend && signedIframeSrc\">\n            <iframe\n                v-show=\"appLoaded\"\n                id=\"app-content\"\n                class=\"sw-extension-app-module-page__app-content\"\n                referrerpolicy=\"origin-when-cross-origin\"\n                :src=\"signedIframeSrc\"\n                :title=\"heading\"\n            ></iframe>\n\n            <template v-if=\"!appLoaded\">\n                <template v-if=\"timedOut\">\n                    <sw-extension-app-module-error-page />\n                </template>\n\n                <template v-else>\n                    <sw-loader />\n                </template>\n            </template>\n        </template>\n    </template>\n</sw-page>\n","import type { AppModuleDefinition } from 'src/core/service/api/app-modules.service';\nimport template from './sw-extension-app-module-page.html.twig';\nimport './sw-extension-app-module-page.scss';\n\nconst { State, Context } = Cicada;\n\n/**\n * @package checkout\n * @private\n */\nexport default Cicada.Component.wrapComponentConfig({\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'acl',\n        'extensionSdkService',\n    ],\n\n    props: {\n        appName: {\n            type: String,\n            required: true,\n        },\n\n        moduleName: {\n            type: String,\n            required: false,\n            default: null,\n        },\n    },\n\n    data(): {\n        appLoaded: boolean;\n        timedOut: boolean;\n        timedOutTimeout: null | number;\n        signedIframeSrc: undefined | string;\n    } {\n        return {\n            appLoaded: false,\n            timedOut: false,\n            timedOutTimeout: null,\n            signedIframeSrc: undefined,\n        };\n    },\n\n    computed: {\n        currentLocale(): string | null {\n            return State.get('session').currentLocale;\n        },\n\n        fallbackLocale(): string | null {\n            return Context.app.fallbackLocale;\n        },\n\n        appDefinition(): AppModuleDefinition | null {\n            return (\n                State.get('cicadaApps').apps.find((app) => {\n                    return app.name === this.appName;\n                }) ?? null\n            );\n        },\n\n        moduleDefinition(): Partial<{\n            source: string;\n            label: { [key: string]: string };\n        }> | null {\n            if (!this.appDefinition) {\n                return null;\n            }\n\n            if (!this.moduleName) {\n                return this.appDefinition.mainModule ?? null;\n            }\n\n            return (\n                this.appDefinition.modules.find((module) => {\n                    return module.name === this.moduleName;\n                }) ?? null\n            );\n        },\n\n        showSmartBar(): boolean {\n            const { hiddenSmartBars } = State.get('extensionSdkModules');\n\n            // The moduleName is null if the module is navigated from the extension listing page!\n            if (!this.moduleName) {\n                const modules = this.appDefinition?.modules ?? [];\n                return modules.some((mod) => !hiddenSmartBars.includes(mod.name));\n            }\n\n            return !hiddenSmartBars.includes(this.moduleName);\n        },\n\n        suspend(): boolean {\n            return !this.appDefinition || !this.moduleDefinition;\n        },\n\n        heading(): string | null {\n            if (!this.appDefinition) {\n                return null;\n            }\n\n            const appLabel = this.translate(this.appDefinition.label);\n\n            if (!this.moduleDefinition || !this.moduleDefinition.label) {\n                return appLabel;\n            }\n\n            const moduleLabel = this.translate(this.moduleDefinition.label);\n\n            return [\n                appLabel,\n                moduleLabel,\n            ]\n                .filter((part) => !!part)\n                .join(' - ');\n        },\n\n        entryPoint(): string | null {\n            if (this.suspend) {\n                return null;\n            }\n\n            return this.moduleDefinition?.source ?? null;\n        },\n\n        origin(): string | null {\n            if (!this.entryPoint) {\n                return null;\n            }\n\n            try {\n                const url = new URL(this.entryPoint);\n                return url.origin;\n            } catch (e) {\n                return null;\n            }\n        },\n\n        loadedMessage(): 'sw-app-loaded' {\n            return 'sw-app-loaded';\n        },\n    },\n\n    watch: {\n        entryPoint(): void {\n            this.appLoaded = false;\n            this.timedOut = false;\n        },\n\n        appLoaded: {\n            immediate: true,\n            handler(loaded) {\n                if (this.timedOutTimeout !== null) {\n                    clearTimeout(this.timedOutTimeout);\n                }\n\n                this.timedOutTimeout = null;\n\n                if (!loaded) {\n                    this.timedOutTimeout = window.setTimeout(() => {\n                        if (!this.appLoaded) {\n                            this.timedOut = true;\n                        }\n                    }, 5000);\n                }\n            },\n        },\n\n        moduleDefinition: {\n            immediate: true,\n            deep: true,\n            handler() {\n                const sourceString = this.moduleDefinition?.source;\n                if (!sourceString) {\n                    return;\n                }\n\n                // The source already contains old query params remove them\n                const source = new URL(sourceString);\n                const sourceWithoutParams = source.origin + source.pathname;\n\n                this.extensionSdkService\n                    .signIframeSrc(this.appName, sourceWithoutParams)\n                    .then((response) => {\n                        const uri = (response as { uri?: string })?.uri;\n\n                        if (!uri) {\n                            return;\n                        }\n\n                        this.signedIframeSrc = uri;\n                    })\n                    .catch(() => {});\n            },\n        },\n    },\n\n    mounted() {\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        window.addEventListener('message', this.onContentLoaded);\n    },\n\n    beforeUnmount() {\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        window.removeEventListener('message', this.onContentLoaded);\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            if (!this.acl.can(`app.${this.appName}`)) {\n                // ignore promise from push because this page should be destroyed after the url change\n                void this.$router.push({ name: 'sw.privilege.error.index' });\n            }\n        },\n\n        translate(labels: { [key: string]: string }): string | null {\n            if (this.currentLocale && labels[this.currentLocale]) {\n                return labels[this.currentLocale];\n            }\n\n            if (this.fallbackLocale && labels[this.fallbackLocale]) {\n                return labels[this.fallbackLocale];\n            }\n\n            return null;\n        },\n\n        onContentLoaded(event: MessageEvent): void {\n            if (event.origin !== this.origin) {\n                return;\n            }\n\n            if (event.data === this.loadedMessage) {\n                this.appLoaded = true;\n            }\n        },\n    },\n});\n"],"names":["template","State","Context","index","app","module","_a","hiddenSmartBars","mod","appLabel","moduleLabel","part","loaded","sourceString","source","sourceWithoutParams","response","uri","labels","event"],"mappings":"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"}