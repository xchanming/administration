{"version":3,"file":"index-D5FmRqQQ.js","sources":["../../../app/administration/src/module/sw-first-run-wizard/view/sw-first-run-wizard-data-import/sw-first-run-wizard-data-import.html.twig","../../../app/administration/src/module/sw-first-run-wizard/view/sw-first-run-wizard-data-import/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_first_run_wizard_data_import %}\n<div class=\"sw-first-run-wizard-data-import\">\n    <sw-container\n        v-if=\"!isInstallingPlugin\"\n        columns=\"1fr 1fr\"\n        gap=\"24px 0\"\n    >\n        <div class=\"sw-first-run-wizard-data-import__card\">\n            <img\n                class=\"sw-first-run-wizard-data-import__icon-demodata\"\n                :src=\"assetFilter('/administration/static/img/first-run-wizard/plugin-demodata-set.svg')\"\n                alt=\"\"\n            >\n            <h5 class=\"sw-first-run-wizard-data-import__headline\">\n                {{ $tc('sw-first-run-wizard.dataImport.headlineDemoData') }}\n            </h5>\n            <p\n                class=\"sw-first-run-wizard-data-import__message\"\n                v-html=\"$tc('sw-first-run-wizard.dataImport.messageDemoData')\"\n            ></p>\n\n            <sw-button-process\n                v-if=\"notInstalled('demodata')\"\n                variant=\"primary\"\n                size=\"small\"\n                :is-loading=\"isInstallingPlugin\"\n                :disabled=\"isInstallingPlugin\"\n                :process-success=\"pluginInstalledSuccessfully.demodata\"\n                class=\"button-plugin-install\"\n                @click=\"onInstall('demodata')\"\n            >\n                {{ $tc('sw-first-run-wizard.dataImport.buttonInstallDemoData') }}\n            </sw-button-process>\n            <div\n                v-else\n                class=\"plugin-status\"\n            >\n                <span class=\"plugin-installed\">\n                    <sw-icon\n                        name=\"regular-check-circle-s\"\n                        size=\"16\"\n                    />\n                    {{ $tc('sw-first-run-wizard.general.pluginInstalled') }}\n                </span>\n            </div>\n        </div>\n\n        <div class=\"sw-first-run-wizard-data-import__card\">\n            <img\n                class=\"sw-first-run-wizard-data-import__icon-migration\"\n                :src=\"assetFilter('/administration/static/img/first-run-wizard/plugin-migration-assistant.svg')\"\n                alt=\"\"\n            >\n            <h5 class=\"sw-first-run-wizard-import-data__headline\">\n                {{ $tc('sw-first-run-wizard.dataImport.headlineMigration') }}\n            </h5>\n            <p\n                class=\"sw-first-run-wizard-data-import__message\"\n                v-html=\"$tc('sw-first-run-wizard.dataImport.messageMigration')\"\n            ></p>\n\n            <sw-button-process\n                v-if=\"notInstalled('migration')\"\n                variant=\"primary\"\n                size=\"small\"\n                :is-loading=\"isInstallingPlugin\"\n                :disabled=\"isInstallingPlugin\"\n                :process-success=\"pluginInstalledSuccessfully.migration\"\n                class=\"button-plugin-install\"\n                @click=\"onInstall('migration')\"\n            >\n                {{ $tc('sw-first-run-wizard.dataImport.buttonInstallMigration') }}\n            </sw-button-process>\n            <div\n                v-else\n                class=\"plugin-status\"\n            >\n                <span class=\"plugin-installed\">\n                    <sw-icon\n                        name=\"regular-check-circle-s\"\n                        size=\"16\"\n                    />\n                    {{ $tc('sw-first-run-wizard.general.pluginInstalled') }}\n                </span>\n            </div>\n        </div>\n    </sw-container>\n\n    <div\n        v-else\n        class=\"installing-plugin\"\n    >\n        <sw-loader size=\"48px\" />\n        <p\n            class=\"sw-loader-info-text\"\n            v-html=\"$tc('sw-first-run-wizard.dataImport.loadingMessage')\"\n        ></p>\n    </div>\n\n    <div\n        v-if=\"installationError\"\n        class=\"sw-first-run-wizard-plugin-installation__error\"\n    >\n        <sw-alert\n            :title=\"pluginError.title\"\n            variant=\"error\"\n            appearance=\"notification\"\n        >\n            {{ pluginError.detail }}\n        </sw-alert>\n    </div>\n</div>\n{% endblock %}\n","import template from './sw-first-run-wizard-data-import.html.twig';\nimport './sw-first-run-wizard-data-import.scss';\n\nconst { Criteria } = Cicada.Data;\n\n/**\n * @package checkout\n * @private\n */\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'extensionStoreActionService',\n        'repositoryFactory',\n    ],\n\n    emits: [\n        'buttons-update',\n        'frw-set-title',\n        'extension-activated',\n    ],\n\n    data() {\n        return {\n            plugins: {\n                demodata: {\n                    name: 'SwagPlatformDemoData',\n                    isInstalled: false,\n                },\n                migration: {\n                    name: 'SwagMigrationAssistant',\n                    isInstalled: false,\n                },\n            },\n            demoDataPluginName: 'SwagPlatformDemoData',\n            migrationPluginName: 'SwagMigrationAssistant',\n            isPluginAlreadyInstalled: false,\n            isInstallingPlugin: false,\n            installationError: false,\n            pluginError: null,\n            pluginInstalledSuccessfully: {\n                demodata: false,\n                migration: false,\n            },\n        };\n    },\n\n    computed: {\n        pluginRepository() {\n            return this.repositoryFactory.create('plugin');\n        },\n\n        buttonConfig() {\n            return [\n                {\n                    key: 'skip',\n                    label: this.$tc('sw-first-run-wizard.general.buttonNext'),\n                    position: 'right',\n                    variant: 'primary',\n                    action: 'sw.first.run.wizard.index.defaults',\n                    disabled: this.isInstallingPlugin,\n                },\n            ];\n        },\n\n        assetFilter() {\n            return Cicada.Filter.getByName('asset');\n        },\n    },\n\n    watch: {\n        isInstallingPlugin() {\n            this.updateButtons();\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.updateButtons();\n            this.setTitle();\n            this.getInstalledPlugins();\n        },\n\n        updateButtons() {\n            this.$emit('buttons-update', this.buttonConfig);\n        },\n\n        setTitle() {\n            this.$emit('frw-set-title', this.$tc('sw-first-run-wizard.dataImport.modalTitle'));\n        },\n\n        notInstalled(pluginKey) {\n            return !this.plugins[pluginKey].isInstalled;\n        },\n\n        onInstall(pluginKey) {\n            const plugin = this.plugins[pluginKey];\n            this.isInstallingPlugin = true;\n            this.installationError = false;\n\n            return this.extensionStoreActionService\n                .downloadExtension(plugin.name)\n                .then(() => {\n                    return this.extensionStoreActionService.installExtension(plugin.name, 'plugin');\n                })\n                .then(() => {\n                    return this.extensionStoreActionService.activateExtension(plugin.name, 'plugin');\n                })\n                .then(() => {\n                    this.$emit('extension-activated');\n                    this.isInstallingPlugin = false;\n                    this.plugins[pluginKey].isInstalled = true;\n\n                    return false;\n                })\n                .catch((error) => {\n                    this.isInstallingPlugin = false;\n                    this.installationError = true;\n\n                    if (error.response?.data?.errors) {\n                        this.pluginError = error.response.data.errors.pop();\n                    }\n\n                    return true;\n                });\n        },\n\n        getInstalledPlugins() {\n            const pluginNames = Object.values(this.plugins).map((plugin) => plugin.name);\n            const pluginCriteria = new Criteria(1, 5);\n\n            pluginCriteria.addFilter(Criteria.equalsAny('plugin.name', pluginNames));\n\n            this.pluginRepository.search(pluginCriteria).then((result) => {\n                if (result.total < 1) {\n                    return;\n                }\n\n                result.forEach((plugin) => {\n                    if (!plugin.active || plugin.installedAt === null) {\n                        return;\n                    }\n\n                    const key = this.findPluginKeyByName(plugin.name);\n\n                    this.plugins[key].isInstalled = true;\n                });\n            });\n        },\n\n        findPluginKeyByName(name) {\n            const [pluginKey] = Object.entries(this.plugins).find(\n                ([\n                    key,\n                    state,\n                ]) => {\n                    if (state.name === name) {\n                        return key;\n                    }\n\n                    return '';\n                },\n            );\n\n            return pluginKey;\n        },\n    },\n};\n"],"names":["template","Criteria","index","pluginKey","plugin","error","_a","_b","pluginNames","pluginCriteria","result","key","name","state"],"mappings":"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"}