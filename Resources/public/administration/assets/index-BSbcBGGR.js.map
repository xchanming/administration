{"version":3,"file":"index-BSbcBGGR.js","sources":["../../../app/administration/src/module/sw-promotion-v2/component/promotion-codes/sw-promotion-v2-generate-codes-modal/sw-promotion-v2-generate-codes-modal.html.twig","../../../app/administration/src/module/sw-promotion-v2/component/promotion-codes/sw-promotion-v2-generate-codes-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_promotion_v2_generate_codes_modal %}\n<sw-modal\n    class=\"sw-promotion-v2-generate-codes-modal\"\n    :title=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.title')\"\n    @modal-close=\"onClose\"\n>\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_generate_codes_modal_content %}\n    <div class=\"sw-promotion-v2-generate-codes-modal__content\">\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_generate_codes_modal_warning %}\n        <sw-alert\n            v-if=\"promotion.individualCodes && promotion.individualCodes.length > 0\"\n            class=\"sw-promotion-v2-generate-codes-modal__warning\"\n            variant=\"warning\"\n        >\n            {{ $tc('sw-promotion-v2.detail.base.codes.individual.generateModal.warning') }}\n        </sw-alert>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_generate_codes_modal_description %}\n        <p class=\"sw-promotion-v2-generate-codes-modal__description\">\n            {{ $tc('sw-promotion-v2.detail.base.codes.individual.generateModal.description') }}\n        </p>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_generate_codes_modal_container_pattern %}\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_generate_codes_modal_container_pattern_simple %}\n        <sw-container\n            v-if=\"!customPatternMode\"\n            class=\"sw-promotion-v2-generate-codes-modal__container-pattern\"\n            columns=\"1fr 1fr 1fr\"\n            gap=\"0px 32px\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_generate_codes_modal_prefix %}\n            <sw-text-field\n                v-model:value=\"pattern.prefix\"\n                class=\"sw-promotion-v2-generate-codes-modal__prefix\"\n                :label=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.labelPrefix')\"\n                :placeholder=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.placeholderPrefix')\"\n            />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_generate_codes_modal_replacement %}\n            <sw-number-field\n                v-model:value=\"pattern.codeLength\"\n                class=\"sw-promotion-v2-generate-codes-modal__replacement\"\n                :label=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.labelCodeLength')\"\n                :min=\"1\"\n                :max=\"20\"\n            />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_generate_codes_modal_suffix %}\n            <sw-text-field\n                v-model:value=\"pattern.suffix\"\n                class=\"sw-promotion-v2-generate-codes-modal__suffix\"\n                :label=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.labelSuffix')\"\n                :placeholder=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.placeholderSuffix')\"\n            />\n            {% endblock %}\n\n        </sw-container>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_generate_codes_modal_container_pattern_custom %}\n        <sw-text-field\n            v-else\n            v-model:value=\"promotion.individualCodePattern\"\n            class=\"sw-promotion-v2-generate-codes-modal__custom-pattern\"\n            :label=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.labelCustomPattern')\"\n            :placeholder=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.placeholderCustomPattern')\"\n            :help-text=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.helpTextCustomPattern')\"\n        />\n        {% endblock %}\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_generate_codes_modal_custom_pattern_switch %}\n        <sw-switch-field\n            v-model:value=\"customPatternMode\"\n            class=\"sw-promotion-v2-generate-codes-modal__custom-pattern\"\n            :label=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.labelUseCustomPattern')\"\n            bordered\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_generate_codes_modal_container_generate %}\n        <sw-container\n            class=\"sw-promotion-v2-generate-codes-modal__container-generate\"\n            columns=\"1fr 1fr\"\n            gap=\"0px 32px\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_generate_codes_modal_preview %}\n            <sw-text-field\n                v-model:value=\"preview\"\n                class=\"sw-promotion-v2-generate-codes-modal__preview\"\n                :label=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.labelPreview')\"\n                disabled\n            />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_generate_codes_modal_code_amount %}\n            <sw-number-field\n                v-model:value=\"codeAmount\"\n                class=\"sw-promotion-v2-generate-codes-modal__code-amount\"\n                :label=\"$tc('sw-promotion-v2.detail.base.codes.individual.generateModal.labelCodeAmount')\"\n                :min=\"1\"\n            />\n            {% endblock %}\n\n        </sw-container>\n        {% endblock %}\n\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_generate_codes_modal_footer %}\n    <template #modal-footer>\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_generate_codes_modal_cancel %}\n        <sw-button\n            class=\"sw-promotion-v2-generate-codes-modal__button-cancel\"\n            size=\"small\"\n            @click=\"onClose\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_generate_codes_modal_generate %}\n        <sw-button-process\n            class=\"sw-promotion-v2-generate-codes-modal__button-generate\"\n            variant=\"primary\"\n            size=\"small\"\n            :is-loading=\"isGenerating\"\n            :process-success=\"false\"\n            @click=\"onGenerate\"\n        >\n            {{ $tc('sw-promotion-v2.detail.base.codes.individual.generateModal.buttonGenerate') }}\n        </sw-button-process>\n        {% endblock %}\n\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n","/**\n * @package checkout\n */\nimport template from './sw-promotion-v2-generate-codes-modal.html.twig';\nimport './sw-promotion-v2-generate-codes-modal.scss';\n\nconst debounce = Cicada.Utils.debounce;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'promotionCodeApiService',\n    ],\n\n    emits: [\n        'generate-finish',\n        'close',\n    ],\n\n    mixins: [\n        'notification',\n    ],\n\n    props: {\n        promotion: {\n            type: Object,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            isGenerating: false,\n            customPatternMode: false,\n            codeAmount: 10,\n            preview: '',\n            pattern: {\n                prefix: '',\n                suffix: '',\n                codeLength: 5,\n            },\n        };\n    },\n\n    watch: {\n        pattern: {\n            deep: true,\n            handler() {\n                if (!this.customPatternMode) {\n                    this.updatePattern();\n                }\n\n                this.updatePreview();\n            },\n        },\n\n        'promotion.individualCodePattern'() {\n            this.updatePreview();\n        },\n\n        customPatternMode() {\n            if (!this.customPatternMode) {\n                this.updatePattern();\n            }\n\n            this.updatePreview();\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            const currentPattern = this.promotion.individualCodePattern;\n\n            if (!currentPattern || !currentPattern.length > 0) {\n                this.pattern = {\n                    prefix: '',\n                    suffix: '',\n                    codeLength: 5,\n                };\n\n                return;\n            }\n\n            const regexp = /(?<prefix>[^%]*)(?<replacement>(%[sd])+)(?<suffix>.*)/g;\n            const groups = regexp.exec(currentPattern).groups;\n\n            // The saved pattern is NOT custom, if it only consists of multiple \"%s\"\n            this.customPatternMode = groups.replacement.includes('d');\n\n            this.pattern = {\n                ...groups,\n                codeLength: groups.replacement.length / 2 || 1,\n            };\n\n            this.updatePreview();\n        },\n\n        updatePattern() {\n            const characters = Array(Number(this.pattern.codeLength) + 1).join('%s');\n            this.promotion.individualCodePattern = `${this.pattern.prefix}${characters}${this.pattern.suffix}`;\n        },\n\n        updatePreview: debounce(function updatePreview() {\n            this.isGenerating = true;\n            this.promotionCodeApiService.generatePreview(this.promotion.individualCodePattern).then((result) => {\n                this.isGenerating = false;\n                this.preview = result;\n            });\n        }, 500),\n\n        onGenerate() {\n            this.isGenerating = true;\n            this.promotionCodeApiService\n                .replaceIndividualCodes(this.promotion.id, this.promotion.individualCodePattern, this.codeAmount)\n                .then(() => {\n                    this.isGenerating = false;\n                    this.$emit('generate-finish');\n                })\n                .catch((e) => {\n                    this.isGenerating = false;\n                    e.response.data.errors.forEach((error) => {\n                        let errorType;\n                        switch (error.code) {\n                            case 'PROMOTION__INDIVIDUAL_CODES_PATTERN_INSUFFICIENTLY_COMPLEX':\n                                errorType = 'notComplexEnoughException';\n                                break;\n                            case 'PROMOTION__INDIVIDUAL_CODES_PATTERN_ALREADY_IN_USE':\n                                errorType = 'alreadyInUseException';\n                                break;\n                            default:\n                                errorType = 'unknownErrorCode';\n                                break;\n                        }\n\n                        this.createNotificationError({\n                            autoClose: false,\n                            message: this.$tc(`sw-promotion-v2.detail.base.codes.individual.generateModal.${errorType}`),\n                        });\n                    });\n                });\n        },\n\n        onClose() {\n            this.$emit('close');\n        },\n    },\n};\n"],"names":["template","debounce","index","currentPattern","groups","characters","result","error","errorType"],"mappings":"AAAA,MAAeA,EAAA,g9ICMTC,EAAW,OAAO,MAAM,SAGfC,EAAA,CACX,SAAAF,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,yBACH,EAED,MAAO,CACH,kBACA,OACH,EAED,OAAQ,CACJ,cACH,EAED,MAAO,CACH,UAAW,CACP,KAAM,OACN,SAAU,EACb,CACJ,EAED,MAAO,CACH,MAAO,CACH,aAAc,GACd,kBAAmB,GACnB,WAAY,GACZ,QAAS,GACT,QAAS,CACL,OAAQ,GACR,OAAQ,GACR,WAAY,CACf,CACb,CACK,EAED,MAAO,CACH,QAAS,CACL,KAAM,GACN,SAAU,CACD,KAAK,mBACN,KAAK,cAAa,EAGtB,KAAK,cAAa,CACrB,CACJ,EAED,mCAAoC,CAChC,KAAK,cAAa,CACrB,EAED,mBAAoB,CACX,KAAK,mBACN,KAAK,cAAa,EAGtB,KAAK,cAAa,CACrB,CACJ,EAED,SAAU,CACN,KAAK,iBAAgB,CACxB,EAED,QAAS,CACL,kBAAmB,CACf,MAAMG,EAAiB,KAAK,UAAU,sBAEtC,GAAI,CAACA,GAAkB,CAACA,EAAe,OAAS,EAAG,CAC/C,KAAK,QAAU,CACX,OAAQ,GACR,OAAQ,GACR,WAAY,CAChC,EAEgB,MACH,CAGD,MAAMC,EADS,yDACO,KAAKD,CAAc,EAAE,OAG3C,KAAK,kBAAoBC,EAAO,YAAY,SAAS,GAAG,EAExD,KAAK,QAAU,CACX,GAAGA,EACH,WAAYA,EAAO,YAAY,OAAS,GAAK,CAC7D,EAEY,KAAK,cAAa,CACrB,EAED,eAAgB,CACZ,MAAMC,EAAa,MAAM,OAAO,KAAK,QAAQ,UAAU,EAAI,CAAC,EAAE,KAAK,IAAI,EACvE,KAAK,UAAU,sBAAwB,GAAG,KAAK,QAAQ,MAAM,GAAGA,CAAU,GAAG,KAAK,QAAQ,MAAM,EACnG,EAED,cAAeJ,EAAS,UAAyB,CAC7C,KAAK,aAAe,GACpB,KAAK,wBAAwB,gBAAgB,KAAK,UAAU,qBAAqB,EAAE,KAAMK,GAAW,CAChG,KAAK,aAAe,GACpB,KAAK,QAAUA,CAC/B,CAAa,CACJ,EAAE,GAAG,EAEN,YAAa,CACT,KAAK,aAAe,GACpB,KAAK,wBACA,uBAAuB,KAAK,UAAU,GAAI,KAAK,UAAU,sBAAuB,KAAK,UAAU,EAC/F,KAAK,IAAM,CACR,KAAK,aAAe,GACpB,KAAK,MAAM,iBAAiB,CAChD,CAAiB,EACA,MAAO,GAAM,CACV,KAAK,aAAe,GACpB,EAAE,SAAS,KAAK,OAAO,QAASC,GAAU,CACtC,IAAIC,EACJ,OAAQD,EAAM,KAAI,CACd,IAAK,6DACDC,EAAY,4BACZ,MACJ,IAAK,qDACDA,EAAY,wBACZ,MACJ,QACIA,EAAY,mBACZ,KACP,CAED,KAAK,wBAAwB,CACzB,UAAW,GACX,QAAS,KAAK,IAAI,8DAA8DA,CAAS,EAAE,CACvH,CAAyB,CACzB,CAAqB,CACrB,CAAiB,CACR,EAED,SAAU,CACN,KAAK,MAAM,OAAO,CACrB,CACJ,CACL"}