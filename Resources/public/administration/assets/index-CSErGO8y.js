const m=`{% block sw_product_variants_overview %} <div class="sw-product-variants-overview"> {% block sw_product_variants_overview_option_list_toolbar %} <div class="sw-configuration-option-list__toolbar"> {% block sw_product_variants_overview_option_list_toolbar_container %} <sw-container columns="1fr minmax(min-content, max-content) minmax(min-content, 180px) minmax(min-content, 180px)" gap="0 10px" > {% block sw_product_variants_overview_option_list_toolbar_container_search_field %} <sw-simple-search-field v-model:value="term" variant="form" size="small" @search-term-change="onSearch" /> {% endblock %} {% block sw_product_variants_overview_option_list_toolbar_container_filter_list %} <div class="sw-product-variants-overview__filter-list-button"> {% block sw_product_variants_overview_option_list_toolbar_container_filter_list_button %} <sw-button @click="filterWindowOpen = !filterWindowOpen"> {{ $tc('sw-product.variations.generatedFilterList') }} <sw-icon name="regular-filter" /> </sw-button> {% endblock %} {% block sw_product_variants_overview_option_list_toolbar_container_filter_context_menu %} <sw-context-menu v-show="filterWindowOpen"> <sw-container columns="1fr" gap="5px" > {% block sw_product_variants_overview_option_list_toolbar_container_filter_tree %} <sw-tree v-show="filterOptions.length" :sortable="false" :items="filterOptions" :searchable="false" :disable-context-menu="true" bind-items-to-folder > <template #items="{ treeItems, sortable, draggedItem, disableContextMenu, onChangeRoute, checkItem }" > <sw-tree-item v-for="(item, index) in treeItems" :key="item.id" :sortable="false" :item="item" :disable-context-menu="true" @check-item="filterOptionChecked" /> </template> </sw-tree> {% endblock %} {% block sw_product_variants_overview_option_list_toolbar_container_filter_buttons %} <div class="sw-product-variants-overview__filter-buttons"> {% block sw_product_variants_overview_option_list_toolbar_container_button_filter_reset %} <sw-button @click="resetFilterOptions()"> {{ $tc('sw-product.variations.overview.filterReset') }} </sw-button> {% endblock %} {% block sw_product_variants_overview_option_list_toolbar_container_button_update_list %} <sw-button variant="primary" @click="getList()" > {{ $tc('sw-product.variations.overview.filter') }} </sw-button> {% endblock %} </div> {% endblock %} </sw-container> </sw-context-menu> {% endblock %} </div> {% endblock %} {% block sw_product_variants_overview_option_list_toolbar_buttons %} <sw-button v-tooltip="{ message: $tc('sw-privileges.tooltip.warning'), disabled: acl.can('product.creator'), showOnDisabledElements: true }" variant="ghost" :disabled="!acl.can('product.creator')" class="sw-product-variants__generate-action" @click="$emit('generator-open')" > {{ $tc('sw-product.variations.overview.generateVariants') }} </sw-button> <sw-button variant="ghost" class="sw-product-variants__configure-storefront-action" :disabled="!acl.can('product.editor')" @click="$emit('delivery-open')" > {{ $tc('sw-product.variations.overview.storefrontDelivery') }} </sw-button> {% endblock %} </sw-container> {% endblock %} </div> {% endblock %} {% block sw_product_variants_overview_data_grid %} <sw-data-grid ref="variantGrid" class="sw-product-variants-overview__data-grid" :data-source="variants" :columns="variantColumns" :show-settings="true" :show-selection="acl.can('product.deleter')" :sort-by="sortBy" :sort-direction="sortDirection" :is-loading="isLoading" :skeleton-item-amount="limit" :allow-inline-edit="acl.can('product.editor')" identifier="product-variants-overview" @column-sort="onSortColumn" @inline-edit-save="onInlineEditSave" @inline-edit-cancel="onInlineEditCancel" > {% block sw_product_variants_overview_data_grid_column_name %} <template #column-name="{ item }" > <template v-if="item.options"> <router-link :to="{ name: 'sw.product.detail.base', params: { id: item.id } }" class="sw-product-variants-overview__variation-link" @click="onOptionEdit(item)" > <sw-icon name="regular-link-xs" /> <span v-for="(singleVariation, index) in item.options" :key="index" class="sw-product-variants-overview__single-variation" > {{ singleVariation.translated.name }} </span> </router-link> </template> <sw-label v-if="variantIsDigital(item)" class="sw-product-variants-overview__digital-indicator" > {{ $tc('sw-product.variations.generatedListColumnContentProductState.is-download') }} </sw-label> </template> {% endblock %} {% block sw_product_variants_overview_data_grid_column_price %} <template v-for="currency in currencies" :key="\`switch-\${currency.isoCode}\`" #[\`column-price.\${currency.id}.net\`]="{ item, compact, isInlineEdit }" > {% block sw_product_variants_overview_data_grid_column_price_inline_edit %} <template v-if="isInlineEdit"> {% block sw_product_variants_overview_data_grid_column_price_inline_edit_inherit %} <sw-inheritance-switch :is-inherited="isPriceFieldInherited(item, currency)" class="sw-product-detail-context-prices__inherited-icon" @inheritance-restore="onInheritanceRestore(item, currency)" @inheritance-remove="onInheritanceRemove(item, currency)" /> {% endblock %} {% block sw_product_variants_overview_data_grid_column_price_inline_edit_price_field %} <sw-price-field :value="item.price ? item.price : []" :default-price="getDefaultPriceForVariant(item, currency)" :tax-rate="productTaxRate" :label="false" :compact="compact" enable-inheritance :currency="currency" /> {% endblock %} </template> {% endblock %} {% block sw_product_variants_overview_data_grid_column_price_preview %} <template v-else> {% block sw_product_variants_overview_data_grid_column_price_preview_inherit %} <sw-inheritance-switch :key="\`else-switch-\${currency.isoCode}\`" :is-inherited="isPriceFieldInherited(item, currency)" class="sw-product-detail-context-prices__inherited-icon" :disabled="true" /> {% endblock %} {% block sw_product_variants_overview_data_grid_column_price_preview_price_field %} <sw-price-preview :key="\`else-price-field-\${currency.isoCode}\`" :value="item.price ? item.price : []" :default-price="getDefaultPriceForVariant(item, currency)" :tax-rate="productTaxRate" :currency="currency" /> {% endblock %} </template> {% endblock %} </template> {% endblock %} {% block sw_product_variants_overview_data_grid_column_stock %} <template #column-stock="{ item, isInlineEdit, compact }" > {% block sw_product_variants_overview_data_grid_column_stock_inline_edit_field %} <sw-number-field v-if="isInlineEdit && (!variantIsDigital(item) || item.isCloseout === true)" v-model:value="item.stock" :size="compact ? 'small' : 'default'" /> {% endblock %} {% block sw_product_variants_overview_data_grid_column_stock_preview %} <span v-else> {{ item.stock }} </span> {% endblock %} </template> {% endblock %} {% block sw_product_variants_overview_data_grid_column_product_number %} <template #column-productNumber="{ item, isInlineEdit, compact }" > {% block sw_product_variants_overview_data_grid_column_product_number_inline_edit %} <sw-text-field v-if="isInlineEdit" v-model:value="item.productNumber" :size="compact ? 'small' : 'default'" /> {% endblock %} {% block sw_product_variants_overview_data_grid_column_product_number_preview %} <span v-else class="sw-product-variants-overview_product-number" > {{ item.productNumber }} </span> {% endblock %} </template> {% endblock %} {% block sw_product_variants_overview_data_grid_column_media %} <template #column-media="{ item, isInlineEdit, compact }"> {% block sw_product_variants_overview_data_grid_column_media_inline_edit %} {% block sw_product_variants_overview_data_grid_column_media_inherit %} <sw-inheritance-switch :is-inherited="isMediaFieldInherited(item)" :disabled="!isInlineEdit" class="sw-product-variants-overview_media__inherited-icon" @inheritance-restore="onMediaInheritanceRestore(item, isInlineEdit)" @inheritance-remove="onMediaInheritanceRemove(item, isInlineEdit)" /> {% endblock %} {% block sw_product_variants_overview_data_grid_column_media_content %} <sw-product-variants-media-upload :source="item" :upload-tag="item.id" :is-inherited="isMediaFieldInherited(item)" :disabled="isInlineEdit ? isMediaFieldInherited(item) : true" :parent-product="product" /> {% endblock %} {% endblock %} </template> {% endblock %} <template #column-downloads="{item, isInlineEdit, compact}"> <sw-upload-listener :upload-tag="item.productNumber" auto-upload @media-upload-finish="(event) => successfulUpload(event, item)" /> <sw-media-compact-upload-v2 v-if="productDownloadFolderId" :upload-tag="item.productNumber" :disabled="!isInlineEdit" private-filesystem allow-multi-select add-files-on-multiselect :disable-deletion-for-last-item="{ value: true, helpText: $tc('sw-product.list.columnDownloadsTooltip') }" :source-multiselect="getDownloadsSource(item)" :target-folder-id="productDownloadFolderId" file-accept="*/*" @delete-item="(file) => removeFile(\`\${file.fileName}.\${file.fileExtension}\`, item)" /> </template> {% block sw_product_variants_overview_data_grid_column_active %} <template #column-active="{ item, isInlineEdit }" > <template v-if="isInlineEdit"> <sw-data-grid-column-boolean v-model:value="item.active" :is-inline-edit="isInlineEdit" :disabled="isActiveFieldInherited(item)" /> <sw-inheritance-switch :is-inherited="isActiveFieldInherited(item)" class="sw-product-variants-overview__active-inherited-icon" @inheritance-restore="onActiveInheritanceRestore(item)" @inheritance-remove="onActiveInheritanceRemove(item)" /> </template> <template v-else> <sw-icon v-if="item.active === true" name="regular-checkmark-xs" size="12px" class="is--active" /> <sw-icon v-else-if="item.active === false" name="regular-times-s" size="10px" class="is--inactive" /> <sw-icon v-else key="inherit-icon" name="regular-link-horizontal" size="16px" /> </template> </template> {% endblock %} {% block sw_product_variants_overview_actions %} <template #actions="{ item }" > {% block sw_product_variants_overview_actions_items %} <sw-context-menu-item v-tooltip="{ message: $tc('sw-privileges.tooltip.warning'), disabled: acl.can('product.editor'), showOnDisabledElements: true }" :disabled="!acl.can('product.editor')" @click="onOptionEdit(item)" > {{ $tc('sw-product.variations.generatedListContextMenuEdit') }} </sw-context-menu-item> <sw-context-menu-item v-tooltip="{ message: $tc('sw-privileges.tooltip.warning'), disabled: acl.can('product.deleter'), showOnDisabledElements: true }" variant="danger" :disabled="!acl.can('product.deleter')" @click="onVariationDelete(item)" > {{ $tc('sw-product.variations.generatedListContextMenuDelete') }} </sw-context-menu-item> {% endblock %} </template> {% endblock %} {% block sw_product_variants_overview_pagination %} <template #pagination> <sw-pagination :page="page" :limit="limit" :total="total" :total-visible="7" @page-change="onPageChange" /> </template> {% endblock %} {% block sw_product_variants_overview_bulk %} <template #bulk> {% block sw_product_variants_overview_bulk_edit %} <span v-if="acl.can('product.editor')" class="link link-primary" role="link" tabindex="0" @click="toggleBulkEditModal" > {{ $tc('global.default.bulkEdit') }} </span> {% endblock %} {% block sw_product_variants_overview_bulk_delete %} <span v-if="acl.can('product.deleter')" class="link link-danger sw-product-variants-overview__bulk-delete-action" role="link" tabindex="0" @click="onClickBulkDelete" > {{ $tc('global.default.delete') }} </span> {% endblock %} </template> {% endblock %} {% block sw_product_variants_overview_bulk_edit_modal %} <template #bulk-modals="{ selection }"> <sw-bulk-edit-modal v-if="showBulkEditModal" class="sw-product-variants-overview__bulk-edit-modal" :selection="selection" :bulk-grid-edit-columns="variantColumns" @edit-items="onEditItems" @modal-close="toggleBulkEditModal" > {% block sw_product_variants_overview_bulk_edit_modal_column_name %} <template #column-name="{ item }"> <template v-if="item.options"> <router-link class="sw-product-variants-overview__variation-link" :to="{ name: 'sw.product.detail.base', params: { id: item.id } }" @click="onOptionEdit(item)" > <sw-icon class="sw-product-variants-overview__variation-link-icon" name="regular-link-xs" /> <span v-for="(singleVariation, index) in item.options" :key="index" class="sw-product-variants-overview__variation-link-name" > {{ singleVariation.translated.name }} </span> </router-link> </template> </template> {% endblock %} {% block sw_product_variants_overview_bulk_edit_modal_column_price %} <template v-for="currency in currencies" :key="currency.id" #[\`column-price.\${currency.id}.net\`]="{ item }" > <sw-inheritance-switch :key="\`else-switch-\${currency.isoCode}\`" :is-inherited="isPriceFieldInherited(item, currency)" disabled /> <sw-price-preview :key="\`else-price-field-\${currency.isoCode}\`" :value="item.price ? item.price : []" :default-price="getDefaultPriceForVariant(item, currency)" :tax-rate="productTaxRate" :currency="currency" /> </template> {% endblock %} {% block sw_product_variants_overview_bulk_edit_modal_column_media %} <template #column-media="{ item }"> <sw-inheritance-switch class="sw-product-variants-overview_media__inherited-icon" :is-inherited="isMediaFieldInherited(item)" disabled /> <sw-product-variants-media-upload :source="item" :upload-tag="item.id" :is-inherited="isMediaFieldInherited(item)" :parent-product="product" disabled /> </template> {% endblock %} <template #column-downloads="{item, isInlineEdit, compact}"> <sw-upload-listener :upload-tag="item.productNumber" auto-upload @media-upload-finish="(event) => successfulUpload(event, item)" /> <sw-media-compact-upload-v2 v-if="productDownloadFolderId" :upload-tag="item.productNumber" :disabled="!isInlineEdit" private-filesystem allow-multi-select :disable-deletion-for-last-item="{ value: true, helpText: $tc('sw-product.list.columnDownloadsTooltip') }" :add-files-on-multiselect="true" :source-multiselect="getDownloadsSource(item)" :target-folder-id="productDownloadFolderId" file-accept="*/*" @delete-item="(file) => removeFile(\`\${file.fileName}.\${file.fileExtension}\`, item)" /> </template> {% block sw_product_variants_overview_bulk_edit_modal_column_active %} <template #column-active="{ item }"> <sw-icon v-if="item.active === true" class="is--active" name="regular-checkmark-xs" small /> <sw-icon v-else-if="item.active === false" class="is--inactive" name="regular-times-s" small /> <sw-icon v-else key="inherit-icon" name="regular-link-horizontal" size="16" /> </template> {% endblock %} </sw-bulk-edit-modal> </template> {% endblock %} </sw-data-grid> {% endblock %} {% block sw_product_variants_overview_data_grid_action_modals %} <sw-modal v-if="showDeleteModal" class="sw-product-variants-overview__delete-modal" :title="$tc('global.default.warning')" variant="small" @modal-close="onCloseDeleteModal" > <p class="sw-product-variants-overview__modal--confirm-delete-text" > {{ toBeDeletedVariantIds.length > 1 ? $tc('sw-product.variations.generatedListDeleteModalMessagePlural') : $tc('sw-product.variations.generatedListDeleteModalMessage') }} </p> <template #modal-footer> {% block sw_product_variants_overview_data_grid_action_modals_buttons %} <sw-button class="sw-product-variants-overview__modal--cancel-button" size="small" :disabled="modalLoading" @click="onCloseDeleteModal" > {{ $tc('global.default.cancel') }} </sw-button> <sw-button variant="danger" size="small" :disabled="modalLoading" @click="onConfirmDelete" > {{ $tc('sw-product.variations.generatedListDeleteModalButtonDelete') }} </sw-button> {% endblock %} </template> </sw-modal> {% endblock %} </div> {% endblock %}`,{Mixin:p,Context:c}=Cicada,{Criteria:a}=Cicada.Data,{mapState:_,mapGetters:v}=Cicada.Component.getComponentHelper(),w={template:m,compatConfig:Cicada.compatConfig,inject:["repositoryFactory","acl","feature","mediaService"],emits:["generator-open","delivery-open","variants-finish-update"],mixins:[p.getByName("notification"),p.getByName("listing")],props:{productEntity:{type:Object,required:!0},selectedGroups:{type:Array,required:!0},productStates:{type:Array,required:!1,default:()=>["all"]}},data(){return{sortBy:"name",sortDirection:"DESC",showDeleteModal:!1,modalLoading:!1,priceEdit:!1,filterOptions:[],activeFilter:[],includeOptions:[],filterWindowOpen:!1,showBulkEditModal:!1,toBeDeletedVariantIds:[],productDownloadFolderId:null}},computed:{..._("swProductDetail",["product","currencies","taxes","variants"]),...v("swProductDetail",["isLoading","defaultPrice","defaultCurrency","productTaxRate"]),productRepository(){return this.repositoryFactory.create("product")},productMediaRepository(){return this.repositoryFactory.create(this.product.media.entity)},mediaRepository(){return this.repositoryFactory.create("media")},productDownloadRepository(){return this.repositoryFactory.create("product_download")},variantColumns(){const e=[{property:"name",label:this.$tc("sw-product.variations.generatedListColumnVariation"),allowResize:!0},...this.currencyColumns,{property:"sales",dataIndex:"sales",label:this.$tc("sw-product.list.columnSales"),allowResize:!0,align:"right"},{property:"stock",label:this.$tc("sw-product.variations.generatedListColumnStock"),allowResize:!0,inlineEdit:"number",width:"125px",align:"right"},{property:"productNumber",label:this.$tc("sw-product.variations.generatedListColumnProductNumber"),allowResize:!0,inlineEdit:"string",width:"150px"},{property:"media",label:this.$tc("sw-product.detailBase.cardTitleMedia"),allowResize:!0,inlineEdit:!0,sortable:!1},{property:"active",label:this.$tc("sw-product.variations.generatedListColumnActive"),allowResize:!0,inlineEdit:"boolean",align:"center"}];return this.productStates.includes("is-download")&&e.splice(e.length-1,0,{property:"downloads",label:this.$tc("sw-product.variations.generatedListColumnDownload"),allowResize:!0,inlineEdit:!0,sortable:!1}),e},currencyColumns(){return this.currencies.sort((e,t)=>t.isSystemDefault?1:-1).map(e=>({property:`price.${e.id}.net`,label:e.translated.name||e.name,visible:e.isSystemDefault,allowResize:!0,primary:!1,rawData:!1,inlineEdit:"number",width:"250px"}))},canBeDeletedCriteria(){const e=new a(1,25),t=this.toBeDeletedVariantIds.map(i=>i.id);return e.addFilter(a.equalsAny("canonicalProductId",t)),e}},watch:{selectedGroups:{immediate:!0,handler(){!this.selectedGroups||this.selectedGroups.length===0||this.getFilterOptions()}},productStates(){this.getList()},"product.id":{handler(){this.getList()}}},created(){this.createdComponent()},methods:{async createdComponent(){this.productDownloadFolderId=await this.mediaService.getDefaultFolderId("product_download")},removeFile(e,t){t.downloads.length!==1&&(t.downloads=t.downloads.filter(i=>`${i.media.fileName}.${i.media.fileExtension}`!==e),this.productRepository.save(t))},mediaExists(e,t){return e.some(({id:i})=>i===t)},successfulUpload(e,t){this.mediaRepository.get(e.targetId,c.api).then(i=>{if(this.mediaExists(this.getDownloadsSource(t),e.targetId))return;const o=this.productDownloadRepository.create(c.api);o.mediaId=e.targetId,o.productId=t.id,o.media=i,Cicada.State.commit("swProductDetail/setVariants",this.variants.map(r=>(r.id===t.id&&(r.downloads.push(o),this.productRepository.save(r)),r)))})},getDownloadsSource(e){return e.downloads?e.downloads.map(t=>t.media):[]},getList(){return new Promise(e=>{if(this.product.parentId)return;Cicada.State.commit("swProductDetail/setLoading",["variants",!0]);const t=new a(1,25),i=this.productStates.filter(r=>r!=="all"),o=i.map(r=>a.equals("states",r));t.setTotalCountMode(1),t.setPage(this.page).setLimit(this.limit).addFilter(a.equals("product.parentId",this.product.id)).addFilter(a.multi("AND",o)),t.getAssociation("media").addSorting(a.sort("position")),t.addAssociation("media.media"),t.getAssociation("options").addSorting(a.sort("groupId")).addSorting(a.sort("id")),i.includes("is-download")&&t.addAssociation("downloads.media"),this.buildSearchQuery(t),this.getFilterCriteria()&&this.getFilterCriteria().forEach(r=>{t.addFilter(r)}),this.sortBy==="name"?t.addSorting(a.sort("product.options.name",this.sortDirection)):t.addSorting(a.sort(this.sortBy,this.sortDirection)),this.sortBy!=="productNumber"&&t.addSorting(a.sort("product.productNumber",this.sortDirection)),this.productRepository.search(t).then(r=>{this.total=r.total,Cicada.State.commit("swProductDetail/setVariants",r),Cicada.State.commit("swProductDetail/setLoading",["variants",!1]),this.$emit("variants-finish-update",this.variants),e()})})},buildSearchQuery(e){return this.term&&(this.term.split(" ").forEach(i=>{e.addQuery(a.equals("product.options.name",i),3500),e.addQuery(a.contains("product.options.name",i),500)}),e.addQuery(a.contains("product.productNumber",this.term),5e3)),e},getFilterOptions(){const e=[...this.selectedGroups].sort((i,o)=>i.position-o.position).map((i,o)=>{const r=this.getOptionsForGroup(i.id);return{id:i.id,name:i.name,childCount:r.length,parentId:null,afterId:o>0?this.selectedGroups[o-1].id:null,storeObject:i}}),t=e.reduce((i,o)=>{const r=this.getOptionsForGroup(o.id),s=r.sort((n,l)=>n.position-l.position).map((n,l)=>{const d=n.option;let u=null;return l>0&&(u=r[l-1].option.id),{id:d.id,name:d.name,childCount:0,parentId:d.groupId,afterId:u,storeObject:n}});return[...i,...s]},[]);this.filterOptions=[...e,...t]},resetFilterOptions(){this.filterOptions=[],this.includeOptions=[],this.$nextTick(()=>{this.getFilterOptions(),this.getList()})},filterOptionChecked(e){e.checked?this.includeOptions.push({id:e.id,groupId:e.parentId}):this.includeOptions=this.includeOptions.filter(t=>t.id!==e.id)},getFilterCriteria(){return this.includeOptions.length<=0?!1:this.includeOptions.reduce((t,i)=>{const o=t.find(r=>r.id===i.groupId);return o?o.options.push(i.id):t.push({id:i.groupId,options:[i.id]}),t},[]).map(t=>a.equalsAny("product.optionIds",t.options))},getOptionsForGroup(e){return this.product.configuratorSettings.filter(t=>!t.isDeleted&&t.option.groupId===e)},isPriceFieldInherited(e,t){return e.price?!e.price.find(o=>o.currencyId===t.id):!0},isActiveFieldInherited(e){return e.active===null},isMediaFieldInherited(e){return e.forceMediaInheritanceRemove?!1:e.media?e.media.length<=0:!!e.media},onInheritanceRestore(e,t){if(!e.price)return;const i=e.price.findIndex(o=>o.currencyId===t.id);i>=0&&(this.isCompatEnabled("INSTANCE_DELETE")?this.$delete(e.price,i):delete e.price[i]),(e.price.length<=0||Object.keys(e.price).length<=0)&&(e.price=null)},onActiveInheritanceRestore(e){e.active=null},onActiveInheritanceRemove(e){e.active=!0},onInheritanceRemove(e,t){e.price||(e.price=[]),t.isSystemDefault||this.onInheritanceRemove(e,this.defaultCurrency);const i=this.getDefaultPriceForVariant(e),o={currencyId:t.id,gross:i.gross*t.factor,linked:i.linked,net:i.net*t.factor};this.isCompatEnabled("INSTANCE_SET")?this.$set(e.price,e.price.length,o):e.price.push(o)},onMediaInheritanceRestore(e,t){t&&(e.forceMediaInheritanceRemove=!1,e.coverId=null,e.media.getIds().forEach(i=>{e.media.remove(i)}))},onMediaInheritanceRemove(e,t){t&&(e.forceMediaInheritanceRemove=!0,this.product.media.forEach(({id:i,mediaId:o,position:r})=>{const s=this.productMediaRepository.create(c.api);Object.assign(s,{mediaId:o,position:r,productId:this.product.id}),this.product.coverId===i&&(e.coverId=s.id),e.media.push(s)}))},getDefaultPriceForVariant(e){return e.price?e.price.find(i=>i.currencyId===this.defaultCurrency.id)||this.defaultPrice:this.defaultPrice},onVariationDelete(e){this.showDeleteModal=!0,this.toBeDeletedVariantIds.push(e)},onInlineEditSave(e){if(!this.productRepository.hasChanges(e))return;const t=e.options.reduce((i,o,r)=>`${i}${r>0?" - ":""}${o.translated.name}`,"");this.productRepository.save(e).then(()=>{const i=this.$tc("global.default.success"),o=this.$tc("sw-product.detail.messageSaveSuccess",0,{name:t});this.createNotificationSuccess({title:i,message:o}),this.getList()}).catch(()=>{const i=this.$tc("global.default.error"),o=this.$tc("global.notification.notificationSaveErrorMessageRequiredFieldsInvalid");this.createNotificationError({title:i,message:o})})},onInlineEditCancel(){this.getList()},onCloseDeleteModal(){this.showDeleteModal=!1,this.toBeDeletedVariantIds=[]},onConfirmDelete(){this.modalLoading=!0,this.showDeleteModal=!1;const e=this.toBeDeletedVariantIds.map(t=>t.id);this.canVariantBeDeleted().then(t=>{if(!t){this.modalLoading=!1,this.toBeDeletedVariantIds=[],this.createNotificationError({message:this.$tc("sw-product.variations.generatedListMessageDeleteErrorCanonicalUrl")});return}this.updateVariantListingConfig(e),this.productRepository.syncDeleted(e).then(()=>{this.modalLoading=!1,this.toBeDeletedVariantIds=[],this.createNotificationSuccess({message:this.$tc("sw-product.variations.generatedListMessageDeleteSuccess")}),this.$refs.variantGrid.resetSelection(),this.getList()})})},async canVariantBeDeleted(){return(await this.productRepository.search(this.canBeDeletedCriteria)).length===0},onOptionEdit(e){e!=null&&e.id&&this.$router.push({name:"sw.product.detail",params:{id:e.id}})},isPriceEditing(e){this.priceEdit=e},toggleBulkEditModal(){this.showBulkEditModal=!this.showBulkEditModal},async onEditItems(){await this.$nextTick();let e="0";const t=Object.values(this.$refs.variantGrid.selection).filter(i=>i.states.includes("is-download"));t.length>0&&(e=t.filter(i=>i.isCloseout).length!==t.length?"1":"2"),this.$router.push({name:"sw.bulk.edit.product",params:{parentId:this.product.id,includesDigital:e}})},onClickBulkDelete(){const e=this.$refs.variantGrid.selection;this.toBeDeletedVariantIds=Object.values(e),this.showDeleteModal=!0},variantIsDigital(e){return this.productStates.includes("all")&&e.states&&e.states.includes("is-download")},updateVariantListingConfig(e){var i,o;e.length===this.variants.length&&(this.productEntity.variantListingConfig=null);const t=(i=this.productEntity.variantListingConfig)==null?void 0:i.mainVariantId;t&&e.includes(t)&&(this.productEntity.variantListingConfig.mainVariantId=null,((o=this.productEntity.variantListingConfig)==null?void 0:o.displayParent)!==null&&(this.productEntity.variantListingConfig.displayParent=!0)),this.productRepository.save(this.productEntity)}}};export{w as default};
//# sourceMappingURL=index-CSErGO8y.js.map
