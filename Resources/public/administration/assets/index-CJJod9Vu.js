const m=`{% block sw_app_actions %} <div class="sw-app-actions" :class="{'sw-app-actions__empty': !areActionsAvailable}" > <template v-if="areActionsAvailable"> <sw-context-button class="sw-app-actions__action-button"> <template #button> <sw-button> <sw-icon name="solid-ellipsis-h-s" size="16" /> </sw-button> </template> <sw-app-action-button v-for="action in actions" :key="action.id" :action="action" @run-app-action="runAction" /> </sw-context-button> {% block sw_app_action_modal %} <sw-modal v-if="isOpenModal" class="sw-modal-app-action-button" :class="{ 'is-expanded' : isExpanded}" :variant="size" @modal-close="onCloseModal" > {% block sw_app_action_modal_header %} <template #modal-header> {% block sw_app_action_modal_slot_header %} {% block sw_app_action_modal_close %} <div id="modal-app-action-button" class="sw-modal__title" > <img v-if="action.icon" class="sw-app-action-button__icon" :src="\`data:image/png;base64, \${action.icon}\`" alt="" > <span>{{ action.app }}</span> </div> {% endblock %} {% block sw_app_action_modal_close_button %} <button class="sw-modal__close" :title="$tc('global.sw-modal.labelClose')" :aria-label="$tc('global.sw-modal.labelClose')" @click.prevent="onCloseModal" > {% block sw_app_action_modal_close_icon %} <sw-icon name="regular-times-s" small /> {% endblock %} </button> {% endblock %} {% endblock %} </template> {% endblock %} {% block sw_app_action_modal_iframe %} <iframe id="app-action-button-iframe" ref="innerFrame" class="sw-app-action-button-iframe" referrerpolicy="origin-when-cross-origin" :src="iframeUrl" ></iframe> {% endblock %} </sw-modal> {% endblock %} {% block sw_app_action_modal_confirm %} <sw-modal v-if="isOpenConfirmModal" class="sw-app-action-button-modal-confirm" :title="$tc('sw-app.component.sw-app-actions.closeWindow')" variant="small" @modal-close="onCloseModalConfirm" > <p>{{ $tc('sw-app.component.sw-app-actions.iframeModalConfirmMessage', { title: action.app }, 0) }}</p> <p>{{ $tc('sw-app.component.sw-app-actions.iframeModalConfirmMessageDescription') }}</p> {% block sw_app_action_modal_confirm_footer %} <template #modal-footer> {% block sw_app_action_modal_confirm_checkbox %} <sw-checkbox-field :value="!isShowModalConfirm" @update:value="onChangeCheckboxShow()" > {% block sw_app_action_modal_confirm_checkbox_label %} <template #label> {{ $tc('sw-app.component.sw-app-actions.dontAskMeAgain') }} </template> {% endblock %} </sw-checkbox-field> {% endblock %} {% block sw_app_action_modal_confirm_footer_buttons %} <div class="footer-buttons"> {% block sw_app_action_modal_confirm_footer_cancel %} <sw-button size="small" @click="onCloseModalConfirm" > {{ $tc('global.default.cancel') }} </sw-button> {% endblock %} {% block sw_app_action_modal_confirm_footer_continue %} <sw-button variant="primary" size="small" @click="onConfirmClose" > {{ $tc('global.default.close') }} </sw-button> {% endblock %} </div> {% endblock %} </template> {% endblock %} </sw-modal> {% endblock %} </template> </div> {% endblock %}`,{Component:f,Mixin:h}=Shopware,{Criteria:r}=Shopware.Data,{hasOwnProperty:u}=Shopware.Utils.object,n=Object.freeze({ACTION_SHOW_NOTIFICATION:"notification",ACTION_RELOAD_DATA:"reload",ACTION_OPEN_NEW_TAB:"openNewTab",ACTION_OPEN_MODAL:"openModal"}),l={small:"small",medium:"default",large:"large",fullscreen:"full"},c="app.action_button.iframe";f.register("sw-app-actions",{template:m,extensionApiDevtoolInformation:{property:"ui.actionButton",entity:e=>`${e.entity}`,view:e=>`${e.view}`},inject:["feature","appActionButtonService","repositoryFactory","extensionSdkService"],mixins:[h.getByName("notification")],data(){return{actions:[],matchedRoutes:[],isOpenModal:!1,isOpenConfirmModal:!1,title:"",action:null,size:"default",isExpanded:!1,iframeUrl:"",isShowModalConfirm:!0,iframeUserConfig:null}},computed:{entity(){var e,t,o;return(o=(t=(e=this.$route)==null?void 0:e.meta)==null?void 0:t.$module)==null?void 0:o.entity},view(){var t,o;const e=this.matchedRoutes.filter(a=>{var i,s;return!!((s=(i=a==null?void 0:a.meta)==null?void 0:i.appSystem)!=null&&s.view)}).pop();return(o=(t=e==null?void 0:e.meta)==null?void 0:t.appSystem)==null?void 0:o.view},areActionsAvailable(){return!!this.actions&&this.actions.length>0&&this.params.length>0},params(){return Shopware.Store.get("shopwareApps").selectedIds},userConfigRepository(){return this.repositoryFactory.create("user_config")},currentUser(){return Shopware.Store.get("session").currentUser},userConfigCriteria(){var t;const e=new r(1,25);return e.addFilter(r.equals("key",c)),e.addFilter(r.equals("userId",(t=this.currentUser)==null?void 0:t.id)),e},extensionSdkButtons(){return Shopware.Store.get("actionButtons").buttons.filter(e=>e.entity===this.entity&&e.view===this.view)}},watch:{$route:{immediate:!0,handler(){this.matchedRoutes=this.$router.currentRoute.value.matched,this.loadActions()}},extensionSdkButtons(){this.loadActions()}},created(){this.entity&&(Shopware.Store.get("shopwareApps").selectedIds=[])},methods:{async runAction(e){const t={ids:this.params};if(u(e,"callback")&&typeof e.callback=="function"){e.callback(e.entity,t.ids);return}const{data:o}=await this.appActionButtonService.runAction(e.id,t),{actionType:a,redirectUrl:i,status:s,message:p}=o;switch(this.action=this.actions.find(d=>d.id===e.id),a){case n.ACTION_OPEN_NEW_TAB:window.open(i,"_blank");break;case n.ACTION_SHOW_NOTIFICATION:this.createNotification({variant:s,message:p});break;case n.ACTION_RELOAD_DATA:window.location.reload();break;case n.ACTION_OPEN_MODAL:await this.getUserConfig(),this.size=l[o.size]||"default",this.iframeUrl=o.iframeUrl,this.isExpanded=o.expand===!0,this.isOpenModal=!0;break}},async loadActions(){try{this.actions=await this.appActionButtonService.getActionButtonsPerView(this.entity,this.view),this.actions.push(...this.extensionSdkButtons)}catch(e){if(this.actions=[],e.name&&e.name==="InvalidActionButtonParameterError")return;this.createNotificationError({message:this.$tc("sw-app.component.sw-app-actions.messageErrorFetchButtons")})}},onCloseModal(){this.size===l.small&&!this.isExpanded?this.isOpenModal=!1:this.onOpenModalConfirm()},onOpenModalConfirm(){if(this.iframeUserConfig.value.isShowModalConfirm){this.isOpenConfirmModal=!0;return}this.isOpenModal=!1},onCloseModalConfirm(){this.isOpenConfirmModal=!1},async onConfirmClose(){this.saveConfig(this.isShowModalConfirm),await this.onCloseModalConfirm(),this.isOpenModal=!1},onChangeCheckboxShow(){this.isShowModalConfirm=!this.isShowModalConfirm},getUserConfig(){this.userConfigRepository.search(this.userConfigCriteria,Shopware.Context.api).then(e=>{var t;e.length?this.iframeUserConfig=e.first():(this.iframeUserConfig=this.userConfigRepository.create(Shopware.Context.api),this.iframeUserConfig.key=c,this.iframeUserConfig.userId=(t=this.currentUser)==null?void 0:t.id,this.iframeUserConfig.value={isShowModalConfirm:!0})})},saveConfig(e){this.iframeUserConfig.value={isShowModalConfirm:e},this.userConfigRepository.save(this.iframeUserConfig,Shopware.Context.api).then(()=>{this.getUserConfig()})}}});
