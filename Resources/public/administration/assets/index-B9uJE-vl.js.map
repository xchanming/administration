{"version":3,"file":"index-B9uJE-vl.js","sources":["../../../app/administration/src/module/sw-bulk-edit/component/sw-bulk-edit-save-modal-process/sw-bulk-edit-save-modal-process.html.twig","../../../app/administration/src/module/sw-bulk-edit/component/sw-bulk-edit-save-modal-process/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_bulk_edit_save_modal_process %}\n<div class=\"sw-bulk-edit-save-modal-process\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_bulk_edit_save_modal_process_icon %}\n    <sw-label\n        class=\"sw-bulk-edit-save-modal__icon\"\n        appearance=\"pill\"\n        variant=\"info\"\n    >\n        <sw-loader\n            class=\"sw-bulk-edit-save-modal__loading-icon\"\n            size=\"30px\"\n        />\n    </sw-label>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_bulk_edit_save_modal_process_generate_document %}\n    <ul\n        v-if=\"selectedDocumentTypes.length > 0\"\n        class=\"sw-bulk-edit-save-modal-process__generate-document-container\"\n    >\n        <li\n            v-for=\"selectedDocumentType in selectedDocumentTypes\"\n            :key=\"selectedDocumentType.id\"\n            class=\"sw-bulk-edit-save-modal-process__generate-document\"\n            :class=\"`is--${selectedDocumentType.technicalName}`\"\n        >\n            <div class=\"progress\">\n                <div class=\"progress__label\">\n                    <span>{{ selectedDocumentType.translated.name }}</span>\n                    <span>{{ `${document[selectedDocumentType.technicalName].isReached}%` }}</span>\n                </div>\n                <div class=\"progress__bar\">\n                    <div\n                        class=\"progress__bar-fill\"\n                        :style=\"{ width: `${document[selectedDocumentType.technicalName].isReached}%` }\"\n                    >\n                    </div>\n                </div>\n            </div>\n        </li>\n    </ul>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_bulk_edit_save_modal_process_content %}\n    <p class=\"sw-bulk-edit-save-modal__help-text\">\n        {{ $tc('sw-bulk-edit.modal.process.description') }}\n        <br>\n        <br>\n        {{ $tc('sw-bulk-edit.modal.process.helpText') }}\n    </p>\n\n    <sw-alert\n        variant=\"warning\"\n        class=\"sw-bulk-edit-save-modal__warning\"\n    >\n        {{ $tc('sw-bulk-edit.modal.warningText') }}\n    </sw-alert>\n    {% endblock %}\n</div>\n{% endblock %}\n","/**\n * @package services-settings\n */\nimport template from './sw-bulk-edit-save-modal-process.html.twig';\nimport './sw-bulk-edit-save-modal-process.scss';\n\nconst { chunk: chunkArray } = Cicada.Utils.array;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: ['orderDocumentApiService'],\n\n    emits: [\n        'changes-apply',\n        'title-set',\n        'buttons-update',\n    ],\n\n    data() {\n        return {\n            requestsPerPayload: 5,\n            document: {\n                invoice: {\n                    isReached: 0,\n                },\n                storno: {\n                    isReached: 0,\n                },\n                delivery_note: {\n                    isReached: 0,\n                },\n                credit_note: {\n                    isReached: 0,\n                },\n            },\n        };\n    },\n\n    computed: {\n        selectedIds() {\n            return Cicada.State.get('cicadaApps').selectedIds;\n        },\n\n        documentTypes() {\n            return Cicada.State.get('swBulkEdit')?.orderDocuments?.download?.value;\n        },\n\n        documentTypeConfigs() {\n            return Cicada.State.getters['swBulkEdit/documentTypeConfigs'];\n        },\n\n        selectedDocumentTypes() {\n            if (!this.documentTypeConfigs || this.documentTypeConfigs.length <= 0) {\n                return [];\n            }\n\n            const selectedDocumentTypes = [];\n\n            this.documentTypeConfigs.forEach((documentTypeConfig) => {\n                const selectedDocumentType = this.documentTypes.find((documentType) => {\n                    return documentTypeConfig.type === documentType.technicalName;\n                });\n\n                if (selectedDocumentType) {\n                    selectedDocumentTypes.push(selectedDocumentType);\n                }\n            });\n\n            return selectedDocumentTypes;\n        },\n\n        createDocumentPayload() {\n            const payload = [];\n\n            this.selectedIds.forEach((selectedId) => {\n                this.documentTypeConfigs?.forEach((documentTypeConfig) => {\n                    if (documentTypeConfig) {\n                        payload.push({\n                            ...documentTypeConfig,\n                            orderId: selectedId,\n                        });\n                    }\n                });\n            });\n\n            return payload;\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        async createdComponent() {\n            this.updateButtons();\n            this.setTitle();\n            await this.createDocuments();\n            this.$emit('changes-apply');\n        },\n\n        setTitle() {\n            this.$emit('title-set', this.$tc('sw-bulk-edit.modal.process.title'));\n        },\n\n        updateButtons() {\n            const buttonConfig = [\n                {\n                    key: 'cancel',\n                    label: this.$tc('global.default.cancel'),\n                    position: 'left',\n                    action: '',\n                    disabled: false,\n                },\n                {\n                    key: 'next',\n                    label: this.$tc('global.sw-modal.labelClose'),\n                    position: 'right',\n                    variant: 'primary',\n                    action: '',\n                    disabled: true,\n                },\n            ];\n\n            this.$emit('buttons-update', buttonConfig);\n        },\n\n        async createDocuments() {\n            if (this.createDocumentPayload.length <= 0) {\n                return;\n            }\n\n            const invoiceDocuments = this.createDocumentPayload.filter((item) => item.type === 'invoice');\n            const stornoDocuments = this.createDocumentPayload.filter((item) => item.type === 'storno');\n            const creditNoteDocuments = this.createDocumentPayload.filter((item) => item.type === 'credit_note');\n            const deliveryNoteDocuments = this.createDocumentPayload.filter((item) => item.type === 'delivery_note');\n\n            if (invoiceDocuments.length > 0) {\n                await this.createDocument('invoice', invoiceDocuments);\n            }\n\n            if (stornoDocuments.length > 0) {\n                await this.createDocument('storno', stornoDocuments);\n            }\n\n            if (creditNoteDocuments.length > 0) {\n                await this.createDocument('credit_note', creditNoteDocuments);\n            }\n\n            if (deliveryNoteDocuments.length > 0) {\n                await this.createDocument('delivery_note', deliveryNoteDocuments);\n            }\n        },\n\n        async createDocument(documentType, payload) {\n            if (payload.length <= this.requestsPerPayload) {\n                await this.orderDocumentApiService.generate(documentType, payload);\n                if (this.isCompatEnabled('INSTANCE_SET')) {\n                    this.$set(this.document[documentType], 'isReached', 100);\n                } else {\n                    this.document[documentType].isReached = 100;\n                }\n\n                return Promise.resolve();\n            }\n\n            const chunkedPayload = chunkArray(payload, this.requestsPerPayload);\n            const percentages = Math.round(100 / chunkedPayload.length);\n\n            return Promise.all(\n                chunkedPayload.map(async (item) => {\n                    await this.orderDocumentApiService.generate(documentType, item);\n                    if (this.isCompatEnabled('INSTANCE_SET')) {\n                        // eslint-disable-next-line max-len\n                        this.$set(\n                            this.document[documentType],\n                            'isReached',\n                            this.document[documentType].isReached + percentages,\n                        );\n                    } else {\n                        // eslint-disable-next-line operator-assignment\n                        this.document[documentType].isReached = this.document[documentType].isReached + percentages;\n                    }\n                }),\n            ).then(() => {\n                if (this.isCompatEnabled('INSTANCE_SET')) {\n                    this.$set(this.document[documentType], 'isReached', 100);\n                } else {\n                    this.document[documentType].isReached = 100;\n                }\n            });\n        },\n    },\n};\n"],"names":["template","chunkArray","index","_a","_b","_c","selectedDocumentTypes","documentTypeConfig","selectedDocumentType","documentType","payload","selectedId","buttonConfig","invoiceDocuments","item","stornoDocuments","creditNoteDocuments","deliveryNoteDocuments","chunkedPayload","percentages"],"mappings":"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"}