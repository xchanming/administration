import{u as P}from"./util.service-DptoGcql.js";import{E as U,aN as x,aO as A,aP as C,aQ as R,M as E,aR as T,aS as m,b as I,C as M,aT as N}from"./channel-Cvr-E4M4.js";class Q{constructor({code:t,meta:r={},status:s="",detail:_=""}={}){if(this.selfLink=void 0,typeof t!="string"||t==="")throw new Error("[ShopwareError] can not identify error by code");this._id=P.createId(),this._code=t,this._parameters=r.parameters,this._status=s,this._detail=_}get id(){return this._id}get code(){return this._code}set code(t){this._code=t}get parameters(){return this._parameters}set parameters(t){this._parameters=t}get status(){return this._status}set status(t){this._status=t}get detail(){return this._detail}set detail(t){this._trace=t}}x((e,t,r)=>{Shopware.Application.view.setReactive(e,t,r)});function G(e){return(t,r,s)=>(e==="datasetSubscribe"&&C("datasetSubscribeRegistration",{id:t,selectors:s==null?void 0:s.selectors}),R(e,a=>{var d;if((a==null?void 0:a.id)!==t||a.selectors&&a.selectors.length>0&&((d=s==null?void 0:s.selectors)===null||d===void 0?void 0:d.sort().join(","))!==a.selectors.sort().join(","))return;(a==null?void 0:a.data)instanceof E&&console.error(a.data);const h=r(a);h&&h.catch(()=>{})}))}const y=A,L=G("datasetUpdate"),W=T("datasetGet");var k={};let c=[],l=[];function D(e){return m.cloneDeepWith(e,t=>{if(t!=null&&t.__identifier__&&typeof t.__identifier__=="function"&&t.__identifier__()==="EntityCollection")return new I(t.source,t.entity,{},t.criteria===null?t.criteria:M.fromCriteria(t.criteria),D(Array.from(t)),t.total,t.aggregations);if(t!=null&&t.__identifier__&&typeof t.__identifier__=="function"&&t.__identifier__()==="Entity")return new U(t.id,t._entityName,D(t._draft),{originData:D(t._origin),isDirty:t._isDirty,isNew:t._isNew})})}W((e,t)=>{var h;const r=(h=t==null?void 0:t._event_)==null?void 0:h.origin,s=c.find(g=>g.id===e.id);if(!s)return null;if(s.deprecated){const g=Object.values(Shopware.Store.get("extensions").extensionsState).find(o=>o.baseUrl.startsWith(t._event_.origin));if(!g)throw new Error(`Extension with the origin "${t._event_.origin}" not found.`);const i=["CORE",`The extension "${g.name}" uses a deprecated data set "${e.id}". ${s.deprecationMessage}`];k!=="prod"?Shopware.Utils.debug.error(...i):Shopware.Utils.debug.warn(...i)}const _=e.selectors;if(!_)return s.data;const a=D(s.data),d=N(a,_,"datasetGet",r);return d instanceof E&&console.error(d),d});function V(e){if(!e.includes("."))return null;const t=e.split("."),r=t.pop(),s=t.join(".");return r&&r.length&&s&&s.length?{pathToLastSegment:s,lastSegment:r}:null}function j({id:e,path:t,scope:r,deprecated:s,deprecationMessage:_}){var h,g;l.includes(e)&&(l=l.filter(i=>i!==e));const a=c.find(i=>i.id===e);if(a&&a.scope!==((h=r==null?void 0:r.$)==null?void 0:h.uid))return console.error(`The dataset id "${e}" you tried to publish is already registered.`),()=>{};if(a&&a.scope===((g=r==null?void 0:r.$)==null?void 0:g.uid))return y({id:e,data:m.get(r,t)}).catch(()=>{}),()=>{};L(e,i=>{var S;if(!i)return;function o(n,f=null){typeof(n==null?void 0:n.getIsDirty)=="function"&&!n.getIsDirty()||Object.keys(n).forEach(u=>{let w;f?w=`${f}.${u}`:w=`${t}.${u}`;const b=V(w);if(b!==null){if(Shopware.Utils.hasOwnProperty(n[u],"getDraft",this)&&typeof n[u].getDraft=="function"){o({[u]:Shopware.Utils.object.cloneDeep(n[u])},w);return}if(Array.isArray(n[u])){n[u].forEach((p,$)=>{o({[$]:p},w)});return}Shopware.Utils.object.get(r,b.pathToLastSegment)[b.lastSegment]=n[u]}})}if(typeof((S=i.data)==null?void 0:S.getDraft)=="function"){o(i.data);return}if(Array.isArray(i.data))i.data.forEach((n,f)=>{n===null||typeof n!="object"||o({[f]:n})});else if(typeof i.data=="object"){o(i.data);return}if(t.includes(".")){const n=t.split("."),f=n.pop(),u=n.join(".");if(!f)return;Shopware.Utils.object.get(r,u)[f]=i.data;return}r[t]=i.data});const d=r.$watch(t,m.debounce(i=>{var n;if(l.includes(e)){l=l.filter(f=>f!==e),d();return}const o=D(i);y({id:e,data:o}).catch(()=>{});const S=c.find(f=>f.id===e);if(S){S.data=i;return}c.push({id:e,data:o,scope:(n=r==null?void 0:r.$)==null?void 0:n.uid,deprecated:s,deprecationMessage:_})},750),{deep:!0,immediate:!0});return r.dataSetUnwatchers.push(()=>{c=c.filter(i=>i.id!==e),l.push(e),d()}),y({id:e,data:m.get(r,t)}).catch(()=>{}),function(){c=c.filter(o=>o.id!==e),l.push(e),d()}}function q(){return c}export{Q as S,D as d,q as g,j as p};
