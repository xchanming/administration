{"version":3,"file":"index-DXKPhK0z.js","sources":["../../../app/administration/src/module/sw-order/component/sw-order-nested-line-items-modal/sw-order-nested-line-items-modal.html.twig","../../../app/administration/src/module/sw-order/component/sw-order-nested-line-items-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_order_nested_line_item_modal %}\n<sw-modal\n    class=\"sw-order-nested-line-items-modal\"\n    variant=\"large\"\n    :title=\"modalTitle\"\n    @modal-close=\"onCloseModal\"\n>\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_order_nested_line_item_modal_loader %}\n    <sw-loader\n        v-if=\"isLoading\"\n        class=\"sw-order-nested-line-items-modal__loader\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_order_nested_line_item_modal_container %}\n    <div\n        v-else\n        class=\"sw-order-nested-line-items-modal__container\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_order_nested_line_item_modal_header_container %}\n        <div class=\"sw-order-nested-line-items-modal__header-container\">\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_order_nested_line_item_modal_header_label %}\n            <div class=\"sw-order-nested-line-items-modal__header-label sw-order-nested-line-items-modal__header-item\">\n                {{ $tc('sw-order.nestedLineItemsModal.headerLabel') }}\n            </div>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_order_nested_line_item_modal_header_unit_price %}\n            <div class=\"sw-order-nested-line-items-modal__header-unit-price sw-order-nested-line-items-modal__header-item\">\n                {{ $tc('sw-order.nestedLineItemsModal.headerUnitPrice') }}\n            </div>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_order_nested_line_item_modal_header_quantity %}\n            <div class=\"sw-order-nested-line-items-modal__header-quantity sw-order-nested-line-items-modal__header-item\">\n                {{ $tc('sw-order.nestedLineItemsModal.headerQuantity') }}\n            </div>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_order_nested_line_item_modal_header_total_price %}\n            <div class=\"sw-order-nested-line-items-modal__header-total-price sw-order-nested-line-items-modal__header-item\">\n                {{ $tc('sw-order.nestedLineItemsModal.headerTotalPrice') }}\n            </div>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_order_nested_line_item_modal_header_tax %}\n            <div class=\"sw-order-nested-line-items-modal__header-tax sw-order-nested-line-items-modal__header-item\">\n                {{ $tc('sw-order.nestedLineItemsModal.headerTax') }}\n            </div>\n            {% endblock %}\n\n        </div>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_order_nested_line_item_modal_content %}\n        <sw-order-nested-line-items-row\n            class=\"sw-order-nested-line-items-modal__content\"\n            :line-item=\"lineItem\"\n            :currency=\"order.currency\"\n        />\n        {% endblock %}\n\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_order_nested_line_item_modal_footer %}\n    <template #modal-footer>\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_order_nested_line_item_modal_footer_content %}\n        <sw-button\n            variant=\"primary\"\n            size=\"small\"\n            @click=\"onCloseModal\"\n        >\n            {{ $tc('global.default.close') }}\n        </sw-button>\n        {% endblock %}\n\n    </template>\n    {% endblock %}\n\n</sw-modal>\n{% endblock %}\n","import template from './sw-order-nested-line-items-modal.html.twig';\nimport './sw-order-nested-line-items-modal.scss';\n\n/**\n * @package checkout\n */\n\nconst { Filter } = Cicada;\nconst { Criteria } = Cicada.Data;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n    ],\n\n    emits: ['modal-close'],\n\n    props: {\n        lineItem: {\n            type: Object,\n            required: true,\n        },\n\n        order: {\n            type: Object,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            isLoading: false,\n        };\n    },\n\n    computed: {\n        lineItemRepository() {\n            return this.repositoryFactory.create('order_line_item');\n        },\n\n        modalTitle() {\n            const price = Filter.getByName('currency')(this.lineItem.totalPrice, this.order.currency.isoCode);\n\n            return this.$tc('sw-order.nestedLineItemsModal.titlePrefix', 0, {\n                lineItemLabel: this.lineItem.label,\n                price,\n            });\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        async createdComponent() {\n            if (this.lineItem === null) {\n                return;\n            }\n            this.isLoading = true;\n            this.lineItem.nestingLevel = 0;\n\n            await this.enrichNestedLineItems(this.lineItem.children);\n        },\n\n        /**\n         * Fetches all children by their parentIds and also adds the children of that result via association.\n         * Therefore, each recursive loop iteration will add 2 additional nesting levels at once with one request.\n         *\n         * @param nestedLineItems - A (children) lineItem collection, to be enriched with all descendants\n         * @return {Promise<void>}\n         */\n        async enrichNestedLineItems(nestedLineItems, nestingLevel = 1) {\n            if (nestedLineItems === null || nestedLineItems.length <= 0) {\n                this.isLoading = false;\n\n                return;\n            }\n\n            const parentIds = nestedLineItems.map((lineItem) => lineItem.id);\n            const criteria = new Criteria(1, 25).addFilter(Criteria.equalsAny('parentId', parentIds));\n\n            criteria.getAssociation('children').addSorting(Criteria.naturalSorting('label'));\n\n            const children = await this.lineItemRepository.search(criteria, Cicada.Context.api);\n\n            const descendants = [];\n            nestedLineItems.forEach((nestedLineItem) => {\n                nestedLineItem.nestingLevel = nestingLevel;\n                nestedLineItem.children = children.filter((child) => child.parentId === nestedLineItem.id);\n                nestedLineItem.children.sort(this.naturalSort);\n\n                descendants.push(...nestedLineItem.children);\n            });\n\n            await this.enrichNestedLineItems(descendants, nestingLevel + 1);\n        },\n\n        naturalSort(a, b) {\n            return a.label.localeCompare(b.label, 'en-GB', {\n                numeric: true,\n                ignorePunctuation: true,\n            });\n        },\n\n        onCloseModal() {\n            this.$emit('modal-close');\n        },\n    },\n};\n"],"names":["template","Filter","Criteria","index","price","nestedLineItems","nestingLevel","parentIds","lineItem","criteria","children","descendants","nestedLineItem","child","a","b"],"mappings":"AAAA,MAAeA,EAAA,ozECOT,CAAE,OAAAC,CAAQ,EAAG,OACb,CAAE,SAAAC,CAAQ,EAAK,OAAO,KAGbC,EAAA,CACX,SAAAH,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,mBACH,EAED,MAAO,CAAC,aAAa,EAErB,MAAO,CACH,SAAU,CACN,KAAM,OACN,SAAU,EACb,EAED,MAAO,CACH,KAAM,OACN,SAAU,EACb,CACJ,EAED,MAAO,CACH,MAAO,CACH,UAAW,EACvB,CACK,EAED,SAAU,CACN,oBAAqB,CACjB,OAAO,KAAK,kBAAkB,OAAO,iBAAiB,CACzD,EAED,YAAa,CACT,MAAMI,EAAQH,EAAO,UAAU,UAAU,EAAE,KAAK,SAAS,WAAY,KAAK,MAAM,SAAS,OAAO,EAEhG,OAAO,KAAK,IAAI,4CAA6C,EAAG,CAC5D,cAAe,KAAK,SAAS,MAC7B,MAAAG,CAChB,CAAa,CACJ,CACJ,EAED,SAAU,CACN,KAAK,iBAAgB,CACxB,EAED,QAAS,CACL,MAAM,kBAAmB,CACjB,KAAK,WAAa,OAGtB,KAAK,UAAY,GACjB,KAAK,SAAS,aAAe,EAE7B,MAAM,KAAK,sBAAsB,KAAK,SAAS,QAAQ,EAC1D,EASD,MAAM,sBAAsBC,EAAiBC,EAAe,EAAG,CAC3D,GAAID,IAAoB,MAAQA,EAAgB,QAAU,EAAG,CACzD,KAAK,UAAY,GAEjB,MACH,CAED,MAAME,EAAYF,EAAgB,IAAKG,GAAaA,EAAS,EAAE,EACzDC,EAAW,IAAIP,EAAS,EAAG,EAAE,EAAE,UAAUA,EAAS,UAAU,WAAYK,CAAS,CAAC,EAExFE,EAAS,eAAe,UAAU,EAAE,WAAWP,EAAS,eAAe,OAAO,CAAC,EAE/E,MAAMQ,EAAW,MAAM,KAAK,mBAAmB,OAAOD,EAAU,OAAO,QAAQ,GAAG,EAE5EE,EAAc,CAAA,EACpBN,EAAgB,QAASO,GAAmB,CACxCA,EAAe,aAAeN,EAC9BM,EAAe,SAAWF,EAAS,OAAQG,GAAUA,EAAM,WAAaD,EAAe,EAAE,EACzFA,EAAe,SAAS,KAAK,KAAK,WAAW,EAE7CD,EAAY,KAAK,GAAGC,EAAe,QAAQ,CAC3D,CAAa,EAED,MAAM,KAAK,sBAAsBD,EAAaL,EAAe,CAAC,CACjE,EAED,YAAYQ,EAAGC,EAAG,CACd,OAAOD,EAAE,MAAM,cAAcC,EAAE,MAAO,QAAS,CAC3C,QAAS,GACT,kBAAmB,EACnC,CAAa,CACJ,EAED,cAAe,CACX,KAAK,MAAM,aAAa,CAC3B,CACJ,CACL"}