{"version":3,"file":"index-CH7dOnyY.js","sources":["../../../app/administration/src/app/component/utils/sw-license-violation/sw-license-violation.html.twig","../../../app/administration/src/app/component/utils/sw-license-violation/index.js"],"sourcesContent":["<sw-modal\n    v-if=\"visible\"\n    :title=\"$tc('sw-license-violation.title')\"\n    :closable=\"false\"\n    variant=\"large\"\n    class=\"sw-license-violation\"\n    :is-loading=\"isLoading\"\n>\n\n    <span class=\"sw-license-violation__text\">\n        {{ $tc('sw-license-violation.alertText') }}\n    </span>\n\n    <table class=\"sw-license-violation__table\">\n        <tr>\n            <th width=\"200px\">\n                {{ $tc('sw-license-violation.table.plugin') }}\n            </th>\n            <th>{{ $tc('sw-license-violation.table.warning') }}</th>\n            <th width=\"350px\"></th>\n        </tr>\n\n        <tr\n            v-for=\"violation in violations\"\n            :key=\"violation.name\"\n        >\n\n            <td class=\"sw-license-violation__table-name\">\n                <template v-if=\"getPluginForViolation(violation)\">\n                    <img\n                        v-if=\"getPluginForViolation(violation).icon || getPluginForViolation(violation).iconRaw\"\n                        :src=\"'data:image/png;base64, ' + (getPluginForViolation(violation).iconRaw || getPluginForViolation(violation).icon)\"\n                        alt=\"\"\n                    >\n                    <strong>\n                        {{ (getPluginForViolation(violation).translated && getPluginForViolation(violation).translated.label) || getPluginForViolation(violation).label}}\n                    </strong>\n                </template>\n\n                <template v-else>\n                    <p>\n                        <strong>{{ violation.name }}</strong>\n                    </p>\n                </template>\n            </td>\n\n            <td>{{ violation.extensions.licenseViolation.text }}</td>\n\n            <td class=\"sw-license-violation__table-actions\">\n                <div\n                    v-for=\"action in violation.extensions.licenseViolation.actions\"\n                    :key=\"action.externalLink\"\n                    class=\"sw-license-violation__table-actions-wrap\"\n                >\n                    <sw-button\n                        class=\"sw-license-violation__table-action-remove\"\n                        variant=\"ghost-danger\"\n                        size=\"small\"\n                        @click.prevent=\"deletePlugin(violation)\"\n                    >\n                        {{ $tc('sw-license-violation.deletePlugin') }}\n                    </sw-button>\n\n                    <sw-button\n                        :link=\"action.externalLink\"\n                        variant=\"ghost\"\n                        size=\"small\"\n                    >{{ action.label }}\n                    </sw-button>\n                </div>\n            </td>\n\n        </tr>\n    </table>\n\n    <template #modal-footer>\n        <sw-checkbox-field\n            v-model:value=\"readNotice\"\n            :label=\"$tc('sw-license-violation.checkboxMessage')\"\n        />\n\n        <sw-button\n            variant=\"primary\"\n            :disabled=\"!readNotice\"\n            size=\"small\"\n            @click=\"deactivateTemporary\"\n        >\n            {{ $tc('sw-license-violation.closeModal') }}\n        </sw-button>\n    </template>\n\n    <sw-modal\n        v-if=\"showDeleteModal\"\n        :title=\"$tc('sw-license-violation.title')\"\n        class=\"sw-license-violation-confirm-delete\"\n        variant=\"small\"\n        @modal-close=\"onCloseDeleteModal\"\n    >\n\n        <p class=\"sw-plugin-list__confirm-delete-text\">\n            {{ $tc('sw-license-violation.messageDeleteConfirm', '', { pluginName: deletePluginItem.label }) }}\n        </p>\n\n        <template #modal-footer>\n            <sw-button\n                size=\"small\"\n                @click=\"onCloseDeleteModal\"\n            >\n                {{ $tc('global.default.cancel') }}\n            </sw-button>\n\n            <sw-button\n                size=\"small\"\n                variant=\"danger\"\n                @click=\"onConfirmDelete\"\n            >\n                {{ $tc('global.default.delete') }}\n            </sw-button>\n        </template>\n    </sw-modal>\n</sw-modal>\n","import template from './sw-license-violation.html.twig';\nimport './sw-license-violation.scss';\n\nconst { mapState } = Cicada.Component.getComponentHelper();\n\n/**\n * @private\n */\nCicada.Component.register('sw-license-violation', {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'cacheApiService',\n        'extensionStoreActionService',\n        'licenseViolationService',\n        'loginService',\n    ],\n\n    mixins: [\n        Cicada.Mixin.getByName('notification'),\n    ],\n\n    data() {\n        return {\n            licenseSubscription: null,\n            showViolation: false,\n            readNotice: false,\n            loading: [],\n            showDeleteModal: false,\n            deletePluginItem: null,\n        };\n    },\n\n    computed: {\n        ...mapState('licenseViolation', [\n            'violations',\n            'warnings',\n        ]),\n\n        visible() {\n            if (!this.showViolation) {\n                return false;\n            }\n\n            return this.violations.length > 0;\n        },\n\n        pluginCriteria() {\n            return new Cicada.Data.Criteria(1, 50);\n        },\n\n        isLoading() {\n            return this.loading.length > 0;\n        },\n    },\n\n    watch: {\n        $route: {\n            handler() {\n                this.$nextTick(() => {\n                    this.getPluginViolation();\n                });\n            },\n            immediate: true,\n        },\n        visible: {\n            handler(newValue) {\n                if (newValue !== true) {\n                    return;\n                }\n\n                this.fetchPlugins();\n            },\n            immediate: true,\n        },\n    },\n\n    methods: {\n        getPluginViolation() {\n            if (!this.loginService.isLoggedIn()) {\n                return Promise.resolve();\n            }\n\n            this.showViolation = this.licenseViolationService.isTimeExpired(\n                this.licenseViolationService.key.showViolationsKey,\n            );\n\n            this.addLoading('getPluginViolation');\n\n            return this.licenseViolationService\n                .checkForLicenseViolations()\n                .then(({ violations, warnings, other }) => {\n                    Cicada.State.commit('licenseViolation/setViolations', violations);\n                    Cicada.State.commit('licenseViolation/setWarnings', warnings);\n                    Cicada.State.commit('licenseViolation/setOther', other);\n                })\n                .finally(() => {\n                    this.finishLoading('getPluginViolation');\n                });\n        },\n\n        reloadViolations() {\n            this.licenseViolationService.resetLicenseViolations();\n\n            return this.getPluginViolation();\n        },\n\n        deactivateTemporary() {\n            this.licenseViolationService.saveTimeToLocalStorage(this.licenseViolationService.key.showViolationsKey);\n\n            this.readNotice = false;\n            this.showViolation = this.licenseViolationService.isTimeExpired(\n                this.licenseViolationService.key.showViolationsKey,\n            );\n        },\n\n        fetchPlugins() {\n            if (!this.loginService.isLoggedIn()) {\n                return;\n            }\n\n            this.addLoading('fetchPlugins');\n\n            this.extensionStoreActionService\n                .getMyExtensions()\n                .then((response) => {\n                    this.plugins = response;\n                })\n                .finally(() => {\n                    this.finishLoading('fetchPlugins');\n                });\n        },\n\n        deletePlugin(violation) {\n            this.deletePluginItem = violation;\n            this.showDeleteModal = true;\n        },\n\n        onCloseDeleteModal() {\n            this.deletePluginItem = null;\n            this.showDeleteModal = false;\n        },\n\n        onConfirmDelete() {\n            const violation = this.deletePluginItem;\n\n            this.showDeleteModal = false;\n            this.addLoading('deletePlugin');\n\n            const matchingPlugin = this.plugins.find((plugin) => plugin.name === violation.name);\n\n            return this.licenseViolationService\n                .forceDeletePlugin(matchingPlugin)\n                .then(() => {\n                    this.createNotificationSuccess({\n                        message: this.$tc('sw-license-violation.successfullyDeleted'),\n                    });\n\n                    return this.reloadViolations();\n                })\n                .finally(() => {\n                    this.finishLoading('deletePlugin');\n                });\n        },\n\n        getPluginForViolation(violation) {\n            if (!Array.isArray(this.plugins)) {\n                return null;\n            }\n\n            const matchingPlugin = this.plugins.find((plugin) => {\n                return plugin.name === violation.name;\n            });\n\n            return matchingPlugin || null;\n        },\n\n        addLoading(key) {\n            this.loading.push(key);\n        },\n\n        finishLoading(key) {\n            this.loading = this.loading.filter((value) => value !== key);\n        },\n    },\n});\n"],"names":["template","mapState","newValue","violations","warnings","other","response","violation","matchingPlugin","plugin","key","value"],"mappings":"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"}