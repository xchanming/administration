{"version":3,"file":"index-BDFfTfNo.js","sources":["../../../app/administration/src/module/sw-settings-shipping/component/sw-settings-shipping-price-matrices/sw-settings-shipping-price-matrices.html.twig","../../../app/administration/src/module/sw-settings-shipping/component/sw-settings-shipping-price-matrices/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_settings_shipping_price_matrices %}\n<div class=\"sw-settings-shipping-price-matrices\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_shipping_price_matrices_price_matrix %}\n    <sw-settings-shipping-price-matrix\n        v-for=\"priceGroup in shippingPriceGroups\"\n        :key=\"priceGroup.ruleId\"\n        :price-group=\"priceGroup\"\n        :disabled=\"disabled || undefined\"\n        @duplicate-price-matrix=\"onDuplicatePriceMatrix\"\n        @delete-price-matrix=\"onDeletePriceMatrix\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_shipping_detail_advanced_prices_actions %}\n    <div class=\"sw-settings-shipping-price-matrices__actions\">\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_shipping_detail_advanced_prices_actions_add_button %}\n        <sw-button\n            v-tooltip=\"{\n                showDelay: 300,\n                showOnDisabledElements: true,\n                message: $tc('sw-settings-shipping.priceMatrix.newMatrixAlreadyExists'),\n                disabled: !newPriceMatrixExists\n            }\"\n            :disabled=\"newPriceMatrixExists || disabled || undefined\"\n            class=\"sw-settings-shipping-price-matrices__actions-add-matrix\"\n            @click=\"onAddNewPriceGroup\"\n        >\n            {{ $tc('sw-settings-shipping.priceMatrix.buttonAddAdditionalPriceMatrix') }}\n        </sw-button>\n        {% endblock %}\n    </div>\n    {% endblock %}\n</div>\n{% endblock %}\n","import template from './sw-settings-shipping-price-matrices.html.twig';\nimport './sw-settings-shipping-price-matrices.scss';\n\nconst {\n    Mixin,\n    Data: { Criteria },\n    Context,\n} = Cicada;\nconst { cloneDeep } = Cicada.Utils.object;\nconst { mapState, mapGetters } = Cicada.Component.getComponentHelper();\n\n/**\n * @package checkout\n */\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'ruleConditionDataProviderService',\n        'feature',\n    ],\n\n    mixins: [\n        Mixin.getByName('notification'),\n        Mixin.getByName('placeholder'),\n    ],\n\n    props: {\n        disabled: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n    },\n\n    computed: {\n        ...mapState('swShippingDetail', [\n            'shippingMethod',\n        ]),\n\n        ...mapGetters('swShippingDetail', [\n            'shippingPriceGroups',\n            'usedRules',\n            'unrestrictedPriceMatrixExists',\n            'newPriceMatrixExists',\n        ]),\n\n        ruleRepository() {\n            return this.repositoryFactory.create('rule');\n        },\n\n        ruleFilter() {\n            const criteria = new Criteria(1, 500);\n            criteria.addFilter(\n                Criteria.multi('OR', [\n                    Criteria.contains('rule.moduleTypes.types', 'price'),\n                    Criteria.equals('rule.moduleTypes', null),\n                ]),\n            );\n            return criteria;\n        },\n\n        shippingPriceRepository() {\n            return this.repositoryFactory.create('shipping_method_price');\n        },\n\n        isLoaded() {\n            return this.currencies.length && this.shippingMethod;\n        },\n    },\n\n    methods: {\n        onAddNewPriceGroup() {\n            const newShippingPrice = this.shippingPriceRepository.create(Context.api);\n            newShippingPrice.shippingMethodId = this.shippingMethod.id;\n            newShippingPrice.quantityStart = 1;\n            newShippingPrice.ruleId = null;\n\n            // Create a flagged as new price matrix, if there is already an unrestricted.\n            if (this.unrestrictedPriceMatrixExists) {\n                // Flag to indicate that this price is in a new matrix\n                newShippingPrice._inNewMatrix = true;\n            }\n\n            this.shippingMethod.prices.add(newShippingPrice);\n        },\n\n        onDeletePriceMatrix(shippingPriceGroup) {\n            this.shippingMethod.prices = this.shippingMethod.prices.filter((shippingPrice) => {\n                // If the shipping price group is new and the prices is also flagged new, remove it\n                if (shippingPriceGroup.isNew) {\n                    if (shippingPrice._inNewMatrix) {\n                        return false;\n                    }\n                    return true;\n                }\n\n                return shippingPrice.ruleId !== shippingPriceGroup.ruleId;\n            });\n        },\n\n        onDuplicatePriceMatrix(priceGroup) {\n            const newPrices = [];\n            priceGroup.prices.forEach((price) => {\n                const newShippingPrice = this.shippingPriceRepository.create(Context.api);\n                // Create a flagged as new price matrix, if there is already an unrestricted.\n                if (this.unrestrictedPriceMatrixExists) {\n                    // Flag to indicate that this price is in a new matrix\n                    newShippingPrice._inNewMatrix = true;\n                }\n\n                newShippingPrice.ruleId = null;\n                newShippingPrice.calculation = price.calculation;\n                newShippingPrice.calculationRule = price.calculationRule;\n                newShippingPrice.calculationRuleId = price.calculationRuleId;\n                newShippingPrice.shippingMethodId = price.shippingMethodId;\n                newShippingPrice.currencyPrice = cloneDeep(price.currencyPrice);\n                newShippingPrice.quantityStart = price.quantityStart;\n                newShippingPrice.quantityEnd = price.quantityEnd;\n\n                newPrices.push(newShippingPrice);\n            });\n\n            this.shippingMethod.prices.push(...newPrices);\n        },\n    },\n};\n"],"names":["template","Mixin","Criteria","Context","cloneDeep","mapState","mapGetters","index","criteria","newShippingPrice","shippingPriceGroup","shippingPrice","priceGroup","newPrices","price"],"mappings":"AAAA,MAAeA,EAAA,slCCGT,CACF,MAAAC,EACA,KAAM,CAAE,SAAAC,CAAU,EAClB,QAAAC,CACJ,EAAI,OACE,CAAE,UAAAC,CAAW,EAAG,OAAO,MAAM,OAC7B,CAAE,SAAAC,EAAU,WAAAC,CAAY,EAAG,OAAO,UAAU,mBAAkB,EAMrDC,EAAA,CACX,SAAAP,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,oBACA,mCACA,SACH,EAED,OAAQ,CACJC,EAAM,UAAU,cAAc,EAC9BA,EAAM,UAAU,aAAa,CAChC,EAED,MAAO,CACH,SAAU,CACN,KAAM,QACN,SAAU,GACV,QAAS,EACZ,CACJ,EAED,SAAU,CACN,GAAGI,EAAS,mBAAoB,CAC5B,gBACZ,CAAS,EAED,GAAGC,EAAW,mBAAoB,CAC9B,sBACA,YACA,gCACA,sBACZ,CAAS,EAED,gBAAiB,CACb,OAAO,KAAK,kBAAkB,OAAO,MAAM,CAC9C,EAED,YAAa,CACT,MAAME,EAAW,IAAIN,EAAS,EAAG,GAAG,EACpC,OAAAM,EAAS,UACLN,EAAS,MAAM,KAAM,CACjBA,EAAS,SAAS,yBAA0B,OAAO,EACnDA,EAAS,OAAO,mBAAoB,IAAI,CAC5D,CAAiB,CACjB,EACmBM,CACV,EAED,yBAA0B,CACtB,OAAO,KAAK,kBAAkB,OAAO,uBAAuB,CAC/D,EAED,UAAW,CACP,OAAO,KAAK,WAAW,QAAU,KAAK,cACzC,CACJ,EAED,QAAS,CACL,oBAAqB,CACjB,MAAMC,EAAmB,KAAK,wBAAwB,OAAON,EAAQ,GAAG,EACxEM,EAAiB,iBAAmB,KAAK,eAAe,GACxDA,EAAiB,cAAgB,EACjCA,EAAiB,OAAS,KAGtB,KAAK,gCAELA,EAAiB,aAAe,IAGpC,KAAK,eAAe,OAAO,IAAIA,CAAgB,CAClD,EAED,oBAAoBC,EAAoB,CACpC,KAAK,eAAe,OAAS,KAAK,eAAe,OAAO,OAAQC,GAExDD,EAAmB,MACf,CAAAC,EAAc,aAMfA,EAAc,SAAWD,EAAmB,MACtD,CACJ,EAED,uBAAuBE,EAAY,CAC/B,MAAMC,EAAY,CAAA,EAClBD,EAAW,OAAO,QAASE,GAAU,CACjC,MAAML,EAAmB,KAAK,wBAAwB,OAAON,EAAQ,GAAG,EAEpE,KAAK,gCAELM,EAAiB,aAAe,IAGpCA,EAAiB,OAAS,KAC1BA,EAAiB,YAAcK,EAAM,YACrCL,EAAiB,gBAAkBK,EAAM,gBACzCL,EAAiB,kBAAoBK,EAAM,kBAC3CL,EAAiB,iBAAmBK,EAAM,iBAC1CL,EAAiB,cAAgBL,EAAUU,EAAM,aAAa,EAC9DL,EAAiB,cAAgBK,EAAM,cACvCL,EAAiB,YAAcK,EAAM,YAErCD,EAAU,KAAKJ,CAAgB,CAC/C,CAAa,EAED,KAAK,eAAe,OAAO,KAAK,GAAGI,CAAS,CAC/C,CACJ,CACL"}