const d='{% block sw_text_editor_toolbar %} <div class="sw-text-editor-toolbar" :style="[position, arrowPosition]" :class="classes" role="menu" tabindex="0" @click="handleToolbarClick" > {% block sw_text_editor_toolbar_buttons %} {% block sw_text_editor_toolbar_buttons_left %} <div v-if="leftButtons.length > 0" class="sw-text-editor-buttons is--left" > <sw-text-editor-toolbar-button v-for="button in leftButtons" :key="button.type" :is-inline-edit="isInlineEdit" :button-config="setButtonValues(button)" :disabled="isDisabled(button)" @button-click="onButtonClick" @menu-toggle="onToggleMenu" /> </div> {% endblock %} {% block sw_text_editor_toolbar_buttons_middle %} <div v-if="middleButtons.length > 0" class="sw-text-editor-buttons is--middle" > <sw-text-editor-toolbar-button v-for="button in middleButtons" :key="button.type" :is-inline-edit="isInlineEdit" :button-config="setButtonValues(button)" :disabled="isDisabled(button)" @button-click="onButtonClick" @menu-toggle="onToggleMenu" /> </div> {% endblock %} {% block sw_text_editor_toolbar_buttons_right %} <div v-if="rightButtons.length > 0" class="sw-text-editor-buttons is--right" > <sw-text-editor-toolbar-button v-for="button in rightButtons" :key="button.type" :is-inline-edit="isInlineEdit" :button-config="setButtonValues(button)" :disabled="isDisabled(button)" @button-click="onButtonClick" @menu-toggle="onToggleMenu" /> </div> {% endblock %} {% block sw_text_editor_toolbar_slot %} <slot name="itemsSlot"></slot> {% endblock %} {% endblock %} </div> {% endblock %}',{Component:h,Utils:c}=Shopware;h.register("sw-text-editor-toolbar",{template:d,emits:["created-el","destroyed-el","remove-link","text-style-change","table-edit","on-set-link"],props:{parentIsActive:{type:Boolean,required:!1,default:!1},isInlineEdit:{type:Boolean,required:!1,default:!1},selection:{required:!1,default:null},buttonConfig:{type:Array,required:!0},isCodeEdit:{type:Boolean,required:!1,default:!1},isTableEdit:{type:Boolean,required:!1,default:!1}},data(){return{position:{},range:null,arrowPosition:{"--left":"49%"},activeTags:[],currentColor:null,currentLink:null,leftButtons:[],middleButtons:[],rightButtons:[],tableEdit:!1,scrollEventHandler:void 0,preventReposition:!1}},computed:{classes(){return{"is--boxedEdit":!this.isInlineEdit}}},watch:{isTableEdit:{handler(){this.tableEdit=this.isTableEdit,this.$nextTick(()=>{this.setActiveTags()})}},position:{handler(t){t.top.replace("px","")<0&&this.closeExpandedMenu()}}},created(){this.createdComponent()},mounted(){this.mountedComponent()},unmounted(){this.destroyedComponent()},methods:{createdComponent(){this.setButtonPositions(),this.setActiveTags()},mountedComponent(){this.isInlineEdit&&(document.querySelector("body").appendChild(this.$el),this.scrollEventHandler=c.throttle(()=>{this.setToolbarPosition()},16),document.addEventListener("scroll",this.scrollEventHandler,!0),this.$device.onResize({listener:this.setToolbarPosition})),document.addEventListener("mouseup",this.onMouseUp),this.setToolbarPosition(),this.$emit("created-el",this.$el),this.$nextTick(()=>{this.isOverlayingLeft()})},isOverlayingLeft(){if(!this.isInlineEdit)return;const t=this.$el,e=document.querySelector(".sw-admin-menu");if(!e)return;const i=e.offsetLeft+e.offsetWidth;if(t.offsetLeft<i){this.position.left=`${i+4}px`,this.position.right="unset";const n=8,s=this.range.getBoundingClientRect();let o=s.right-s.width/2;o-=i+n,this.arrowPosition["--left"]=`${o}px`,this.arrowPosition["--right"]="unset"}},destroyedComponent(){var t,e;this.closeExpandedMenu(),document.removeEventListener("scroll",this.scrollEventListener,!0),document.removeEventListener("mouseup",this.onMouseUp),(e=(t=this.$el)==null?void 0:t.parentElement)!=null&&e.contains(this.$el)&&this.$el.parentElement.removeChild(this.$el),this.$emit("destroyed-el")},onMouseUp(t){const e=[];let i=t.target;for(;i;)e.push(i),i=i.parentNode;if(!e.some(n=>{var s;return(s=n.classList)==null?void 0:s.contains("sw-popover__wrapper")})){if(!e.includes(this.$el)){!this.isInlineEdit&&this.selection?this.setActiveTags():this.activeTags.length>0&&(this.activeTags=[]),this.closeExpandedMenu();return}e.indexOf(this.$el)>-1||!this.parentIsActive||this.setToolbarPosition()}},setToolbarPosition(){var l,a;if(!this.selection||this.preventReposition)return;if(!this.isInlineEdit){this.setSelectionRange();return}this.setSelectionRange();const t=(a=(l=this.range)==null?void 0:l.getBoundingClientRect)==null?void 0:a.call(l);if(!t||t.top<=0||t.left<=0||t.width<=0||t.height<=0)return;let i=window.pageYOffset;i+=t.top-(this.$el.clientHeight+8);const s=t.left+t.width/2+4,o=this.$el.clientWidth/2,r=s-o;this.position={left:`${r}px`,top:`${i}px`}},setSelectionRange(){this.selection.anchorNode&&this.selection.rangeCount>0&&(this.range=this.selection.getRangeAt(0))},setButtonValues(t){var e,i,n,s;return this.isCodeEdit&&t.type!=="codeSwitch"||(t.children&&(typeof t.expanded>"u"&&(t.expanded=!1),t.children.forEach(o=>{o.active=!!this.activeTags.includes(o.tag)})),t.type==="foreColor"&&this.currentColor&&(t.value=this.currentColor,this.currentColor=null),t.type==="link"&&(t.value=((e=this.currentLink)==null?void 0:e.url)??"",t.newTab=((i=this.currentLink)==null?void 0:i.newTab)??!1,t.displayAsButton=((n=this.currentLink)==null?void 0:n.displayAsButton)??!1,t.buttonVariant=((s=this.currentLink)==null?void 0:s.buttonVariant)??"primary"),t.active=!!this.activeTags.includes(t.tag)),t},isDisabled(t){return this.isCodeEdit?t.type!=="codeSwitch":!1},handleToolbarClick(t){t.target.classList.contains("sw-text-editor-toolbar")&&this.keepSelection()},onButtonClick(t,e=null){if(this.preventReposition=!1,t.type==="link"){this.handleTextStyleChangeLink(t);return}if(t.type==="linkRemove"&&this.$emit("remove-link"),t.type==="foreColor"&&this.keepSelection(!0),t.children||this.closeExpandedMenu(),e&&e.children.forEach(i=>{i.active=!1}),this.keepSelection(),t.handler){t.handler(t,e),t.expanded=!1;return}this.$emit("text-style-change",t.type,t.value),this.isInlineEdit&&this.setToolbarPosition(),this.$nextTick(()=>{this.setActiveTags(),t.active=!!this.activeTags.includes(t.tag)})},closeExpandedMenu(){this.buttonConfig.forEach(t=>{t.expanded&&t.type!=="codeSwitch"&&(t.expanded=!1)})},setActiveTags(){if(this.currentColor=null,this.currentLink=null,!this.selection||!this.selection.anchorNode)return;let t=this.selection.anchorNode.parentNode;for(this.activeTags=[];t.tagName!=="DIV";){if(t.tagName==="FONT"&&(this.currentColor=t.color),t.tagName==="A"){const e=t.classList.contains("btn-secondary")?"secondary":"primary",i=t.classList.contains("btn-sm")?"-sm":"";this.currentLink={url:t.getAttribute("href"),newTab:t.target==="_blank",displayAsButton:t.classList.contains("btn"),buttonVariant:`${e}${i}`}}t.tagName==="TABLE"&&(this.tableEdit||(this.tableEdit=!0,this.$emit("table-edit",this.tableEdit))),this.activeTags.push(t.tagName.toLowerCase()),t=t.parentNode}this.tableEdit&&!this.activeTags.includes("table")&&(this.tableEdit=!1,this.$emit("table-edit",this.tableEdit))},setButtonPositions(){this.buttonConfig.forEach(t=>{!t.position||t.position==="left"?this.leftButtons.push(t):t.position==="middle"?this.middleButtons.push(t):t.position==="right"&&this.rightButtons.push(t)})},handleTextStyleChangeLink(t){let e="_self";if(t.newTab&&(e="_blank"),this.keepSelection(!0),t.value){if(!this.selection||this.selection.rangeCount<1){t.expanded=!1;return}this.$emit("on-set-link",t.value,e,t.displayAsButton,t.buttonVariant),this.range=document.getSelection().getRangeAt(0),this.range.setStart(this.range.startContainer,0),t.expanded=!1}},keepSelection(t){this.selection&&(t||this.setSelectionRange(),this.selection.removeAllRanges(),this.selection.addRange(this.range))},onToggleMenu(t,e){this.preventReposition=e.type==="link",this.keepSelection(),this.buttonConfig.forEach(i=>{i===e||i.type==="codeSwitch"||i.expanded&&(i.expanded=!1)}),e.expanded=!e.expanded}}});
