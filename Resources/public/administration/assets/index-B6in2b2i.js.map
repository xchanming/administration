{"version":3,"file":"index-B6in2b2i.js","sources":["../../../app/administration/src/app/component/rule/sw-condition-type-select/sw-condition-type-select.html.twig","../../../app/administration/src/app/component/rule/sw-condition-type-select/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_condition_type_select %}\n<sw-grouped-single-select\n    class=\"sw-condition-type-select sw-condition-type-select__select\"\n    size=\"medium\"\n    label-value=\"label\"\n    :value-property=\"valueProperty\"\n    label-property=\"translatedLabel\"\n    :options=\"typeOptions\"\n    :groups=\"availableGroups\"\n    :placeholder=\"$tc('global.sw-condition.condition.placeholder')\"\n    :value=\"currentValue\"\n    :disabled=\"disabled || undefined\"\n    required\n    show-clearable-button\n    @update:value=\"changeType\"\n    @item-selected=\"changeItem\"\n    @search-term-change=\"typeSearchTerm = $event\"\n>\n    <template\n        #result-item=\"{item, index, labelProperty, searchTerm, highlightSearchTerm, isSelected, setValue, getKey }\"\n    >\n        <sw-select-result\n            v-tooltip=\"getTooltipConfig(item)\"\n            :disabled=\"item.disabled || restrictedConditions[item.type] !== undefined || undefined\"\n            :class=\"'sw-select-option--' + item.value\"\n            :selected=\"isSelected(item)\"\n            v-bind=\"{ item, index }\"\n            @item-select=\"setValue\"\n        >\n            <sw-highlight-text\n                v-if=\"highlightSearchTerm && !isSelected(item)\"\n                :text=\"getKey(item, labelProperty)\"\n                :search-term=\"searchTerm\"\n            />\n            <template v-else>\n                {{ getKey(item, labelProperty) }}\n            </template>\n        </sw-select-result>\n    </template>\n</sw-grouped-single-select>\n{% endblock %}\n","import template from './sw-condition-type-select.html.twig';\nimport './sw-condition-type-select.scss';\n\nconst { Component } = Cicada;\n\n/**\n * @private\n * @package services-settings\n */\nComponent.register('sw-condition-type-select', {\n    template: template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'removeNodeFromTree',\n        'conditionDataProviderService',\n        'restrictedConditions',\n        'childAssociationField',\n    ],\n\n    props: {\n        availableTypes: {\n            type: Array,\n            required: true,\n        },\n\n        condition: {\n            type: Object,\n            required: true,\n        },\n\n        hasError: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n\n        disabled: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n\n        availableGroups: {\n            type: Array,\n            required: false,\n            default() {\n                return [];\n            },\n        },\n    },\n\n    data() {\n        return {\n            typeSearchTerm: '',\n        };\n    },\n\n    computed: {\n        currentValue() {\n            return this.condition.scriptId ?? this.condition.type;\n        },\n\n        valueProperty() {\n            return this.condition.scriptId ? 'scriptId' : 'type';\n        },\n\n        ucTerm() {\n            return this.typeSearchTerm.toUpperCase();\n        },\n\n        typeOptions() {\n            if (!(typeof this.typeSearchTerm === 'string') || this.typeSearchTerm === '') {\n                return this.availableTypes;\n            }\n\n            return this.availableTypes.filter(({ type, label }) => {\n                const ucType = type.toUpperCase();\n                const ucLabel = label.toUpperCase();\n\n                return ucType.includes(this.ucTerm) || ucLabel.includes(this.ucTerm);\n            });\n        },\n\n        typeSelectClasses() {\n            return {\n                'has--error': this.hasError,\n            };\n        },\n\n        arrowColor() {\n            if (this.disabled) {\n                return {\n                    primary: '#d1d9e0',\n                    secondary: '#d1d9e0',\n                };\n            }\n\n            if (this.hasError) {\n                return {\n                    primary: '#DE294C',\n                    secondary: '#ffffff',\n                };\n            }\n\n            return {\n                primary: '#758CA3',\n                secondary: '#ffffff',\n            };\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            if (this.condition.type === 'scriptRule' && !this.condition.scriptId) {\n                // eslint-disable-next-line vue/no-mutating-props\n                this.condition.type = null;\n            }\n        },\n\n        changeItem(item) {\n            const { type, scriptId, appScriptCondition } = item ?? {};\n            // eslint-disable-next-line vue/no-mutating-props\n            this.condition.type = type;\n            // eslint-disable-next-line vue/no-mutating-props\n            this.condition.scriptId = scriptId;\n            // eslint-disable-next-line vue/no-mutating-props\n            this.condition.appScriptCondition = appScriptCondition;\n        },\n\n        changeType(type) {\n            // eslint-disable-next-line vue/no-mutating-props\n            this.condition.value = null;\n\n            if (this.condition[this.childAssociationField] && this.condition[this.childAssociationField].length > 0) {\n                this.condition[this.childAssociationField].forEach((child) => {\n                    this.removeNodeFromTree(this.condition, child);\n                });\n            }\n\n            // eslint-disable-next-line vue/no-mutating-props\n            this.condition.type = type;\n        },\n\n        getTooltipConfig(item) {\n            if (!Object.keys(this.restrictedConditions).includes(item.type)) {\n                return { message: '', disabled: true };\n            }\n\n            return {\n                disabled: false,\n                width: 260,\n                message: this.$t('sw-restricted-rules.restrictedConditions.restrictedConditionTooltip', {\n                    assignments: this.groupAssignments(item),\n                }),\n            };\n        },\n\n        groupAssignments(item) {\n            const groups = this.restrictedConditions[item.type].reduce((accumulator, current) => {\n                if (current.associationName.startsWith('flowTrigger')) {\n                    if (!accumulator.flowTrigger) {\n                        accumulator.flowTrigger = [];\n                    }\n\n                    accumulator.flowTrigger.push(current);\n                } else if (/promotion/i.test(current.associationName)) {\n                    if (!accumulator.promotion) {\n                        accumulator.promotion = [];\n                    }\n\n                    accumulator.promotion.push(current);\n                } else {\n                    if (!accumulator[current.associationName]) {\n                        accumulator[current.associationName] = [];\n                    }\n\n                    accumulator[current.associationName].push(current);\n                }\n\n                return accumulator;\n            }, {});\n\n            return Object.entries(groups).reduce(\n                (\n                    accumulator,\n                    [\n                        key,\n                        value,\n                    ],\n                    index,\n                ) => {\n                    let snippet = '';\n\n                    value.forEach((currentValue, currentIndex) => {\n                        if (currentIndex > 0) {\n                            snippet += '<br />';\n                        }\n\n                        snippet += this.$t(`sw-restricted-rules.restrictedConditions.relation.${key}`, {\n                            assignments: `\"${this.$tc(currentValue.snippet, 1)}\"`,\n                        });\n                    });\n\n                    if (index > 0) {\n                        return `${accumulator} </br> ${snippet}`;\n                    }\n\n                    return `${accumulator} ${snippet}`;\n                },\n                '',\n            );\n        },\n    },\n});\n"],"names":["template","Component","type","label","ucType","ucLabel","item","scriptId","appScriptCondition","child","groups","accumulator","current","key","value","index","snippet","currentValue","currentIndex"],"mappings":"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"}