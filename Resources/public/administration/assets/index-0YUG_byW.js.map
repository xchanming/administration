{"version":3,"file":"index-0YUG_byW.js","sources":["../../../app/administration/src/app/component/entity/sw-product-stream-grid-preview/sw-product-stream-grid-preview.html.twig","../../../app/administration/src/app/component/entity/sw-product-stream-grid-preview/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_product_stream_grid_preview_content %}\n<div class=\"sw-product-stream-grid-preview\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_stream_grid_preview_search_field_label %}\n    <div class=\"sw-product-stream-grid-preview__toolbar\">\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_stream_grid_preview_search_field %}\n        <sw-simple-search-field\n            v-model:value=\"searchTerm\"\n            size=\"small\"\n            variant=\"form\"\n            :delay=\"750\"\n            :disabled=\"!filters\"\n            class=\"sw-product-stream-grid-preview__search-field\"\n            @search-term-change=\"onSearchTermChange\"\n        />\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_stream_grid_preview_grid %}\n    <sw-data-grid\n        v-if=\"total\"\n        class=\"sw-product-stream-grid-preview__grid\"\n        :data-source=\"products\"\n        :columns=\"productColumns\"\n        :show-selection=\"showSelection\"\n        :show-actions=\"false\"\n        :show-previews=\"true\"\n        :plain-appearance=\"true\"\n        :is-loading=\"isLoading\"\n        @selection-change=\"onSelectionChange\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_stream_grid_preview_grid_columns %}\n        <template #column-name=\"{ item, column }\">\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_stream_grid_preview_grid_column_name %}\n            <router-link\n                v-if=\"column.routerLink\"\n                :to=\"{ name: column.routerLink, params: { id: item.id } }\"\n            >\n                <sw-product-variant-info :variations=\"item.variation\">\n                    {{ item.name || item.translated.name }}\n                </sw-product-variant-info>\n            </router-link>\n            <sw-product-variant-info\n                v-else\n                :variations=\"item.variation\"\n            >\n                {{ item.name || item.translated.name }}\n            </sw-product-variant-info>\n            {% endblock %}\n        </template>\n\n        <template #column-manufacturer.name=\"{ item, column }\">\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_stream_grid_preview_grid_column_manufacturer %}\n            <router-link\n                v-if=\"column.routerLink && item.manufacturerId\"\n                :to=\"{ name: column.routerLink, params: { id: item.manufacturerId } }\"\n            >\n                {{ item.manufacturer.name || item.manufacturer.translated.name }}\n            </router-link>\n            <template v-else-if=\"item.manufacturerId\">\n                {{ item.manufacturer.name || item.manufacturer.translated.name }}\n            </template>\n            {% endblock %}\n        </template>\n\n        <template #column-active=\"{ item }\">\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_stream_grid_preview_grid_column_active %}\n            <sw-data-grid-column-boolean\n                :value=\"item.active\"\n                :is-inline-edit=\"false\"\n            />\n            {% endblock %}\n        </template>\n\n        <template #column-price=\"{ item }\">\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_stream_grid_preview_grid_column_price %}\n            {{ currencyFilter(getPriceForDefaultCurrency(item), systemCurrency.isoCode) }}\n            {% endblock %}\n        </template>\n\n        <template #column-stock=\"{ item }\">\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_stream_grid_preview_grid_column_stock %}\n            {{ item.stock }}\n            {% endblock %}\n        </template>\n        {% endblock %}\n\n        <slot name=\"additional-columns\"></slot>\n\n        <template #pagination>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_stream_grid_preview_grid_pagination %}\n            <sw-pagination\n                v-bind=\"{ total, page, limit }\"\n                :total-visible=\"7\"\n                :auto-hide=\"false\"\n                @page-change=\"onPageChange\"\n            />\n            {% endblock %}\n        </template>\n    </sw-data-grid>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_stream_grid_preview_empty_state %}\n    <slot name=\"empty-state\">\n        <sw-empty-state\n            v-if=\"!total && !isLoading\"\n            :title=\"emptyStateMessage\"\n            :absolute=\"false\"\n            auto-height\n            :show-description=\"false\"\n        >\n            <template #icon>\n                <img\n                    :src=\"assetFilter('/administration/static/img/empty-states/products-empty-state.svg')\"\n                    alt=\"\"\n                >\n            </template>\n        </sw-empty-state>\n    </slot>\n    {% endblock %}\n</div>\n{% endblock %}\n","import template from './sw-product-stream-grid-preview.html.twig';\nimport './sw-product-stream-grid-preview.scss';\n\nconst { Component, Context, Defaults } = Cicada;\nconst { Criteria } = Cicada.Data;\n\n/**\n * @private\n */\nComponent.register('sw-product-stream-grid-preview', {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'productStreamPreviewService',\n    ],\n\n    emits: ['selection-change'],\n\n    props: {\n        /**\n         * The apiFilter of a loaded product stream\n         */\n        // eslint-disable-next-line vue/require-prop-types\n        filters: {\n            required: true,\n        },\n        columns: {\n            required: false,\n            type: Array,\n            default() {\n                return [];\n            },\n        },\n        criteria: {\n            required: false,\n            type: Object,\n            default() {\n                return new Criteria(1, 10);\n            },\n        },\n        showSelection: {\n            required: false,\n            type: Boolean,\n            default: false,\n        },\n    },\n\n    data() {\n        return {\n            products: [],\n            systemCurrency: null,\n            searchTerm: '',\n            page: 1,\n            total: 0,\n            limit: 10,\n            isLoading: false,\n        };\n    },\n\n    computed: {\n        productRepository() {\n            return this.repositoryFactory.create('product');\n        },\n\n        currencyRepository() {\n            return this.repositoryFactory.create('currency');\n        },\n\n        salesChannelRepository() {\n            return this.repositoryFactory.create('sales_channel');\n        },\n\n        salesChannelCriteria() {\n            return new Criteria(1, 1)\n                .addFilter(\n                    Criteria.not('OR', [\n                        Criteria.equals('typeId', Defaults.productComparisonTypeId),\n                    ]),\n                )\n                .addSorting(Criteria.sort('type.iconName', 'ASC'));\n        },\n\n        defaultColumns() {\n            return [\n                {\n                    property: 'name',\n                    label: this.$tc('sw-product-stream.filter.values.product'),\n                    type: 'text',\n                    routerLink: 'sw.product.detail',\n                },\n                {\n                    property: 'manufacturer.name',\n                    label: this.$tc('sw-product-stream.filter.values.manufacturer'),\n                },\n                {\n                    property: 'active',\n                    label: this.$tc('sw-product-stream.filter.values.active'),\n                    align: 'center',\n                    type: 'bool',\n                },\n                {\n                    property: 'price',\n                    label: this.$tc('sw-product-stream.filter.values.price'),\n                },\n                {\n                    property: 'stock',\n                    label: this.$tc('sw-product-stream.filter.values.stock'),\n                    align: 'right',\n                },\n            ];\n        },\n\n        productColumns() {\n            if (this.columns.length) {\n                return this.columns;\n            }\n\n            return this.defaultColumns;\n        },\n\n        emptyStateMessage() {\n            if (!this.filters) {\n                return this.$tc('global.entity-components.productStreamPreview.emptyMessageNoStream');\n            }\n\n            if (this.searchTerm.length) {\n                return this.$tc(\n                    'global.entity-components.productStreamPreview.emptyMessageNoSearchResults',\n                    this.searchTerm,\n                    {\n                        term: this.searchTerm,\n                    },\n                );\n            }\n\n            return this.$tc('global.entity-components.productStreamPreview.emptyMessageNoProducts');\n        },\n\n        assetFilter() {\n            return Cicada.Filter.getByName('asset');\n        },\n\n        currencyFilter() {\n            return Cicada.Filter.getByName('currency');\n        },\n    },\n\n    watch: {\n        async filters(filtersValue) {\n            if (!filtersValue) {\n                this.total = 0;\n                return;\n            }\n\n            this.isLoading = true;\n            this.systemCurrency = await this.loadSystemDefaultCurrency();\n            this.loadProducts();\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        onSearchTermChange(searchTerm) {\n            this.searchTerm = searchTerm;\n            this.page = 1;\n            this.loadProducts();\n        },\n        async createdComponent() {\n            if (!this.filters) {\n                return;\n            }\n\n            this.isLoading = true;\n            this.systemCurrency = await this.loadSystemDefaultCurrency();\n            this.loadProducts();\n        },\n\n        loadSystemDefaultCurrency() {\n            return this.currencyRepository.get(Context.app.systemCurrencyId, Context.api);\n        },\n\n        loadProducts() {\n            // eslint-disable-next-line vue/no-mutating-props\n            this.criteria.term = this.searchTerm || null;\n            // eslint-disable-next-line vue/no-mutating-props\n            this.criteria.filters = [...this.filters];\n            // eslint-disable-next-line vue/no-mutating-props\n            this.criteria.limit = this.limit;\n            this.criteria.setPage(this.page);\n            this.criteria.addAssociation('manufacturer');\n            this.criteria.addAssociation('options.group');\n            this.criteria.addGroupField('displayGroup');\n            this.criteria.addFilter(\n                Criteria.not('AND', [\n                    Criteria.equals('displayGroup', null),\n                ]),\n            );\n\n            return this.salesChannelRepository\n                .searchIds(this.salesChannelCriteria)\n                .then(({ data }) => {\n                    return this.productStreamPreviewService.preview(data.at(0), this.criteria, [], {\n                        'sw-currency-id': Context.app.systemCurrencyId,\n                        'sw-inheritance': true,\n                    });\n                })\n                .then((result) => {\n                    this.products = Object.values(result.elements);\n                    this.total = result.total;\n                    this.isLoading = false;\n                });\n        },\n\n        onPageChange({ page = 1, limit = 25 }) {\n            this.page = page;\n            this.limit = limit;\n            this.isLoading = true;\n\n            this.loadProducts();\n        },\n\n        getPriceForDefaultCurrency(product) {\n            const price = product.price.find((productPrice) => {\n                return productPrice.currencyId === this.systemCurrency.id;\n            });\n\n            return price ? price.gross : '-';\n        },\n\n        onSelectionChange(products) {\n            this.$emit('selection-change', products);\n        },\n    },\n});\n"],"names":["template","Component","Context","Defaults","Criteria","filtersValue","searchTerm","data","result","page","limit","product","price","productPrice","products"],"mappings":"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"}