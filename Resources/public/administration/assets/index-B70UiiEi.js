const n=`{% block sw_settings_listing_option_criteria_card %} <sw-card class="sw-settings-listing-option-criteria-grid__criteria-card" position-identifier="sw-settings-listing-option-criteria-grid" :title="$tc('sw-settings-listing.base.criteria.title')" > {% block sw_settings_listing_option_criteria_card_toolbar %} <template #toolbar> {% block sw_settings_listing_option_criteria_card_toolbar_select %} <sw-single-select :value="selectedCriteria" :options="criteriaOptions" :placeholder="$tc('sw-settings-listing.base.criteria.selectPlaceholder')" value-property="value" label-property="label" show-clearable-button @update:value="onAddCriteria" /> {% endblock %} </template> {% endblock %} {% block sw_settings_listing_option_criteria_card_grid %} <sw-data-grid v-if="productSortingEntity && productSortingEntity.fields.length > 0" ref="dataGrid" :columns="productSortingEntityColumns" :data-source="sortedProductSortingFields" :show-actions="true" :allow-inline-edit="true" :compact-mode="false" :show-selection="false" plain-appearance item-identifier-property="field" @inline-edit-save="onSaveInlineEdit" @inline-edit-cancel="onCancelInlineEdit" > {% block sw_settings_listing_option_criteria_card_grid_column_field %} <template #column-field="{item, isInlineEdit}"> {% block sw_settings_listing_option_criteria_card_grid_column_field_select %} <sw-entity-single-select v-if="item.field === 'customField' || (isItemACustomField(item.field) && isInlineEdit)" ref="customFieldSelection" v-model:value="item.name" :placeholder="$tc('global.sw-single-select.valuePlaceholder')" :criteria="customFieldCriteriaSingleSelect(item)" :label-callback="getCustomFieldName" entity="custom_field" show-clearable-button @update:value="changeCustomField" /> {% endblock %} {% block sw_settings_listing_option_criteria_card_grid_column_field_custom_field %} <span v-else-if="isItemACustomField(item.field)"> {{ getCustomFieldLabelByCriteriaName(item.field) }} </span> {% endblock %} {% block sw_settings_listing_option_criteria_card_grid_column_field_custom_criteria %} <span v-else> {{ getCriteriaSnippetByFieldName(item.field) }} </span> {% endblock %} </template> {% endblock %} {% block sw_settings_listing_option_criteria_card_grid_column_order %} <template #column-order="{item, isInlineEdit}"> {% block sw_settings_listing_option_criteria_card_grid_column_order_text %} <div v-if="!isInlineEdit"> {{ getOrderSnippet(item.order) }} </div> {% endblock %} {% block sw_settings_listing_option_criteria_card_grid_column_order_select %} <sw-single-select v-else v-model:value="item.order" :options="orderOptions" value-property="value" label-property="label" :placeholder="$tc('global.sw-single-select.valuePlaceholder')" /> {% endblock %} </template> {% endblock %} {% block sw_settings_listing_option_criteria_card_grid_column_actions %} <template #actions="{item}"> {% block sw_settings_listing_option_criteria_card_grid_column_actions_delete %} <sw-context-menu-item variant="danger" @click="onRemoveCriteria(item)" > {{ $tc('global.default.delete') }} </sw-context-menu-item> {% endblock %} </template> {% endblock %} </sw-data-grid> {% endblock %} {% block sw_settings_listing_option_criteria_card_empty_state %} <sw-empty-state v-else class="sw-settings-listing-option-criteria-grid__criteria-empty-state" title="" :subline="$tc('sw-settings-listing.base.criteria.emptyStateSubline')" > {% block sw_settings_listing_option_criteria_card_empty_state_icon %} <template #icon> <img :src="assetFilter('administration/static/img/empty-states/settings-empty-state.svg')" alt="" > </template> {% endblock %} </sw-empty-state> {% endblock %} </sw-card> {% endblock %}`,{Mixin:l}=Cicada,{Criteria:i}=Cicada.Data,o={template:n,compatConfig:Cicada.compatConfig,inject:["repositoryFactory"],emits:["criteria-add","criteria-delete","inline-edit-save","inline-edit-cancel"],mixins:[l.getByName("notification"),l.getByName("sw-inline-snippet")],props:{productSortingEntity:{type:Object,required:!0}},data(){return{customFields:[],selectedCriteria:null,customFieldSetIDs:null,notSortableCustomFields:["price","json","text","html"]}},computed:{customFieldRepository(){return this.repositoryFactory.create("custom_field")},customFieldSetRepository(){return this.repositoryFactory.create("custom_field_set")},customFieldSetRelationsRepository(){return this.repositoryFactory.create("custom_field_set_relation")},customFieldCriteria(){const t=new i(1,25);return t.addFilter(i.not("and",[i.equalsAny("type",this.notSortableCustomFields)])),this.customFieldSetIDs&&t.addFilter(i.equalsAny("customFieldSetId",this.customFieldSetIDs)),this.getProductSortingFieldsByName().length&&t.addFilter(i.equalsAny("id",this.getProductSortingFieldsByName())),t},customFieldsRelationsCriteria(){const t=new i(1,25);return t.addFilter(i.equals("entityName","product")),t},sortedProductSortingFields(){return this.productSortingEntity.fields.sort((t,e)=>t.priority===e.priority?0:t.priority<e.priority?1:-1)},productSortingEntityColumns(){return[{property:"field",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.header.name"),inlineEdit:"string"},{property:"order",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.header.order"),inlineEdit:"string"},{property:"priority",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.header.priority"),inlineEdit:"number"}]},criteriaOptions(){return[{value:"product.name",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.options.label.product.name")},{value:"product.ratingAverage",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.options.label.product.ratingAverage")},{value:"product.productNumber",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.options.label.product.productNumber")},{value:"product.releaseDate",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.options.label.product.releaseDate")},{value:"product.stock",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.options.label.product.stock")},{value:"product.sales",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.options.label.product.sales")},{value:"customField",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.options.label.customField")},{value:"product.cheapestPrice",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.options.label.product.cheapestPrice")},{value:"product.price",label:this.$tc("sw-settings-listing.general.productSortingCriteriaGrid.options.label.product.price")}].sort((e,r)=>e.label.localeCompare(r.label))},orderOptions(){return[{label:this.$tc("global.default.ascending"),value:"asc"},{label:this.$tc("global.default.descending"),value:"desc"}]},assetFilter(){return Cicada.Filter.getByName("asset")}},watch:{productSortingEntity:{handler(){!this.productSortingEntity||!this.productSortingEntity.fields||this.productSortingEntity.fields.forEach(t=>{t.field===null&&(t.field="customField")})},deep:!0}},created(){this.createdComponent()},methods:{createdComponent(){this.fetchCustomFieldSetIds().then(()=>{this.fetchCustomFields()})},fetchCustomFieldSetIds(){return this.customFieldSetRelationsRepository.search(this.customFieldsRelationsCriteria).then(t=>{this.customFieldSetIDs=t.map(e=>e.customFieldSetId)})},fetchCustomFields(){this.customFieldRepository.search(this.customFieldCriteria).then(t=>{this.customFields=t})},isItemACustomField(t){const e=this.stripCustomFieldPath(t);return this.customFields.some(r=>r.name===e)},getCustomFieldByName(t){return this.customFields.find(e=>e.name===t)},onAddCriteria(t){if(!this.criteriaIsAlreadyUsed(t)){this.$emit("criteria-add",t);const r=this.productSortingEntity.fields.find(s=>s.field===t);this.$nextTick().then(()=>{r&&this.$refs.dataGrid&&this.$refs.dataGrid.onDbClickCell(r)});return}const e=this.getCriteriaSnippetByFieldName(t);this.createNotificationError({message:this.$t("sw-settings-listing.general.productSortingCriteriaGrid.options.criteriaAlreadyUsed",{criteriaName:e})})},getOrderSnippet(t){return t==="asc"?this.$tc("global.default.ascending"):this.$tc("global.default.descending")},onRemoveCriteria(t){this.$emit("criteria-delete",t)},getCriteriaTemplate(t){return{field:t,order:"asc",priority:1,naturalSorting:0}},onSaveInlineEdit(t){if(t.field===null){this.createNotificationError({message:this.$t("sw-settings-listing.general.productSortingCriteriaGrid.options.customFieldCriteriaNotNull")});return}if(t.field==="customFields"&&(t.field=`customFields.${t.field}`),t.field==="customField"){this.createNotificationError({message:this.$t("sw-settings-listing.general.productSortingCriteriaGrid.options.customFieldCriteriaNotNull")}),this.filterEmptyCustomFields(t);return}this.$emit("inline-edit-save")},onCancelInlineEdit(t){t&&t.field==="customField"?this.filterEmptyCustomFields(t):this.$emit("inline-edit-cancel",t)},filterEmptyCustomFields(t){this.productSortingEntity.fields=this.productSortingEntity.fields.filter(e=>e.field!==t.field)},stripCustomFieldPath(t){return t.replace(/customFields\./,"")},getCriteriaSnippetByFieldName(t){return this.$tc(`sw-settings-listing.general.productSortingCriteriaGrid.options.label.${t}`)},criteriaIsAlreadyUsed(t){return this.productSortingEntity.fields.some(e=>e.field===t)},getCustomFieldLabelByCriteriaName(t){const e=this.stripCustomFieldPath(t),r=this.getCustomFieldByName(e);return this.getInlineSnippet(r.config.label)||e},getCustomFieldName(t){const e=t&&this.getInlineSnippet(t.config.label);return e||(t==null?void 0:t.name)},customFieldCriteriaSingleSelect(t){const e=new i(1,25);return e.addFilter(i.not("and",[i.equalsAny("type",this.notSortableCustomFields)])),this.customFieldSetIDs&&e.addFilter(i.equalsAny("customFieldSetId",this.customFieldSetIDs)),this.getProductSortingFieldsByName(t).length&&e.addFilter(i.not("AND",[i.equalsAny("id",this.getProductSortingFieldsByName(t))])),e},async changeCustomField(t,e){const r=this.sortedProductSortingFields.find(s=>s.field==="customField"||s.name===t);r.field=`customFields.${e.name}`,await this.fetchCustomFields(),this.onSaveInlineEdit(r.field)},getProductSortingFieldsByName(t=null){return this.sortedProductSortingFields.filter(e=>t?/^customFields\./.test(e.field)&&e.field!==t.field:/^customFields\./.test(e.field)).map(e=>e.name)||{}}}};export{o as default};
//# sourceMappingURL=index-B70UiiEi.js.map
