{"version":3,"file":"index-CfSXvBVN.js","sources":["../../../app/administration/src/module/sw-flow/component/modals/sw-flow-create-mail-template-modal/sw-flow-create-mail-template-modal.html.twig","../../../app/administration/src/module/sw-flow/component/modals/sw-flow-create-mail-template-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_flow_create_mail_template_modal %}\n<sw-modal\n    class=\"sw-flow-create-mail-template-modal\"\n    :title=\"$tc('sw-flow.modals.mail.titleNewEmailTemplate')\"\n    :closable=\"false\"\n    @modal-close=\"onClose\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_flow_create_mail_template_modal_content %}\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_flow_create_mail_template_modal_type_selection %}\n    <sw-entity-single-select\n        v-model:value=\"mailTemplate.mailTemplateTypeId\"\n        name=\"sw-field--mailTemplate-mailTemplateTypeId\"\n        class=\"sw-flow-create-mail-template-modal__type\"\n        entity=\"mail_template_type\"\n        required\n        :label=\"$tc('sw-flow.modals.mail.labelMailType')\"\n        :placeholder=\"$tc('sw-flow.modals.mail.placeholderMailType')\"\n        :error=\"mailTemplateMailTemplateTypeIdError\"\n        @update:value=\"onChangeType\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_flow_create_mail_template_modal_info %}\n    <sw-container\n        columns=\"1fr 1fr\"\n        gap=\"30px\"\n    >\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_flow_create_mail_template_modal_subject %}\n        <sw-text-field\n            v-model:value=\"mailTemplate.subject\"\n            name=\"sw-field--mailTemplate-subject\"\n            class=\"sw-flow-create-mail-template-modal__subject\"\n            required\n            :label=\"$tc('sw-flow.modals.mail.labelSubject')\"\n            :placeholder=\"$tc('sw-flow.modals.mail.placeholderSubject')\"\n            :error=\"mailTemplateSubjectError\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_flow_create_mail_template_modal_sender_name %}\n        <sw-text-field\n            v-model:value=\"mailTemplate.senderName\"\n            name=\"sw-field--mailTemplate-senderName\"\n            class=\"sw-flow-create-mail-template-modal__sender-name\"\n            :label=\"$tc('sw-flow.modals.mail.labelSenderName')\"\n            :placeholder=\"$tc('sw-flow.modals.mail.placeholderSenderName')\"\n        />\n        {% endblock %}\n    </sw-container>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_flow_create_mail_template_modal_description %}\n    <sw-textarea-field\n        v-model:value=\"mailTemplate.description\"\n        name=\"sw-field--mailTemplate-description\"\n        class=\"sw-flow-create-mail-template-modal__description\"\n        :label=\"$tc('sw-flow.modals.mail.labelDescription')\"\n        :placeholder=\"$tc('sw-flow.modals.mail.placeholderDescription')\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_flow_create_mail_template_modal_plain_content %}\n    <sw-code-editor\n        ref=\"plainEditor\"\n        :key=\"`${mailTemplate.mailTemplateTypeId}plain`\"\n        v-model:value=\"mailTemplate.contentPlain\"\n        class=\"sw-flow-create-mail-template-modal__content-plain\"\n        name=\"content_plain\"\n        completion-mode=\"entity\"\n        :label=\"$tc('sw-flow.modals.mail.labelContentPlain')\"\n        :placeholder=\"placeholder(mailTemplate, 'contentPlain', $tc('sw-flow.modals.mail.placeholderPlain'))\"\n        :completer-function=\"outerCompleterFunction\"\n        :editor-config=\"editorConfig\"\n        :error=\"mailTemplateContentPlainError\"\n        required\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_flow_create_mail_template_modal_html_content %}\n    <sw-code-editor\n        ref=\"htmlEditor\"\n        :key=\"`${mailTemplate.mailTemplateTypeId}html`\"\n        v-model:value=\"mailTemplate.contentHtml\"\n        class=\"sw-flow-create-mail-template-modal__content-html\"\n        name=\"content_html\"\n        completion-mode=\"entity\"\n        :label=\"$tc('sw-flow.modals.mail.labelContentHtml')\"\n        :placeholder=\"placeholder(mailTemplate, 'contentPlain', $tc('sw-flow.modals.mail.placeholderHtml'))\"\n        :completer-function=\"outerCompleterFunction\"\n        :editor-config=\"editorConfig\"\n        :error=\"mailTemplateContentHtmlError\"\n        required\n    />\n    {% endblock %}\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_flow_create_mail_template_modal_footer %}\n    <template #modal-footer>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_flow_create_mail_template_modal_footer_cancel_button %}\n        <sw-button\n            class=\"sw-flow-create-mail-template-modal__cancel-button\"\n            size=\"small\"\n            @click=\"onClose\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_flow_create_mail_template_modal_footer_save_button %}\n        <sw-button\n            class=\"sw-flow-create-mail-template-modal__save-button\"\n            variant=\"primary\"\n            size=\"small\"\n            :is-loading=\"isLoading\"\n            @click=\"onAddMailTemplate\"\n        >\n            {{ $tc('sw-flow.modals.mail.buttonAddMailTemplate') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n","import template from './sw-flow-create-mail-template-modal.html.twig';\nimport './sw-flow-create-mail-template-modal.scss';\n\nconst { Mixin } = Cicada;\nconst { Criteria } = Cicada.Data;\nconst { mapPropertyErrors } = Cicada.Component.getComponentHelper();\nconst utils = Cicada.Utils;\n\n/**\n * @private\n * @package services-settings\n */\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'mailService',\n        'entityMappingService',\n        'repositoryFactory',\n    ],\n\n    emits: [\n        'modal-close',\n        'process-finish',\n    ],\n\n    mixins: [\n        Mixin.getByName('placeholder'),\n        Mixin.getByName('notification'),\n    ],\n\n    data() {\n        return {\n            mailTemplate: {},\n            mailTemplateType: {},\n            editorConfig: {\n                enableBasicAutocompletion: true,\n            },\n            isLoading: false,\n        };\n    },\n\n    computed: {\n        mailTemplateRepository() {\n            return this.repositoryFactory.create('mail_template');\n        },\n\n        mailTemplateTypeRepository() {\n            return this.repositoryFactory.create('mail_template_type');\n        },\n\n        mailTemplateCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addAssociation('mailTemplateType');\n\n            return criteria;\n        },\n\n        outerCompleterFunction() {\n            return (function completerWrapper(entityMappingService, innerMailTemplateType) {\n                function completerFunction(prefix) {\n                    const properties = [];\n                    Object.keys(\n                        entityMappingService.getEntityMapping(prefix, innerMailTemplateType.availableEntities),\n                    ).forEach((val) => {\n                        properties.push({\n                            value: val,\n                        });\n                    });\n                    return properties;\n                }\n                return completerFunction;\n            })(this.entityMappingService, this.mailTemplateType);\n        },\n\n        ...mapPropertyErrors('mailTemplate', [\n            'contentHtml',\n            'contentPlain',\n            'mailTemplateTypeId',\n            'subject',\n        ]),\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            if (!Cicada.State.getters['context/isSystemDefaultLanguage']) {\n                Cicada.State.commit('context/resetLanguageToDefault');\n            }\n\n            this.mailTemplate = this.mailTemplateRepository.create(Cicada.Context.api, utils.createId());\n        },\n\n        onClose() {\n            this.$emit('modal-close');\n        },\n\n        onAddMailTemplate() {\n            const mailTemplateSubject = this.mailTemplate.subject || this.placeholder(this.mailTemplate, 'subject');\n\n            this.isSaveSuccessful = false;\n            this.isLoading = true;\n\n            return this.mailTemplateRepository\n                .save(this.mailTemplate)\n                .then(() => {\n                    this.getMailTemplate();\n                })\n                .catch((error) => {\n                    let errorMsg = '';\n                    this.isLoading = false;\n\n                    if (error.response.data.errors.length > 0) {\n                        const errorDetailMsg = error.response.data.errors[0].detail;\n                        errorMsg = `<br/> ${this.$tc('sw-mail-template.detail.textErrorMessage')}: \"${errorDetailMsg}\"`;\n                    }\n\n                    this.createNotificationError({\n                        message:\n                            this.$tc('sw-mail-template.detail.messageSaveError', 0, { subject: mailTemplateSubject }) +\n                            errorMsg,\n                    });\n                });\n        },\n\n        getMailTemplateType() {\n            if (!this.mailTemplate?.mailTemplateTypeId) {\n                return Promise.resolve();\n            }\n\n            return this.mailTemplateTypeRepository.get(this.mailTemplate.mailTemplateTypeId).then((item) => {\n                this.mailTemplateType = item;\n                this.$refs.htmlEditor.defineAutocompletion(this.outerCompleterFunction);\n                this.$refs.plainEditor.defineAutocompletion(this.outerCompleterFunction);\n            });\n        },\n\n        async onChangeType(id) {\n            if (!id) {\n                return;\n            }\n\n            try {\n                await this.getMailTemplateType();\n            } catch (e) {\n                let errorMsg = '';\n                if (e.response.data.errors.length > 0) {\n                    const errorDetailMsg = e.response.data.errors[0].detail;\n                    errorMsg = `<br/> ${this.$tc('sw-mail-template.detail.textErrorMessage')}: \"${errorDetailMsg}\"`;\n                }\n\n                this.createNotificationError({\n                    message: errorMsg,\n                });\n            }\n        },\n\n        getMailTemplate() {\n            return this.mailTemplateRepository\n                .get(this.mailTemplate.id, Cicada.Context.api, this.mailTemplateCriteria)\n                .then((data) => {\n                    this.$emit('process-finish', data);\n                })\n                .catch(() => {\n                    this.$emit('process-finish', null);\n                })\n                .finally(() => {\n                    this.isLoading = false;\n                    this.onClose();\n                });\n        },\n    },\n};\n"],"names":["template","Mixin","Criteria","mapPropertyErrors","utils","index","criteria","entityMappingService","innerMailTemplateType","completerFunction","prefix","properties","val","mailTemplateSubject","error","errorMsg","errorDetailMsg","_a","item","id","e","data"],"mappings":"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"}