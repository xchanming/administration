{"version":3,"file":"index-ClZG7zol.js","sources":["../../../app/administration/src/module/sw-promotion-v2/view/sw-promotion-v2-detail-base/sw-promotion-v2-detail-base.html.twig","../../../app/administration/src/module/sw-promotion-v2/view/sw-promotion-v2-detail-base/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_promotion_v2_detail_base %}\n<div class=\"sw-promotion-v2-detail-base\">\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_detail_base_general_card %}\n    <sw-card\n        v-if=\"promotion\"\n        position-identifier=\"sw-promotion-detail-base-general\"\n        class=\"sw-promotion-v2-detail-base__card-general\"\n        :is-loading=\"isLoading\"\n        :title=\"$tc('sw-promotion-v2.detail.base.general.cardTitle')\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_detail_base_general_name %}\n        <sw-container\n            columns=\"2fr 1fr\"\n            gap=\"0 32px\"\n        >\n            <sw-text-field\n                v-model:value=\"promotion.name\"\n                class=\"sw-promotion-v2-detail-base__field-name\"\n                :label=\"$tc('sw-promotion-v2.detail.base.general.nameLabel')\"\n                :disabled=\"!acl.can('promotion.editor')\"\n                required\n                :error=\"promotionNameError\"\n                :placeholder=\"placeholder(promotion, 'name', $tc('sw-promotion-v2.detail.base.general.namePlaceholder'))\"\n            />\n\n            <sw-number-field\n                v-model:value=\"promotion.priority\"\n                :disabled=\"!acl.can('promotion.editor')\"\n                :label=\"$tc('sw-promotion-v2.detail.base.general.priorityLabel')\"\n                :help-text=\"$tc('sw-promotion-v2.detail.base.general.helpTextPriority')\"\n            />\n        </sw-container>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_detail_base_general_valid_container %}\n        <sw-container\n            columns=\"1fr 1fr\"\n            gap=\"0 32px\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_base_general_valid_from %}\n            <sw-datepicker\n                v-model:value=\"promotion.validFrom\"\n                class=\"sw-promotion-v2-detail-base__field-valid-from\"\n                date-type=\"datetime\"\n                :label=\"$tc('sw-promotion-v2.detail.base.general.validFromLabel')\"\n                :placeholder=\"$tc('sw-promotion-v2.detail.base.general.validFromPlaceholder')\"\n                :disabled=\"!acl.can('promotion.editor')\"\n            />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_base_general_valid_until %}\n            <sw-datepicker\n                v-model:value=\"promotion.validUntil\"\n                class=\"sw-promotion-v2-detail-base__field-valid-until\"\n                date-type=\"datetime\"\n                :label=\"$tc('sw-promotion-v2.detail.base.general.validUntilLabel')\"\n                :placeholder=\"$tc('sw-promotion-v2.detail.base.general.validUntilPlaceholder')\"\n                :disabled=\"!acl.can('promotion.editor')\"\n                :error=\"promotionValidUntilError\"\n            />\n            {% endblock %}\n\n        </sw-container>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_detail_base_general_max_uses %}\n        <sw-container\n            columns=\"1fr 1fr\"\n            gap=\"0 32px\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_base_general_max_uses_global %}\n            <sw-number-field\n                v-model:value=\"promotion.maxRedemptionsGlobal\"\n                class=\"sw-promotion-v2-detail-base__field-max-uses-global\"\n                number-type=\"int\"\n                :label=\"$tc('sw-promotion-v2.detail.base.general.maxUsesGlobalLabel')\"\n                :placeholder=\"$tc('sw-promotion-v2.detail.base.general.maxUsesGlobalPlaceholder')\"\n                :disabled=\"!acl.can('promotion.editor')\"\n                allow-empty\n            />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_base_general_max_uses_customer %}\n            <sw-number-field\n                v-model:value=\"promotion.maxRedemptionsPerCustomer\"\n                class=\"sw-promotion-v2-detail-base__field-max-uses-per-customer\"\n                number-type=\"int\"\n                :label=\"$tc('sw-promotion-v2.detail.base.general.maxUsesPerCustomerLabel')\"\n                :placeholder=\"$tc('sw-promotion-v2.detail.base.general.maxUsesPerCustomerPlaceholder')\"\n                :disabled=\"!acl.can('promotion.editor')\"\n                allow-empty\n            />\n            {% endblock %}\n\n        </sw-container>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_detail_base_general_active %}\n        <sw-switch-field\n            v-model:value=\"promotion.active\"\n            class=\"sw-promotion-v2-detail-base__field-active\"\n            :label=\"$tc('sw-promotion-v2.detail.base.general.activeLabel')\"\n            :disabled=\"!acl.can('promotion.editor')\"\n            bordered\n        />\n        {% endblock %}\n\n    </sw-card>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_detail_base_codes_card %}\n    <sw-card\n        v-if=\"promotion && !isCreateMode\"\n        class=\"sw-promotion-v2-detail-base__card-codes\"\n        position-identifier=\"sw-promotion-detail-base-codes\"\n        :is-loading=\"isLoading\"\n        :title=\"$tc('sw-promotion-v2.detail.base.codes.cardTitle')\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_detail_base_codes_select %}\n        <sw-select-field\n            class=\"sw-promotion-v2-detail-base__field-code-type\"\n            :label=\"$tc('sw-promotion-v2.detail.base.codes.codeTypeLabel')\"\n            :disabled=\"!acl.can('promotion.editor')\"\n            :value=\"selectedCodeType\"\n            @update:value=\"onChangeCodeType\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_base_codes_select_options %}\n            <option\n                v-for=\"option in codeTypeOptions\"\n                :key=\"option.value\"\n                :value=\"option.value\"\n                :selected=\"option.value === selectedCodeType\"\n            >\n                {{ option.label }}\n            </option>\n            {% endblock %}\n\n        </sw-select-field>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_detail_base_codes_type_fixed %}\n        <template v-if=\"selectedCodeType === CODE_TYPES.FIXED\">\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_base_codes_type_fixed_code %}\n            <sw-text-field\n                v-model:value=\"promotion.code\"\n                class=\"sw-promotion-v2-detail-base__fixed-field-code\"\n                :disabled=\"!acl.can('promotion.editor')\"\n                :label=\"$tc('sw-promotion-v2.detail.base.codes.fixed.codeLabel')\"\n                :placeholder=\"$tc('sw-promotion-v2.detail.base.codes.fixed.codePlaceholder')\"\n                copyable\n            />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_base_codes_type_fixed_generate %}\n            <sw-button-process\n                class=\"sw-promotion-v2-detail-base__fixed-generate-button\"\n                :is-loading=\"isGenerating\"\n                :disabled=\"!acl.can('promotion.editor')\"\n                :process-success=\"isGenerateSuccessful\"\n                @update:process-success=\"generateFinish\"\n                @click.prevent=\"onGenerateCodeFixed\"\n            >\n                {{ $tc('sw-promotion-v2.detail.base.codes.fixed.generateButton') }}\n            </sw-button-process>\n            {% endblock %}\n\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_detail_base_codes_type_individual %}\n        <template v-else-if=\"selectedCodeType === CODE_TYPES.INDIVIDUAL\">\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_promotion_v2_detail_base_codes_type_individual_codes_behavior %}\n            <sw-promotion-v2-individual-codes-behavior\n                :promotion=\"promotion\"\n                @generate-finish=\"$emit('generate-individual-codes-finish')\"\n                @delete-finish=\"$emit('delete-individual-codes-finish')\"\n            />\n            {% endblock %}\n\n        </template>\n        {% endblock %}\n\n    </sw-card>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_detail_custom_field_sets %}\n    <sw-card\n        v-if=\"showCustomFields\"\n        position-identifier=\"sw-promotion-detail-base-custom-field-sets\"\n        :title=\"$tc('sw-settings-custom-field.general.mainMenuItemGeneral')\"\n        :is-loading=\"isLoading\"\n    >\n        <sw-custom-field-set-renderer\n            :entity=\"promotion\"\n            :disabled=\"!acl.can('promotion.editor')\"\n            :sets=\"customFieldSets\"\n        />\n    </sw-card>\n    {% endblock %}\n</div>\n{% endblock %}\n","/**\n * @package checkout\n */\nimport template from './sw-promotion-v2-detail-base.html.twig';\n\nconst { Mixin } = Cicada;\nconst { mapPropertyErrors } = Cicada.Component.getComponentHelper();\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'acl',\n        'promotionCodeApiService',\n        'customFieldDataProviderService',\n    ],\n\n    emits: [\n        'generate-individual-codes-finish',\n        'delete-individual-codes-finish',\n        'clean-up-codes',\n    ],\n\n    mixins: [\n        Mixin.getByName('placeholder'),\n    ],\n\n    props: {\n        promotion: {\n            type: Object,\n            required: false,\n            default() {\n                return null;\n            },\n        },\n\n        isLoading: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n\n        isCreateMode: {\n            type: Boolean,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            selectedCodeType: '0',\n            isGenerating: false,\n            isGenerateSuccessful: false,\n            codeSortProperty: 'code',\n            codeSortDirection: 'ASC',\n            CODE_TYPES: Object.freeze({\n                NONE: '0',\n                FIXED: '1',\n                INDIVIDUAL: '2',\n            }),\n            customFieldSets: null,\n        };\n    },\n\n    computed: {\n        codeTypeOptions() {\n            return Object.entries(this.CODE_TYPES).map((type) =>\n                Object.create({\n                    label: this.$tc(`sw-promotion-v2.detail.base.codes.${type[0].toLowerCase()}.description`),\n                    value: type[1],\n                }),\n            );\n        },\n\n        ...mapPropertyErrors('promotion', [\n            'name',\n            'validUntil',\n        ]),\n\n        showCustomFields() {\n            return this.customFieldSets && this.customFieldSets.length > 0;\n        },\n    },\n\n    watch: {\n        promotion() {\n            this.createdComponent();\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            if (!this.promotion) {\n                return;\n            }\n\n            this.loadCustomFieldSets();\n\n            if (this.promotion.useCodes && this.promotion.useIndividualCodes) {\n                this.setNewCodeType(this.CODE_TYPES.INDIVIDUAL);\n                this.initialSort();\n\n                return;\n            }\n\n            this.setNewCodeType(this.promotion.useCodes ? this.CODE_TYPES.FIXED : this.CODE_TYPES.NONE);\n        },\n\n        initialSort() {\n            this.promotion.individualCodes.sort((a, b) => {\n                const aValue = a[this.codeSortProperty];\n                const bValue = b[this.codeSortProperty];\n\n                let isBigger = null;\n\n                if (typeof aValue === 'string' && typeof bValue === 'string') {\n                    isBigger = aValue.toUpperCase() > bValue.toUpperCase();\n                }\n\n                if (typeof aValue === 'number' && typeof bValue === 'number') {\n                    isBigger = aValue - bValue > 0;\n                }\n\n                if (isBigger !== null) {\n                    if (this.codeSortDirection === 'DESC') {\n                        return isBigger ? -1 : 1;\n                    }\n\n                    return isBigger ? 1 : -1;\n                }\n\n                return 0;\n            });\n        },\n\n        onChangeCodeType(value) {\n            const hasInactiveIndividualCodes =\n                value !== this.CODE_TYPES.INDIVIDUAL &&\n                this.promotion.individualCodes !== null &&\n                this.promotion.individualCodes.length > 0;\n            const hasInactiveFixedCode =\n                value !== this.CODE_TYPES.FIXED && this.promotion.code !== null && this.promotion.code.length > 0;\n\n            this.$emit('clean-up-codes', hasInactiveIndividualCodes, hasInactiveFixedCode);\n            this.setNewCodeType(value);\n        },\n\n        setNewCodeType(value) {\n            this.promotion.useCodes = value !== this.CODE_TYPES.NONE;\n            this.promotion.useIndividualCodes = value === this.CODE_TYPES.INDIVIDUAL;\n\n            this.selectedCodeType = value;\n        },\n\n        loadCustomFieldSets() {\n            this.customFieldDataProviderService.getCustomFieldSets('promotion').then((sets) => {\n                this.customFieldSets = sets;\n            });\n        },\n\n        onGenerateCodeFixed() {\n            this.isGenerating = true;\n            this.promotionCodeApiService\n                .generateCodeFixed()\n                .then((code) => {\n                    this.promotion.code = code;\n                    this.isGenerateSuccessful = true;\n                })\n                .finally(() => {\n                    this.isGenerating = false;\n                });\n        },\n\n        generateFinish() {\n            this.isGenerateSuccessful = false;\n        },\n    },\n};\n"],"names":["template","Mixin","mapPropertyErrors","index","type","a","b","aValue","bValue","isBigger","value","hasInactiveIndividualCodes","hasInactiveFixedCode","sets","code"],"mappings":"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"}