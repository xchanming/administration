{"version":3,"file":"index-BdHIxQe7.js","sources":["../../../app/administration/src/module/sw-promotion-v2/view/sw-promotion-v2-conditions/sw-promotion-v2-conditions.html.twig","../../../app/administration/src/module/sw-promotion-v2/view/sw-promotion-v2-conditions/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_promotion_v2_conditions %}\n<div class=\"sw-promotion-v2-conditions\">\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_conditions_pre_conditions_card %}\n    <sw-card\n        :title=\"$tc('sw-promotion-v2.detail.conditions.preConditions.cardTitlePreConditions')\"\n        position-identifier=\"sw-promotion-conditions-pre-conditions\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_conditions_pre_conditions_sales_channel_selection %}\n        <sw-promotion-v2-sales-channel-select\n            class=\"sw-promotion-v2-conditions__sales-channel-selection\"\n            :promotion=\"promotion\"\n            :entity-collection=\"promotion.salesChannels\"\n            :disabled=\"!acl.can('promotion.editor')\"\n            :label=\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelPromotionSalesChannel')\"\n            :placeholder=\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelPromotionSalesChannel')\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_conditions_pre_conditions_prevent_combination %}\n        <sw-switch-field\n            v-model:value=\"promotion.preventCombination\"\n            class=\"sw-promotion-v2-conditions__prevent-combination\"\n            :disabled=\"!acl.can('promotion.editor')\"\n            :label=\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelPreventCombination')\"\n            :help-text=\"$tc('sw-promotion-v2.detail.conditions.preConditions.helpTextPreventCombination')\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_conditions_pre_conditions_exclusions %}\n        <sw-entity-multi-select\n            class=\"sw-promotion-v2-conditions__rules-exclusion-selection\"\n            :label=\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelPromotionExclusions')\"\n            :placeholder=\"$tc('sw-promotion-v2.detail.conditions.preConditions.placeholderPromotionExclusions')\"\n            :criteria=\"exclusionCriteria\"\n            :entity-collection=\"excludedPromotions\"\n            :disabled=\"!acl.can('promotion.editor') || promotion.preventCombination\"\n            @update:entity-collection=\"onChangeExclusions\"\n        />\n        {% endblock %}\n\n    </sw-card>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_promotion_v2_rule_conditions_card %}\n    <sw-card\n        :title=\"$tc('sw-promotion-v2.detail.conditions.preConditions.cardTitleRuleConditions')\"\n        position-identifier=\"sw-promotion-conditions-rules\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_rule_conditions_rule_select_customer %}\n        <sw-promotion-v2-rule-select\n            v-if=\"promotion\"\n            v-model:collection=\"promotion.personaRules\"\n            class=\"sw-promotion-v2-conditions__rule-select-customer\"\n            :local-mode=\"promotion.isNew()\"\n            :criteria=\"personaRuleFilter\"\n            :label=\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelCustomerSelect')\"\n            :placeholder=\"$tc('sw-promotion-v2.detail.conditions.preConditions.placeholderCustomerSelect')\"\n            :rule-scope=\"['checkout']\"\n            :disabled=\"!acl.can('promotion.editor')\"\n            rule-aware-group-key=\"personaPromotions\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_rule_conditions_rule_select_cart_conditions %}\n        <sw-promotion-v2-cart-condition-form\n            :promotion=\"promotion\"\n            :restricted-rules=\"cartRestrictedRules\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_promotion_v2_rule_conditions_rule_select_order_conditions %}\n        <sw-promotion-v2-rule-select\n            v-if=\"promotion\"\n            v-model:collection=\"promotion.orderRules\"\n            class=\"sw-promotion-v2-conditions__rule-select-order-conditions\"\n            :label=\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelOrderConditionSelect')\"\n            :placeholder=\"$tc('sw-promotion-v2.detail.conditions.preConditions.placeholderOrderConditionSelect')\"\n            :criteria=\"orderConditionsFilter\"\n            :rule-scope=\"['checkout']\"\n            :disabled=\"!acl.can('promotion.editor')\"\n            rule-aware-group-key=\"orderPromotions\"\n        />\n        {% endblock %}\n\n    </sw-card>\n    {% endblock %}\n\n</div>\n{% endblock %}\n","/**\n * @package checkout\n */\nimport template from './sw-promotion-v2-conditions.html.twig';\n\nconst { Criteria, EntityCollection } = Cicada.Data;\nconst types = Cicada.Utils.types;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n        'feature',\n        'ruleConditionDataProviderService',\n    ],\n\n    props: {\n        promotion: {\n            type: Object,\n            required: false,\n            default() {\n                return null;\n            },\n        },\n    },\n\n    data() {\n        return {\n            excludedPromotions: this.createPromotionCollection(),\n            personaRestrictedRules: [],\n            orderRestrictedRules: [],\n            cartRestrictedRules: [],\n        };\n    },\n\n    computed: {\n        exclusionCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addFilter(Criteria.not('and', [Criteria.equals('id', this.promotion.id)]));\n            return criteria;\n        },\n\n        personaRuleFilter() {\n            const criteria = new Criteria(1, 25);\n\n            criteria.addAssociation('conditions').addSorting(Criteria.sort('name', 'ASC', false));\n\n            return criteria;\n        },\n\n        cartConditionsRuleFilter() {\n            const criteria = new Criteria(1, 25);\n\n            criteria.addAssociation('conditions').addSorting(Criteria.sort('name', 'ASC', false));\n\n            return criteria;\n        },\n\n        orderConditionsFilter() {\n            const criteria = new Criteria(1, 25);\n\n            criteria.addAssociation('conditions').addSorting(Criteria.sort('name', 'ASC', false));\n\n            return criteria;\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.loadExclusions();\n        },\n\n        loadExclusions() {\n            if (types.isEmpty(this.promotion.exclusionIds)) {\n                this.excludedPromotions = this.createPromotionCollection();\n                return;\n            }\n\n            const promotionRepository = this.repositoryFactory.create('promotion');\n            const criteria = new Criteria(1, 25).addFilter(Criteria.equalsAny('id', this.promotion.exclusionIds));\n\n            promotionRepository.search(criteria).then((excluded) => {\n                this.excludedPromotions = excluded;\n            });\n        },\n\n        onChangeExclusions(promotions) {\n            this.promotion.exclusionIds = promotions.map((promotion) => {\n                return promotion.id;\n            });\n\n            this.loadExclusions();\n        },\n\n        createPromotionCollection() {\n            return new EntityCollection('/promotion', 'promotion', Cicada.Context.api, new Criteria(1, 25));\n        },\n    },\n};\n"],"names":["template","Criteria","EntityCollection","types","index","criteria","promotionRepository","excluded","promotions","promotion"],"mappings":"AAAA,MAAeA,EAAA,o0GCKT,CAAE,SAAAC,EAAU,iBAAAC,GAAqB,OAAO,KACxCC,EAAQ,OAAO,MAAM,MAGZC,EAAA,CACX,SAAAJ,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,oBACA,MACA,UACA,kCACH,EAED,MAAO,CACH,UAAW,CACP,KAAM,OACN,SAAU,GACV,SAAU,CACN,OAAO,IACV,CACJ,CACJ,EAED,MAAO,CACH,MAAO,CACH,mBAAoB,KAAK,0BAA2B,EACpD,uBAAwB,CAAE,EAC1B,qBAAsB,CAAE,EACxB,oBAAqB,CAAE,CACnC,CACK,EAED,SAAU,CACN,mBAAoB,CAChB,MAAMK,EAAW,IAAIJ,EAAS,EAAG,EAAE,EACnC,OAAAI,EAAS,UAAUJ,EAAS,IAAI,MAAO,CAACA,EAAS,OAAO,KAAM,KAAK,UAAU,EAAE,CAAC,CAAC,CAAC,EAC3EI,CACV,EAED,mBAAoB,CAChB,MAAMA,EAAW,IAAIJ,EAAS,EAAG,EAAE,EAEnC,OAAAI,EAAS,eAAe,YAAY,EAAE,WAAWJ,EAAS,KAAK,OAAQ,MAAO,EAAK,CAAC,EAE7EI,CACV,EAED,0BAA2B,CACvB,MAAMA,EAAW,IAAIJ,EAAS,EAAG,EAAE,EAEnC,OAAAI,EAAS,eAAe,YAAY,EAAE,WAAWJ,EAAS,KAAK,OAAQ,MAAO,EAAK,CAAC,EAE7EI,CACV,EAED,uBAAwB,CACpB,MAAMA,EAAW,IAAIJ,EAAS,EAAG,EAAE,EAEnC,OAAAI,EAAS,eAAe,YAAY,EAAE,WAAWJ,EAAS,KAAK,OAAQ,MAAO,EAAK,CAAC,EAE7EI,CACV,CACJ,EAED,SAAU,CACN,KAAK,iBAAgB,CACxB,EAED,QAAS,CACL,kBAAmB,CACf,KAAK,eAAc,CACtB,EAED,gBAAiB,CACb,GAAIF,EAAM,QAAQ,KAAK,UAAU,YAAY,EAAG,CAC5C,KAAK,mBAAqB,KAAK,4BAC/B,MACH,CAED,MAAMG,EAAsB,KAAK,kBAAkB,OAAO,WAAW,EAC/DD,EAAW,IAAIJ,EAAS,EAAG,EAAE,EAAE,UAAUA,EAAS,UAAU,KAAM,KAAK,UAAU,YAAY,CAAC,EAEpGK,EAAoB,OAAOD,CAAQ,EAAE,KAAME,GAAa,CACpD,KAAK,mBAAqBA,CAC1C,CAAa,CACJ,EAED,mBAAmBC,EAAY,CAC3B,KAAK,UAAU,aAAeA,EAAW,IAAKC,GACnCA,EAAU,EACpB,EAED,KAAK,eAAc,CACtB,EAED,2BAA4B,CACxB,OAAO,IAAIP,EAAiB,aAAc,YAAa,OAAO,QAAQ,IAAK,IAAID,EAAS,EAAG,EAAE,CAAC,CACjG,CACJ,CACL"}