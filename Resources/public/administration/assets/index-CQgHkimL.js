import{L as d}from"./order.types-BvKP5qzO.js";import{Y as l}from"./channel-DxwX5hMG.js";import"./administration-BlrHhDOI.js";const c=`{% block sw_order_create_details %} <div class="sw-order-create-details"> <sw-loader v-if="isLoading" /> {% block sw_order_create_details_promotion_modal %} <sw-order-create-promotion-modal v-if="showPromotionModal" :is-loading="isLoading" :currency="currency" :sales-channel-id="salesChannelId" @close="onClosePromotionModal" @save="onSavePromotionModal" /> {% endblock %} {% block sw_order_create_details_payment %} <sw-card class="sw-order-create-details__payment" position-identifier="sw-order-create-details-payment" :title="$tc('sw-order.createBase.detailsTab.labelTransactionCard')" > <sw-container class="sw_order_create-details__payment-container" gap="0px 30px" columns="1fr 1fr" > <sw-order-customer-address-select v-model:value="context.billingAddressId" :label="$tc('sw-order.createBase.labelBillingAddress')" :placeholder="$tc('sw-order.createBase.placeholderBillingAddress')" :same-address-value="context.shippingAddressId" :customer="customer" /> <sw-entity-single-select v-model:value="context.paymentMethodId" entity="payment_method" label-property="distinguishableName" class="sw_order_create-details__payment-method" :criteria="paymentMethodCriteria" :label="$tc('sw-order.createBase.labelPaymentMethod')" :placeholder="$tc('sw-order.createBase.placeholderPaymentMethod')" show-clearable-button required /> <sw-entity-single-select v-model:value="context.currencyId" class="sw_order_create-details__currency" entity="currency" :criteria="currencyCriteria" :label="$tc('sw-order.createBase.labelCurrency')" :placeholder="$tc('sw-order.createBase.placeholderCurrency')" show-clearable-button required /> </sw-container> </sw-card> {% endblock %} {% block sw_order_create_details_shipping %} <sw-card class="sw-order-create-details__shipping" position-identifier="sw-order-create-details-shipping" :title="$tc('sw-order.createBase.detailsTab.labelDeliveryCard')" > <sw-container class="sw_order_create_details__shipping-container" gap="0px 30px" columns="1fr 1fr" > <sw-order-customer-address-select v-model:value="context.shippingAddressId" :label="$tc('sw-order.createBase.labelShippingAddress')" :placeholder="$tc('sw-order.createBase.placeholderShippingAddress')" :same-address-label="$tc('sw-order.initialModal.options.textSameAsBillingAddress')" :same-address-value="context.billingAddressId" :customer="customer" /> <sw-entity-single-select v-model:value="context.shippingMethodId" show-clearable-button class="sw_order_create-details__shipping" entity="shipping_method" :criteria="shippingMethodCriteria" :label="$tc('sw-order.createBase.labelShippingMethod')" :placeholder="$tc('sw-order.createBase.placeholderShippingMethod')" required /> <sw-number-field v-model:value="shippingCosts" :label="$tc('sw-order.createBase.labelShippingCosts')" :min="0" fill-digits required > <template #suffix> {{ currency.symbol }} </template> </sw-number-field> <sw-datepicker v-model:value="deliveryDate" disabled hide-hint :label="$tc('sw-order.detailDeliveries.labelDeliveryDate')" /> </sw-container> </sw-card> {% endblock %} {% block sw_order_create_details_order %} <sw-card class="sw-order-create-details__order" position-identifier="sw-order-create-details-order" :title="$tc('sw-order.createBase.detailsTab.labelOrderCard')" > <sw-container class="sw_order_create_details__order-container" gap="0px 30px" columns="1fr 1fr" > {% block sw_order_create_details_email %} <sw-text-field v-model:value="email" disabled class="sw-order-create-details__email" :label="$tc('sw-order.createBase.labelEmail')" :placeholder="$tc('sw-order.createBase.placeholderEmail')" required /> {% endblock %} {% block sw_order_create_details_phone_number %} <sw-text-field v-model:value="phoneNumber" disabled class="sw-order-create-details__phone-number" :label="$tc('sw-order.createBase.labelPhoneNumber')" :placeholder="$tc('sw-order.createBase.placeholderPhoneNumber')" required /> {% endblock %} {% block sw_order_create_details__order_sales_channel %} <sw-entity-single-select v-model:value="salesChannelId" disabled entity="sales_channel" class="sw-order-create-options__sales-channel" :label="$tc('sw-order.createBase.labelSalesChannel')" required /> {% endblock %} {% block sw_order_create_details_order_language %} <sw-entity-single-select v-model:value="context.languageId" entity="language" class="sw-order-create-options__order-language" :criteria="languageCriteria" :label="$tc('sw-order.createBase.labelOrderLanguage')" :placeholder="$tc('sw-order.createBase.placeholderOrderLanguage')" show-clearable-button required /> {% endblock %} </sw-container> {% block sw_order_create_details_voucher_field %} <sw-order-promotion-tag-field v-model:value="promotionCodeTags" :disabled="!hasLineItem" :currency="currency" :label="$tc('sw-order.createBase.labelAddPromotion')" :placeholder="$tc('sw-order.createBase.placeholderAddPromotion')" :error="promotionError" @on-remove-code="onRemoveExistingCode" /> {% endblock %} {% block sw_order_create_details_switch_disable_auto_promotion %} <sw-switch-field class="sw-order-create-details__disable-auto-promotion" :value="disabledAutoPromotion" :label="$tc('sw-order.createBase.labelToggleAutomaticPromotions')" @update:value="toggleAutomaticPromotions" /> {% endblock %} </sw-card> {% endblock %} </div> {% endblock %}`,{Component:h,Mixin:n,State:r}=Cicada,{Criteria:a}=Cicada.Data,g=h.wrapComponentConfig({template:c,compatConfig:Cicada.compatConfig,inject:["repositoryFactory","cartStoreService"],mixins:[n.getByName("notification"),n.getByName("cart-notification")],data(){return{showPromotionModal:!1,promotionError:null,isLoading:!1,context:{currencyId:"",paymentMethodId:"",shippingMethodId:"",languageId:"",billingAddressId:"",shippingAddressId:""}}},computed:{salesChannelId(){var e;return((e=this.salesChannelContext)==null?void 0:e.salesChannel.id)||""},customer(){return r.get("swOrder").customer},cart(){return r.get("swOrder").cart},currency(){return r.get("swOrder").context.currency},salesChannelContext(){return r.get("swOrder").context},email(){var e;return((e=this.customer)==null?void 0:e.email)||""},phoneNumber(){var e,t;return((t=(e=this.customer)==null?void 0:e.defaultBillingAddress)==null?void 0:t.phoneNumber)||""},cartDelivery(){return l(this.cart,"deliveries[0]",null)},shippingCosts:{get(){var e;return((e=this.cartDelivery)==null?void 0:e.shippingCosts.totalPrice)||0},set(e){this.modifyShippingCosts(e)}},deliveryDate(){var e;return((e=this.cartDelivery)==null?void 0:e.deliveryDate.earliest)||""},shippingMethodCriteria(){const e=new a(1,25);return e.addFilter(a.equals("salesChannels.id",this.salesChannelId)),e},paymentMethodCriteria(){const e=new a(1,25);return e.addFilter(a.equals("salesChannels.id",this.salesChannelId)),e.addFilter(a.equals("active",1)),e},languageCriteria(){const e=new a(1,25);return e.addFilter(a.equals("salesChannels.id",this.salesChannelId)),e},currencyCriteria(){const e=new a(1,25);return e.addFilter(a.equals("salesChannels.id",this.salesChannelId)),e},currencyRepository(){return this.repositoryFactory.create("currency")},isCartTokenAvailable(){return r.getters["swOrder/isCartTokenAvailable"]},hasLineItem(){var e;return((e=this.cart)==null?void 0:e.lineItems.filter(t=>t.hasOwnProperty("id")).length)>0},promotionCodeLineItems(){var e;return(e=this.cart)==null?void 0:e.lineItems.filter(t=>{var s;return t.type===d.PROMOTION&&((s=t==null?void 0:t.payload)==null?void 0:s.code)})},disabledAutoPromotion(){return r.get("swOrder").disabledAutoPromotion},promotionCodeTags:{get(){return r.get("swOrder").promotionCodes},set(e){r.commit("swOrder/setPromotionCodes",e)}}},watch:{context:{deep:!0,handler(){!this.customer||!this.isCartTokenAvailable||(this.isLoading=!0,this.updateContext().finally(()=>{this.isLoading=!1}))}},cart:{deep:!0,immediate:!0,handler:"updatePromotionList"},promotionCodeTags:{handler:"handlePromotionCodeTags"},"context.languageId"(e){e&&r.commit("context/setLanguageId",e)}},created(){this.createdComponent()},methods:{createdComponent(){var e,t,s,o;this.customer||this.$nextTick(()=>{this.$router.push({name:"sw.order.create.initial"})}),this.context={...this.context,currencyId:this.salesChannelContext.context.currencyId,languageId:this.salesChannelContext.context.languageIdChain[0],shippingMethodId:this.salesChannelContext.shippingMethod.id,paymentMethodId:this.salesChannelContext.paymentMethod.id,billingAddressId:((t=(e=this.salesChannelContext.customer)==null?void 0:e.activeBillingAddress)==null?void 0:t.id)??"",shippingAddressId:((o=(s=this.salesChannelContext.customer)==null?void 0:s.activeShippingAddress)==null?void 0:o.id)??""}},updateContext(){var e;return r.dispatch("swOrder/updateOrderContext",{context:this.context,salesChannelId:(e=this.customer)==null?void 0:e.salesChannelId,contextToken:this.cart.token}).then(()=>this.loadCart())},loadCart(){var e;return r.dispatch("swOrder/getCart",{salesChannelId:(e=this.customer)==null?void 0:e.salesChannelId,contextToken:this.cart.token})},onRemoveExistingCode(e){return e.isInvalid?(this.promotionCodeTags=this.promotionCodeTags.filter(t=>t.code!==e.code),Promise.resolve()):this.onRemoveItems([e.discountId])},onRemoveItems(e){var t;return this.isLoading=!0,r.dispatch("swOrder/removeLineItems",{salesChannelId:(t=this.customer)==null?void 0:t.salesChannelId,contextToken:this.cart.token,lineItemKeys:e}).then(()=>{e.forEach(s=>{const o=this.promotionCodeTags.find(i=>i.discountId===s);o&&(this.promotionCodeTags=this.promotionCodeTags.filter(i=>i.discountId!==o.discountId))})}).finally(()=>{this.isLoading=!1})},updatePromotionList(){this.promotionCodeTags=this.promotionCodeTags.map(e=>{const t=this.promotionCodeLineItems.find(s=>{var o;return((o=s.payload)==null?void 0:o.code)===e.code});return t?{...t.payload,isInvalid:!1}:{...e,isInvalid:!0}}),this.promotionCodeLineItems.forEach(e=>{this.promotionCodeTags.find(s=>{var o;return s.code===((o=e.payload)==null?void 0:o.code)})||(this.promotionCodeTags=[...this.promotionCodeTags,{...e.payload,isInvalid:!1}])})},toggleAutomaticPromotions(e){if(this.showPromotionModal=e,e){r.commit("swOrder/setDisabledAutoPromotion",!0);return}this.isLoading=!0,this.cartStoreService.enableAutomaticPromotions(this.cart.token,{salesChannelId:this.salesChannelId}).then(()=>(r.commit("swOrder/setDisabledAutoPromotion",!1),this.loadCart())).finally(()=>{this.isLoading=!1})},onClosePromotionModal(){this.showPromotionModal=!1,r.commit("swOrder/setDisabledAutoPromotion",!1)},onSavePromotionModal(){return this.showPromotionModal=!1,r.commit("swOrder/setDisabledAutoPromotion",!0),this.loadCart().finally(()=>{this.isLoading=!1})},modifyShippingCosts(e){const t=Math.abs(e);this.cartDelivery&&(this.cartDelivery.shippingCosts.unitPrice=t,this.cartDelivery.shippingCosts.totalPrice=t,this.isLoading=!0,r.dispatch("swOrder/modifyShippingCosts",{salesChannelId:this.salesChannelId,contextToken:this.cart.token,shippingCosts:this.cartDelivery.shippingCosts}).catch(s=>{this.$emit("error",s)}).finally(()=>{this.isLoading=!1}))},handlePromotionCodeTags(e,t){if(this.promotionError=null,e.length<t.length)return;const s=this.promotionCodeTags.length,o=this.promotionCodeTags[s-1];e.length>t.length&&this.onSubmitCode(o.code),s>0&&o.isInvalid&&(this.promotionError={detail:this.$tc("sw-order.createBase.textInvalidPromotionCode")})},onSubmitCode(e){var t;return this.isLoading=!0,r.dispatch("swOrder/addPromotionCode",{salesChannelId:(t=this.customer)==null?void 0:t.salesChannelId,contextToken:this.cart.token,code:e}).finally(()=>{this.isLoading=!1})}}});export{g as default};
//# sourceMappingURL=index-CQgHkimL.js.map
