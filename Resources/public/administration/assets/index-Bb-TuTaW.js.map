{"version":3,"file":"index-Bb-TuTaW.js","sources":["../../../app/administration/src/module/sw-settings-country/component/sw-settings-country-currency-dependent-modal/sw-settings-country-currency-dependent-modal.html.twig","../../../app/administration/src/module/sw-settings-country/component/sw-settings-country-currency-dependent-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_settings_country_currency_dependent_modal %}\n<sw-modal\n    class=\"sw-settings-country-currency-dependent-modal\"\n    :title=\"$tc('sw-settings-country.detail.currencyDependentValues')\"\n    @modal-close=\"closeModal\"\n>\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_country_currency_dependent_modal_content %}\n    <sw-data-grid\n        class=\"sw-settings-country-currency-dependent-modal__grid\"\n        :data-source=\"currencyDependsValue\"\n        :is-loading=\"isLoading\"\n        :show-selection=\"false || undefined\"\n        :plain-appearance=\"true\"\n        :columns=\"countryCurrencyColumns\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_country_currency_dependent_modal_content_hamburger_menu %}\n        <template #customSettings>\n            <sw-settings-country-currency-hamburger-menu\n                :options=\"menuOptions\"\n                @currency-change=\"changeCurrencyDependentRow\"\n            />\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block  sw_settings_country_currency_dependent_modal_content_currency_name %}\n        <template #column-currencyId=\"{ item }\">\n            <div class=\"sw-settings-country-currency-dependent-modal__inheritance-wrapper\">\n                <!-- eslint-disable-next-line vuejs-accessibility/label-has-for -->\n                <label>{{ getCurrencyNameById(item.currencyId) }}</label>\n            </div>\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_country_currency_dependent_grid_column_value %}\n        <template #column-amount=\"{ item }\">\n            <sw-number-field\n                v-model:value=\"item.amount\"\n                class=\"sw-settings-country-currency-dependent-modal__input\"\n                :min=\"0\"\n                :disabled=\"(!item.enabled || !acl.can('country.editor')) || undefined\"\n                @update:value=\"reCalculatorInherited(item)\"\n            />\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_country_currency_dependent_grid_column_is_base_currency %}\n        <template #column-enabled=\"{ item }\">\n            <sw-radio-field\n                :value=\"checkBox\"\n                :name=\"radioButtonName\"\n                :options=\"[{ value: item.enabled }]\"\n                :disabled=\"!acl.can('country.editor') || undefined\"\n                @update:value=\"onChangeBaseCurrency(item)\"\n            />\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_country_currency_dependent_column_actions %}\n        <template #actions=\"{ item }\">\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_country_currency_dependent_grid_column_action_delete %}\n            <sw-context-menu-item\n                variant=\"danger\"\n                :disabled=\"(item.enabled || !acl.can('country.editor')) || undefined\"\n                @click=\"changeCurrencyDependentRow(item.currencyId, false)\"\n            >\n                {{ $tc('global.default.delete') }}\n            </sw-context-menu-item>\n            {% endblock %}\n\n        </template>\n        {% endblock %}\n\n    </sw-data-grid>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_country_currency_dependent_modal_footer %}\n    <template #modal-footer>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_country_currency_dependent_modal_close %}\n        <sw-button\n            class=\"sw-settings-country-currency-dependent-modal__cancel-button\"\n            size=\"small\"\n            :disabled=\"!acl.can('country.editor') || undefined\"\n            @click=\"closeModal\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n\n        <sw-button\n            class=\"sw-settings-country-currency-dependent-modal__save-button\"\n            variant=\"primary\"\n            size=\"small\"\n            :disabled=\"!acl.can('country.editor') || undefined\"\n            @click=\"saveModal\"\n        >\n            {{ $tc('global.default.save') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n","/**\n * @package buyers-experience\n */\nimport template from './sw-settings-country-currency-dependent-modal.html.twig';\nimport './sw-settings-country-currency-dependent-modal.scss';\n\nconst utils = Cicada.Utils;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n    ],\n\n    emits: [\n        'modal-close',\n        'modal-save',\n        'base-item-change',\n    ],\n\n    props: {\n        currencyDependsValue: {\n            type: Array,\n            required: true,\n        },\n        countryId: {\n            type: String,\n            required: true,\n        },\n        userConfig: {\n            type: Object,\n            required: true,\n        },\n        userConfigValues: {\n            type: Object,\n            required: true,\n        },\n        menuOptions: {\n            type: Array,\n            required: true,\n        },\n        taxFreeType: {\n            type: String,\n            required: false,\n            default: '',\n        },\n        isLoading: {\n            type: Boolean,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            inputId: utils.createId(),\n            checkBox: true,\n            basedItem: {},\n        };\n    },\n\n    computed: {\n        currentUserId() {\n            return Cicada.State.get('session').currentUser.id;\n        },\n\n        currencyTaxFreeDependentRepository() {\n            return this.repositoryFactory.create('country_currency_tax_free_dependent_value');\n        },\n\n        radioButtonName() {\n            return `sw-settings-country-currency-dependent-modal-boolean-radio-${this.inputId}`;\n        },\n\n        countryCurrencyColumns() {\n            return [\n                {\n                    property: 'currencyId',\n                    label: '',\n                    inlineEdit: 'string',\n                    primary: true,\n                },\n                {\n                    property: 'amount',\n                    label: this.$tc('sw-settings-country.detail.taxFreeFrom'),\n                    inlineEdit: 'string',\n                    primary: true,\n                },\n                {\n                    property: 'enabled',\n                    label: this.$tc('sw-settings-country.detail.baseCurrency'),\n                    inlineEdit: 'string',\n                },\n            ];\n        },\n    },\n\n    methods: {\n        closeModal() {\n            this.$emit('modal-close');\n        },\n\n        saveModal() {\n            this.createUserConfigValue();\n            this.closeModal();\n            this.$emit('modal-save');\n        },\n\n        changeCurrencyDependentRow(currencyId, isChecked) {\n            if (isChecked) {\n                this.addCurrencyDependentRow(currencyId);\n                return;\n            }\n            this.removeCurrencyDependentRow(currencyId);\n        },\n\n        addCurrencyDependentRow(currencyId) {\n            const taxFreeDependent = {\n                amount: this.calculateInheritedPrice(currencyId),\n                enabled: false,\n                currencyId: currencyId,\n            };\n\n            this.currencyDependsValue.push(taxFreeDependent);\n        },\n\n        removeCurrencyDependentRow(currencyId) {\n            const currencyDependentRemoval = this.currencyDependsValue.find((value) => {\n                return value.currencyId === currencyId;\n            });\n\n            if (!currencyDependentRemoval) {\n                return;\n            }\n\n            this.currencyDependsValue.splice(this.currencyDependsValue.indexOf(currencyDependentRemoval), 1);\n\n            if (this.userConfigValues[this.taxFreeType]) {\n                this.userConfigValues[this.taxFreeType].splice(\n                    this.userConfigValues[this.taxFreeType].indexOf(currencyId),\n                    1,\n                );\n            }\n            this.updateCheckBoxHamburgerMenu(currencyId);\n        },\n\n        updateCheckBoxHamburgerMenu(currencyId) {\n            this.menuOptions.forEach((currency) => {\n                if (currency.id === currencyId) {\n                    currency.checked = false;\n                }\n            });\n        },\n\n        onChangeBaseCurrency(item) {\n            item.enabled = true;\n\n            this.currencyDependsValue.forEach((value) => {\n                value.enabled = value.currencyId === item.currencyId;\n            });\n\n            if (this.userConfigValues[this.taxFreeType]) {\n                this.userConfigValues[this.taxFreeType].splice(\n                    this.userConfigValues[this.taxFreeType].indexOf(item.currencyId),\n                    1,\n                );\n            }\n\n            this.menuOptions.forEach((currency) => {\n                currency.disabled = currency.id === item.currencyId;\n            });\n\n            this.checkBox = true;\n            this.basedItem = item;\n            this.$emit('base-item-change', this.basedItem);\n        },\n\n        calculateInheritedPrice(currencyId) {\n            const basePrice = this.currencyDependsValue.find((value) => {\n                return value.enabled === true;\n            });\n\n            if (!basePrice) {\n                return 0;\n            }\n            return this.getPriceByCurrency(basePrice, currencyId);\n        },\n\n        reCalculatorInherited(basePrice) {\n            this.currencyDependsValue.forEach((item) => {\n                if (item.enabled === false) {\n                    item.amount = this.getPriceByCurrency(basePrice, item.currencyId);\n                }\n            });\n        },\n\n        getPriceByCurrency(basePrice, currencyId) {\n            const currency = this.getCurrencyById(currencyId);\n            const currencyBaseItem = this.getCurrencyById(basePrice.currencyId);\n            if (!currency.factor || !currencyBaseItem.factor) {\n                return 0;\n            }\n\n            return (basePrice.amount / currencyBaseItem.factor) * currency.factor;\n        },\n\n        createUserConfigValue() {\n            if (this.userConfig.isNew()) {\n                return this.createNewUserConfig();\n            }\n            return this.updateExistedValue();\n        },\n\n        createNewUserConfig() {\n            this.userConfig.value = {\n                [this.countryId]: {\n                    [this.taxFreeType]: [],\n                },\n            };\n\n            this.currencyDependsValue.forEach((value) => {\n                if (!value.enabled) {\n                    this.userConfig.value[this.countryId][this.taxFreeType].push(value.currencyId);\n                }\n            });\n        },\n\n        updateExistedValue() {\n            let valuesUserConfig = this.userConfigValues[this.taxFreeType];\n            if (!valuesUserConfig) {\n                this.userConfigValues[this.taxFreeType] = [];\n                valuesUserConfig = this.userConfigValues[this.taxFreeType];\n            }\n\n            this.currencyDependsValue.forEach((value) => {\n                if (!value.enabled) {\n                    valuesUserConfig.push(value.currencyId);\n                }\n            });\n\n            this.userConfig.value[this.countryId][this.taxFreeType] = [\n                ...new Set(valuesUserConfig),\n            ];\n        },\n\n        getCurrencyNameById(currencyId) {\n            const currency = this.menuOptions.find((checkBoxCurrency) => {\n                return checkBoxCurrency.id === currencyId;\n            });\n\n            return currency?.name ?? '';\n        },\n\n        getCurrencyById(currencyId) {\n            const currency = this.menuOptions.find((checkBoxCurrency) => {\n                return checkBoxCurrency.id === currencyId;\n            });\n\n            return currency || {};\n        },\n    },\n};\n"],"names":["template","utils","index","currencyId","isChecked","taxFreeDependent","currencyDependentRemoval","value","currency","item","basePrice","currencyBaseItem","valuesUserConfig","checkBoxCurrency"],"mappings":"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"}