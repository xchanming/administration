const s=`{% block sw_product_clone_modal %} <sw-modal v-if="cloningVariants" :title="$tc('sw-product.general.cloneTitle')" :closable="false" variant="small" class="clone-variant__modal" > {% block sw_product_clone_modal_description %} <div class="clone-variant__description"> {{ $tc('sw-product.general.cloneNotice') }} </div> {% endblock %} {% block sw_product_clone_modal_progress_bar %} <sw-progress-bar class="clone-variant-progress-bar" :value="progressInPercentage" /> {% endblock %} {% block sw_product_clone_modal_progress_bar_description %} <div class="clone-variant-progress-bar__description"> {{ cloneProgress }} {{ $tc('sw-product.variations.progressTypeOf') }} {{ cloneMaxProgress }} {{ $tc('sw-product.general.cloneSuffix') }} </div> {% endblock %} </sw-modal> {% endblock %}`,{Criteria:n}=Shopware.Data,a={template:s,inject:["repositoryFactory","numberRangeService"],emits:["clone-finish"],props:{product:{type:Object,required:!0}},data(){return{cloningVariants:!1,cloneMaxProgress:0,cloneProgress:0}},computed:{progressInPercentage(){return 100/(this.cloneMaxProgress*this.cloneProgress)},repository(){return this.repositoryFactory.create("product")}},created(){this.createdComponent()},methods:{createdComponent(){this.duplicate()},duplicate(){this.numberRangeService.reserve("product").then(this.cloneParent).then(this.verifyVariants)},async cloneParent(r){const e=this.product.variantListingConfig;e&&e.mainVariantId&&(e.mainVariantId=null);const t={cloneChildren:!1,overwrites:{productNumber:r.number,name:`${this.product.name} ${this.$tc("global.default.copy")}`,active:!1,mainVariantId:null,variantListingConfig:e}};return await this.repository.save(this.product),{id:(await this.repository.clone(this.product.id,t,Shopware.Context.api)).id,productNumber:r.number}},verifyVariants(r){this.getChildrenIds().then(e=>{if(e.length<=0){this.$emit("clone-finish",{id:r.id});return}this.cloningVariants=!0,this.cloneProgress=1,this.cloneMaxProgress=e.length,this.duplicateVariant(r,e,()=>{this.cloningVariants=!1,this.$emit("clone-finish",{id:r.id})})})},getChildrenIds(){const r=new n(1,null);return r.addFilter(n.equals("parentId",this.product.id)),this.repository.searchIds(r).then(e=>e.data)},duplicateVariant(r,e,t){if(e.length<=0){t();return}const o=e.shift(),i={overwrites:{parentId:r.id,productNumber:`${r.productNumber}.${this.cloneProgress}`},cloneChildren:!1};this.repository.clone(o,i,Shopware.Context.api).then(()=>{this.cloneProgress+=1,this.duplicateVariant(r,e,t)})}}};export{a as default};
