{"version":3,"file":"index-CkaEB_dH.js","sources":["../../../app/administration/src/module/sw-settings-salutation/page/sw-settings-salutation-detail/sw-settings-salutation-detail.html.twig","../../../app/administration/src/module/sw-settings-salutation/page/sw-settings-salutation-detail/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_settings_salutation_detail %}\n<sw-page class=\"sw-settings-salutation-detail\">\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_salutation_detail_search_bar %}\n    <template #search-bar></template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_salutation_detail_smart_bar_header %}\n    <template #smart-bar-header>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_salutation_detail_smart_bar_header_title %}\n        <h2>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_salutation_detail_smart_bar_header_title_text %}\n            {{ placeholder(salutation, 'salutationKey', $tc('sw-settings-salutation.detail.placeholderNewSalutation')) }}\n            {% endblock %}\n        </h2>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_salutation_detail_language_switch %}\n    <template #language-switch>\n        <sw-language-switch\n            :disabled=\"salutationId == null || undefined\"\n            @on-change=\"onChangeLanguage\"\n        />\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_salutation_detail_actions %}\n    <template #smart-bar-actions>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_salutation_detail_actions_cancel %}\n        <sw-button\n            v-tooltip.bottom=\"tooltipCancel\"\n            class=\"sw-settings-salutation-detail__cancel\"\n            @click=\"onCancel\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_salutation_detail_actions_save %}\n        <sw-button-process\n            v-tooltip.bottom=\"tooltipSave\"\n            class=\"sw-settings-salutation-detail__save\"\n            :is-loading=\"isLoading\"\n            :process-success=\"isSaveSuccessful\"\n            :disabled=\"invalidKey || isKeyChecking || !allowSave || undefined\"\n            variant=\"primary\"\n            @update:process-success=\"saveFinish\"\n            @click=\"onSave\"\n        >\n            {{ $tc('sw-settings-salutation.general.buttonSave') }}\n        </sw-button-process>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_salutation_detail_cardview %}\n    <template #content>\n        <sw-card-view>\n            <sw-skeleton v-if=\"isLoading\" />\n\n            <template v-else>\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_salutation_detail_content_language_info %}\n                <sw-language-info :entity-description=\"entityDescription\" />\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_salutation_detail_content_card %}\n                <sw-card\n                    position-identifier=\"sw-settings-salutation-detail-content\"\n                    :is-loading=\"isLoading\"\n                    :title=\"$tc('sw-settings-salutation.detail.cardTitle')\"\n                >\n\n                    <template v-if=\"salutation\">\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_settings_salutation_detail_content_card_salutation_key %}\n                        <sw-text-field\n                            v-model:value=\"salutation.salutationKey\"\n                            name=\"sw-field--salutation-salutationKey\"\n                            class=\"sw-settings-salutation-detail__salutation_key\"\n                            :label=\"$tc('sw-settings-salutation.detail.fieldSalutationKeyLabel')\"\n                            :placeholder=\"$tc('sw-settings-salutation.detail.fieldSalutationKeyPlaceholder')\"\n                            :help-text=\"$tc('sw-settings-salutation.detail.fieldSalutationKeyTooltip')\"\n                            :error=\"salutationSalutationKeyError\"\n                            validation=\"required\"\n                            required\n                            :disabled=\"!acl.can('salutation.editor') || undefined\"\n                            @update:value=\"onChange\"\n                        />\n                        {% endblock %}\n\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_settings_salutation_detail_content_card_display_name %}\n                        <sw-text-field\n                            v-model:value=\"salutation.displayName\"\n                            name=\"sw-field--salutation-displayName\"\n                            required\n                            class=\"sw-settings-salutation-detail__displayName\"\n                            :label=\"$tc('sw-settings-salutation.detail.fieldDisplayNameLabel')\"\n                            :error=\"salutationDisplayNameError\"\n                            :disabled=\"!acl.can('salutation.editor') || undefined\"\n                            :placeholder=\"placeholder(salutation, 'displayName', $tc('sw-settings-salutation.detail.fieldDisplayNamePlaceholder'))\"\n                        />\n                        {% endblock %}\n\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_settings_salutation_detail_content_card_letter_name %}\n                        <sw-text-field\n                            v-model:value=\"salutation.letterName\"\n                            name=\"sw-field--salutation-letterName\"\n                            required\n                            class=\"sw-settings-salutation-detail__letterName\"\n                            :label=\"$tc('sw-settings-salutation.detail.fieldLetterNameLabel')\"\n                            :error=\"salutationLetterNameError\"\n                            :disabled=\"!acl.can('salutation.editor') || undefined\"\n                            :placeholder=\"placeholder(salutation, 'letterName', $tc('sw-settings-salutation.detail.fieldLetterNamePlaceholder'))\"\n                        />\n                        {% endblock %}\n                    </template>\n                </sw-card>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_salutation_detail_custom_field_sets %}\n                <sw-card\n                    v-if=\"showCustomFields\"\n                    position-identifier=\"sw-settings-salutation-detail-custom-fields\"\n                    :title=\"$tc('sw-settings-custom-field.general.mainMenuItemGeneral')\"\n                    :is-loading=\"isLoading\"\n                >\n                    <sw-custom-field-set-renderer\n                        :entity=\"salutation\"\n                        :disabled=\"!acl.can('salutation.editor') || undefined\"\n                        :sets=\"customFieldSets\"\n                    />\n                </sw-card>\n                {% endblock %}\n            </template>\n        </sw-card-view>\n    </template>\n    {% endblock %}\n\n</sw-page>\n{% endblock %}\n","/**\n * @package checkout\n */\nimport template from './sw-settings-salutation-detail.html.twig';\n\nconst { Mixin } = Cicada;\nconst { Criteria } = Cicada.Data;\nconst CicadaError = Cicada.Classes.CicadaError;\nconst { mapPropertyErrors } = Cicada.Component.getComponentHelper();\nconst utils = Cicada.Utils;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n        'customFieldDataProviderService',\n    ],\n\n    mixins: [\n        Mixin.getByName('notification'),\n        Mixin.getByName('placeholder'),\n        Mixin.getByName('discard-detail-page-changes')('salutation'),\n    ],\n\n    props: {\n        salutationId: {\n            type: String,\n            required: false,\n            default: null,\n        },\n    },\n\n    shortcuts: {\n        'SYSTEMKEY+S': {\n            active() {\n                return this.allowSave;\n            },\n            method: 'onSave',\n        },\n\n        ESCAPE: 'onCancel',\n    },\n\n    data() {\n        return {\n            entityName: 'salutation',\n            isLoading: false,\n            salutation: null,\n            invalidKey: false,\n            isKeyChecking: false,\n            isSaveSuccessful: false,\n            customFieldSets: null,\n        };\n    },\n\n    metaInfo() {\n        return {\n            title: this.$createTitle(this.identifier),\n        };\n    },\n\n    computed: {\n        identifier() {\n            return this.placeholder(this.salutation, 'displayName');\n        },\n\n        salutationRepository() {\n            return this.repositoryFactory.create('salutation');\n        },\n\n        entityDescription() {\n            return this.placeholder(\n                this.salutation,\n                'salutationKey',\n                this.$tc('sw-settings-salutation.detail.placeholderNewSalutation'),\n            );\n        },\n\n        invalidKeyError() {\n            if (this.invalidKey && !this.isKeyChecking) {\n                return new CicadaError({ code: 'DUPLICATED_SALUTATION_KEY' });\n            }\n            return null;\n        },\n\n        allowSave() {\n            return this.salutation && this.salutation.isNew()\n                ? this.acl.can('salutation.creator')\n                : this.acl.can('salutation.editor');\n        },\n\n        tooltipSave() {\n            if (!this.allowSave) {\n                return {\n                    message: this.$tc('sw-privileges.tooltip.warning'),\n                    disabled: this.allowSave,\n                    showOnDisabledElements: true,\n                };\n            }\n\n            const systemKey = this.$device.getSystemKey();\n\n            return {\n                message: `${systemKey} + S`,\n                appearance: 'light',\n            };\n        },\n\n        tooltipCancel() {\n            return {\n                message: 'ESC',\n                appearance: 'light',\n            };\n        },\n\n        ...mapPropertyErrors('salutation', [\n            'displayName',\n            'letterName',\n            'salutationKey',\n        ]),\n\n        showCustomFields() {\n            return this.salutation && this.customFieldSets && this.customFieldSets.length > 0;\n        },\n    },\n\n    watch: {\n        salutationId() {\n            if (!this.salutationId) {\n                this.createdComponent();\n            }\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.isLoading = true;\n            if (this.salutationId) {\n                this.salutationRepository.get(this.salutationId).then((salutation) => {\n                    this.salutation = salutation;\n                    this.isLoading = false;\n                });\n                this.loadCustomFieldSets();\n                return;\n            }\n\n            Cicada.State.commit('context/resetLanguageToDefault');\n            this.salutation = this.salutationRepository.create();\n            this.isLoading = false;\n        },\n\n        loadCustomFieldSets() {\n            this.customFieldDataProviderService.getCustomFieldSets('salutation').then((sets) => {\n                this.customFieldSets = sets;\n            });\n        },\n\n        onChangeLanguage() {\n            this.createdComponent();\n        },\n\n        saveFinish() {\n            this.isSaveSuccessful = false;\n        },\n\n        onSave() {\n            this.isLoading = true;\n            this.isSaveSuccessful = false;\n\n            return this.salutationRepository\n                .save(this.salutation)\n                .then(() => {\n                    this.isSaveSuccessful = true;\n                    if (!this.salutationId) {\n                        this.$router.push({\n                            name: 'sw.settings.salutation.detail',\n                            params: { id: this.salutation.id },\n                        });\n                    }\n\n                    this.salutationRepository.get(this.salutation.id).then((updatedSalutation) => {\n                        this.salutation = updatedSalutation;\n                        this.isLoading = false;\n                    });\n                })\n                .catch(() => {\n                    this.isLoading = false;\n\n                    this.createNotificationError({\n                        title: this.$tc('global.default.error'),\n                        message: this.$tc('sw-settings-salutation.detail.notificationErrorMessage'),\n                    });\n                });\n        },\n\n        onCancel() {\n            this.$router.push({ name: 'sw.settings.salutation.index' });\n        },\n\n        onChange() {\n            this.isKeyChecking = true;\n            this.onChangeDebounce();\n        },\n\n        onChangeDebounce: utils.debounce(function executeChange() {\n            if (!this.salutation) {\n                return;\n            }\n\n            if (typeof this.salutation.salutationKey !== 'string' || this.salutation.salutationKey.trim() === '') {\n                this.invalidKey = false;\n                this.isKeyChecking = false;\n                return;\n            }\n\n            const criteria = new Criteria(1, 1);\n            criteria.addFilter(\n                Criteria.multi('AND', [\n                    Criteria.equals('salutationKey', this.salutation.salutationKey),\n                    Criteria.not('AND', [\n                        Criteria.equals('id', this.salutation.id),\n                    ]),\n                ]),\n            );\n\n            this.salutationRepository\n                .search(criteria)\n                .then(({ total }) => {\n                    this.invalidKey = total > 0;\n                    this.isKeyChecking = false;\n                })\n                .catch(() => {\n                    this.invalidKey = true;\n                    this.isKeyChecking = false;\n                });\n        }, 500),\n    },\n};\n"],"names":["template","Mixin","Criteria","CicadaError","mapPropertyErrors","utils","index","salutation","sets","updatedSalutation","criteria","total"],"mappings":"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"}