{"version":3,"file":"index-CGr26bei.js","sources":["../../../app/administration/src/app/asyncComponent/media/sw-media-list-selection-v2/sw-media-list-selection-v2.html.twig","../../../app/administration/src/app/asyncComponent/media/sw-media-list-selection-v2/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_media_list_selection_v2 %}\n<div class=\"sw-media-list-selection-v2\">\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_media_list_selection_v2_upload %}\n    <sw-upload-listener\n        :upload-tag=\"uploadId\"\n        @media-upload-add=\"onUploadsAdded\"\n        @media-upload-finish=\"successfulUpload\"\n        @media-upload-fail=\"onUploadFailed\"\n    />\n\n    <sw-media-upload-v2\n        :upload-tag=\"uploadId\"\n        variant=\"regular\"\n        :default-folder=\"defaultFolderName\"\n        @media-upload-sidebar-open=\"onMediaUploadButtonOpenSidebar\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_media_list_selection_v2_grid %}\n    <div\n        ref=\"grid\"\n        class=\"sw-media-list-selection-v2__grid\"\n        :style=\"gridAutoRows\"\n    >\n        <sw-loader v-if=\"entity.isLoading\" />\n        {%  block sw_media_list_selection_v2_grid_items %}\n        <sw-media-list-selection-item-v2\n            v-for=\"(mediaItem, i) in mediaItems\"\n            :key=\"mediaItem?.url\"\n            v-draggable=\"{ dragGroup: 'media-items', data: mediaItem, onDragEnter: onDeboundDragDrop }\"\n            v-droppable=\"{ dragGroup: 'media-items', data: mediaItem }\"\n            :item=\"mediaItem\"\n            @item-remove=\"removeItem(mediaItem, i)\"\n        />\n        {% endblock %}\n    </div>\n    {% endblock %}\n</div>\n{% endblock %}\n","import template from './sw-media-list-selection-v2.html.twig';\nimport './sw-media-list-selection-v2.scss';\n\nconst { Mixin, Context } = Cicada;\nconst utils = Cicada.Utils;\n\n/**\n * @package content\n */\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'mediaService',\n    ],\n\n    emits: [\n        'open-sidebar',\n        'upload-finish',\n        'item-sort',\n        'item-remove',\n    ],\n\n    mixins: [\n        Mixin.getByName('notification'),\n    ],\n\n    props: {\n        entity: {\n            type: Object,\n            required: true,\n        },\n\n        entityMediaItems: {\n            type: Array,\n            required: true,\n        },\n\n        uploadTag: {\n            type: String,\n            required: false,\n            default: null,\n        },\n\n        defaultFolderName: {\n            type: String,\n            required: false,\n            default: null,\n        },\n    },\n\n    data() {\n        return {\n            columnCount: 8,\n            columnWidth: '90px',\n        };\n    },\n\n    computed: {\n        mediaRepository() {\n            return this.repositoryFactory.create('media');\n        },\n\n        currentCount() {\n            return this.entityMediaItems.length;\n        },\n\n        mediaItems() {\n            // two rows with columnCount columns\n            const columnCount = this.columnCount * 2;\n            if (this.currentCount >= columnCount) {\n                return this.entityMediaItems;\n            }\n\n            const items = [...this.entityMediaItems];\n            items.splice(this.currentCount, 0, ...this.createPlaceholders(columnCount - this.currentCount));\n            items.forEach((item, index) => {\n                item.position = index;\n            });\n            return items;\n        },\n\n        gridAutoRows() {\n            return `grid-auto-rows: ${this.columnWidth}`;\n        },\n\n        uploadId() {\n            return this.uploadTag || this.entity.id;\n        },\n\n        defaultFolder() {\n            return this.defaultFolderName || this.entity.getEntityName();\n        },\n    },\n\n    mounted() {\n        this.mountedComponent();\n    },\n\n    methods: {\n        mountedComponent() {\n            this.$device.onResize({\n                listener: this.updateColumnCount,\n                component: this,\n            });\n            this.updateColumnCount();\n        },\n\n        updateColumnCount() {\n            this.$nextTick(() => {\n                const cssColumns = window\n                    .getComputedStyle(this.$refs.grid, null)\n                    .getPropertyValue('grid-template-columns')\n                    .split(' ');\n                this.columnCount = cssColumns.length;\n                this.columnWidth = cssColumns[0];\n            });\n        },\n\n        createPlaceholders(count) {\n            return new Array(count).fill({\n                isPlaceholder: true,\n                media: {\n                    isPlaceholder: true,\n                    name: '',\n                },\n                mediaId: this.currentCount,\n            });\n        },\n\n        async onUploadsAdded({ data }) {\n            if (data.length === 0) {\n                return;\n            }\n\n            this.entity.isLoading = true;\n\n            await this.mediaService.runUploads(this.uploadId);\n            this.entity.isLoading = false;\n        },\n\n        onMediaUploadButtonOpenSidebar() {\n            this.$emit('open-sidebar');\n        },\n\n        async successfulUpload({ targetId }) {\n            const mediaItem = await this.mediaRepository.get(targetId, Context.api);\n            this.$forceUpdate();\n            this.$emit('upload-finish', mediaItem);\n        },\n\n        onUploadFailed(uploadTask) {\n            const toRemove = this.mediaItems.find((media) => {\n                return media.mediaId === uploadTask.targetId;\n            });\n\n            if (toRemove) {\n                this.removeItem(toRemove);\n            }\n\n            this.entity.isLoading = false;\n        },\n\n        onMediaItemDragSort(dragData, dropData, validDrop) {\n            if (validDrop !== true || dropData.position > this.currentCount || dragData.position > this.currentCount) {\n                return;\n            }\n            this.$emit('item-sort', dragData, dropData);\n        },\n\n        onDeboundDragDrop: utils.debounce(function debouncedDragDrop(dragData, dropData, validDrop) {\n            this.onMediaItemDragSort(dragData, dropData, validDrop);\n        }, 500),\n\n        removeItem(mediaItem, index) {\n            this.$emit('item-remove', mediaItem, index);\n        },\n    },\n};\n"],"names":["template","Mixin","Context","utils","index","columnCount","items","item","cssColumns","count","data","targetId","mediaItem","uploadTask","toRemove","media","dragData","dropData","validDrop"],"mappings":"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"}