const o=`{% block sw_settings_listing_option_base %} <sw-page class="sw-settings-listing-base"> {% block sw_settings_listing_option_base_smart_bar_heading %} <template #smart-bar-header> <h2>{{ smartBarHeading }}</h2> </template> {% endblock %} {% block sw_settings_listing_option_base_language_switch %} <template #language-switch> <sw-language-switch @on-change="onChangeLanguage" /> </template> {% endblock %} {% block sw_settings_listing_option_base_smart_bar_actions %} <template #smart-bar-actions> {% block sw_settings_listing_option_base_smart_bar_actions_save %} <sw-button variant="primary" :disabled="isSaveButtonDisabled" @click="onSave" > {{ $t('global.default.save') }} </sw-button> {% endblock %} </template> {% endblock %} {% block sw_settings_listing_option_base_smart_content %} <template #content> {% block sw_settings_listing_option_base_smart_content_general_info %} <sw-settings-listing-option-general-info v-if="productSortingEntity" :sorting-option="productSortingEntity" :is-default-sorting="isDefaultSorting" :label-error="sortingOptionLabelError" :technical-name-error="sortingOptionTechnicalNameError" /> {% endblock %} {% block sw_settings_listing_option_base_smart_bar_actions_grid %} <sw-settings-listing-option-criteria-grid v-if="productSortingEntity" :product-sorting-entity="productSortingEntity" @criteria-delete="onDeleteCriteria" @criteria-add="onAddCriteria" @inline-edit-save="onSave" @inline-edit-cancel="onCancelEditCriteria" /> {% endblock %} {% block sw_settings_listing_option_base_smart_bar_actions_grid_delete_modal %} <sw-settings-listing-delete-modal v-if="toBeDeletedCriteria" :title="$tc('sw-settings-listing.base.delete.modalTitle')" :description="$tc('sw-settings-listing.base.delete.modalDescription')" @cancel="toBeDeletedCriteria = null" @delete="onConfirmDeleteCriteria" /> {% endblock %} </template> {% endblock %} </sw-page> {% endblock %}`,{Mixin:s}=Shopware,{Criteria:e}=Shopware.Data,{ShopwareError:r}=Shopware.Classes,a={template:o,inject:["repositoryFactory","systemConfigApiService"],mixins:[s.getByName("notification")],data(){return{productSortingEntity:null,toBeDeletedCriteria:null,customFieldOptions:[],customFields:[],defaultSortingId:null,sortingOptionTechnicalNameError:null,sortingOptionLabelError:null}},computed:{productSortingRepository(){return this.repositoryFactory.create("product_sorting")},customFieldRepository(){return this.repositoryFactory.create("custom_field")},smartBarHeading(){return this.productSortingEntity&&this.productSortingEntity.label?this.productSortingEntity.label:this.$tc("sw-settings-listing.base.smartBarTitle")},isGeneralCardLoading(){return!this.productSortingEntity},customFieldCriteria(){return new e(1,25)},productSortingEntityCriteria(){return new e(1,25)},isSaveButtonDisabled(){return!this.productSortingEntity||this.productSortingEntity.fields.length<=0||this.productSortingEntity.fields.some(t=>!t.field||t.field==="customField")},isDefaultSorting(){return this.defaultSortingId===this.productSortingEntity.id}},created(){this.createdComponent()},methods:{createdComponent(){Promise.all([this.fetchProductSortingEntity(),this.fetchCustomFields(),this.fetchDefaultSorting()])},fetchProductSortingEntity(){const t=this.getProductSortingEntityId();this.productSortingRepository.get(t,Shopware.Context.api,this.productSortingEntityCriteria).then(i=>{Array.isArray(i.fields)||(i.fields=[]),this.productSortingEntity=i})},fetchCustomFields(){return this.customFieldRepository.search(this.customFieldCriteria).then(t=>{this.customFields=t})},fetchDefaultSorting(){this.systemConfigApiService.getValues("core.listing").then(t=>{this.defaultSortingId=t["core.listing.defaultSorting"]})},getProductSortingEntityId(){return this.$route.params.id},async isValidSortingOption(){return this.productSortingEntity.key||(this.sortingOptionTechnicalNameError=new r({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})),await this.searchForAlreadyExistingKey(this.productSortingEntity.key)&&(this.sortingOptionTechnicalNameError=new r({code:"DUPLICATED_NAME"})),this.productSortingEntity.label||(this.sortingOptionLabelError=new r({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})),!(this.sortingOptionTechnicalNameError||this.sortingOptionLabelError)},async searchForAlreadyExistingKey(t){if(!t)return!1;const i=new e;i.addFilter(e.equals("key",t));const n=await this.productSortingRepository.search(i);return n.first()?n.first().id!==this.productSortingEntity.id:!1},async saveProductSorting(){return await this.isValidSortingOption()?this.productSortingRepository.save(this.productSortingEntity):Promise.reject()},onSave(){return this.sortingOptionTechnicalNameError=null,this.sortingOptionLabelError=null,this.transformCustomFieldCriterias(),this.productSortingEntity.fields=this.productSortingEntity.fields.filter(t=>t.field!=="customField"),this.saveProductSorting().then(()=>{const t=this.productSortingEntity.label;this.createNotificationSuccess({message:this.$t("sw-settings-listing.base.notification.saveSuccess",{sortingOptionName:t})})}).catch(()=>{const t=this.productSortingEntity.label;this.createNotificationError({message:this.$t("sw-settings-listing.base.notification.saveError",{sortingOptionName:t})})})},getCriteriaTemplate(t){return{field:t,order:"asc",priority:1,naturalSorting:0}},onDeleteCriteria(t){this.toBeDeletedCriteria=t},onConfirmDeleteCriteria(){this.productSortingEntity.fields=this.productSortingEntity.fields.filter(t=>t.field!==this.toBeDeletedCriteria.field),this.saveProductSorting().finally(()=>{this.toBeDeletedCriteria=null})},onAddCriteria(t){if(!t)return;const i=this.getCriteriaTemplate(t);this.productSortingEntity.fields||(this.productSortingEntity.fields=[]),this.productSortingEntity.fields.push(i)},onCancelEditCriteria(t){if(this.getProductSortingEntityId()){this.fetchProductSortingEntity();return}this.productSortingEntity.fields=this.productSortingEntity.fields.filter(i=>i.field!==t.field)},isCriteriaACustomField(t){return this.customFields.some(i=>i.name===t)},transformCustomFieldCriterias(){this.productSortingEntity.fields=this.productSortingEntity.fields.map(t=>(this.isCriteriaACustomField(t.field)&&(t.field=`customFields.${t.field}`),t))},onChangeLanguage(){this.fetchProductSortingEntity()}}};export{a as default};
