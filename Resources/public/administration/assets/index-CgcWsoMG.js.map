{"version":3,"file":"index-CgcWsoMG.js","sources":["../../../app/administration/src/module/sw-cms/component/sw-cms-layout-modal/sw-cms-layout-modal.html.twig","../../../app/administration/src/module/sw-cms/component/sw-cms-layout-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_cms_layout_modal %}\n<sw-modal\n    class=\"sw-cms-layout-modal\"\n    variant=\"large\"\n    :title=\"$tc('sw-cms.components.cmsLayoutModal.modalTitle')\"\n    @modal-close=\"closeModal\"\n>\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_cms_layout_modal_header %}\n    <div class=\"sw-cms-layout-modal__header\">\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_cms_layout_modal_header_search %}\n        <sw-simple-search-field\n            v-model:value=\"term\"\n            class=\"sw-cms-layout-modal__header-search\"\n            :placeholder=\"$tc('sw-cms.general.placeholderSearchBar')\"\n            @search-term-change=\"onSearch\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_cms_layout_modal_header_sorting_container %}\n        <div class=\"sw-cms-layout-modal__actions-sorting\">\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_cms_layout_modal_header_sorting_select %}\n            <sw-sorting-select\n                class=\"sw-cms-layout-modal__header-sorting-select\"\n                :sort-by=\"sortBy\"\n                :sort-direction=\"sortDirection\"\n                @sorting-changed=\"onSort\"\n            />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_cms_layout_modal_header_view_toggle %}\n            <div\n                class=\"sw-cms-layout-modal__actions-mode\"\n                role=\"button\"\n                tabindex=\"0\"\n                @click=\"toggleListMode\"\n                @keydown.enter=\"toggleListMode\"\n            >\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_cms_layout_modal_header_view_toogle_grid %}\n                <sw-icon\n                    v-if=\"listMode === 'grid'\"\n                    name=\"regular-view-normal\"\n                    size=\"16\"\n                />\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_cms_layout_modal_header_view_toogle_list %}\n                <sw-icon\n                    v-if=\"listMode === 'list'\"\n                    name=\"regular-view-grid\"\n                    size=\"16\"\n                />\n                {% endblock %}\n\n            </div>\n            {% endblock %}\n\n        </div>\n        {% endblock %}\n\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_cms_layout_modal_content %}\n    <div class=\"sw-cms-layout-modal__content\">\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_cms_layout_modal_loader %}\n        <sw-loader v-if=\"isLoading\" />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_cms_layout_modal_content_container %}\n        <div v-else-if=\"listMode === 'grid'\">\n            <sw-container\n                columns=\"repeat(auto-fill, minmax(250px, 1fr))\"\n                gap=\"24px\"\n            >\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_cms_layout_modal_content_listing %}\n                <div\n                    v-for=\"(cmsPage, index) in pages\"\n                    :key=\"index\"\n                    :class=\"gridItemClasses(cmsPage.id, index)\"\n                >\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_cms_layout_modal_content_listing_item %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_cms_layout_modal_content_listing_item_checkbox %}\n                    <sw-checkbox-field\n                        :value=\"cmsPage.id === selectedPageObject?.id\"\n                        class=\"sw-cms-layout-modal__content-checkbox\"\n                        @update:value=\"selectItem(cmsPage)\"\n                    />\n                    {% endblock %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_cms_layout_modal_content_listing_item_inner %}\n                    <sw-cms-list-item\n                        :page=\"cmsPage\"\n                        :is-default=\"[defaultProductId, defaultCategoryId].includes(cmsPage.id)\"\n                        @element-click=\"selectItem(cmsPage)\"\n                        @item-click=\"selectItem(cmsPage)\"\n                    />\n                    {% endblock %}\n\n                    {% endblock %}\n                </div>\n            </sw-container>\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_cms_layout_modal_content_pagination %}\n            <sw-pagination\n                class=\"sw-cms-layout-modal__content-pagination\"\n                :page=\"page\"\n                :limit=\"limit\"\n                :total=\"total\"\n                :auto-hide=\"false\"\n                @page-change=\"onPageChange\"\n            />\n            {% endblock %}\n\n        </div>\n        {% endblock %}\n\n        <sw-data-grid\n            v-else-if=\"listMode === 'list'\"\n            class=\"sw-cms-list__list-data-grid\"\n            identifier=\"sw-cms-list\"\n            :is-loading=\"isLoading\"\n            :limit=\"limit\"\n            :data-source=\"pages\"\n            :columns=\"columnConfig\"\n            :skeleton-item-amount=\"limit\"\n            :sort-by=\"sortBy\"\n            :sort-direction=\"sortDirection\"\n            :allow-inline-edit=\"false\"\n            :allow-column-edit=\"false\"\n            :show-settings=\"false\"\n            :show-actions=\"false\"\n            :show-selection=\"true\"\n            :maximum-select-items=\"1\"\n            :pre-selection=\"gridPreSelection\"\n            @selection-change=\"selectInGrid\"\n            @column-sort=\"onSortColumn\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_cms_list_listing_list_data_grid_column_name %}\n            <template #column-name=\"{ item }\">\n                <div\n                    role=\"button\"\n                    tabindex=\"0\"\n                    @click=\"selectItem(item)\"\n                    @keydown.enter=\"selectItem(item)\"\n                >\n                    {{ item.translated.name }}\n                </div>\n            </template>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_cms_list_listing_list_data_grid_column_type %}\n            <template #column-type=\"{ item }\">\n                {{ getPageType(item) }}\n            </template>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_cms_list_listing_list_data_grid_column_created %}\n            <template #column-createdAt=\"{ item }\">\n                {{ dateFilter(item.createdAt, { hour: '2-digit', minute: '2-digit' }) }}\n            </template>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_cms_list_listing_list_data_grid_column_updated %}\n            <template #column-updatedAt=\"{ item }\">\n                {{ dateFilter(item.updatedAt, { hour: '2-digit', minute: '2-digit' }) }}\n            </template>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_cms_list_listing_list_data_grid_pagination %}\n            <template #pagination>\n                <sw-pagination\n                    :page=\"page\"\n                    :limit=\"limit\"\n                    :total=\"total\"\n                    :auto-hide=\"false\"\n                    @page-change=\"onPageChange\"\n                />\n            </template>\n            {% endblock %}\n        </sw-data-grid>\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_cms_layout_modal_footer %}\n    <template #modal-footer>\n        <sw-button @click=\"closeModal\">\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        <sw-button\n            variant=\"primary\"\n            class=\"sw-cms-layout-modal__button-select-layout\"\n            @click=\"selectLayout\"\n        >\n            {{ $tc('sw-cms.components.cmsLayoutModal.actionConfirm') }}\n        </sw-button>\n    </template>\n    {% endblock %}\n\n</sw-modal>\n{% endblock %}\n","import template from './sw-cms-layout-modal.html.twig';\nimport './sw-cms-layout-modal.scss';\n\nconst { Mixin } = Cicada;\nconst { Criteria } = Cicada.Data;\n\n/**\n * @private\n * @package discovery\n */\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'systemConfigApiService',\n        'acl',\n        'cmsPageTypeService',\n    ],\n\n    emits: [\n        'modal-layout-select',\n        'modal-close',\n    ],\n\n    mixins: [\n        Mixin.getByName('listing'),\n    ],\n\n    props: {\n        headline: {\n            type: String,\n            required: false,\n            default: '',\n        },\n\n        cmsPageTypes: {\n            type: Array,\n            required: false,\n            default() {\n                return [];\n            },\n        },\n\n        preSelection: {\n            type: Object,\n            required: false,\n            default: () => {},\n        },\n    },\n\n    data() {\n        return {\n            listMode: 'grid',\n            disableRouteParams: true,\n            sortBy: 'createdAt',\n            sortDirection: 'DESC',\n            limit: 10,\n            selectedPageObject: null,\n            isLoading: false,\n            term: null,\n            total: null,\n            pages: [],\n            defaultCategoryId: '',\n            defaultProductId: '',\n        };\n    },\n\n    computed: {\n        pageRepository() {\n            return this.repositoryFactory.create('cms_page');\n        },\n\n        cmsPageCriteria() {\n            const criteria = new Criteria(this.page, this.limit);\n\n            criteria.addAssociation('previewMedia').addSorting(Criteria.sort(this.sortBy, this.sortDirection));\n\n            if (this.cmsPageTypes.length) {\n                criteria.addFilter(Criteria.equalsAny('type', this.cmsPageTypes));\n            }\n\n            criteria.setTerm(this.term);\n\n            return criteria;\n        },\n\n        columnConfig() {\n            return [\n                {\n                    property: 'name',\n                    label: this.$tc('sw-cms.list.gridHeaderName'),\n                    inlineEdit: 'string',\n                    primary: true,\n                },\n                {\n                    property: 'type',\n                    label: this.$tc('sw-cms.list.gridHeaderType'),\n                },\n                {\n                    property: 'createdAt',\n                    label: this.$tc('sw-cms.list.gridHeaderCreated'),\n                },\n                {\n                    property: 'updatedAt',\n                    label: this.$tc('sw-cms.list.gridHeaderUpdated'),\n                },\n            ];\n        },\n\n        gridPreSelection() {\n            if (!this.selectedPageObject?.id) {\n                return {};\n            }\n\n            return { [this.selectedPageObject.id]: this.selectedPageObject };\n        },\n\n        dateFilter() {\n            return Cicada.Filter.getByName('date');\n        },\n    },\n\n    watch: {\n        preSelection: {\n            handler: function handler(newSelection) {\n                this.selectedPageObject = newSelection;\n            },\n            immediate: true,\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            if (this.acl.can('system_config:read')) {\n                this.getDefaultLayouts();\n            }\n        },\n\n        getList() {\n            this.isLoading = true;\n\n            return this.pageRepository\n                .search(this.cmsPageCriteria)\n                .then((searchResult) => {\n                    this.total = searchResult.total;\n                    this.pages = searchResult;\n                })\n                .finally(() => {\n                    this.isLoading = false;\n                });\n        },\n\n        selectLayout() {\n            this.$emit('modal-layout-select', this.selectedPageObject?.id, this.selectedPageObject);\n            this.closeModal();\n        },\n\n        selectInGrid(column) {\n            const columnEntries = Object.values(column);\n            if (columnEntries.length === 0) {\n                this.selectedPageObject = null;\n                return;\n            }\n\n            this.selectedPageObject = columnEntries[0];\n        },\n\n        selectItem(page) {\n            this.selectedPageObject = page;\n        },\n\n        onSearch(value) {\n            if (!value.length || value.length <= 0) {\n                this.term = null;\n            }\n\n            this.page = 1;\n            this.getList();\n        },\n\n        toggleListMode() {\n            this.listMode = this.listMode === 'grid' ? 'list' : 'grid';\n        },\n\n        gridItemClasses(pageId, index) {\n            return [\n                {\n                    'is--selected': pageId === this.selectedPageObject?.id,\n                },\n                'sw-cms-layout-modal__content-item',\n                `sw-cms-layout-modal__content-item--${index}`,\n            ];\n        },\n\n        closeModal() {\n            this.selectedPageObject = null;\n            this.term = null;\n            this.$emit('modal-close');\n        },\n\n        getPageType(page) {\n            const isDefault = [\n                this.defaultProductId,\n                this.defaultCategoryId,\n            ].includes(page.id);\n            const defaultText = this.$tc('sw-cms.components.cmsListItem.defaultLayout');\n            const typeLabel = this.$tc(this.cmsPageTypeService.getType(page.type)?.title);\n            return isDefault ? `${defaultText} - ${typeLabel}` : typeLabel;\n        },\n\n        async getDefaultLayouts() {\n            const response = await this.systemConfigApiService.getValues('core.cms');\n\n            this.defaultCategoryId = response['core.cms.default_category_cms_page'];\n            this.defaultProductId = response['core.cms.default_product_cms_page'];\n        },\n    },\n};\n"],"names":["template","Mixin","Criteria","index","criteria","_a","newSelection","searchResult","column","columnEntries","page","value","pageId","isDefault","defaultText","typeLabel","response"],"mappings":"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"}