{"version":3,"file":"index-C3W4jmF-.js","sources":["../../../app/administration/src/module/sw-product/component/sw-product-seo-form/sw-product-seo-form.html.twig","../../../app/administration/src/module/sw-product/component/sw-product-seo-form/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_product_seo_form %}\n<div class=\"sw-product-seo-form\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_seo_form_meta_title %}\n    <sw-inherit-wrapper\n        v-model:value=\"product.metaTitle\"\n        :has-parent=\"hasParent\"\n        :label=\"$tc('sw-product.seoForm.labelMetaTitle')\"\n        :help-text=\"$tc('sw-product.seoForm.helpTextMetaTitle')\"\n        :inherited-value=\"parentProduct.metaTitle\"\n    >\n        <template #content=\"props\">\n            <sw-text-field\n                :placeholder=\"$tc('sw-product.seoForm.placeholderMetaTitle')\"\n                :error=\"productMetaTitleError\"\n                :disabled=\"props.isInherited || !allowEdit\"\n                :value=\"props.currentValue\"\n                @update:value=\"props.updateCurrentValue\"\n            />\n        </template>\n    </sw-inherit-wrapper>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_seo_form_meta_description %}\n    <sw-inherit-wrapper\n        v-model:value=\"product.metaDescription\"\n        :has-parent=\"hasParent\"\n        :label=\"$tc('sw-product.seoForm.labelMetaDescription')\"\n        :help-text=\"$tc('sw-product.seoForm.helpTextMetaDescription')\"\n        :inherited-value=\"parentProduct.metaDescription\"\n    >\n        <template #content=\"props\">\n            <sw-textarea-field\n                :placeholder=\"$tc('sw-product.seoForm.placeholderMetaDescription')\"\n                :error=\"productMetaDescriptionError\"\n                :disabled=\"props.isInherited || !allowEdit\"\n                :value=\"props.currentValue\"\n                @update:value=\"props.updateCurrentValue\"\n            />\n        </template>\n    </sw-inherit-wrapper>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_seo_form_keywords %}\n    <sw-inherit-wrapper\n        v-model:value=\"product.keywords\"\n        :has-parent=\"hasParent\"\n        :label=\"$tc('sw-product.seoForm.labelKeywords')\"\n        :help-text=\"$tc('sw-product.seoForm.helpTextKeywords')\"\n        :inherited-value=\"parentProduct.keywords\"\n    >\n        <template #content=\"props\">\n            <sw-text-field\n                :placeholder=\"$tc('sw-product.seoForm.placeholderKeywords')\"\n                :error=\"productKeywordsError\"\n                :disabled=\"props.isInherited || !allowEdit\"\n                :value=\"props.currentValue\"\n                @update:value=\"props.updateCurrentValue\"\n            />\n        </template>\n    </sw-inherit-wrapper>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_seo_form_canonical_url %}\n    <template v-if=\"!hasParent && hasVariants\">\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_seo_form_canonical_url_switch %}\n        <sw-switch-field\n            v-model:value=\"canonicalProductSwitchEnabled\"\n            :label=\"$tc('sw-product.seoForm.labelCanonicalUrlMode')\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_seo_form_canonical_url_select %}\n        <sw-single-select\n            ref=\"canonicalProductSelect\"\n            v-model:value=\"product.canonicalProductId\"\n            :options=\"variants\"\n            :disabled=\"!canonicalProductSwitchEnabled\"\n            value-property=\"id\"\n            :label=\"$tc('sw-product.seoForm.labelCanonicalProduct')\"\n            :placeholder=\"$tc('sw-product.seoForm.placeholderCanonicalProduct')\"\n            show-clearable-button\n            @search=\"onSearch\"\n        >\n\n            <template #selection-label-property=\"{ item }\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_seo_form_canonical_url_select_selection %}\n                <sw-product-variant-info\n                    :variations=\"item.variation\"\n                    :show-tooltip=\"false\"\n                >\n                    {{ getItemName(item) }}\n                </sw-product-variant-info>\n                {% endblock %}\n            </template>\n\n            <template #result-label-property=\"{ item }\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_seo_form_canonical_url_select_result %}\n                <sw-product-variant-info\n                    :variations=\"item.variation\"\n                    :show-tooltip=\"false\"\n                >\n                    {{ getItemName(item) }}\n                </sw-product-variant-info>\n                {% endblock %}\n            </template>\n        </sw-single-select>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</div>\n{% endblock %}\n","/*\n * @package inventory\n */\n\nimport template from './sw-product-seo-form.html.twig';\n\nconst { Mixin } = Cicada;\nconst { Criteria } = Cicada.Data;\nconst { mapPropertyErrors, mapState, mapGetters } = Cicada.Component.getComponentHelper();\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n    ],\n\n    mixins: [\n        Mixin.getByName('placeholder'),\n    ],\n\n    props: {\n        allowEdit: {\n            type: Boolean,\n            required: false,\n            // eslint-disable-next-line vue/no-boolean-default\n            default: true,\n        },\n    },\n\n    data() {\n        return {\n            variants: [],\n            searchTerm: '',\n            canonicalProductSwitchEnabled: false,\n            switchStateHasBeenSet: false,\n            shouldKeepSelectValue: false,\n            selectValue: null,\n        };\n    },\n\n    computed: {\n        productRepository() {\n            return this.repositoryFactory.create('product');\n        },\n\n        hasParent() {\n            return !!this.parentProduct.id;\n        },\n\n        hasVariants() {\n            return this.product.childCount > 0;\n        },\n\n        variantCriteria() {\n            const criteria = new Criteria(1, 25);\n\n            criteria.addAssociation('options.group');\n\n            criteria.addFilter(Criteria.equals('parentId', this.product.id));\n\n            if (this.searchTerm) {\n                criteria.setTerm(this.searchTerm);\n\n                // split search term by words\n                const terms = this.searchTerm.split(' ').filter((term) => {\n                    return term !== '';\n                });\n\n                terms.forEach((term) => {\n                    criteria.addQuery(Criteria.equals('product.options.name', term), 3500);\n                    criteria.addQuery(Criteria.contains('product.options.name', term), 500);\n                });\n            }\n\n            return criteria;\n        },\n\n        isCanonicalUrlSelectLoading() {\n            return this.variants.length < 1;\n        },\n\n        variantsWithResetOption() {\n            const variants = this.variants;\n\n            variants.unshift({\n                id: null,\n                name: this.$tc('sw-product.seoForm.placeholderCanonicalProduct'),\n            });\n\n            return variants;\n        },\n\n        ...mapGetters('swProductDetail', [\n            'isLoading',\n        ]),\n\n        ...mapState('swProductDetail', [\n            'product',\n            'parentProduct',\n        ]),\n\n        ...mapPropertyErrors('product', [\n            'keywords',\n            'metaDescription',\n            'metaTitle',\n        ]),\n    },\n\n    watch: {\n        'product.canonicalProductId': {\n            handler(value) {\n                /* Return if value is undefined or the switch state has been set the very first time.\n                 * The reason to return is that using `immediate` on this watcher the very first value is always `undefined`.\n                 * So when the product actually has a `canonicalProductId` the switch will be initially off instead off on.\n                 */\n                if (value === undefined || this.switchStateHasBeenSet) {\n                    return;\n                }\n\n                this.canonicalProductSwitchEnabled = !!value;\n                this.switchStateHasBeenSet = true;\n            },\n            immediate: true,\n        },\n\n        'product.id': {\n            // eslint-disable-next-line func-names\n            handler: function (value) {\n                if (!value) {\n                    return;\n                }\n\n                this.fetchVariants();\n            },\n            immediate: true,\n        },\n\n        canonicalProductSwitchEnabled(isEnabled) {\n            if (!this.shouldKeepSelectValue) {\n                this.shouldKeepSelectValue = true;\n\n                return;\n            }\n\n            /* When the switch state is false it saves the variant id internally.\n             * And when the switch is enabled and the value is not null it sets back the variant id.\n             */\n            if (isEnabled) {\n                this.product.canonicalProductId = this.selectValue;\n                this.selectValue = null;\n\n                return;\n            }\n\n            this.selectValue = this.product.canonicalProductId;\n            this.product.canonicalProductId = null;\n        },\n\n        isLoading(isLoading) {\n            if (isLoading) {\n                return;\n            }\n\n            this.selectValue = this.product.canonicalProductId;\n        },\n    },\n\n    methods: {\n        fetchVariants() {\n            return this.productRepository.search(this.variantCriteria).then((variants) => {\n                this.variants = variants;\n\n                return variants;\n            });\n        },\n\n        getItemName(item) {\n            if (!item.id) {\n                return item.name;\n            }\n\n            return item.translated.name || this.product.translated.name;\n        },\n\n        onSearch(searchTerm) {\n            this.searchTerm = searchTerm;\n\n            this.fetchVariants().then((variants) => {\n                this.$refs.canonicalProductSelect.results = variants;\n\n                this.$nextTick().then(() => {\n                    this.$refs.canonicalProductSelect.resetActiveItem();\n                });\n            });\n        },\n    },\n};\n"],"names":["template","Mixin","Criteria","mapPropertyErrors","mapState","mapGetters","index","criteria","term","variants","value","isEnabled","isLoading","item","searchTerm"],"mappings":"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"}