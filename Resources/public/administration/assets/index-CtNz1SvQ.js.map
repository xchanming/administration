{"version":3,"file":"index-CtNz1SvQ.js","sources":["../../../app/administration/src/module/sw-bulk-edit/component/product/sw-bulk-edit-product-media/sw-bulk-edit-product-media.html.twig","../../../app/administration/src/module/sw-bulk-edit/component/product/sw-bulk-edit-product-media/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_bulk_edit_product_media %}\n<div class=\"sw-bulk-edit-product-media\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_bulk_edit_product_media_form %}\n    <sw-bulk-edit-product-media-form\n        :disabled=\"disabled || undefined\"\n        @media-open=\"showMediaModal = true\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_bulk_edit_product_media_modal %}\n    <sw-media-modal-v2\n        v-if=\"showMediaModal\"\n        :initial-folder-id=\"mediaDefaultFolderId\"\n        :entity-context=\"product.getEntityName()\"\n        @media-modal-selection-change=\"onAddMedia\"\n        @modal-close=\"showMediaModal = false\"\n    />\n    {% endblock %}\n</div>\n{% endblock %}\n","/**\n * @package services-settings\n */\nimport template from './sw-bulk-edit-product-media.html.twig';\n\nconst { Context, Utils, Mixin } = Cicada;\nconst { Criteria } = Cicada.Data;\nconst { mapState } = Cicada.Component.getComponentHelper();\nconst { isEmpty } = Utils.types;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: ['repositoryFactory'],\n\n    mixins: [\n        Mixin.getByName('notification'),\n    ],\n\n    props: {\n        disabled: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n    },\n\n    data() {\n        return {\n            showMediaModal: false,\n            mediaDefaultFolderId: null,\n        };\n    },\n\n    computed: {\n        ...mapState('swProductDetail', [\n            'product',\n        ]),\n\n        productMediaRepository() {\n            return this.repositoryFactory.create('product_media');\n        },\n\n        mediaDefaultFolderRepository() {\n            return this.repositoryFactory.create('media_default_folder');\n        },\n\n        mediaDefaultFolderCriteria() {\n            const criteria = new Criteria(1, 1);\n\n            criteria.addAssociation('folder');\n            criteria.addFilter(Criteria.equals('entity', 'product'));\n\n            return criteria;\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.loadMediaDefaultFolder();\n        },\n\n        loadMediaDefaultFolder() {\n            this.getMediaDefaultFolderId().then((mediaDefaultFolderId) => {\n                this.mediaDefaultFolderId = mediaDefaultFolderId;\n            });\n        },\n\n        getMediaDefaultFolderId() {\n            return this.mediaDefaultFolderRepository\n                .search(this.mediaDefaultFolderCriteria, Context.api)\n                .then((mediaDefaultFolder) => {\n                    const defaultFolder = mediaDefaultFolder.first();\n                    if (defaultFolder === null) {\n                        return null;\n                    }\n\n                    if (defaultFolder.folder?.id) {\n                        return defaultFolder.folder.id;\n                    }\n\n                    return null;\n                });\n        },\n\n        onAddMedia(media) {\n            if (isEmpty(media)) {\n                return;\n            }\n\n            media.forEach((item) => {\n                this.addMedia(item).catch(({ fileName }) => {\n                    this.createNotificationError({\n                        message: this.$tc('sw-product.mediaForm.errorMediaItemDuplicated', 0, { fileName }),\n                    });\n                });\n            });\n        },\n\n        addMedia(media) {\n            if (this.isExistingMedia(media)) {\n                return Promise.reject(media);\n            }\n\n            const newMedia = this.productMediaRepository.create(Cicada.Context.api);\n            newMedia.mediaId = media.id;\n            newMedia.media = {\n                url: media.url,\n                id: media.id,\n            };\n\n            this.product.media.add(newMedia);\n\n            return Promise.resolve();\n        },\n\n        isExistingMedia(media) {\n            return this.product.media.some(({ id, mediaId }) => {\n                return id === media.id || mediaId === media.id;\n            });\n        },\n    },\n};\n"],"names":["template","Context","Utils","Mixin","Criteria","mapState","isEmpty","index","criteria","mediaDefaultFolderId","mediaDefaultFolder","_a","defaultFolder","media","item","fileName","newMedia","id","mediaId"],"mappings":"AAAA,MAAeA,EAAA,0hBCKT,CAAE,QAAAC,EAAS,MAAAC,EAAO,MAAAC,CAAK,EAAK,OAC5B,CAAE,SAAAC,CAAQ,EAAK,OAAO,KACtB,CAAE,SAAAC,CAAQ,EAAK,OAAO,UAAU,mBAAkB,EAClD,CAAE,QAAAC,CAAO,EAAKJ,EAAM,MAGXK,EAAA,CACX,SAAAP,EAEA,aAAc,OAAO,aAErB,OAAQ,CAAC,mBAAmB,EAE5B,OAAQ,CACJG,EAAM,UAAU,cAAc,CACjC,EAED,MAAO,CACH,SAAU,CACN,KAAM,QACN,SAAU,GACV,QAAS,EACZ,CACJ,EAED,MAAO,CACH,MAAO,CACH,eAAgB,GAChB,qBAAsB,IAClC,CACK,EAED,SAAU,CACN,GAAGE,EAAS,kBAAmB,CAC3B,SACZ,CAAS,EAED,wBAAyB,CACrB,OAAO,KAAK,kBAAkB,OAAO,eAAe,CACvD,EAED,8BAA+B,CAC3B,OAAO,KAAK,kBAAkB,OAAO,sBAAsB,CAC9D,EAED,4BAA6B,CACzB,MAAMG,EAAW,IAAIJ,EAAS,EAAG,CAAC,EAElC,OAAAI,EAAS,eAAe,QAAQ,EAChCA,EAAS,UAAUJ,EAAS,OAAO,SAAU,SAAS,CAAC,EAEhDI,CACV,CACJ,EAED,SAAU,CACN,KAAK,iBAAgB,CACxB,EAED,QAAS,CACL,kBAAmB,CACf,KAAK,uBAAsB,CAC9B,EAED,wBAAyB,CACrB,KAAK,wBAAuB,EAAG,KAAMC,GAAyB,CAC1D,KAAK,qBAAuBA,CAC5C,CAAa,CACJ,EAED,yBAA0B,CACtB,OAAO,KAAK,6BACP,OAAO,KAAK,2BAA4BR,EAAQ,GAAG,EACnD,KAAMS,GAAuB,CD9E9C,IAAAC,EC+EoB,MAAMC,EAAgBF,EAAmB,QACzC,OAAIE,IAAkB,KACX,MAGPD,EAAAC,EAAc,SAAd,MAAAD,EAAsB,GACfC,EAAc,OAAO,GAGzB,IAC3B,CAAiB,CACR,EAED,WAAWC,EAAO,CACVP,EAAQO,CAAK,GAIjBA,EAAM,QAASC,GAAS,CACpB,KAAK,SAASA,CAAI,EAAE,MAAM,CAAC,CAAE,SAAAC,KAAe,CACxC,KAAK,wBAAwB,CACzB,QAAS,KAAK,IAAI,gDAAiD,EAAG,CAAE,SAAAA,EAAU,CAC1G,CAAqB,CACrB,CAAiB,CACjB,CAAa,CACJ,EAED,SAASF,EAAO,CACZ,GAAI,KAAK,gBAAgBA,CAAK,EAC1B,OAAO,QAAQ,OAAOA,CAAK,EAG/B,MAAMG,EAAW,KAAK,uBAAuB,OAAO,OAAO,QAAQ,GAAG,EACtE,OAAAA,EAAS,QAAUH,EAAM,GACzBG,EAAS,MAAQ,CACb,IAAKH,EAAM,IACX,GAAIA,EAAM,EAC1B,EAEY,KAAK,QAAQ,MAAM,IAAIG,CAAQ,EAExB,QAAQ,SAClB,EAED,gBAAgBH,EAAO,CACnB,OAAO,KAAK,QAAQ,MAAM,KAAK,CAAC,CAAE,GAAAI,EAAI,QAAAC,KAC3BD,IAAOJ,EAAM,IAAMK,IAAYL,EAAM,EAC/C,CACJ,CACJ,CACL"}