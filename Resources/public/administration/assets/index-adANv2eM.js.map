{"version":3,"file":"index-adANv2eM.js","sources":["../../../app/administration/src/module/sw-flow/component/modals/sw-flow-tag-modal/sw-flow-tag-modal.html.twig","../../../app/administration/src/module/sw-flow/component/modals/sw-flow-tag-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_flow_tag_modal %}\n<sw-modal\n    class=\"sw-flow-tag-modal\"\n    :title=\"tagTitle\"\n    :closable=\"false\"\n    @modal-close=\"onClose\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_flow_tag_modal_content %}\n    <div class=\"sw-flow-tag-modal__content\">\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_flow_tag_modal_to_field %}\n        <sw-single-select\n            v-model:value=\"entity\"\n            name=\"sw-field--entity\"\n            class=\"sw-flow-tag-modal__to-field\"\n            required\n            show-clearable-button\n            :label=\"$tc('sw-flow.modals.tag.labelToField')\"\n            :placeholder=\"$tc('sw-flow.modals.tag.placeholderToField')\"\n            :error=\"entityError\"\n            :options=\"entityOptions\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_flow_tag_modal_tags_field %}\n        <sw-entity-tag-select\n            v-model:entityCollection=\"tagCollection\"\n            name=\"sw-field--tagCollection\"\n            class=\"sw-flow-tag-modal__tags-field\"\n            required\n            :label=\"$tc('sw-flow.modals.tag.labelTagsField')\"\n            :placeholder=\"$tc('sw-flow.modals.tag.placeholderTagsField')\"\n            :error=\"tagError\"\n            @item-add=\"onAddTag\"\n            @item-remove=\"onRemoveTag\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_flow_tag_modal_content_custom %}\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    <template #modal-footer>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_flow_tag_modal_footer_cancel_button %}\n        <sw-button\n            class=\"sw-flow-tag-modal__cancel-button\"\n            size=\"small\"\n            @click=\"onClose\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_flow_tag_modal_footer_save_button %}\n        <sw-button\n            class=\"sw-flow-tag-modal__save-button\"\n            variant=\"primary\"\n            size=\"small\"\n            @click=\"onSaveTag\"\n        >\n            {{ isNewTag ? $tc('sw-flow.modals.buttonAddAction') : $tc('sw-flow.modals.buttonSaveAction') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n</sw-modal>\n{% endblock %}\n","import template from './sw-flow-tag-modal.html.twig';\n\nconst { Component, Mixin, Context } = Cicada;\nconst { CicadaError } = Cicada.Classes;\nconst { EntityCollection, Criteria } = Cicada.Data;\nconst { mapState } = Component.getComponentHelper();\n\n/**\n * @private\n * @package services-settings\n */\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'acl',\n        'repositoryFactory',\n        'flowBuilderService',\n    ],\n\n    emits: [\n        'process-finish',\n        'modal-close',\n    ],\n\n    mixins: [\n        Mixin.getByName('placeholder'),\n        Mixin.getByName('notification'),\n    ],\n\n    props: {\n        sequence: {\n            type: Object,\n            required: true,\n        },\n        action: {\n            type: String,\n            required: false,\n            default: null,\n        },\n    },\n\n    data() {\n        return {\n            isLoading: false,\n            entity: null,\n            entityOptions: [],\n            tagCollection: null,\n            tagError: null,\n            entityError: null,\n        };\n    },\n\n    computed: {\n        tagCriteria() {\n            const criteria = new Criteria(1, 25);\n            const { config } = this.sequence;\n            const tagIds = Object.keys(config.tagIds);\n            if (tagIds.length) {\n                criteria.addFilter(Criteria.equalsAny('id', tagIds));\n            }\n\n            return criteria;\n        },\n\n        isNewTag() {\n            return !this.sequence?.id;\n        },\n\n        tagRepository() {\n            return this.repositoryFactory.create('tag');\n        },\n\n        tagTitle() {\n            if (!this.action) return '';\n\n            if (this.action.match(/add.*tag/)) {\n                return this.$tc('sw-flow.modals.tag.labelAddTag');\n            }\n\n            if (this.action.match(/remove.*tag/)) {\n                return this.$tc('sw-flow.modals.tag.labelRemoveTag');\n            }\n\n            return '';\n        },\n\n        ...mapState('swFlowState', [\n            'triggerEvent',\n            'triggerActions',\n        ]),\n    },\n\n    watch: {\n        entity(value) {\n            if (value && this.entityError) {\n                this.entityError = null;\n            }\n        },\n\n        tagCollection(value) {\n            if (value && this.tagError) {\n                this.tagError = null;\n            }\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.getEntityOptions();\n            this.tagCollection = this.createTagCollection();\n\n            const { config, id } = this.sequence;\n\n            if (config?.entity) {\n                this.entity = config?.entity;\n            }\n\n            if (id && config?.tagIds) {\n                this.getTagCollection();\n            }\n        },\n\n        getTagCollection() {\n            return this.tagRepository\n                .search(this.tagCriteria)\n                .then((tags) => {\n                    this.tagCollection = tags;\n                })\n                .catch(() => {\n                    this.tagCollection = [];\n                });\n        },\n\n        createTagCollection() {\n            return new EntityCollection(this.tagRepository.route, this.tagRepository.entityName, Context.api);\n        },\n\n        onAddTag(data) {\n            this.tagCollection.add(data);\n        },\n\n        onRemoveTag(data) {\n            this.tagCollection.remove(data);\n        },\n\n        getEntityOptions() {\n            if (!this.triggerEvent) {\n                this.entityOptions = [];\n                return;\n            }\n\n            const allowedAware = this.triggerEvent.aware ?? [];\n            // eslint-disable-next-line max-len\n            const options = this.flowBuilderService.getAvailableEntities(this.action, this.triggerActions, allowedAware, [\n                'tags',\n            ]);\n\n            if (options.length) {\n                this.entity = options[0].value;\n            }\n\n            this.entityOptions = options;\n        },\n\n        getConfig() {\n            const tagIds = {};\n            this.tagCollection.forEach((tag) => {\n                Object.assign(tagIds, {\n                    [tag.id]: tag.name,\n                });\n            });\n\n            const config = {\n                entity: this.entity,\n                tagIds,\n            };\n            return config;\n        },\n\n        fieldError(field) {\n            if (!field || !field.length) {\n                return new CicadaError({\n                    code: 'c1051bb4-d103-4f74-8988-acbcafc7fdc3',\n                });\n            }\n\n            return null;\n        },\n\n        onSaveTag() {\n            this.tagError = this.fieldError(this.tagCollection);\n            this.entityError = this.fieldError(this.entity);\n            if (this.tagError || this.entityError) {\n                return;\n            }\n\n            const config = this.getConfig();\n            const data = {\n                ...this.sequence,\n                config,\n            };\n            this.$emit('process-finish', data);\n            this.onClose();\n        },\n\n        onClose() {\n            this.tagError = null;\n            this.$emit('modal-close');\n        },\n    },\n};\n"],"names":["template","Component","Mixin","Context","CicadaError","EntityCollection","Criteria","mapState","index","criteria","config","tagIds","_a","value","id","tags","data","allowedAware","options","tag","field"],"mappings":"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"}