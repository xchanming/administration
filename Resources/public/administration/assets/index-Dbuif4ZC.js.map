{"version":3,"file":"index-Dbuif4ZC.js","sources":["../../../app/administration/src/module/sw-product/component/sw-product-variants/sw-product-variants-configurator/sw-product-variants-price-field/sw-product-variants-price-field.html.twig","../../../app/administration/src/module/sw-product/component/sw-product-variants/sw-product-variants-configurator/sw-product-variants-price-field/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_product_variants_price_field %}\n<div\n    class=\"sw-product-variants-price-field\"\n    :class=\"{'is--readonly': readonly}\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_variants_price_field_gross %}\n    <div class=\"sw-field\">\n        <sw-number-field\n            v-model:value=\"price.gross\"\n            size=\"small\"\n            class=\"sw-product-variants-price-field__input\"\n            :disabled=\"readonly\"\n            :digits=\"currency.decimalPrecision\"\n            v-bind=\"$attrs\"\n            @update:value=\"onPriceGrossChange\"\n        />\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_variants_price_field_lock_button %}\n    <button\n        class=\"sw-product-variants-price-field__lock\"\n        :class=\"{'is--locked': price.linked}\"\n        @click=\"onLockSwitch\"\n    >\n        <sw-icon\n            v-if=\"price.linked\"\n            name=\"regular-lock\"\n            size=\"16\"\n        />\n        <sw-icon\n            v-else\n            name=\"regular-lock-open\"\n            size=\"16\"\n        />\n    </button>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_variants_price_field_net %}\n    <div class=\"sw-field\">\n        <sw-number-field\n            v-model:value=\"price.net\"\n            size=\"small\"\n            class=\"sw-field sw-product-variants-price-field__input\"\n            :disabled=\"readonly\"\n            :digits=\"currency.decimalPrecision\"\n            v-bind=\"$attrs\"\n            @update:value=\"onPriceNetChange\"\n        />\n    </div>\n    {% endblock %}\n</div>\n{% endblock %}\n","/*\n * @package inventory\n */\n\nimport template from './sw-product-variants-price-field.html.twig';\nimport './sw-product-variants-price-field.scss';\n\nconst { Application } = Cicada;\nconst utils = Cicada.Utils;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    emits: [\n        'price-lock-change',\n        'change',\n        'price-calculate',\n        'price-gross-change',\n        'price-net-change',\n    ],\n\n    props: {\n        price: {\n            type: Object,\n            required: true,\n        },\n\n        taxRate: {\n            type: String,\n            required: false,\n            default: null,\n        },\n\n        currency: {\n            type: Object,\n            required: true,\n        },\n\n        readonly: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n    },\n\n    computed: {\n        calculatePriceApiService() {\n            return Application.getContainer('factory').apiService.getByName('calculate-price');\n        },\n    },\n\n    watch: {\n        'price.linked': function priceLinkedWatcher(value) {\n            if (value === true) {\n                this.price.net = this.convertGrossToNet(this.price.gross);\n            }\n        },\n\n        'taxRate.taxRate': function taxRateWatcher() {\n            if (this.price.linked === true) {\n                this.price.net = this.convertGrossToNet(this.price.gross);\n            }\n        },\n    },\n\n    methods: {\n        onLockSwitch() {\n            if (this.readonly) {\n                return false;\n            }\n            this.price.linked = !this.price.linked;\n            this.$emit('price-lock-change', this.price.linked);\n            this.$emit('change', this.price);\n            return true;\n        },\n\n        onPriceGrossChange(value) {\n            if (!value || typeof value !== 'number') {\n                return;\n            }\n\n            if (this.price.linked) {\n                this.$emit('price-calculate', true);\n                this.onPriceGrossChangeDebounce(Number(this.price.gross));\n            }\n        },\n\n        onPriceGrossChangeDebounce: utils.debounce(function onPriceGrossChange(value) {\n            this.$emit('price-gross-change', value);\n            this.$emit('change', this.price);\n\n            this.convertGrossToNet(value);\n        }, 500),\n\n        onPriceNetChange(value) {\n            if (!value || typeof value !== 'number') {\n                return;\n            }\n\n            if (this.price.linked) {\n                this.$emit('price-calculate', true);\n                this.onPriceNetChangeDebounce(Number(this.price.net));\n            }\n        },\n\n        onPriceNetChangeDebounce: utils.debounce(function onPriceNetChange(value) {\n            this.$emit('price-net-change', value);\n            this.$emit('change', this.price);\n\n            this.convertNetToGross(value);\n        }, 500),\n\n        convertNetToGross(value) {\n            if (!value || typeof value !== 'number') {\n                return false;\n            }\n            this.$emit('price-calculate', true);\n\n            this.requestTaxValue(value, 'net').then((res) => {\n                this.price.gross = Number(this.price.net) + res;\n            });\n            return true;\n        },\n\n        convertGrossToNet(value) {\n            if (!value || typeof value !== 'number') {\n                return false;\n            }\n            this.$emit('price-calculate', true);\n\n            this.requestTaxValue(value, 'gross').then((res) => {\n                this.price.net = Number(this.price.gross) - res;\n            });\n            return true;\n        },\n\n        requestTaxValue(value, outputType) {\n            this.$emit('price-calculate', true);\n\n            return new Promise((resolve) => {\n                if (!value || typeof value !== 'number' || !this.price[outputType] || !this.taxRate || !outputType) {\n                    return;\n                }\n\n                this.calculatePriceApiService\n                    .calculatePrice({\n                        taxId: this.taxRate,\n                        price: this.price[outputType],\n                        output: outputType,\n                        currencyId: this.currency.id,\n                    })\n                    .then(({ data }) => {\n                        resolve(data.calculatedTaxes[0].tax);\n                        this.$emit('price-calculate', false);\n                    });\n            });\n        },\n    },\n};\n"],"names":["template","Application","utils","index","value","res","outputType","resolve","data"],"mappings":"AAAA,MAAeA,EAAA,ikCCOT,CAAE,YAAAC,CAAa,EAAG,OAClBC,EAAQ,OAAO,MAGNC,EAAA,CACX,SAAAH,EAEA,aAAc,OAAO,aAErB,MAAO,CACH,oBACA,SACA,kBACA,qBACA,kBACH,EAED,MAAO,CACH,MAAO,CACH,KAAM,OACN,SAAU,EACb,EAED,QAAS,CACL,KAAM,OACN,SAAU,GACV,QAAS,IACZ,EAED,SAAU,CACN,KAAM,OACN,SAAU,EACb,EAED,SAAU,CACN,KAAM,QACN,SAAU,GACV,QAAS,EACZ,CACJ,EAED,SAAU,CACN,0BAA2B,CACvB,OAAOC,EAAY,aAAa,SAAS,EAAE,WAAW,UAAU,iBAAiB,CACpF,CACJ,EAED,MAAO,CACH,eAAgB,SAA4BG,EAAO,CAC3CA,IAAU,KACV,KAAK,MAAM,IAAM,KAAK,kBAAkB,KAAK,MAAM,KAAK,EAE/D,EAED,kBAAmB,UAA0B,CACrC,KAAK,MAAM,SAAW,KACtB,KAAK,MAAM,IAAM,KAAK,kBAAkB,KAAK,MAAM,KAAK,EAE/D,CACJ,EAED,QAAS,CACL,cAAe,CACX,OAAI,KAAK,SACE,IAEX,KAAK,MAAM,OAAS,CAAC,KAAK,MAAM,OAChC,KAAK,MAAM,oBAAqB,KAAK,MAAM,MAAM,EACjD,KAAK,MAAM,SAAU,KAAK,KAAK,EACxB,GACV,EAED,mBAAmBA,EAAO,CAClB,CAACA,GAAS,OAAOA,GAAU,UAI3B,KAAK,MAAM,SACX,KAAK,MAAM,kBAAmB,EAAI,EAClC,KAAK,2BAA2B,OAAO,KAAK,MAAM,KAAK,CAAC,EAE/D,EAED,2BAA4BF,EAAM,SAAS,SAA4BE,EAAO,CAC1E,KAAK,MAAM,qBAAsBA,CAAK,EACtC,KAAK,MAAM,SAAU,KAAK,KAAK,EAE/B,KAAK,kBAAkBA,CAAK,CAC/B,EAAE,GAAG,EAEN,iBAAiBA,EAAO,CAChB,CAACA,GAAS,OAAOA,GAAU,UAI3B,KAAK,MAAM,SACX,KAAK,MAAM,kBAAmB,EAAI,EAClC,KAAK,yBAAyB,OAAO,KAAK,MAAM,GAAG,CAAC,EAE3D,EAED,yBAA0BF,EAAM,SAAS,SAA0BE,EAAO,CACtE,KAAK,MAAM,mBAAoBA,CAAK,EACpC,KAAK,MAAM,SAAU,KAAK,KAAK,EAE/B,KAAK,kBAAkBA,CAAK,CAC/B,EAAE,GAAG,EAEN,kBAAkBA,EAAO,CACrB,MAAI,CAACA,GAAS,OAAOA,GAAU,SACpB,IAEX,KAAK,MAAM,kBAAmB,EAAI,EAElC,KAAK,gBAAgBA,EAAO,KAAK,EAAE,KAAMC,GAAQ,CAC7C,KAAK,MAAM,MAAQ,OAAO,KAAK,MAAM,GAAG,EAAIA,CAC5D,CAAa,EACM,GACV,EAED,kBAAkBD,EAAO,CACrB,MAAI,CAACA,GAAS,OAAOA,GAAU,SACpB,IAEX,KAAK,MAAM,kBAAmB,EAAI,EAElC,KAAK,gBAAgBA,EAAO,OAAO,EAAE,KAAMC,GAAQ,CAC/C,KAAK,MAAM,IAAM,OAAO,KAAK,MAAM,KAAK,EAAIA,CAC5D,CAAa,EACM,GACV,EAED,gBAAgBD,EAAOE,EAAY,CAC/B,YAAK,MAAM,kBAAmB,EAAI,EAE3B,IAAI,QAASC,GAAY,CACxB,CAACH,GAAS,OAAOA,GAAU,UAAY,CAAC,KAAK,MAAME,CAAU,GAAK,CAAC,KAAK,SAAW,CAACA,GAIxF,KAAK,yBACA,eAAe,CACZ,MAAO,KAAK,QACZ,MAAO,KAAK,MAAMA,CAAU,EAC5B,OAAQA,EACR,WAAY,KAAK,SAAS,EAClD,CAAqB,EACA,KAAK,CAAC,CAAE,KAAAE,KAAW,CAChBD,EAAQC,EAAK,gBAAgB,CAAC,EAAE,GAAG,EACnC,KAAK,MAAM,kBAAmB,EAAK,CAC3D,CAAqB,CACrB,CAAa,CACJ,CACJ,CACL"}