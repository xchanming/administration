{"version":3,"file":"index-BA5PnpgF.js","sources":["../../../app/administration/src/module/sw-order/component/sw-order-create-promotion-modal/sw-order-create-promotion-modal.html.twig","../../../app/administration/src/module/sw-order/component/sw-order-create-promotion-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_order_create_promotion_modal %}\n<sw-modal\n    :title=\"$tc('sw-order.promotionModal.labelTitle')\"\n    class=\"sw-order-create-promotion-modal\"\n    @modal-close=\"onCancel\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_order_create_promotion_modal_body %}\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_order_create_promotion_modal_message %}\n    <p>{{ hasNoAutomaticPromotions ? $tc('sw-order.promotionModal.messageNoItems') : $tc('sw-order.promotionModal.message') }}</p>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_order_create_promotion_modal_promotions %}\n    <div\n        v-for=\"(item, index) in cartAutomaticPromotionItems\"\n        :key=\"index\"\n        class=\"sw-order-create-promotion-modal__promotion\"\n    >\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_order_create_promotion_modal_promotion_name %}\n        <strong class=\"sw-order-create-promotion-modal__promotion-name\">{{ item.label }}</strong>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_order_create_promotion_modal_promotion_description %}\n        <p>{{ getDescription(item) }}</p>\n        {% endblock %}\n    </div>\n    {% endblock %}\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_order_create_promotion_modal_footer %}\n    <template #modal-footer>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_order_create_promotion_modal_footer_button_cancel %}\n        <sw-button\n            size=\"small\"\n            @click=\"onCancel\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_order_create_promotion_modal_footer_button_save %}\n        <sw-button\n            size=\"small\"\n            variant=\"primary\"\n            :is-loading=\"isLoading\"\n            :disabled=\"hasNoAutomaticPromotions\"\n            @click=\"onSave\"\n        >\n            {{ $tc('sw-order.promotionModal.buttonDisable') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n","import { DiscountTypes, DiscountScopes } from 'src/module/sw-promotion-v2/helper/promotion.helper';\nimport template from './sw-order-create-promotion-modal.html.twig';\nimport './sw-order-create-promotion-modal.scss';\n\n/**\n * @package checkout\n */\n\nconst { State, Utils, Service } = Cicada;\nconst { format } = Utils;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    emits: [\n        'close',\n        'save',\n    ],\n\n    props: {\n        currency: {\n            type: Object,\n            required: true,\n        },\n        salesChannelId: {\n            type: String,\n            required: false,\n            default: null,\n        },\n    },\n\n    data() {\n        return {\n            isLoading: false,\n        };\n    },\n\n    computed: {\n        cart() {\n            return State.get('swOrder').cart;\n        },\n\n        cartAutomaticPromotionItems() {\n            return this.cart.lineItems.filter((item) => {\n                return item.type === 'promotion' && item.payload.code === '';\n            });\n        },\n\n        hasNoAutomaticPromotions() {\n            return this.cartAutomaticPromotionItems.length === 0;\n        },\n    },\n\n    methods: {\n        onCancel() {\n            this.$emit('close');\n        },\n\n        onSave() {\n            this.disableAutomaticPromotions();\n        },\n\n        disableAutomaticPromotions() {\n            this.isLoading = true;\n            const additionalParams = { salesChannelId: this.salesChannelId };\n\n            Service('cartStoreService')\n                .disableAutomaticPromotions(this.cart.token, additionalParams)\n                .then(() => {\n                    this.isLoading = false;\n                    this.$emit('save');\n                });\n        },\n\n        getDescription(item) {\n            const { totalPrice } = item.price;\n            const { value, discountScope, discountType, groupId } = item.payload;\n            const snippet = `sw-order.createBase.textPromotionDescription.${discountScope}`;\n\n            if (\n                discountScope === DiscountScopes.CART &&\n                discountType === DiscountTypes.ABSOLUTE &&\n                Math.abs(totalPrice) < value\n            ) {\n                return this.$tc(`${snippet}.absoluteUpto`, 0, {\n                    value: format.currency(Number(value), this.currency.isoCode),\n                    totalPrice: format.currency(Math.abs(totalPrice), this.currency.isoCode),\n                });\n            }\n\n            const discountValue =\n                discountType === DiscountTypes.PERCENTAGE ? value : format.currency(Number(value), this.currency.isoCode);\n\n            return this.$tc(`${snippet}.${discountType}`, 0, {\n                value: discountValue,\n                groupId,\n            });\n        },\n    },\n};\n"],"names":["template","State","Utils","Service","format","index","item","additionalParams","totalPrice","value","discountScope","discountType","groupId","snippet","DiscountScopes","DiscountTypes","discountValue"],"mappings":"6HAAA,MAAeA,EAAA,o8CCQT,CAAE,MAAAC,EAAO,MAAAC,EAAO,QAAAC,CAAO,EAAK,OAC5B,CAAE,OAAAC,CAAQ,EAAGF,EAGJG,EAAA,CACX,SAAAL,EAEA,aAAc,OAAO,aAErB,MAAO,CACH,QACA,MACH,EAED,MAAO,CACH,SAAU,CACN,KAAM,OACN,SAAU,EACb,EACD,eAAgB,CACZ,KAAM,OACN,SAAU,GACV,QAAS,IACZ,CACJ,EAED,MAAO,CACH,MAAO,CACH,UAAW,EACvB,CACK,EAED,SAAU,CACN,MAAO,CACH,OAAOC,EAAM,IAAI,SAAS,EAAE,IAC/B,EAED,6BAA8B,CAC1B,OAAO,KAAK,KAAK,UAAU,OAAQK,GACxBA,EAAK,OAAS,aAAeA,EAAK,QAAQ,OAAS,EAC7D,CACJ,EAED,0BAA2B,CACvB,OAAO,KAAK,4BAA4B,SAAW,CACtD,CACJ,EAED,QAAS,CACL,UAAW,CACP,KAAK,MAAM,OAAO,CACrB,EAED,QAAS,CACL,KAAK,2BAA0B,CAClC,EAED,4BAA6B,CACzB,KAAK,UAAY,GACjB,MAAMC,EAAmB,CAAE,eAAgB,KAAK,cAAc,EAE9DJ,EAAQ,kBAAkB,EACrB,2BAA2B,KAAK,KAAK,MAAOI,CAAgB,EAC5D,KAAK,IAAM,CACR,KAAK,UAAY,GACjB,KAAK,MAAM,MAAM,CACrC,CAAiB,CACR,EAED,eAAeD,EAAM,CACjB,KAAM,CAAE,WAAAE,CAAU,EAAKF,EAAK,MACtB,CAAE,MAAAG,EAAO,cAAAC,EAAe,aAAAC,EAAc,QAAAC,CAAS,EAAGN,EAAK,QACvDO,EAAU,gDAAgDH,CAAa,GAE7E,GACIA,IAAkBI,EAAe,MACjCH,IAAiBI,EAAc,UAC/B,KAAK,IAAIP,CAAU,EAAIC,EAEvB,OAAO,KAAK,IAAI,GAAGI,CAAO,gBAAiB,EAAG,CAC1C,MAAOT,EAAO,SAAS,OAAOK,CAAK,EAAG,KAAK,SAAS,OAAO,EAC3D,WAAYL,EAAO,SAAS,KAAK,IAAII,CAAU,EAAG,KAAK,SAAS,OAAO,CAC3F,CAAiB,EAGL,MAAMQ,EACFL,IAAiBI,EAAc,WAAaN,EAAQL,EAAO,SAAS,OAAOK,CAAK,EAAG,KAAK,SAAS,OAAO,EAE5G,OAAO,KAAK,IAAI,GAAGI,CAAO,IAAIF,CAAY,GAAI,EAAG,CAC7C,MAAOK,EACP,QAAAJ,CAChB,CAAa,CACJ,CACJ,CACL"}