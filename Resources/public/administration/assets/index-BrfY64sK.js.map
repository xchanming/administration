{"version":3,"file":"index-BrfY64sK.js","sources":["../../../app/administration/src/app/component/rule/sw-condition-modal/sw-condition-modal.html.twig","../../../app/administration/src/app/component/rule/sw-condition-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_condition_modal %}\n<sw-modal\n    class=\"sw-condition-modal\"\n    variant=\"large\"\n    :title=\"$tc('sw-settings-rule.conditionModal.modalTitle')\"\n    @modal-close=\"closeModal\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_condition_modal_tree %}\n    <sw-condition-tree\n        v-bind=\"{ initialConditions, scopes, allowedTypes, conditionRepository, conditionDataProviderService }\"\n        :root-condition=\"condition\"\n        association-field=\"ruleId\"\n        :association-value=\"condition.ruleId\"\n        :child-association-field=\"childAssociationField\"\n        @conditions-changed=\"onConditionsChanged\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_condition_modal_footer %}\n    <template #modal-footer>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_condition_modal_footer_cancel %}\n        <sw-button\n            size=\"small\"\n            @click=\"$emit('modal-close')\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_condition_modal_footer_save %}\n        <sw-button\n            variant=\"primary\"\n            size=\"small\"\n            @click=\"saveAndCloseModal\"\n        >\n            {{ $tc('global.default.save') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n","import template from './sw-condition-modal.html.twig';\nimport './sw-condition-modal.scss';\n\nconst { Component } = Cicada;\nconst { EntityCollection } = Cicada.Data;\n\n/**\n * @private\n * @package services-settings\n */\nComponent.register('sw-condition-modal', {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: ['repositoryFactory'],\n\n    emits: [\n        'modal-close',\n    ],\n\n    props: {\n        conditionDataProviderService: {\n            type: Object,\n            required: true,\n        },\n\n        condition: {\n            type: Object,\n            required: false,\n            default: null,\n        },\n\n        scopes: {\n            type: Array,\n            required: false,\n            default() {\n                return ['lineItem'];\n            },\n        },\n\n        allowedTypes: {\n            type: Array,\n            required: false,\n            default: null,\n        },\n\n        childAssociationField: {\n            type: String,\n            required: false,\n            default: 'children',\n        },\n    },\n\n    data() {\n        return {\n            childConditions: null,\n            deletedIds: [],\n        };\n    },\n\n    computed: {\n        conditionRepository() {\n            return this.repositoryFactory.create(\n                this.condition[this.childAssociationField].entity,\n                this.condition[this.childAssociationField].source,\n            );\n        },\n\n        initialConditions() {\n            return this.condition[this.childAssociationField];\n        },\n    },\n\n    methods: {\n        onConditionsChanged({ conditions, deletedIds }) {\n            this.childConditions = conditions;\n            this.deletedIds = [\n                ...this.deletedIds,\n                ...deletedIds,\n            ];\n        },\n\n        deleteAndClose() {\n            const childrenToDelete = this.condition[this.childAssociationField].filter((child) => !child.isNew()).getIds();\n\n            this.deleteChildren(childrenToDelete, this.condition[this.childAssociationField].context).then(() => {\n                // eslint-disable-next-line vue/no-mutating-props\n                this.condition[this.childAssociationField] = new EntityCollection(\n                    this.condition[this.childAssociationField].source,\n                    this.condition[this.childAssociationField].entity,\n                    this.condition[this.childAssociationField].context,\n                );\n                this.closeModal();\n            });\n        },\n\n        saveAndCloseModal() {\n            this.deleteChildren(this.deletedIds, this.condition[this.childAssociationField].context).then(() => {\n                // eslint-disable-next-line vue/no-mutating-props\n                this.condition[this.childAssociationField] = this.childConditions;\n                this.closeModal();\n            });\n        },\n\n        deleteChildren(ids, context) {\n            if (ids.length <= 0) {\n                return Promise.resolve();\n            }\n\n            return Promise.all(\n                ids.map((id) => {\n                    return this.conditionRepository.delete(id, context);\n                }),\n            );\n        },\n\n        closeModal() {\n            this.$emit('modal-close');\n        },\n    },\n});\n"],"names":["template","Component","EntityCollection","conditions","deletedIds","childrenToDelete","child","ids","context","id"],"mappings":"AAAA,MAAeA,EAAA,89BCGT,CAAE,UAAAC,CAAW,EAAG,OAChB,CAAE,iBAAAC,CAAgB,EAAK,OAAO,KAMpCD,EAAU,SAAS,qBAAsB,CACrC,SAAAD,EAEA,aAAc,OAAO,aAErB,OAAQ,CAAC,mBAAmB,EAE5B,MAAO,CACH,aACH,EAED,MAAO,CACH,6BAA8B,CAC1B,KAAM,OACN,SAAU,EACb,EAED,UAAW,CACP,KAAM,OACN,SAAU,GACV,QAAS,IACZ,EAED,OAAQ,CACJ,KAAM,MACN,SAAU,GACV,SAAU,CACN,MAAO,CAAC,UAAU,CACrB,CACJ,EAED,aAAc,CACV,KAAM,MACN,SAAU,GACV,QAAS,IACZ,EAED,sBAAuB,CACnB,KAAM,OACN,SAAU,GACV,QAAS,UACZ,CACJ,EAED,MAAO,CACH,MAAO,CACH,gBAAiB,KACjB,WAAY,CAAE,CAC1B,CACK,EAED,SAAU,CACN,qBAAsB,CAClB,OAAO,KAAK,kBAAkB,OAC1B,KAAK,UAAU,KAAK,qBAAqB,EAAE,OAC3C,KAAK,UAAU,KAAK,qBAAqB,EAAE,MAC3D,CACS,EAED,mBAAoB,CAChB,OAAO,KAAK,UAAU,KAAK,qBAAqB,CACnD,CACJ,EAED,QAAS,CACL,oBAAoB,CAAE,WAAAG,EAAY,WAAAC,GAAc,CAC5C,KAAK,gBAAkBD,EACvB,KAAK,WAAa,CACd,GAAG,KAAK,WACR,GAAGC,CACnB,CACS,EAED,gBAAiB,CACb,MAAMC,EAAmB,KAAK,UAAU,KAAK,qBAAqB,EAAE,OAAQC,GAAU,CAACA,EAAM,MAAK,CAAE,EAAE,OAAM,EAE5G,KAAK,eAAeD,EAAkB,KAAK,UAAU,KAAK,qBAAqB,EAAE,OAAO,EAAE,KAAK,IAAM,CAEjG,KAAK,UAAU,KAAK,qBAAqB,EAAI,IAAIH,EAC7C,KAAK,UAAU,KAAK,qBAAqB,EAAE,OAC3C,KAAK,UAAU,KAAK,qBAAqB,EAAE,OAC3C,KAAK,UAAU,KAAK,qBAAqB,EAAE,OAC/D,EACgB,KAAK,WAAU,CAC/B,CAAa,CACJ,EAED,mBAAoB,CAChB,KAAK,eAAe,KAAK,WAAY,KAAK,UAAU,KAAK,qBAAqB,EAAE,OAAO,EAAE,KAAK,IAAM,CAEhG,KAAK,UAAU,KAAK,qBAAqB,EAAI,KAAK,gBAClD,KAAK,WAAU,CAC/B,CAAa,CACJ,EAED,eAAeK,EAAKC,EAAS,CACzB,OAAID,EAAI,QAAU,EACP,QAAQ,UAGZ,QAAQ,IACXA,EAAI,IAAKE,GACE,KAAK,oBAAoB,OAAOA,EAAID,CAAO,CACrD,CACjB,CACS,EAED,YAAa,CACT,KAAK,MAAM,aAAa,CAC3B,CACJ,CACL,CAAC"}