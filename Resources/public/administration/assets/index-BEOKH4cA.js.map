{"version":3,"file":"index-BEOKH4cA.js","sources":["../../../app/administration/src/app/component/form/sw-text-editor/sw-text-editor-table-toolbar/sw-text-editor-table-toolbar.html.twig","../../../app/administration/src/app/component/form/sw-text-editor/sw-text-editor-table-toolbar/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_text_editor_table_toolbar %}\n<div class=\"sw-text-editor-table-toolbar\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_text_editor_table_toolbar_buttons %}\n    <div class=\"sw-text-editor-table-toolbar__buttons\">\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_text_editor_table_toolbar_button_row_before %}\n        <div\n            class=\"sw-text-editor-table-toolbar__button\"\n            role=\"button\"\n            tabindex=\"0\"\n            @mousedown=\"onAddRow('before')\"\n        >\n            <sw-icon\n                name=\"regular-insert-row-before\"\n                size=\"12\"\n            />\n        </div>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_text_editor_table_toolbar_button_row_after %}\n        <div\n            class=\"sw-text-editor-table-toolbar__button\"\n            role=\"button\"\n            tabindex=\"0\"\n            @mousedown=\"onAddRow('after')\"\n        >\n            <sw-icon\n                name=\"regular-insert-row-after\"\n                size=\"12\"\n            />\n        </div>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_text_editor_table_toolbar_button_row_delete %}\n        <div\n            class=\"sw-text-editor-table-toolbar__button\"\n            role=\"button\"\n            tabindex=\"0\"\n            @mousedown=\"onDeleteRow\"\n        >\n            <sw-icon\n                name=\"regular-delete-row\"\n                size=\"12\"\n            />\n        </div>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_text_editor_table_toolbar_button_column_before %}\n        <div\n            class=\"sw-text-editor-table-toolbar__button\"\n            role=\"button\"\n            tabindex=\"0\"\n            @mousedown=\"onAddColumn('before')\"\n        >\n            <sw-icon\n                name=\"regular-insert-column-before\"\n                size=\"12\"\n            />\n        </div>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_text_editor_table_toolbar_button_column_after %}\n        <div\n            class=\"sw-text-editor-table-toolbar__button\"\n            role=\"button\"\n            tabindex=\"0\"\n            @mousedown=\"onAddColumn('after')\"\n        >\n            <sw-icon\n                name=\"regular-insert-column-after\"\n                size=\"12\"\n            />\n        </div>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_text_editor_table_toolbar_button_column_delete %}\n        <div\n            class=\"sw-text-editor-table-toolbar__button\"\n            role=\"button\"\n            tabindex=\"0\"\n            @mousedown=\"onDeleteColumn\"\n        >\n            <sw-icon\n                name=\"regular-delete-column\"\n                size=\"12\"\n            />\n        </div>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_text_editor_table_toolbar_button_table_delete %}\n        <div\n            class=\"sw-text-editor-table-toolbar__button\"\n            role=\"button\"\n            tabindex=\"0\"\n            @mousedown=\"onDeleteTable\"\n        >\n            <sw-icon\n                name=\"regular-times\"\n                size=\"12\"\n            />\n        </div>\n        {% endblock %}\n    </div>\n    {% endblock %}\n</div>\n{% endblock %}\n","import template from './sw-text-editor-table-toolbar.html.twig';\nimport './sw-text-editor-table-toolbar.scss';\n\nconst { Component } = Cicada;\n\n/**\n * @package admin\n *\n * @private\n */\nComponent.register('sw-text-editor-table-toolbar', {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    emits: [\n        'table-modify',\n        'table-delete',\n    ],\n\n    props: {\n        // eslint-disable-next-line vue/require-prop-types\n        selection: {\n            required: false,\n            default: null,\n        },\n    },\n\n    data() {\n        return {\n            range: null,\n            colClassName: 'sw-text-editor-table__col',\n            resizeHandle: '<div class=\"sw-text-editor-table__col-selector\" contenteditable=\"false\"></div>',\n        };\n    },\n\n    methods: {\n        onAddRow(position) {\n            const { table, index } = this.getVariables('tr');\n\n            if (!table || index === undefined) {\n                return;\n            }\n\n            const newRowIdx = position === 'after' ? index + 1 : index;\n\n            const newFirstRow = newRowIdx === 0;\n            if (newFirstRow) {\n                this.removeResizeHandle(table);\n            }\n\n            const colCount = table.rows[0].cells.length;\n            const newRow = table.insertRow(newRowIdx);\n            newRow.className = 'sw-text-editor-table__row';\n\n            this.fillRowWithCells(newRow, colCount, newFirstRow);\n\n            this.$emit('table-modify', table);\n        },\n\n        fillRowWithCells(row, colCount, newFirstRow) {\n            let newCell;\n\n            for (let i = 0; i < colCount; i += 1) {\n                newCell = row.insertCell();\n                newCell.className = this.colClassName;\n\n                if (newFirstRow) {\n                    newCell.innerHTML = this.resizeHandle;\n                }\n            }\n        },\n\n        removeResizeHandle(table) {\n            const handles = table.querySelectorAll('.sw-text-editor-table__col-selector');\n\n            Object.values(handles).forEach((handle) => {\n                handle.remove();\n            });\n        },\n\n        onAddColumn(position) {\n            const { table, index } = this.getVariables('td');\n\n            if (!table || index === undefined) {\n                return;\n            }\n\n            const tBodies = Object.values(table.tBodies);\n            const thead = table.tHead;\n\n            const newIndex = position === 'after' ? index + 1 : index;\n\n            if (thead) {\n                this.insertNewCellsForColumn(Object.values(thead.children), newIndex, true);\n            }\n\n            tBodies.forEach((tbody) => {\n                this.insertNewCellsForColumn(Object.values(tbody.children), newIndex, !thead);\n            });\n\n            this.$emit('table-modify', table);\n\n            this.keepSelection();\n        },\n\n        insertNewCellsForColumn(rows, colIdx, addResizeHanlde = false) {\n            let newCell;\n\n            rows.forEach((row, index) => {\n                newCell = row.insertCell(colIdx);\n                newCell.className = this.colClassName;\n\n                if (index === 0 && addResizeHanlde) {\n                    newCell.innerHTML = this.resizeHandle;\n                }\n            });\n        },\n\n        onDeleteColumn() {\n            const { table, index } = this.getVariables('td');\n\n            if (!table || index === undefined) {\n                return;\n            }\n\n            const tBodies = Object.values(table.tBodies);\n            const thead = table.tHead;\n\n            if (!tBodies) {\n                return;\n            }\n\n            if (thead) {\n                this.deleteCells(Object.values(thead.children), index);\n            }\n\n            tBodies.forEach((tbody) => {\n                this.deleteCells(Object.values(tbody.children), index);\n            });\n\n            this.setRangeAfterDelete(table, index, 'cell');\n            this.keepSelection();\n        },\n\n        setRangeAfterDelete(table, index, mode) {\n            if (this.selection.rangeCount > 0) {\n                this.selection.removeAllRanges();\n            }\n\n            const range = new Range();\n            let rangeRow;\n            let rangeTd;\n\n            if (mode === 'cell') {\n                rangeRow = table.rows[0];\n\n                if (!rangeRow) return;\n\n                rangeTd = !rangeRow.children[index] ? rangeRow.children[index - 1] : rangeRow.children[index];\n            } else {\n                rangeRow = !table.rows[index] ? table.rows[index - 1] : table.rows[index];\n\n                if (!rangeRow) return;\n\n                rangeTd = rangeRow.children[0];\n            }\n\n            if (!rangeTd) {\n                return;\n            }\n\n            range.setStart(rangeTd, 0);\n            range.setEnd(rangeTd, 0);\n\n            setTimeout(() => {\n                this.selection.addRange(range);\n            }, 250);\n        },\n\n        onDeleteRow() {\n            const { table, index } = this.getVariables('tr');\n\n            if (!table || index === undefined) {\n                return;\n            }\n\n            table.deleteRow(index);\n\n            if (index === 0) {\n                this.addResizeHandle(table);\n            }\n\n            this.setRangeAfterDelete(table, index, 'row');\n            this.keepSelection();\n        },\n\n        addResizeHandle(table) {\n            this.$nextTick(() => {\n                const firstRow = table.rows[0];\n\n                if (!firstRow) {\n                    return;\n                }\n\n                const rowChildren = Object.values(firstRow.children);\n\n                rowChildren.forEach((child) => {\n                    child.innerHTML = this.resizeHandle + child.innerHTML;\n                });\n            });\n        },\n\n        deleteCells(rows, colIdx) {\n            rows.forEach((row) => {\n                row.deleteCell(colIdx);\n            });\n        },\n\n        onDeleteTable(event) {\n            const node = this.getNode();\n            const table = node.closest('table');\n\n            table.remove();\n            this.$emit('table-delete', event);\n        },\n\n        getVariables(mode = 'td') {\n            const node = this.getNode();\n\n            if (!node || !node.closest(mode)) {\n                return {};\n            }\n\n            const indexConfig = {\n                td: 'cellIndex',\n                tr: 'rowIndex',\n            };\n\n            const table = node.closest('table');\n            const index = node.closest(mode)[indexConfig[mode]];\n\n            if (!table || index === undefined) {\n                return {};\n            }\n\n            return { index, table };\n        },\n\n        getNode() {\n            this.setSelectionRange();\n            this.keepSelection();\n\n            if (!this.selection || !this.selection.anchorNode) {\n                return null;\n            }\n\n            let node = this.selection.anchorNode;\n            if (node.nodeName === '#text') {\n                node = node.parentNode;\n            }\n\n            return node;\n        },\n\n        setSelectionRange() {\n            if (this.selection.rangeCount > 0) {\n                this.range = this.selection.getRangeAt(0).cloneRange();\n            }\n        },\n\n        keepSelection() {\n            if (!this.range) {\n                return;\n            }\n\n            this.selection.removeAllRanges();\n            this.selection.addRange(this.range);\n        },\n    },\n});\n"],"names":["template","Component","position","table","index","newRowIdx","newFirstRow","colCount","newRow","row","newCell","i","handles","handle","tBodies","thead","newIndex","tbody","rows","colIdx","addResizeHanlde","mode","range","rangeRow","rangeTd","firstRow","child","event","node","indexConfig"],"mappings":"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"}