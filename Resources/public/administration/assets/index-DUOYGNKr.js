const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Du5utWfC.js","assets/index-DMJqF4q9.css","assets/index-rysCY9VD.js","assets/index-B8lKpjFT.css","assets/index-DnTAhe7U.js","assets/extension-error-handler.service-2kuyx48j.js","assets/index-D_NY26QB.css","assets/index-DpbSbn5W.js","assets/index-DptE43Lh.css","assets/index-BDEK4hdA.js","assets/index-BoYOD_LJ.css","assets/index-D6TjOCrl.js","assets/sw-extension-permissions-details-modal.html-DZOKBomz.js","assets/index-h4KBIDgX.css","assets/index-CLaAWzad.js","assets/index-Di0tLeWk.css","assets/index-ERIq3HMz.js","assets/index-CMRuv-5B.css","assets/index-BeRSR3ax.js","assets/index-CuoCKJIS.js","assets/index-BBMRHiGI.css","assets/index-DkQeBY0W.js","assets/index-Wup3RJLT.css","assets/index-wzVR5qHe.js","assets/index-vgrIpI6P.css","assets/index-CfL6Ev0r.js","assets/index-BZegBBwf.css","assets/index-CAz-M6zM.js","assets/index-C3LJ-J2I.css","assets/index-Bd0q_Vm8.js","assets/index-BmPrDRa_.css","assets/index-2splp_pH.js","assets/index-BzLqeAnE.css","assets/index-DjTn4sS8.js","assets/index-NasofbBZ.css","assets/index-BUWBF5bQ.js","assets/index-e8ln6OQo.css","assets/index-Cx93eOpm.js","assets/index-Pp6dVW83.css","assets/index-CV2Pqkh1.js","assets/index-C6FWpoew.css","assets/index-CRD-ruEZ.js","assets/index-JbDO_mLI.css","assets/index-9--oqD5i.js","assets/index-BFPCqJbX.css","assets/index-CGTxU-aR.js","assets/index-DIMNLXiO.css","assets/index-CEZr3kxG.js","assets/index-CbwGItYj.css","assets/index-B6PF89SK.js","assets/index-CE4c3FU4.css","assets/index-BrVV_8Ua.js","assets/index-sdXvo5Nr.css","assets/index-BAaVBym1.js","assets/index-DaL2qSgY.css","assets/index-BNXzC1aS.js","assets/index-CE6qQHld.css"])))=>i.map(i=>d[i]);
import{_ as i}from"./administration-CcAM5iN0.js";import{u}from"./main-DGszniXu.js";import{d as l}from"./channel-Cvr-E4M4.js";import{A as p}from"./api.service-DUFBkRAb.js";Shopware.Store.register({id:"shopwareExtensions",state:()=>({search:{page:1,limit:12,rating:null,sorting:null,term:null,filter:{}},extensionListing:[],categoriesLanguageId:null,myExtensions:{loading:!0,data:[]},userInfo:null,shopwareId:null,loginStatus:!1,licensedExtensions:{loading:!1,data:[]},totalPlugins:0,plugins:null}),actions:{setSearchValue({key:s,value:e}){this.search.page=1,this.search[s]=e},loadMyExtensions(){this.myExtensions.loading=!0},setLoading(s=!0){this.myExtensions.loading=s},setMyExtensions(s){this.myExtensions.data=s,this.myExtensions.loading=!1},pluginErrorsMapped(s){}}});function m(s){s.Vue.watch(u().languageId,async e=>{s.Service("acl").can("system.plugin_maintain")&&e!==""&&await s.Service("shopwareExtensionService").updateExtensionData()})}Shopware.Mixin.register("sw-extension-error",l({mixins:[Shopware.Mixin.getByName("notification")],methods:{showExtensionErrors(s){Shopware.Service("extensionErrorService").handleErrorResponse(s,this).forEach(e=>{this.createNotificationError(e)})}}}));class h extends p{constructor(e,t){super(e,t,"extension","application/json"),this.name="extensionStoreActionService"}downloadExtension(e){return this.httpClient.post(`_action/${this.getApiBasePath()}/download/${e}`,{},{headers:this.storeHeaders(Shopware.Context.api),version:3})}installExtension(e,t){return this.httpClient.post(`_action/${this.getApiBasePath()}/install/${t}/${e}`,{},{headers:this.storeHeaders(),version:3})}updateExtension(e,t,n=!1){return this.httpClient.post(`_action/${this.getApiBasePath()}/update/${t}/${e}`,{allowNewPermissions:n},{headers:this.storeHeaders(),version:3})}activateExtension(e,t){return this.httpClient.put(`_action/${this.getApiBasePath()}/activate/${t}/${e}`,{},{headers:this.storeHeaders(),version:3})}deactivateExtension(e,t){return this.httpClient.put(`_action/${this.getApiBasePath()}/deactivate/${t}/${e}`,{},{headers:this.storeHeaders(),version:3})}uninstallExtension(e,t,n){return this.httpClient.post(`_action/${this.getApiBasePath()}/uninstall/${t}/${e}`,{keepUserData:!n},{headers:this.storeHeaders(),version:3})}removeExtension(e,t,n){return this.httpClient.post(`_action/${this.getApiBasePath()}/remove/${t}/${e}`,{keepUserData:!n},{headers:this.storeHeaders(),version:3})}cancelLicense(e){return this.httpClient.delete(`/license/cancel/${e}`,{headers:this.storeHeaders(),version:3})}rateExtension({authorName:e,extensionId:t,headline:n,rating:o,text:r,tocAccepted:a,version:c}){return this.httpClient.post(`/license/rate/${t}`,{authorName:e,headline:n,rating:o,text:r,tocAccepted:a,version:c},{headers:this.storeHeaders(),version:3})}async getMyExtensions(){const e=this.getBasicHeaders(),{data:t}=await this.httpClient.get(`/_action/${this.getApiBasePath()}/installed`,{headers:e,version:3});return t}async upload(e){const t={"Content-Type":"application/zip"},n=this.getBasicHeaders(t),o=await this.httpClient.post(`/_action/${this.getApiBasePath()}/upload`,e,{headers:n});return p.handleResponse(o)}async refresh(){const e=this.getBasicHeaders(),t=await this.httpClient.post(`/_action/${this.getApiBasePath()}/refresh`,{},{params:{},headers:e});return p.handleResponse(t)}storeHeaders(e=null){const t=super.getBasicHeaders();return e!=null&&e.languageId&&(t["sw-language-id"]=e.languageId),t}}class _{constructor(e,t,n,o){this.appModulesService=e,this.extensionStoreActionService=t,this.discountCampaignService=n,this.storeApiService=o,this.EXTENSION_VARIANT_TYPES=Object.freeze({RENT:"rent",BUY:"buy",FREE:"free"}),this.EXTENSION_TYPES=Object.freeze({APP:"app",PLUGIN:"plugin"})}async installAndActivateExtension(e,t){await this.extensionStoreActionService.installExtension(e,t),await this.extensionStoreActionService.activateExtension(e,t),await this.updateExtensionData()}async installExtension(e,t){await this.extensionStoreActionService.installExtension(e,t),await this.updateExtensionData()}async updateExtension(e,t,n=!1){await this.extensionStoreActionService.updateExtension(e,t,n),await this.updateExtensionData()}async uninstallExtension(e,t,n){await this.extensionStoreActionService.uninstallExtension(e,t,n),await this.updateExtensionData()}async removeExtension(e,t,n){await this.extensionStoreActionService.removeExtension(e,t,n),await this.updateExtensionData()}async cancelLicense(e){await this.extensionStoreActionService.cancelLicense(e)}async activateExtension(e,t){await this.extensionStoreActionService.activateExtension(e,t),await this.updateModules()}async deactivateExtension(e,t){await this.extensionStoreActionService.deactivateExtension(e,t),await this.updateModules()}async updateExtensionData(){Shopware.Store.get("shopwareExtensions").loadMyExtensions();try{await this.extensionStoreActionService.refresh();const e=await this.extensionStoreActionService.getMyExtensions();Shopware.Store.get("shopwareExtensions").setMyExtensions(e),await this.updateModules()}finally{Shopware.Store.get("shopwareExtensions").setLoading(!1)}}async checkLogin(){try{const{userInfo:e}=await this.storeApiService.checkLogin();Shopware.Store.get("shopwareExtensions").userInfo=e}catch{Shopware.Store.get("shopwareExtensions").userInfo=null}}orderVariantsByRecommendation(e){const t=e.filter(o=>this.isVariantDiscounted(o)),n=e.filter(o=>!this.isVariantDiscounted(o));return[...this.orderByType(t),...this.orderByType(n)]}isVariantDiscounted(e){return!e||!e.discountCampaign||typeof e.discountCampaign.discountedPrice!="number"||e.discountCampaign.discountedPrice===e.netPrice?!1:this.discountCampaignService.isDiscountCampaignActive(e.discountCampaign)}getPriceFromVariant(e){return this.isVariantDiscounted(e)?e.discountCampaign.discountedPrice:e.netPrice}mapVariantToRecommendation(e){switch(e.type){case this.EXTENSION_VARIANT_TYPES.FREE:return 0;case this.EXTENSION_VARIANT_TYPES.RENT:return 1;case this.EXTENSION_VARIANT_TYPES.BUY:return 2;default:return 3}}async getOpenLink(e){if(e.isTheme)return this.getLinkToTheme(e);if(e.type===this.EXTENSION_TYPES.APP)return this.getLinkToApp(e);if(!e.active)return null;const t=Shopware.Store.get("extensionEntryRoutes").routes;return t[e.name]!==void 0?{name:t[e.name].route,label:t[e.name].label??null}:null}async updateModules(){const e=await this.appModulesService.fetchAppModules();Shopware.Store.get("shopwareApps").apps=e}async getLinkToTheme(e){const{Criteria:t}=Shopware.Data,n=Shopware.Service("repositoryFactory").create("theme"),o=new t(1,1);o.addFilter(t.equals("technicalName",e.name));const{data:r}=await n.searchIds(o);return r.length===0?null:{name:"sw.theme.manager.detail",params:{id:r[0]}}}getLinkToApp(e){const t=this.getAppFromStore(e.name);return t&&this.appHasMainModule(t)?this.createLinkToModule(t.name):null}getAppFromStore(e){return Shopware.Store.get("shopwareApps").apps.find(t=>t.name===e)}appHasMainModule(e){var t;return!!((t=e.mainModule)!=null&&t.source)}createLinkToModule(e){return{name:"sw.extension.module",params:{appName:e}}}orderByType(e){const t=e.map((n,o)=>({value:this.mapVariantToRecommendation(n),index:o}));return t.sort((n,o)=>n.value-o.value),t.map(n=>e[n.index])}}class g{static get name(){return"extensionErrorService"}constructor(e,t){this.errorCodes=e,this.fallbackError=t}handleErrorResponse(e,t){var o,r;const n=((r=(o=e==null?void 0:e.response)==null?void 0:o.data)==null?void 0:r.errors)??[];return Array.isArray(n)?n.map(a=>this.handleError(a,t)):[]}handleError(e,t){var n;return this._translateRawNotification({...this._getNotification(e,t),parameters:((n=e==null?void 0:e.meta)==null?void 0:n.parameters)||{}},t)}_getNotification(e){return this.errorCodes[e.code]?this.errorCodes[e.code]:{title:e.title||this.fallbackError.title,message:e.detail||this.fallbackError.detail}}_translateRawNotification(e,t){return{title:t.$t(e.title,e.parameters),message:t.$t(e.message,e.parameters),autoClose:e.autoClose!==!1,actions:e.actions??[]}}}const{Application:d}=Shopware;d.addServiceProvider("extensionStoreActionService",()=>new h(Shopware.Application.getContainer("init").httpClient,Shopware.Service("loginService")));d.addServiceProvider("shopwareExtensionService",()=>new _(Shopware.Service("appModulesService"),Shopware.Service("extensionStoreActionService"),Shopware.Service("shopwareDiscountCampaignService"),Shopware.Service("storeService")));d.addServiceProvider("extensionErrorService",()=>{const s=Shopware.Application.getApplicationRoot();return new g({FRAMEWORK__APP_LICENSE_COULD_NOT_BE_VERIFIED:{title:"sw-extension.errors.appLicenseCouldNotBeVerified.title",message:"sw-extension.errors.appLicenseCouldNotBeVerified.message",autoClose:!1,actions:[{label:s.$tc("sw-extension.errors.appLicenseCouldNotBeVerified.actionSetLicenseDomain"),method:()=>{s.$router.push({name:"sw.settings.store.index"})}},{label:s.$tc("sw-extension.errors.appLicenseCouldNotBeVerified.actionLogin"),method:()=>{s.$router.push({name:"sw.extension.my-extensions.account"})}}]},FRAMEWORK__APP_NOT_COMPATIBLE:{title:"global.default.error",message:"sw-extension.errors.appIsNotCompatible"}},{title:"global.default.error",message:"global.notification.unspecifiedSaveErrorMessage"})});Shopware.Service("privileges").addPrivilegeMappingEntry({category:"additional_permissions",parent:null,key:"system",roles:{extension_store:{privileges:[],dependencies:["system.plugin_maintain"]}}});m(Shopware);Shopware.Component.register("sw-extension-config",()=>i(()=>import("./index-Du5utWfC.js"),__vite__mapDeps([0,1])));Shopware.Component.register("sw-extension-my-extensions-listing",()=>i(()=>import("./index-rysCY9VD.js"),__vite__mapDeps([2,3])));Shopware.Component.register("sw-extension-my-extensions-account",()=>i(()=>import("./index-DnTAhe7U.js"),__vite__mapDeps([4,5,6])));Shopware.Component.register("sw-extension-my-extensions-index",()=>i(()=>import("./index-D__IDZdb.js"),[]));Shopware.Component.register("sw-extension-store-landing-page",()=>i(()=>import("./index-DpbSbn5W.js"),__vite__mapDeps([7,8])));Shopware.Component.register("sw-extension-my-extensions-recommendation",()=>i(()=>import("./index-CxrDOIWm.js"),[]));Shopware.Component.register("sw-extension-file-upload",()=>i(()=>import("./index-BDEK4hdA.js"),__vite__mapDeps([9,5,10])));Shopware.Component.register("sw-extension-permissions-details-modal",()=>i(()=>import("./index-D6TjOCrl.js"),__vite__mapDeps([11,12,13])));Shopware.Component.register("sw-extension-card-base",()=>i(()=>import("./index-CLaAWzad.js"),__vite__mapDeps([14,15])));Shopware.Component.extend("sw-extension-card-bought","sw-extension-card-base",()=>i(()=>import("./index-ERIq3HMz.js"),__vite__mapDeps([16,5,17])));Shopware.Component.extend("sw-self-maintained-extension-card","sw-extension-card-base",()=>i(()=>import("./index-BeRSR3ax.js"),__vite__mapDeps([18,12])));Shopware.Component.register("sw-extension-my-extensions-listing-controls",()=>i(()=>import("./index-CuoCKJIS.js"),__vite__mapDeps([19,20])));Shopware.Component.register("sw-extension-permissions-modal",()=>i(()=>import("./index-DkQeBY0W.js"),__vite__mapDeps([21,22])));Shopware.Component.register("sw-extension-domains-modal",()=>i(()=>import("./index-wzVR5qHe.js"),__vite__mapDeps([23,24])));Shopware.Component.register("sw-extension-privacy-policy-extensions-modal",()=>i(()=>import("./index-CfL6Ev0r.js"),__vite__mapDeps([25,26])));Shopware.Component.register("sw-extension-deactivation-modal",()=>i(()=>import("./index-CAz-M6zM.js"),__vite__mapDeps([27,28])));Shopware.Component.register("sw-extension-removal-modal",()=>i(()=>import("./index-Bd0q_Vm8.js"),__vite__mapDeps([29,30])));Shopware.Component.register("sw-extension-uninstall-modal",()=>i(()=>import("./index-2splp_pH.js"),__vite__mapDeps([31,32])));Shopware.Component.register("sw-extension-rating-stars",()=>i(()=>import("./index-DjTn4sS8.js"),__vite__mapDeps([33,34])));Shopware.Component.register("sw-extension-ratings-card",()=>i(()=>import("./index-BUWBF5bQ.js"),__vite__mapDeps([35,36])));Shopware.Component.register("sw-extension-ratings-summary",()=>i(()=>import("./index-Cx93eOpm.js"),__vite__mapDeps([37,38])));Shopware.Component.register("sw-extension-review",()=>i(()=>import("./index-CV2Pqkh1.js"),__vite__mapDeps([39,40])));Shopware.Component.register("sw-extension-review-creation",()=>i(()=>import("./index-CRD-ruEZ.js"),__vite__mapDeps([41,42])));Shopware.Component.register("sw-extension-review-creation-inputs",()=>i(()=>import("./index-9--oqD5i.js"),__vite__mapDeps([43,44])));Shopware.Component.register("sw-extension-review-reply",()=>i(()=>import("./index-CGTxU-aR.js"),__vite__mapDeps([45,46])));Shopware.Component.extend("sw-extension-select-rating","sw-text-field-deprecated",()=>i(()=>import("./index-DJG44IF-.js"),[]));Shopware.Component.extend("sw-extension-rating-modal","sw-extension-review-creation",()=>i(()=>import("./index-CEZr3kxG.js"),__vite__mapDeps([47,48])));Shopware.Component.register("sw-extension-adding-failed",()=>i(()=>import("./index-B6PF89SK.js"),__vite__mapDeps([49,50])));Shopware.Component.register("sw-extension-adding-success",()=>i(()=>import("./index-BrVV_8Ua.js"),__vite__mapDeps([51,52])));Shopware.Component.register("sw-extension-app-module-error-page",()=>i(()=>import("./index-BAaVBym1.js"),__vite__mapDeps([53,54])));Shopware.Component.register("sw-extension-app-module-page",()=>i(()=>import("./index-BNXzC1aS.js"),__vite__mapDeps([55,56])));Shopware.Module.register("sw-extension",{type:"core",title:"sw-extension-store.title",description:"sw-extension-store.descriptionTextModule",color:"#189EFF",icon:"regular-plug",version:"1.0.0",targetVersion:"1.0.0",entity:"extension",searchMatcher:(s,e,t)=>{var o;return e.toLowerCase().match(s)?[{icon:t.icon,color:t.color,label:e,entity:t.entity,route:t.routes.store,privilege:(o=t.routes.index)==null?void 0:o.meta.privilege}]:!1},routes:{"my-extensions":{path:"my-extensions",component:"sw-extension-my-extensions-index",redirect:{name:"sw.extension.my-extensions.listing"},meta:{privilege:"system.plugin_maintain"},children:{listing:{path:"listing",component:"sw-extension-my-extensions-listing",redirect:{name:"sw.extension.my-extensions.listing.app"},meta:{privilege:"system.plugin_maintain"},children:{app:{path:"app",component:"sw-extension-my-extensions-listing",propsData:{isTheme:!1},meta:{privilege:"system.plugin_maintain"}},theme:{path:"theme",component:"sw-extension-my-extensions-listing",propsData:{isTheme:!0},meta:{privilege:"system.plugin_maintain"}}}},recommendation:{path:"recommendation",component:"sw-extension-my-extensions-recommendation",meta:{privilege:"system.plugin_maintain"}},account:{path:"account",component:"sw-extension-my-extensions-account",meta:{privilege:"system.plugin_maintain"}}}},config:{component:"sw-extension-config",path:"config/:namespace",meta:{parentPath:"sw.extension.my-extensions",privilege:"system.plugin_maintain"},props:{default(s){return{namespace:s.params.namespace}}}},store:{path:"store",component:"sw-extension-store-landing-page",redirect:{name:"sw.extension.store.landing-page"}},"store.landing-page":{path:"store/landing-page",component:"sw-extension-store-landing-page"},module:{path:"module/:appName/:moduleName?",component:"sw-extension-app-module-page",props:{default(s){const{appName:e,moduleName:t}=s.params;return{appName:e,moduleName:t}}}}},navigation:[{id:"sw-extension",label:"sw-extension.mainMenu.mainMenuItemExtensionStore",color:"#189EFF",icon:"regular-plug",position:70},{id:"sw-extension-store",parent:"sw-extension",label:"sw-extension.mainMenu.store",path:"sw.extension.store",privilege:"system.extension_store",position:10},{id:"sw-extension-my-extensions",parent:"sw-extension",label:"sw-extension.mainMenu.purchased",path:"sw.extension.my-extensions",privilege:"system.plugin_maintain",position:10}]});
