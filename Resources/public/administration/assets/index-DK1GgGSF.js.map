{"version":3,"file":"index-DK1GgGSF.js","sources":["../../../app/administration/src/module/sw-extension/component/sw-ratings/sw-extension-review-creation/sw-extension-review-creation.html.twig","../../../app/administration/src/module/sw-extension/component/sw-ratings/sw-extension-review-creation/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_extension_review_creation %}\n<div class=\"sw-extension-review-creation\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_extension_review_creation_inputs %}\n    <sw-extension-review-creation-inputs\n        :errors=\"errors\"\n        @changed=\"onChange\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_extension_review_creation_gtc_checkbox %}\n    <sw-gtc-checkbox\n        v-model:value=\"tocAccepted\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_extension_review_creation_buttons %}\n    <div class=\"sw-extension-review-creation__buttons\">\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_extension_review_creation_buttons_submit_button %}\n        <sw-button-process\n            class=\"sw-extension-review-creation__submit\"\n            variant=\"primary\"\n            size=\"small\"\n            :is-loading=\"isLoading\"\n            :process-success=\"isCreatedSuccessful\"\n            :disabled=\"disabled\"\n            @update:process-success=\"emitCreated\"\n            @click=\"handleCreateReview\"\n        >\n            {{ $tc('sw-extension-store.component.sw-extension-ratings.sw-extension-review-creation.submitBtn') }}\n        </sw-button-process>\n        {% endblock %}\n    </div>\n    {% endblock %}\n</div>\n{% endblock %}\n","import template from './sw-extension-review-creation.html.twig';\nimport './sw-extension-review-creation.scss';\n\nconst { CicadaError } = Cicada.Classes;\n\n/**\n * @package checkout\n * @private\n */\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: ['extensionStoreActionService'],\n\n    emits: ['created'],\n\n    mixins: ['sw-extension-error'],\n\n    props: {\n        extension: {\n            type: Object,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            tocAccepted: false,\n            isLoading: false,\n            isCreatedSuccessful: false,\n            headline: null,\n            rating: null,\n            text: null,\n            errors: {\n                headlineError: null,\n                ratingError: null,\n            },\n        };\n    },\n\n    computed: {\n        currentUser() {\n            return Cicada.State.get('session').currentUser;\n        },\n\n        userName() {\n            if (!this.currentUser) {\n                return '';\n            }\n\n            return `${this.currentUser.name} ${this.currentUser.lastName}`.trim();\n        },\n\n        installedVersion() {\n            const installedExtension = Cicada.State.get('cicadaExtensions').myExtensions.data.find(\n                (extension) => extension.name === this.extension.name,\n            );\n\n            return installedExtension.version;\n        },\n\n        hasError() {\n            return this.errors.headlineError !== null || this.errors.ratingError !== null;\n        },\n\n        disabled() {\n            return this.hasError || !this.tocAccepted;\n        },\n    },\n\n    watch: {\n        headline() {\n            this.validateHeadline();\n        },\n\n        rating() {\n            this.validateRating();\n        },\n    },\n\n    methods: {\n        async handleCreateReview() {\n            this.isLoading = true;\n            this.validateInputs();\n\n            if (this.hasError) {\n                this.isLoading = false;\n                return;\n            }\n\n            const review = {\n                extensionId: this.extension.id,\n                authorName: this.userName,\n                headline: this.headline,\n                rating: this.rating,\n                text: this.text,\n                tocAccepted: this.tocAccepted,\n                version: this.installedVersion,\n            };\n\n            await this.createReview(review);\n            this.isLoading = false;\n        },\n\n        async createReview(review) {\n            try {\n                await this.extensionStoreActionService.rateExtension(review);\n                this.isCreatedSuccessful = true;\n            } catch (e) {\n                this.showExtensionErrors(e);\n            }\n        },\n\n        validateInputs() {\n            this.validateHeadline();\n            this.validateRating();\n        },\n\n        validateHeadline() {\n            if (this.headline === null || this.headline === '') {\n                this.errors.headlineError = new CicadaError({\n                    code: 'c1051bb4-d103-4f74-8988-acbcafc7fdc3',\n                });\n\n                return;\n            }\n\n            this.errors.headlineError = null;\n        },\n\n        validateRating() {\n            if (this.rating === null || this.rating === 0) {\n                this.errors.ratingError = new CicadaError({\n                    code: 'c1051bb4-d103-4f74-8988-acbcafc7fdc3',\n                });\n\n                return;\n            }\n\n            this.errors.ratingError = null;\n        },\n\n        onChange(type, value) {\n            this[type] = value;\n        },\n\n        emitCreated() {\n            this.$emit('created');\n            this.isCreatedSuccessful = false;\n        },\n    },\n};\n"],"names":["template","CicadaError","index","extension","review","e","type","value"],"mappings":"AAAA,MAAeA,EAAA,w6BCGT,CAAE,YAAAC,CAAW,EAAK,OAAO,QAMhBC,EAAA,CACX,SAAAF,EAEA,aAAc,OAAO,aAErB,OAAQ,CAAC,6BAA6B,EAEtC,MAAO,CAAC,SAAS,EAEjB,OAAQ,CAAC,oBAAoB,EAE7B,MAAO,CACH,UAAW,CACP,KAAM,OACN,SAAU,EACb,CACJ,EAED,MAAO,CACH,MAAO,CACH,YAAa,GACb,UAAW,GACX,oBAAqB,GACrB,SAAU,KACV,OAAQ,KACR,KAAM,KACN,OAAQ,CACJ,cAAe,KACf,YAAa,IAChB,CACb,CACK,EAED,SAAU,CACN,aAAc,CACV,OAAO,OAAO,MAAM,IAAI,SAAS,EAAE,WACtC,EAED,UAAW,CACP,OAAK,KAAK,YAIH,GAAG,KAAK,YAAY,IAAI,IAAI,KAAK,YAAY,QAAQ,GAAG,KAAI,EAHxD,EAId,EAED,kBAAmB,CAKf,OAJ2B,OAAO,MAAM,IAAI,kBAAkB,EAAE,aAAa,KAAK,KAC7EG,GAAcA,EAAU,OAAS,KAAK,UAAU,IACjE,EAEsC,OAC7B,EAED,UAAW,CACP,OAAO,KAAK,OAAO,gBAAkB,MAAQ,KAAK,OAAO,cAAgB,IAC5E,EAED,UAAW,CACP,OAAO,KAAK,UAAY,CAAC,KAAK,WACjC,CACJ,EAED,MAAO,CACH,UAAW,CACP,KAAK,iBAAgB,CACxB,EAED,QAAS,CACL,KAAK,eAAc,CACtB,CACJ,EAED,QAAS,CACL,MAAM,oBAAqB,CAIvB,GAHA,KAAK,UAAY,GACjB,KAAK,eAAc,EAEf,KAAK,SAAU,CACf,KAAK,UAAY,GACjB,MACH,CAED,MAAMC,EAAS,CACX,YAAa,KAAK,UAAU,GAC5B,WAAY,KAAK,SACjB,SAAU,KAAK,SACf,OAAQ,KAAK,OACb,KAAM,KAAK,KACX,YAAa,KAAK,YAClB,QAAS,KAAK,gBAC9B,EAEY,MAAM,KAAK,aAAaA,CAAM,EAC9B,KAAK,UAAY,EACpB,EAED,MAAM,aAAaA,EAAQ,CACvB,GAAI,CACA,MAAM,KAAK,4BAA4B,cAAcA,CAAM,EAC3D,KAAK,oBAAsB,EAC9B,OAAQC,EAAG,CACR,KAAK,oBAAoBA,CAAC,CAC7B,CACJ,EAED,gBAAiB,CACb,KAAK,iBAAgB,EACrB,KAAK,eAAc,CACtB,EAED,kBAAmB,CACf,GAAI,KAAK,WAAa,MAAQ,KAAK,WAAa,GAAI,CAChD,KAAK,OAAO,cAAgB,IAAIJ,EAAY,CACxC,KAAM,sCAC1B,CAAiB,EAED,MACH,CAED,KAAK,OAAO,cAAgB,IAC/B,EAED,gBAAiB,CACb,GAAI,KAAK,SAAW,MAAQ,KAAK,SAAW,EAAG,CAC3C,KAAK,OAAO,YAAc,IAAIA,EAAY,CACtC,KAAM,sCAC1B,CAAiB,EAED,MACH,CAED,KAAK,OAAO,YAAc,IAC7B,EAED,SAASK,EAAMC,EAAO,CAClB,KAAKD,CAAI,EAAIC,CAChB,EAED,aAAc,CACV,KAAK,MAAM,SAAS,EACpB,KAAK,oBAAsB,EAC9B,CACJ,CACL"}