{"version":3,"file":"index-CiIXiKK5.js","sources":["../../../app/administration/src/module/sw-product/component/sw-product-download-form/sw-product-download-form.html.twig","../../../app/administration/src/module/sw-product/component/sw-product-download-form/index.js"],"sourcesContent":["<div\n    class=\"sw-product-download-form\"\n    :class=\"{ 'is--disabled': disabled }\"\n>\n    <sw-upload-listener\n        v-if=\"!isLoading\"\n        :upload-tag=\"`downloads-${product.id}`\"\n        auto-upload\n        @media-upload-finish=\"successfulUpload\"\n        @media-upload-fail=\"onUploadFailed\"\n    />\n\n    <sw-media-upload-v2\n        v-if=\"!isLoading && acl.can('product.editor')\"\n        :class=\"swFieldClasses\"\n        variant=\"regular\"\n        :upload-tag=\"`downloads-${product.id}`\"\n        :scroll-target=\"$parent.$el\"\n        :private-filesystem=\"true\"\n        :extension-accept=\"fileAccept\"\n        default-folder=\"product_download\"\n        v-bind=\"$attrs\"\n    />\n\n    <sw-field-error :error=\"error\" />\n\n    <div\n        v-if=\"!isLoading\"\n        class=\"sw-product-download-form__previews sw-product-download-form__grid\"\n    >\n        <div\n            v-for=\"download in productDownloads\"\n            :key=\"download.id\"\n            class=\"sw-product-download-form__row\"\n        >\n            <span\n                v-tooltip=\"{\n                    message: getFileName(download),\n                    disabled: false,\n                    width: 'auto'\n                }\"\n                class=\"sw-product-download-form-row__name\"\n            >\n                {{ getFileName(download) }}\n            </span>\n\n            <div class=\"sw-product-download-form-row__info\">\n                <span class=\"sw-product-download-form-row__mime\">\n                    {{ download.media.mimeType }}\n                </span>\n\n                <span class=\"sw-product-download-form-row__size\">\n                    {{ getFileSize(download) }}\n                </span>\n\n                <span class=\"sw-product-download-form-row__changed-date\">\n                    {{ createdAt(download) }}\n                </span>\n            </div>\n\n            <sw-context-button class=\"sw-product-download-form-row__context\">\n                <sw-context-menu-item\n                    class=\"sw-product-download-form-row__context-remove\"\n                    variant=\"danger\"\n                    :disabled=\"isLoading || !acl.can('product.editor')\"\n                    @click=\"onRemoveDownload(download)\"\n                >\n                    {{ $tc('global.default.remove') }}\n                </sw-context-menu-item>\n            </sw-context-button>\n\n        </div>\n    </div>\n    <sw-loader v-else />\n</div>\n","import template from './sw-product-download-form.html.twig';\nimport './sw-product-download-form.scss';\n\nconst { Component, Mixin } = Cicada;\nconst { format } = Cicada.Utils;\nconst { mapGetters } = Component.getComponentHelper();\n\n/**\n * @private\n */\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n        'configService',\n    ],\n\n    emits: ['media-open'],\n\n    mixins: [\n        Mixin.getByName('notification'),\n    ],\n\n    props: {\n        disabled: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n\n        isInherited: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n    },\n\n    data() {\n        return {\n            isMediaLoading: false,\n            fileAcceptedExtensions: [],\n        };\n    },\n\n    computed: {\n        ...mapGetters('error', [\n            'getApiError',\n        ]),\n\n        product() {\n            const state = Cicada.State.get('swProductDetail');\n\n            if (this.isInherited) {\n                return state.parentProduct;\n            }\n\n            return state.product;\n        },\n\n        ...mapGetters('swProductDetail', {\n            isStoreLoading: 'isLoading',\n        }),\n\n        isLoading() {\n            return this.isMediaLoading || this.isStoreLoading;\n        },\n\n        productDownloadRepository() {\n            return this.repositoryFactory.create('product_download');\n        },\n\n        productDownloads() {\n            if (!this.product) {\n                return [];\n            }\n            return this.product.downloads;\n        },\n\n        mediaRepository() {\n            return this.repositoryFactory.create('media');\n        },\n\n        error() {\n            return this.getApiError(this.product, 'downloads');\n        },\n\n        hasError() {\n            return !!this.error;\n        },\n\n        swFieldClasses() {\n            return {\n                'has--error': this.hasError,\n            };\n        },\n\n        fileAccept() {\n            return this.fileAcceptedExtensions.join(', ');\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        async createdComponent() {\n            this.configService.getConfig().then((result) => {\n                this.fileAcceptedExtensions = result.settings.private_allowed_extensions;\n            });\n        },\n\n        onOpenMedia() {\n            this.$emit('media-open');\n        },\n\n        getFileSize(download) {\n            return format.fileSize(download.media.fileSize);\n        },\n\n        getFileName(download) {\n            if (download.media.fileExtension) {\n                return `${download.media.fileName}.${download.media.fileExtension}`;\n            }\n\n            return download.media.fileName;\n        },\n\n        createdAt(download) {\n            const date = download.media.uploadedAt || download.media.createdAt;\n            return format.date(date, {\n                month: 'numeric',\n            });\n        },\n\n        onRemoveDownload(download) {\n            this.product.downloads.remove(download.id);\n        },\n\n        async successfulUpload({ targetId }) {\n            // on replace\n            if (this.product.downloads.find((productDownload) => productDownload.mediaId === targetId)) {\n                return;\n            }\n\n            const productDownload = this.createDownloadAssociation(targetId);\n            productDownload.media = await this.mediaRepository.get(targetId);\n\n            this.product.downloads.add(productDownload);\n            if (this.error) {\n                Cicada.State.dispatch('error/removeApiError', {\n                    expression: this.error.selfLink,\n                });\n            }\n        },\n\n        createDownloadAssociation(targetId) {\n            const productDownload = this.productDownloadRepository.create();\n\n            productDownload.productId = this.product.id;\n            productDownload.mediaId = targetId;\n            productDownload.position = this.product.downloads.length;\n\n            return productDownload;\n        },\n\n        onUploadFailed(uploadTask) {\n            const toRemove = this.product.media.find((productMedia) => {\n                return productMedia.mediaId === uploadTask.targetId;\n            });\n            if (toRemove) {\n                if (this.product.coverId === toRemove.id) {\n                    this.product.coverId = null;\n                }\n                this.product.media.remove(toRemove.id);\n            }\n            this.product.isLoading = false;\n        },\n\n        removeFile(productMedia) {\n            // remove cover id if mediaId matches\n            if (this.product.coverId === productMedia.id) {\n                this.product.cover = null;\n                this.product.coverId = null;\n            }\n\n            if (this.product.coverId === null && this.product.media.length > 0) {\n                this.product.coverId = this.product.media.first().id;\n            }\n\n            this.product.media.remove(productMedia.id);\n        },\n\n        updateMediaItemPositions() {\n            this.productMedia.forEach((medium, index) => {\n                medium.position = index;\n            });\n        },\n    },\n};\n"],"names":["template","Component","Mixin","format","mapGetters","index","state","result","download","date","targetId","productDownload","uploadTask","toRemove","productMedia","medium"],"mappings":"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"}