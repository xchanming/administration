{"version":3,"file":"index-DDmZmu2b.js","sources":["../../../app/administration/src/module/sw-product/component/sw-product-variants/sw-product-variants-media-upload/sw-product-variants-media-upload.html.twig","../../../app/administration/src/module/sw-product/component/sw-product-variants/sw-product-variants-media-upload/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_media_upload_v2 %}\n<div\n    class=\"sw-media-upload-v2 sw-product-variants-media-upload\"\n    :class=\"{ 'is--disabled': disabled }\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_variants_media_upload_content %}\n    <div class=\"sw-media-upload-v2__content\">\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_variants_media_upload_drop_zone %}\n        <div\n            ref=\"dropzone\"\n            class=\"sw-media-upload-v2__dropzone\"\n        >\n            <div class=\"sw-product-variants-media-upload__preview-images\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_variants_media_upload_cover_preview %}\n                <div\n                    v-if=\"product.cover || cover\"\n                    class=\"sw-product-variants-media-upload__preview-cover\"\n                >\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_product_variants_media_upload_cover_image %}\n                    <sw-media-preview-v2\n                        class=\"sw-product-variants-media-upload__cover-image\"\n                        :source=\"coverImageSource\"\n                    />\n                    {% endblock %}\n                </div>\n                <div\n                    v-else-if=\"source.media.length > 0\"\n                    class=\"sw-product-variants-media-upload__preview-cover\"\n                >\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_product_variants_media_upload_cover_image_empty %}\n                    <sw-media-preview-v2\n                        class=\"sw-product-variants-media-upload__cover-image\"\n                        :source=\"null\"\n                    />\n                    {% endblock %}\n                </div>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_variants_media_upload_preview %}\n                <div\n                    class=\"sw-product-variants-media-upload__images\"\n                    :class=\"{ 'is--compact--button': mediaSource.length > 2 }\"\n                >\n                    <div\n                        v-for=\"(item, index) in mediaSource\"\n                        :key=\"index\"\n                        class=\"sw-product-variants-media-upload__image\"\n                    >\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block ssw_product_variants_media_upload_content_preview_file %}\n                        <sw-media-preview-v2\n                            :key=\"item.id\"\n                            class=\"sw-media-upload-v2__preview\"\n                            :class=\"{ 'is--cover': isCover(item), 'is--disabled': disabled }\"\n                            :source=\"item.media && item.productId ? item.media : item.mediaId\"\n                        />\n                        {% endblock %}\n\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_product_variants_media_upload_action_buttons %}\n                        <sw-context-button\n                            class=\"sw-product-variants-media-upload__context-button\"\n                            :disabled=\"disabled\"\n                        >\n                            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                            {% block sw_product_variants_media_upload_context %}\n                            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                            {% block sw_product_variants_media_upload_context_cover_action %}\n                            <sw-context-menu-item\n                                v-if=\"!isCover(item)\"\n                                @click=\"markMediaAsCover(item)\"\n                            >\n                                {{ $tc('global.sw-product-image.context.buttonAsCover') }}\n                            </sw-context-menu-item>\n                            {% endblock %}\n\n                            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                            {% block sw_product_variants_media_upload_context_preview_action %}\n                            <sw-context-menu-item @click=\"previewMedia(item)\">\n                                {{ $tc('global.sw-product-image.context.buttonPreviewImage') }}\n                            </sw-context-menu-item>\n                            {% endblock %}\n\n                            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                            {% block sw_product_variants_media_upload_context_delete_action %}\n                            <sw-context-menu-item\n                                variant=\"danger\"\n                                @click=\"removeMedia(item)\"\n                            >\n                                {{ $tc('global.sw-product-image.context.buttonRemove') }}\n                            </sw-context-menu-item>\n                            {% endblock %}\n                            {% endblock %}\n                        </sw-context-button>\n                        {% endblock %}\n                    </div>\n                </div>\n                {% endblock %}\n            </div>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_variants_media_upload_actions %}\n            <div class=\"sw-media-upload-v2__actions\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_variants_media_upload_actions_regular %}\n                <div\n                    v-if=\"mediaSource.length <= 2\"\n                    class=\"sw-product-variants-media-upload__regular-button\"\n                >\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_product_variants_media_upload_actions_regular_upload_button %}\n                    <sw-button\n                        class=\"sw-media-upload-v2__button upload\"\n                        :disabled=\"disabled\"\n                        variant=\"ghost\"\n                        size=\"small\"\n                        @click=\"onClickUpload\"\n                    >\n                        {{ $tc('global.sw-media-upload-v2.buttonFilesUpload') }}\n                    </sw-button>\n                    {% endblock %}\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_product_variants_media_upload_actions_regular_open_button %}\n                    <sw-button\n                        variant=\"primary\"\n                        :disabled=\"disabled\"\n                        class=\"sw-product-variants-media-upload__browse-button\"\n                        @click=\"showMediaModal = true\"\n                    >\n                        <sw-icon\n                            class=\"sw-product-variants-media-upload__browse-icon\"\n                            name=\"regular-image\"\n                        />\n                    </sw-button>\n                    {% endblock %}\n                </div>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_variants_media_upload_actions_compact %}\n                <div\n                    v-else\n                    class=\"sw-product-variants-media-upload__compact-button\"\n                >\n                    <sw-button\n                        variant=\"primary\"\n                        :disabled=\"disabled\"\n                        class=\"sw-product-variants-media-upload__browse-button\"\n                    >\n                        <sw-icon\n                            class=\"sw-product-variants-media-upload__browse-icon\"\n                            name=\"regular-plus\"\n                        />\n                    </sw-button>\n                    <sw-context-button\n                        class=\"sw-product-variants-media-upload__context-button\"\n                        :disabled=\"disabled\"\n                    >\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_product_variants_media_upload_actions_compact_button_context %}\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_product_variants_media_upload_actions_compact_button_context_upload_action %}\n                        <sw-context-menu-item @click=\"onClickUpload\">\n                            {{ $tc('global.sw-media-upload-v2.buttonFilesUpload') }}\n                        </sw-context-menu-item>\n                        {% endblock %}\n\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_product_variants_media_upload_actions_compact_button_context_open_action %}\n                        <sw-context-menu-item @click=\"showMediaModal = true\">\n                            {{ $tc('global.sw-media-upload-v2.buttonOpenMedia') }}\n                        </sw-context-menu-item>\n                        {% endblock %}\n                        {% endblock %}\n                    </sw-context-button>\n                </div>\n                {% endblock %}\n            </div>\n            {% endblock %}\n        </div>\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_variants_media_upload_file_input %}\n    <form\n        ref=\"fileForm\"\n        class=\"sw-media-upload-v2__form\"\n    >\n        <!-- eslint-disable-next-line vuejs-accessibility/form-control-has-label -->\n        <input\n            :key=\"source.id\"\n            ref=\"fileInput\"\n            class=\"sw-media-upload-v2__file-input\"\n            type=\"file\"\n            :accept=\"fileAccept\"\n            :multiple=\"multiSelect\"\n            @change=\"onFileInputChange\"\n        >\n    </form>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_variants_media_upload_actions_media_modal %}\n    <sw-media-modal-v2\n        v-if=\"showMediaModal\"\n        :initial-folder-id=\"mediaDefaultFolderId\"\n        :entity-context=\"product.getEntityName()\"\n        @modal-close=\"showMediaModal = false\"\n        @media-modal-selection-change=\"onAddMedia\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_variants_media_upload_listener %}\n    <sw-upload-listener\n        auto-upload\n        :upload-tag=\"uploadTag\"\n        @media-upload-finish=\"onUploadMediaSuccessful\"\n        @media-upload-fail=\"onUploadMediaFailed\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_variants_media_upload_preview_modal %}\n    <sw-image-preview-modal\n        v-if=\"showPreviewModal\"\n        :active-item-id=\"activeItemId\"\n        :media-items=\"mediaSource\"\n        @modal-close=\"onClosePreviewModal\"\n    />\n    {% endblock %}\n</div>\n{% endblock %}\n","/*\n * @package inventory\n */\n\nimport template from './sw-product-variants-media-upload.html.twig';\nimport './sw-product-variants-media-upload.scss';\n\nconst { Mixin, Context } = Cicada;\nconst { isEmpty } = Cicada.Utils.types;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'mediaDefaultFolderService',\n    ],\n\n    mixins: [\n        Mixin.getByName('notification'),\n    ],\n\n    props: {\n        source: {\n            type: Object,\n            required: true,\n        },\n\n        parentProduct: {\n            type: Object,\n            required: true,\n        },\n\n        isInherited: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n    },\n\n    data() {\n        return {\n            showMediaModal: false,\n            mediaDefaultFolderId: null,\n            showPreviewModal: false,\n            activeItemId: null,\n        };\n    },\n\n    computed: {\n        productMediaRepository() {\n            return this.repositoryFactory.create(this.source.media.entity);\n        },\n\n        product() {\n            if (this.isInherited) {\n                return this.parentProduct;\n            }\n\n            return this.source;\n        },\n\n        mediaSource() {\n            if (!this.product) {\n                return [];\n            }\n            const media = [...this.product.media];\n\n            return media.sort((a, b) => a.position - b.position);\n        },\n\n        cover() {\n            if (!this.product) {\n                return null;\n            }\n\n            return this.product.media.find((media) => media.id === this.product.coverId);\n        },\n\n        coverImageSource() {\n            if (this.cover) {\n                return this.cover.media ?? this.cover.mediaId;\n            }\n\n            return this.product?.cover?.mediaId ?? this.product?.cover?.media;\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.getMediaDefaultFolderId()\n                .then((id) => {\n                    this.mediaDefaultFolderId = id;\n                    this.defaultFolderId = id;\n                    this.updateMediaItemPositions();\n                })\n                .catch(() => {\n                    this.mediaDefaultFolderId = null;\n                    this.defaultFolderId = null;\n                });\n        },\n\n        getMediaDefaultFolderId() {\n            return this.mediaDefaultFolderService.getDefaultFolderId('product');\n        },\n\n        isCover(productMedia) {\n            const coverId = this.product.cover ? this.product.cover.id : this.product.coverId;\n\n            if (this.product.media.length === 0) {\n                return false;\n            }\n\n            return productMedia.id === coverId;\n        },\n\n        markMediaAsCover(productMedia) {\n            this.product.cover = productMedia;\n            this.product.coverId = productMedia.id;\n        },\n\n        removeMedia(productMedia) {\n            if (this.product.coverId === productMedia.id) {\n                this.product.cover = null;\n                this.product.coverId = null;\n            }\n\n            if (this.product.coverId === null && this.product.media.length > 0) {\n                this.product.coverId = this.product.media.first().id;\n            }\n\n            this.product.media.remove(productMedia.id);\n        },\n\n        onAddMedia(media) {\n            if (isEmpty(media)) {\n                return;\n            }\n\n            media.forEach((item) => {\n                this.addMedia(item).catch(({ fileName }) => {\n                    this.createNotificationError({\n                        message: this.$tc('sw-product.mediaForm.errorMediaItemDuplicated', 0, { fileName }),\n                    });\n                });\n            });\n            this.updateMediaItemPositions();\n        },\n\n        addMedia(media) {\n            if (this.isExistingMedia(media)) {\n                return Promise.reject(media);\n            }\n\n            const newMedia = this.productMediaRepository.create(Context.api);\n            newMedia.mediaId = media.id;\n            newMedia.media = { url: media.url, id: media.id };\n\n            if (isEmpty(this.source.media)) {\n                this.source.cover = newMedia;\n                this.source.coverId = newMedia.id;\n            }\n\n            this.source.media.add(newMedia);\n\n            return Promise.resolve();\n        },\n\n        isExistingMedia(media) {\n            return this.source.media.some(({ id, mediaId }) => {\n                return id === media.id || mediaId === media.id;\n            });\n        },\n\n        onUploadMediaSuccessful({ targetId }) {\n            if (this.isReplacedMedia(targetId)) {\n                return;\n            }\n\n            const newMedia = this.productMediaRepository.create(Context.api);\n            newMedia.productId = this.source.id;\n            newMedia.mediaId = targetId;\n\n            if (isEmpty(this.source.media)) {\n                newMedia.position = 0;\n                this.source.coverId = newMedia.id;\n            } else {\n                newMedia.position = this.source.media.length;\n            }\n\n            this.source.media.add(newMedia);\n            this.updateMediaItemPositions();\n        },\n\n        isReplacedMedia(targetId) {\n            return this.source.media.find((sourceMedia) => {\n                return sourceMedia.mediaId === targetId;\n            });\n        },\n\n        onUploadMediaFailed({ targetId }) {\n            const newMedia = this.source.media.find((sourceMedia) => {\n                return sourceMedia.mediaId === targetId;\n            });\n\n            if (newMedia) {\n                if (this.source.coverId === newMedia.id) {\n                    this.source.coverId = null;\n                }\n                this.source.media.remove(newMedia.id);\n            }\n\n            this.source.isLoading = false;\n        },\n\n        previewMedia(item) {\n            this.activeItemId = item.id;\n            this.showPreviewModal = true;\n        },\n\n        onClosePreviewModal() {\n            this.activeItemId = null;\n            this.showPreviewModal = false;\n        },\n\n        updateMediaItemPositions() {\n            this.source.media.forEach((medium, index) => {\n                medium.position = index;\n            });\n        },\n    },\n};\n"],"names":["template","Mixin","Context","isEmpty","index","a","b","media","_a","_b","_c","_d","id","productMedia","coverId","item","fileName","newMedia","mediaId","targetId","sourceMedia","medium"],"mappings":"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"}