{"version":3,"file":"index-VVKhIbpC.js","sources":["../../../app/administration/src/module/sw-product/component/sw-product-variants/sw-product-variants-delivery/sw-product-variants-delivery-media/sw-product-variants-delivery-media.html.twig","../../../app/administration/src/module/sw-product/component/sw-product-variants/sw-product-variants-delivery/sw-product-variants-delivery-media/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_product_variants_delivery_media %}\n<div class=\"sw-product-variants-delivery-media\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_variants_delivery_media_groups %}\n    <div class=\"sw-product-variants-delivery-media__groups\">\n        <ul>\n            <li\n                v-for=\"group in selectedGroupsSorted\"\n                :key=\"group.id\"\n                class=\"sw-product-variants-delivery-media__groupElement\"\n                role=\"button\"\n                tabindex=\"0\"\n                :class=\"{'is--selected': activeGroup.id == group.id}\"\n                @click=\"activeGroup = group\"\n                @keydown.enter=\"activeGroup = group\"\n            >\n                <sw-icon\n                    name=\"regular-folder\"\n                    size=\"16px\"\n                />\n                {{ group.translated.name }}\n            </li>\n        </ul>\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_variants_delivery_media_media %}\n    <div\n        v-if=\"activeOptions.length\"\n        class=\"sw-product-variants-delivery-media__media\"\n    >\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_variants_delivery_media_data_grid %}\n        <sw-data-grid\n            ref=\"variantsMedia\"\n            :data-source=\"activeOptions\"\n            :columns=\"optionColumns\"\n            :show-actions=\"false\"\n            :show-selection=\"false\"\n            :compact-mode=\"false\"\n            full-page\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_variants_delivery_media_data_grid_column_name %}\n            <template\n                #column-name=\"{ item, isInlineEdit, compact }\"\n            >\n                {{ item.option.translated.name }}\n            </template>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_variants_delivery_media_data_grid_column_option_media %}\n            <template #column-option.media=\"{ item, isInlineEdit, compact }\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_variants_delivery_media_data_grid_column_option_media_listener %}\n                <sw-upload-listener\n                    :upload-tag=\"item.id\"\n                    @media-upload-add=\"onUploadsAdded\"\n                    @media-upload-finish=\"successfulUpload\"\n                />\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_variants_delivery_media_data_grid_column_option_media_upload %}\n                <sw-media-compact-upload-v2\n                    :source=\"item.mediaId\"\n                    :upload-tag=\"item.id\"\n                    :default-folder=\"product.getEntityName()\"\n                    @media-upload-remove-image=\"removeMedia(item)\"\n                    @selection-change=\"setMedia\"\n                />\n                {% endblock %}\n            </template>\n            {% endblock %}\n\n        </sw-data-grid>\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_variants_delivery_media_loader %}\n    <sw-loader v-if=\"isLoading\" />\n    {% endblock %}\n\n</div>\n{% endblock %}\n","/*\n * @package inventory\n */\n\nimport template from './sw-product-variants-delivery-media.html.twig';\nimport './sw-product-variants-delivery-media.scss';\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'mediaService',\n    ],\n\n    props: {\n        product: {\n            type: Object,\n            required: true,\n        },\n\n        selectedGroups: {\n            type: Array,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            activeGroup: {},\n            isLoading: false,\n        };\n    },\n\n    computed: {\n        selectedGroupsSorted() {\n            // prepare group sorting\n            let sortedGroups = [];\n            const selectedGroupsCopy = [...this.selectedGroups];\n\n            // check if sorting exists on server\n            if (\n                this.product.variantListingConfig.configuratorGroupConfig &&\n                this.product.variantListingConfig.configuratorGroupConfig.length > 0\n            ) {\n                // add server sorting to the sortedGroups\n                sortedGroups = this.product.variantListingConfig.configuratorGroupConfig.reduce((acc, configGroup) => {\n                    const relatedGroup = selectedGroupsCopy.find((group) => group.id === configGroup.id);\n\n                    if (relatedGroup) {\n                        acc.push(relatedGroup);\n\n                        // remove from original array\n                        selectedGroupsCopy.splice(selectedGroupsCopy.indexOf(relatedGroup), 1);\n                    }\n\n                    return acc;\n                }, []);\n            }\n\n            // add non sorted groups at the end of the sorted array\n            sortedGroups = [\n                ...sortedGroups,\n                ...selectedGroupsCopy,\n            ];\n\n            return sortedGroups;\n        },\n\n        optionColumns() {\n            return [\n                {\n                    property: 'name',\n                    label: 'sw-product.variations.deliveryModal.mediaOptions',\n                    rawData: true,\n                },\n                {\n                    property: 'option.media',\n                    label: 'sw-product.variations.deliveryModal.media',\n                    rawData: true,\n                },\n            ];\n        },\n\n        activeOptions() {\n            return this.product.configuratorSettings.filter((element) => {\n                return !element.isDeleted && element.option.groupId === this.activeGroup.id;\n            });\n        },\n    },\n\n    watch: {\n        activeGroup: {\n            handler() {\n                this.product.variantListingConfig.configuratorGroupConfig.find((group) => {\n                    return group.id === this.activeGroup.id;\n                });\n            },\n        },\n    },\n\n    methods: {\n        async onUploadsAdded({ data }) {\n            if (data.length === 0) {\n                return;\n            }\n\n            const uploadData = data[0];\n            const relatedOption = this.activeOptions.find((option) => option.id === uploadData.uploadTag);\n\n            this.isLoading = true;\n\n            data.forEach((upload) => {\n                relatedOption.mediaId = upload.targetId;\n            });\n\n            await this.mediaService.runUploads(uploadData.uploadTag);\n        },\n\n        async successfulUpload() {\n            this.isLoading = false;\n\n            this.$forceUpdate();\n        },\n\n        removeMedia(option) {\n            option.mediaId = null;\n        },\n\n        setMedia(selection, optionId) {\n            const relatedOption = this.activeOptions.find((option) => option.id === optionId);\n            relatedOption.mediaId = selection[0].id;\n        },\n\n        onChangeGroupListing(value) {\n            const existingIndex = this.product.variantListingConfig.configuratorGroupConfig.findIndex(\n                (group) => group.id === this.activeGroup.id,\n            );\n\n            if (existingIndex >= 0) {\n                const existingConfig = this.product.variantListingConfig.configuratorGroupConfig[existingIndex];\n\n                this.product.variantListingConfig.configuratorGroupConfig[existingIndex] = {\n                    id: existingConfig.id,\n                    expressionForListings: value,\n                    representation: existingConfig.representation,\n                };\n            } else {\n                this.product.variantListingConfig.configuratorGroupConfig = [\n                    ...this.product.variantListingConfig.configuratorGroupConfig,\n                    {\n                        id: this.activeGroup.id,\n                        expressionForListings: value,\n                        representation: 'box',\n                    },\n                ];\n            }\n        },\n    },\n};\n"],"names":["template","index","sortedGroups","selectedGroupsCopy","acc","configGroup","relatedGroup","group","element","data","uploadData","relatedOption","option","upload","selection","optionId","value","existingIndex","existingConfig"],"mappings":"AAAA,MAAeA,EAAA,68DCQAC,EAAA,CACX,SAAAD,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,oBACA,cACH,EAED,MAAO,CACH,QAAS,CACL,KAAM,OACN,SAAU,EACb,EAED,eAAgB,CACZ,KAAM,MACN,SAAU,EACb,CACJ,EAED,MAAO,CACH,MAAO,CACH,YAAa,CAAE,EACf,UAAW,EACvB,CACK,EAED,SAAU,CACN,sBAAuB,CAEnB,IAAIE,EAAe,CAAA,EACnB,MAAMC,EAAqB,CAAC,GAAG,KAAK,cAAc,EAGlD,OACI,KAAK,QAAQ,qBAAqB,yBAClC,KAAK,QAAQ,qBAAqB,wBAAwB,OAAS,IAGnED,EAAe,KAAK,QAAQ,qBAAqB,wBAAwB,OAAO,CAACE,EAAKC,IAAgB,CAClG,MAAMC,EAAeH,EAAmB,KAAMI,GAAUA,EAAM,KAAOF,EAAY,EAAE,EAEnF,OAAIC,IACAF,EAAI,KAAKE,CAAY,EAGrBH,EAAmB,OAAOA,EAAmB,QAAQG,CAAY,EAAG,CAAC,GAGlEF,CACV,EAAE,CAAE,CAAA,GAITF,EAAe,CACX,GAAGA,EACH,GAAGC,CACnB,EAEmBD,CACV,EAED,eAAgB,CACZ,MAAO,CACH,CACI,SAAU,OACV,MAAO,mDACP,QAAS,EACZ,EACD,CACI,SAAU,eACV,MAAO,4CACP,QAAS,EACZ,CACjB,CACS,EAED,eAAgB,CACZ,OAAO,KAAK,QAAQ,qBAAqB,OAAQM,GACtC,CAACA,EAAQ,WAAaA,EAAQ,OAAO,UAAY,KAAK,YAAY,EAC5E,CACJ,CACJ,EAED,MAAO,CACH,YAAa,CACT,SAAU,CACN,KAAK,QAAQ,qBAAqB,wBAAwB,KAAMD,GACrDA,EAAM,KAAO,KAAK,YAAY,EACxC,CACJ,CACJ,CACJ,EAED,QAAS,CACL,MAAM,eAAe,CAAE,KAAAE,GAAQ,CAC3B,GAAIA,EAAK,SAAW,EAChB,OAGJ,MAAMC,EAAaD,EAAK,CAAC,EACnBE,EAAgB,KAAK,cAAc,KAAMC,GAAWA,EAAO,KAAOF,EAAW,SAAS,EAE5F,KAAK,UAAY,GAEjBD,EAAK,QAASI,GAAW,CACrBF,EAAc,QAAUE,EAAO,QAC/C,CAAa,EAED,MAAM,KAAK,aAAa,WAAWH,EAAW,SAAS,CAC1D,EAED,MAAM,kBAAmB,CACrB,KAAK,UAAY,GAEjB,KAAK,aAAY,CACpB,EAED,YAAYE,EAAQ,CAChBA,EAAO,QAAU,IACpB,EAED,SAASE,EAAWC,EAAU,CAC1B,MAAMJ,EAAgB,KAAK,cAAc,KAAMC,GAAWA,EAAO,KAAOG,CAAQ,EAChFJ,EAAc,QAAUG,EAAU,CAAC,EAAE,EACxC,EAED,qBAAqBE,EAAO,CACxB,MAAMC,EAAgB,KAAK,QAAQ,qBAAqB,wBAAwB,UAC3EV,GAAUA,EAAM,KAAO,KAAK,YAAY,EACzD,EAEY,GAAIU,GAAiB,EAAG,CACpB,MAAMC,EAAiB,KAAK,QAAQ,qBAAqB,wBAAwBD,CAAa,EAE9F,KAAK,QAAQ,qBAAqB,wBAAwBA,CAAa,EAAI,CACvE,GAAIC,EAAe,GACnB,sBAAuBF,EACvB,eAAgBE,EAAe,cACnD,CACA,MACgB,KAAK,QAAQ,qBAAqB,wBAA0B,CACxD,GAAG,KAAK,QAAQ,qBAAqB,wBACrC,CACI,GAAI,KAAK,YAAY,GACrB,sBAAuBF,EACvB,eAAgB,KACnB,CACrB,CAES,CACJ,CACL"}