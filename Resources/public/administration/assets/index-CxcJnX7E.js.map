{"version":3,"file":"index-CxcJnX7E.js","sources":["../../../app/administration/src/module/sw-product/component/sw-product-clone-modal/sw-product-clone-modal.html.twig","../../../app/administration/src/module/sw-product/component/sw-product-clone-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_product_clone_modal %}\n<sw-modal\n    v-if=\"cloningVariants\"\n    :title=\"$tc('sw-product.general.cloneTitle')\"\n    :closable=\"false\"\n    variant=\"small\"\n    class=\"clone-variant__modal\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_clone_modal_description %}\n    <div class=\"clone-variant__description\">\n        {{ $tc('sw-product.general.cloneNotice') }}\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_clone_modal_progress_bar %}\n    <sw-progress-bar\n        class=\"clone-variant-progress-bar\"\n        :value=\"progressInPercentage\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_clone_modal_progress_bar_description %}\n    <div class=\"clone-variant-progress-bar__description\">\n        {{ cloneProgress }} {{ $tc('sw-product.variations.progressTypeOf') }} {{ cloneMaxProgress }} {{ $tc('sw-product.general.cloneSuffix') }}\n    </div>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n","/*\n * @package inventory\n */\n\nimport template from './sw-product-clone-modal.html.twig';\nimport './sw-product-clone-modal.scss';\n\nconst { Criteria } = Cicada.Data;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'numberRangeService',\n    ],\n\n    emits: ['clone-finish'],\n\n    props: {\n        product: {\n            type: Object,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            cloningVariants: false,\n            cloneMaxProgress: 0,\n            cloneProgress: 0,\n        };\n    },\n\n    computed: {\n        progressInPercentage() {\n            return 100 / (this.cloneMaxProgress * this.cloneProgress);\n        },\n\n        repository() {\n            return this.repositoryFactory.create('product');\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.duplicate();\n        },\n\n        duplicate() {\n            this.numberRangeService.reserve('product').then(this.cloneParent).then(this.verifyVariants);\n        },\n\n        async cloneParent(number) {\n            const variantListingConfigOverwrite = this.product.variantListingConfig;\n            if (variantListingConfigOverwrite && variantListingConfigOverwrite.mainVariantId) {\n                variantListingConfigOverwrite.mainVariantId = null;\n            }\n\n            const behavior = {\n                cloneChildren: false,\n                overwrites: {\n                    productNumber: number.number,\n                    name: `${this.product.name} ${this.$tc('global.default.copy')}`,\n                    active: false,\n                    mainVariantId: null,\n                    variantListingConfig: variantListingConfigOverwrite,\n                },\n            };\n\n            await this.repository.save(this.product);\n            const clone = await this.repository.clone(this.product.id, behavior, Cicada.Context.api);\n\n            return { id: clone.id, productNumber: number.number };\n        },\n\n        verifyVariants(duplicate) {\n            this.getChildrenIds().then((ids) => {\n                if (ids.length <= 0) {\n                    this.$emit('clone-finish', { id: duplicate.id });\n                    return;\n                }\n\n                this.cloningVariants = true;\n\n                this.cloneProgress = 1;\n                this.cloneMaxProgress = ids.length;\n\n                this.duplicateVariant(duplicate, ids, () => {\n                    this.cloningVariants = false;\n                    this.$emit('clone-finish', { id: duplicate.id });\n                });\n            });\n        },\n\n        getChildrenIds() {\n            const criteria = new Criteria(1, null);\n            criteria.addFilter(Criteria.equals('parentId', this.product.id));\n\n            return this.repository.searchIds(criteria).then((response) => {\n                return response.data;\n            });\n        },\n\n        duplicateVariant(duplicate, ids, callback) {\n            if (ids.length <= 0) {\n                callback();\n                return;\n            }\n            const id = ids.shift();\n\n            const behavior = {\n                overwrites: {\n                    parentId: duplicate.id,\n                    productNumber: `${duplicate.productNumber}.${this.cloneProgress}`,\n                },\n                cloneChildren: false,\n            };\n\n            this.repository.clone(id, behavior, Cicada.Context.api).then(() => {\n                this.cloneProgress += 1;\n                this.duplicateVariant(duplicate, ids, callback);\n            });\n        },\n    },\n};\n"],"names":["template","Criteria","index","number","variantListingConfigOverwrite","behavior","duplicate","ids","criteria","response","callback","id"],"mappings":"AAAA,MAAeA,EAAA,+wBCOT,CAAE,SAAAC,CAAQ,EAAK,OAAO,KAGbC,EAAA,CACX,SAAAF,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,oBACA,oBACH,EAED,MAAO,CAAC,cAAc,EAEtB,MAAO,CACH,QAAS,CACL,KAAM,OACN,SAAU,EACb,CACJ,EAED,MAAO,CACH,MAAO,CACH,gBAAiB,GACjB,iBAAkB,EAClB,cAAe,CAC3B,CACK,EAED,SAAU,CACN,sBAAuB,CACnB,MAAO,MAAO,KAAK,iBAAmB,KAAK,cAC9C,EAED,YAAa,CACT,OAAO,KAAK,kBAAkB,OAAO,SAAS,CACjD,CACJ,EAED,SAAU,CACN,KAAK,iBAAgB,CACxB,EAED,QAAS,CACL,kBAAmB,CACf,KAAK,UAAS,CACjB,EAED,WAAY,CACR,KAAK,mBAAmB,QAAQ,SAAS,EAAE,KAAK,KAAK,WAAW,EAAE,KAAK,KAAK,cAAc,CAC7F,EAED,MAAM,YAAYG,EAAQ,CACtB,MAAMC,EAAgC,KAAK,QAAQ,qBAC/CA,GAAiCA,EAA8B,gBAC/DA,EAA8B,cAAgB,MAGlD,MAAMC,EAAW,CACb,cAAe,GACf,WAAY,CACR,cAAeF,EAAO,OACtB,KAAM,GAAG,KAAK,QAAQ,IAAI,IAAI,KAAK,IAAI,qBAAqB,CAAC,GAC7D,OAAQ,GACR,cAAe,KACf,qBAAsBC,CACzB,CACjB,EAEY,aAAM,KAAK,WAAW,KAAK,KAAK,OAAO,EAGhC,CAAE,IAFK,MAAM,KAAK,WAAW,MAAM,KAAK,QAAQ,GAAIC,EAAU,OAAO,QAAQ,GAAG,GAEpE,GAAI,cAAeF,EAAO,OAChD,EAED,eAAeG,EAAW,CACtB,KAAK,eAAc,EAAG,KAAMC,GAAQ,CAChC,GAAIA,EAAI,QAAU,EAAG,CACjB,KAAK,MAAM,eAAgB,CAAE,GAAID,EAAU,EAAE,CAAE,EAC/C,MACH,CAED,KAAK,gBAAkB,GAEvB,KAAK,cAAgB,EACrB,KAAK,iBAAmBC,EAAI,OAE5B,KAAK,iBAAiBD,EAAWC,EAAK,IAAM,CACxC,KAAK,gBAAkB,GACvB,KAAK,MAAM,eAAgB,CAAE,GAAID,EAAU,EAAE,CAAE,CACnE,CAAiB,CACjB,CAAa,CACJ,EAED,gBAAiB,CACb,MAAME,EAAW,IAAIP,EAAS,EAAG,IAAI,EACrC,OAAAO,EAAS,UAAUP,EAAS,OAAO,WAAY,KAAK,QAAQ,EAAE,CAAC,EAExD,KAAK,WAAW,UAAUO,CAAQ,EAAE,KAAMC,GACtCA,EAAS,IACnB,CACJ,EAED,iBAAiBH,EAAWC,EAAKG,EAAU,CACvC,GAAIH,EAAI,QAAU,EAAG,CACjBG,IACA,MACH,CACD,MAAMC,EAAKJ,EAAI,QAETF,EAAW,CACb,WAAY,CACR,SAAUC,EAAU,GACpB,cAAe,GAAGA,EAAU,aAAa,IAAI,KAAK,aAAa,EAClE,EACD,cAAe,EAC/B,EAEY,KAAK,WAAW,MAAMK,EAAIN,EAAU,OAAO,QAAQ,GAAG,EAAE,KAAK,IAAM,CAC/D,KAAK,eAAiB,EACtB,KAAK,iBAAiBC,EAAWC,EAAKG,CAAQ,CAC9D,CAAa,CACJ,CACJ,CACL"}