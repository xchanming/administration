const{Component:r}=Shopware,{Criteria:i}=Shopware.Data;r.extend("sw-entity-tag-select","sw-entity-multi-select",{data(){return{tagExists:!0}},methods:{resetActiveItem(t=0){this.$refs.swSelectResultList.setActiveItemIndex(t)},search(t){this.filterSearchGeneratedTags(),Promise.all([this.checkTagExists(this.searchTerm),this.$super("search",t)]).then(()=>{if(!this.tagExists){const e=this.repository.create(this.entityCollection.context,-1);e.name=this.$tc("global.sw-tag-field.listItemAdd",{term:this.searchTerm},0),this.resultCollection.unshift(e),this.$nextTick(this.resetActiveItem)}})},addItem(t){if(t.id===-1){if(this.isLoading)return;this.createNewTag()}else this.$super("addItem",t)},createNewTag(){const t=this.repository.create(this.entityCollection.context);t.name=this.searchTerm,this.isLoading=!0,this.repository.save(t,this.entityCollection.context).then(()=>(this.addItem(t),this.criteria.setPage(1),this.criteria.setLimit(this.resultLimit),this.criteria.setTerm(""),this.searchTerm="",this.resultCollection=null,this.loadData())).then(()=>{this.resetActiveItem()}).finally(()=>{this.isLoading=!1})},checkTagExists(t){if(t.trim().length===0)return this.tagExists=!0,Promise.resolve();const e=new i(1,25);return e.addFilter(i.equals("name",t)),this.repository.search(e,this.context).then(s=>{this.tagExists=s.total>0})},filterSearchGeneratedTags(){this.resultCollection=this.resultCollection.filter(t=>t.id!==-1)}}});
