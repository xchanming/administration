{"version":3,"file":"index-B0dvqKEM.js","sources":["../../../app/administration/src/module/sw-product-stream/component/sw-product-stream-modal-preview/sw-product-stream-modal-preview.html.twig","../../../app/administration/src/module/sw-product-stream/component/sw-product-stream-modal-preview/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_product_stream_modal_preview %}\n<sw-modal\n    class=\"sw-product-stream-modal-preview\"\n    :title=\"`${$tc('sw-product-stream.previewModal.title')} (${total || 0})`\"\n    :is-loading=\"isLoading\"\n    variant=\"full\"\n    @modal-close=\"closeModal\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_stream_modal_preview_content %}\n    <div class=\"sw-product-stream-modal-preview__content\">\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_stream_modal_preview_content_header %}\n        <sw-container class=\"sw-product-stream-modal-preview__content-header\">\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_stream_modal_preview_search_field_label %}\n            <sw-label class=\"sw-product-stream-modal-preview__search-field-label\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_stream_modal_preview_search_field %}\n                <sw-simple-search-field\n                    class=\"sw-product-stream-modal-preview__search-field\"\n                    variant=\"form\"\n                    :value=\"searchTerm\"\n                    :delay=\"750\"\n                    @search-term-change=\"onSearchTermChange\"\n                />\n                {% endblock %}\n            </sw-label>\n            {% endblock %}\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_stream_modal_preview_sales_channel_field_label %}\n            <sw-label class=\"sw-product-stream-modal-preview__sales-channel-field-label\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_stream_modal_preview_sales_channel_field %}\n                <sw-entity-single-select\n                    v-model:value=\"selectedSalesChannel\"\n                    entity=\"sales_channel\"\n                    class=\"sw-product-stream-modal-preview__sales-channel-field\"\n                    name=\"sw-field--selectedSalesChannel\"\n                    :criteria=\"previewSelectionCriteria\"\n                    :disabled=\"isLoading\"\n                    :label=\"$tc('sw-settings.system-config.labelSalesChannelSelect')\"\n                    @update:value=\"onSalesChannelChange\"\n                />\n                {% endblock %}\n            </sw-label>\n            {% endblock %}\n        </sw-container>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_stream_modal_preview_grid %}\n        <sw-data-grid\n            v-if=\"total\"\n            :data-source=\"products\"\n            :columns=\"productColumns\"\n            :show-selection=\"false\"\n            :show-actions=\"false\"\n            :show-previews=\"true\"\n            :is-loading=\"isLoading\"\n            full-page\n        >\n\n            <template #column-name=\"{ item, column }\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_stream_modal_preview_grid_column_name %}\n                <router-link :to=\"{ name: column.routerLink, params: { id: item.id } }\">\n                    <sw-product-variant-info :variations=\"item.variation\">\n                        {{ item.name || item.translated.name }}\n                    </sw-product-variant-info>\n                </router-link>\n                {% endblock %}\n            </template>\n\n            <template #column-active=\"{ item }\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_stream_modal_preview_grid_column_active %}\n                <sw-data-grid-column-boolean\n                    :value=\"item.active\"\n                    :is-inline-edit=\"false\"\n                />\n                {% endblock %}\n            </template>\n\n            <template #column-price=\"{ item }\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_stream_modal_preview_grid_column_price %}\n                {{ currencyFilter(getPriceForDefaultCurrency(item).unitPrice, selectedCurrencyIsoCode) }}\n                {% endblock %}\n            </template>\n\n            <template #column-stock=\"{ item }\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_stream_modal_preview_grid_column_stock %}\n                {{ item.stock }}\n                <sw-color-badge :variant=\"stockColorVariantFilter(item.stock)\" />\n                {% endblock %}\n            </template>\n\n            <template #pagination>\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_stream_modal_preview_grid_pagination %}\n                <sw-pagination\n                    v-bind=\"{ total, page, limit }\"\n                    :total-visible=\"7\"\n                    :auto-hide=\"false\"\n                    @page-change=\"onPageChange\"\n                />\n                {% endblock %}\n            </template>\n        </sw-data-grid>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_stream_modal_preview_empty_state %}\n        <sw-empty-state\n            v-if=\"!total && !isLoading\"\n            :absolute=\"false\"\n            :title=\"$tc('sw-product-stream.previewModal.empty')\"\n        />\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_stream_modal_preview_footer %}\n    <template #modal-footer>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_stream_modal_preview_close_button %}\n        <sw-button\n            class=\"sw-product-stream-modal-preview__close-action\"\n            variant=\"primary\"\n            @click.prevent=\"closeModal\"\n        >\n            {{ $tc('sw-product-stream.previewModal.close') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n","/*\n * @package services-settings\n */\n\nimport template from './sw-product-stream-modal-preview.html.twig';\nimport './sw-product-stream-modal-preview.scss';\n\nconst { Context } = Cicada;\nconst { Criteria } = Cicada.Data;\nconst PRODUCT_COMPARISON_SALES_CHANNEL_TYPE_ID = 'ed535e5722134ac1aa6524f73e26881b';\n\n/**\n * @private\n */\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'productStreamPreviewService',\n    ],\n\n    emits: ['modal-close'],\n\n    props: {\n        filters: {\n            type: Array,\n            required: true,\n        },\n        defaultLimit: {\n            type: Number,\n            default: 25,\n        },\n        defaultSorting: {\n            type: String,\n            default: null,\n            validator(value) {\n                return value === null || value.split(':').length === 2;\n            },\n        },\n    },\n    data() {\n        return {\n            products: [],\n            selectedSalesChannel: null,\n            searchTerm: '',\n            page: 1,\n            total: false,\n            limit: this.defaultLimit,\n            sorting: this.defaultSorting,\n            isLoading: false,\n            selectedCurrencyIsoCode: 'EUR',\n            selectedCurrencyId: Context.app.systemCurrencyId,\n        };\n    },\n\n    computed: {\n        salesChannelRepository() {\n            return this.repositoryFactory.create('sales_channel');\n        },\n\n        salesChannelCriteria() {\n            return new Criteria(1, 1)\n                .addFilter(\n                    Criteria.not('OR', [\n                        Criteria.equals('typeId', PRODUCT_COMPARISON_SALES_CHANNEL_TYPE_ID),\n                    ]),\n                )\n                .addSorting(Criteria.sort('type.iconName', 'ASC'));\n        },\n\n        previewCriteria() {\n            const criteria = new Criteria(this.page, this.limit).setTerm(this.searchTerm);\n\n            if (this.sorting) {\n                const [\n                    field,\n                    direction,\n                ] = this.sorting.split(':');\n                criteria.addSorting(Criteria.sort(field, direction));\n            }\n\n            return criteria;\n        },\n\n        previewSelectionCriteria() {\n            return new Criteria()\n                .addFilter(\n                    Criteria.not('OR', [\n                        Criteria.equals('typeId', PRODUCT_COMPARISON_SALES_CHANNEL_TYPE_ID),\n                    ]),\n                )\n                .addSorting(Criteria.sort('name', 'ASC'));\n        },\n\n        productColumns() {\n            return [\n                {\n                    property: 'name',\n                    label: this.$tc('sw-product-stream.filter.values.product'),\n                    type: 'text',\n                    routerLink: 'sw.product.detail',\n                },\n                {\n                    property: 'manufacturer.name',\n                    label: this.$tc('sw-product-stream.filter.values.manufacturerId'),\n                },\n                {\n                    property: 'active',\n                    label: this.$tc('sw-product-stream.filter.values.active'),\n                    align: 'center',\n                    type: 'bool',\n                },\n                {\n                    property: 'price',\n                    label: this.$tc('sw-product-stream.filter.values.price'),\n                },\n                {\n                    property: 'stock',\n                    label: this.$tc('sw-product-stream.filter.values.stock'),\n                    align: 'right',\n                },\n            ];\n        },\n\n        currencyFilter() {\n            return Cicada.Filter.getByName('currency');\n        },\n\n        stockColorVariantFilter() {\n            return Cicada.Filter.getByName('stockColorVariant');\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.isLoading = true;\n\n            return this.loadSalesChannels()\n                .then(() => {\n                    return this.loadEntityData();\n                })\n                .finally(() => {\n                    this.isLoading = false;\n                });\n        },\n\n        onSearchTermChange(searchTerm) {\n            this.searchTerm = searchTerm;\n            this.page = 1;\n            this.isLoading = true;\n            this.loadEntityData().finally(() => {\n                this.isLoading = false;\n            });\n        },\n\n        onSalesChannelChange() {\n            this.page = 1;\n            this.isLoading = true;\n            this.loadSalesChannelById()\n                .then(() => {\n                    return this.loadEntityData();\n                })\n                .finally(() => {\n                    this.isLoading = false;\n                });\n        },\n\n        loadEntityData() {\n            if (!this.selectedSalesChannel) {\n                return false;\n            }\n\n            return this.productStreamPreviewService\n                .preview(this.selectedSalesChannel, this.previewCriteria, this.mapFiltersForSearch(this.filters), {\n                    'sw-currency-id': this.selectedCurrencyId,\n                    'sw-inheritance': true,\n                })\n                .then((result) => {\n                    this.products = Object.values(result.elements);\n                    this.total = result.total;\n                });\n        },\n\n        loadSalesChannels() {\n            return this.salesChannelRepository.searchIds(this.salesChannelCriteria).then(({ data }) => {\n                this.selectedSalesChannel = data.at(0);\n            });\n        },\n\n        mapFiltersForSearch(filters = [], parentType = null) {\n            return filters.map((condition) => {\n                const { field, type, operator, value, parameters, queries } = condition;\n                const mappedQueries = this.mapFiltersForSearch(queries, type);\n                const mapped = {\n                    field,\n                    type,\n                    operator,\n                    value,\n                    parameters,\n                    queries: mappedQueries,\n                };\n\n                if (field === 'id' || field === 'product.id') {\n                    const newOperator = this.isNotEqualToAnyType(type, parentType) ? 'AND' : 'OR';\n\n                    return {\n                        type: 'multi',\n                        field: null,\n                        operator: newOperator,\n                        value: null,\n                        parameters: null,\n                        queries: [\n                            mapped,\n                            { ...mapped, ...{ field: 'parentId' } },\n                        ],\n                    };\n                }\n\n                return mapped;\n            });\n        },\n\n        closeModal() {\n            this.$emit('modal-close');\n        },\n\n        getPriceForDefaultCurrency(product) {\n            const cheapest = product.calculatedCheapestPrice;\n            let real = product.calculatedPrice;\n\n            if (product.calculatedPrices.length > 0) {\n                real = product.calculatedPrices[product.calculatedPrices.length - 1];\n            }\n\n            if (cheapest.unitPrice !== real.unitPrice) {\n                return real;\n            }\n\n            return cheapest;\n        },\n\n        onPageChange({ page = 1, limit = 25 }) {\n            this.isLoading = true;\n\n            this.page = page;\n            this.limit = limit;\n\n            this.loadEntityData().finally(() => {\n                this.isLoading = false;\n            });\n        },\n\n        loadSalesChannelById() {\n            if (this.selectedSalesChannel === null) {\n                return Promise.resolve();\n            }\n\n            const criteria = this.salesChannelCriteria;\n\n            criteria.addAssociation('currency');\n\n            return this.salesChannelRepository\n                .get(this.selectedSalesChannel, Cicada.Context.api, this.salesChannelCriteria)\n                .then((salesChannel) => {\n                    this.selectedCurrencyIsoCode = salesChannel.currency.isoCode;\n                    this.selectedCurrencyId = salesChannel.currencyId;\n                });\n        },\n\n        isNotEqualToAnyType(type, parentType) {\n            return type === 'equalsAny' && parentType === 'not';\n        },\n    },\n};\n"],"names":["template","Context","Criteria","PRODUCT_COMPARISON_SALES_CHANNEL_TYPE_ID","index","value","criteria","field","direction","searchTerm","result","data","filters","parentType","condition","type","operator","parameters","queries","mappedQueries","mapped","product","cheapest","real","page","limit","salesChannel"],"mappings":"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"}