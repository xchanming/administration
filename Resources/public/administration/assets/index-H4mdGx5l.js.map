{"version":3,"file":"index-H4mdGx5l.js","sources":["../../../app/administration/src/module/sw-import-export/component/profile-wizard/sw-import-export-new-profile-wizard/sw-import-export-new-profile-wizard.html.twig","../../../app/administration/src/module/sw-import-export/component/profile-wizard/sw-import-export-new-profile-wizard/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_import_export_new_profile_wizard %}\n<sw-wizard\n    ref=\"wizard\"\n    class=\"sw-import-export-new-profile-wizard\"\n    variant=\"full\"\n    :right-button-disabled=\"nextButtonDisabled\"\n    :active-page=\"currentlyActivePage\"\n    @close=\"onClose\"\n    @finish=\"onFinish\"\n    @current-page-change=\"onCurrentPageChange\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_new_profile_wizard_page_general %}\n    <sw-wizard-page\n        :position=\"0\"\n        :title=\"pageTitleSnippet('sw-import-export.profile.generalTab')\"\n    >\n        <sw-import-export-new-profile-wizard-general-page\n            :profile=\"profile\"\n            @next-disable=\"onNextDisable\"\n            @next-allow=\"onNextAllow\"\n        />\n    </sw-wizard-page>\n    {% endblock %}\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_new_profile_wizard_page_csv %}\n    <sw-wizard-page\n        :position=\"csvUploadPagePosition\"\n        :title=\"pageTitleSnippet('sw-import-export.profile.csvUploadTab')\"\n    >\n        <sw-import-export-new-profile-wizard-csv-page\n            :profile=\"profile\"\n            @next-disable=\"onNextDisable\"\n            @next-allow=\"onNextAllow\"\n        />\n    </sw-wizard-page>\n    {% endblock %}\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_new_profile_wizard_page_mapping %}\n    <sw-wizard-page\n        :position=\"2\"\n        :title=\"pageTitleSnippet('sw-import-export.profile.mappingsTab')\"\n    >\n        <sw-import-export-new-profile-wizard-mapping-page\n            :profile=\"profile\"\n            :system-required-fields=\"systemRequiredFields\"\n            @next-disable=\"onNextDisable\"\n            @next-allow=\"onNextAllow\"\n        />\n    </sw-wizard-page>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_new_profile_wizard_footer_right_button %}\n    <template #footer-right-button>\n        <div class=\"sw-import-export-new-profile-wizard__footer-right-button-group\">\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_import_export_new_profile_wizard_footer_right_button_finish %}\n            <sw-button\n                v-if=\"showNextButton\"\n                size=\"small\"\n                variant=\"primary\"\n                :disabled=\"nextButtonDisabled\"\n                @click=\"onFinish\"\n            >\n                {{ $tc('sw-import-export.profile.addProfileLabel') }}\n            </sw-button>\n            {% endblock %}\n\n            <template v-else>\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_import_export_new_profile_wizard_footer_right_button_skip %}\n                <sw-button\n                    v-if=\"showCsvSkipButton\"\n                    size=\"small\"\n                    @click=\"onNextPage\"\n                >\n                    {{ $tc('sw-import-export.profile.skipCsvUpload') }}\n                </sw-button>\n                {% endblock %}\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_import_export_new_profile_wizard_footer_right_button_next %}\n                <sw-button\n                    size=\"small\"\n                    variant=\"primary\"\n                    :disabled=\"nextButtonDisabled\"\n                    @click=\"onNextPage\"\n                >\n                    {{ $tc('sw-wizard.nextButton') }}\n                </sw-button>\n            {% endblock %}\n            </template>\n        </div>\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_import_export_new_profile_wizard_violation_modal %}\n    <sw-modal\n        v-if=\"showValidationError\"\n        :title=\"$tc('global.default.error')\"\n        class=\"sw-import-export-new-profile-wizard__violation-modal\"\n        @modal-close=\"resetViolations\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_new_profile_wizard_violation_modal_message %}\n        <p>{{ $tc('sw-import-export.profile.violationMessage') }}</p>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_new_profile_wizard_violation_modal_required_fields %}\n        <ul>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_import_export_new_profile_wizard_violation_modal_required_field %}\n            <li\n                v-for=\"requiredField in missingRequiredFields\"\n                :key=\"requiredField\"\n            >\n                {{ requiredField }}\n            </li>\n            {% endblock %}\n        </ul>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_import_export_new_profile_wizard_violation_modal_footer %}\n        <template #modal-footer>\n            <sw-button\n                size=\"small\"\n                @click=\"resetViolations\"\n            >\n                {{ $tc('sw-import-export.profile.closeViolation') }}\n            </sw-button>\n        </template>\n        {% endblock %}\n    </sw-modal>\n    {% endblock %}\n</sw-wizard>\n{% endblock %}\n","/**\n * @package services-settings\n */\nimport template from './sw-import-export-new-profile-wizard.html.twig';\nimport './sw-import-export-new-profile-wizard.scss';\n\nconst { Criteria } = Cicada.Data;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'feature',\n        'importExportProfileMapping',\n    ],\n\n    emits: [\n        'close',\n        'profile-save',\n    ],\n\n    props: {\n        profile: {\n            type: Object,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            nextButtonDisabled: true,\n            missingRequiredFields: [],\n            systemRequiredFields: {},\n            csvUploadPagePosition: 1,\n            currentlyActivePage: 0,\n            pagesCount: 3,\n        };\n    },\n\n    computed: {\n        profileRepository() {\n            return this.repositoryFactory.create('import_export_profile');\n        },\n\n        showValidationError() {\n            return this.missingRequiredFields.length > 0;\n        },\n\n        showNextButton() {\n            return this.currentlyActivePage >= this.pagesCount - 1;\n        },\n\n        showCsvSkipButton() {\n            return this.currentlyActivePage === this.csvUploadPagePosition;\n        },\n\n        parentProfileCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addFilter(Criteria.equals('sourceEntity', this.profile.sourceEntity));\n            criteria.addFilter(Criteria.equals('systemDefault', true));\n\n            return criteria;\n        },\n    },\n\n    watch: {\n        'profile.sourceEntity': {\n            handler(value) {\n                if (value) {\n                    this.loadSystemRequiredFieldsForEntity(value);\n                }\n            },\n        },\n    },\n\n    methods: {\n        onClose() {\n            this.$emit('close');\n        },\n\n        onFinish() {\n            return this.saveProfile();\n        },\n\n        pageTitleSnippet(snippet) {\n            return `${this.$tc('sw-import-export.profile.newProfileLabel')} - ${this.$tc(snippet)}`;\n        },\n\n        onNextAllow() {\n            this.nextButtonDisabled = false;\n        },\n\n        onNextDisable() {\n            this.nextButtonDisabled = true;\n        },\n\n        loadSystemRequiredFieldsForEntity(entityName) {\n            this.systemRequiredFields = this.importExportProfileMapping.getSystemRequiredFields(entityName);\n        },\n\n        saveProfile() {\n            return this.getParentProfileSelected().then((parentProfile) => {\n                this.checkValidation(parentProfile);\n\n                if (this.missingRequiredFields.length === 0) {\n                    this.$emit('profile-save');\n                }\n            });\n        },\n\n        getParentProfileSelected() {\n            return this.profileRepository\n                .search(this.parentProfileCriteria)\n                .then((results) => {\n                    if (results.total > 0) {\n                        return results[0];\n                    }\n\n                    return null;\n                })\n                .catch(() => {\n                    this.createNotificationError({\n                        message: this.$tc('sw-import-export.profile.messageSearchParentProfileError'),\n                    });\n                });\n        },\n\n        checkValidation(parentProfile) {\n            // Skip validation for only export profiles\n            if (this.profile.type === 'export') {\n                return;\n            }\n\n            const parentMapping = parentProfile ? parentProfile.mapping : [];\n            const isOnlyUpdateProfile =\n                this.profile.config.createEntities === false && this.profile.config.updateEntities === true;\n\n            const validationErrors = this.importExportProfileMapping.validate(\n                this.profile.sourceEntity,\n                this.profile.mapping,\n                parentMapping,\n                isOnlyUpdateProfile,\n            );\n\n            if (validationErrors.missingRequiredFields.length > 0) {\n                this.missingRequiredFields = validationErrors.missingRequiredFields;\n            }\n        },\n\n        resetViolations() {\n            this.missingRequiredFields = [];\n        },\n\n        onCurrentPageChange(activePageIndex) {\n            this.currentlyActivePage = activePageIndex;\n        },\n\n        onNextPage() {\n            this.$refs.wizard.nextPage();\n        },\n    },\n};\n"],"names":["template","Criteria","index","criteria","value","snippet","entityName","parentProfile","results","parentMapping","isOnlyUpdateProfile","validationErrors","activePageIndex"],"mappings":"AAAA,MAAeA,EAAA,urGCMT,CAAE,SAAAC,CAAQ,EAAK,OAAO,KAGbC,EAAA,CACX,SAAAF,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,oBACA,UACA,4BACH,EAED,MAAO,CACH,QACA,cACH,EAED,MAAO,CACH,QAAS,CACL,KAAM,OACN,SAAU,EACb,CACJ,EAED,MAAO,CACH,MAAO,CACH,mBAAoB,GACpB,sBAAuB,CAAE,EACzB,qBAAsB,CAAE,EACxB,sBAAuB,EACvB,oBAAqB,EACrB,WAAY,CACxB,CACK,EAED,SAAU,CACN,mBAAoB,CAChB,OAAO,KAAK,kBAAkB,OAAO,uBAAuB,CAC/D,EAED,qBAAsB,CAClB,OAAO,KAAK,sBAAsB,OAAS,CAC9C,EAED,gBAAiB,CACb,OAAO,KAAK,qBAAuB,KAAK,WAAa,CACxD,EAED,mBAAoB,CAChB,OAAO,KAAK,sBAAwB,KAAK,qBAC5C,EAED,uBAAwB,CACpB,MAAMG,EAAW,IAAIF,EAAS,EAAG,EAAE,EACnC,OAAAE,EAAS,UAAUF,EAAS,OAAO,eAAgB,KAAK,QAAQ,YAAY,CAAC,EAC7EE,EAAS,UAAUF,EAAS,OAAO,gBAAiB,EAAI,CAAC,EAElDE,CACV,CACJ,EAED,MAAO,CACH,uBAAwB,CACpB,QAAQC,EAAO,CACPA,GACA,KAAK,kCAAkCA,CAAK,CAEnD,CACJ,CACJ,EAED,QAAS,CACL,SAAU,CACN,KAAK,MAAM,OAAO,CACrB,EAED,UAAW,CACP,OAAO,KAAK,aACf,EAED,iBAAiBC,EAAS,CACtB,MAAO,GAAG,KAAK,IAAI,0CAA0C,CAAC,MAAM,KAAK,IAAIA,CAAO,CAAC,EACxF,EAED,aAAc,CACV,KAAK,mBAAqB,EAC7B,EAED,eAAgB,CACZ,KAAK,mBAAqB,EAC7B,EAED,kCAAkCC,EAAY,CAC1C,KAAK,qBAAuB,KAAK,2BAA2B,wBAAwBA,CAAU,CACjG,EAED,aAAc,CACV,OAAO,KAAK,yBAAwB,EAAG,KAAMC,GAAkB,CAC3D,KAAK,gBAAgBA,CAAa,EAE9B,KAAK,sBAAsB,SAAW,GACtC,KAAK,MAAM,cAAc,CAE7C,CAAa,CACJ,EAED,0BAA2B,CACvB,OAAO,KAAK,kBACP,OAAO,KAAK,qBAAqB,EACjC,KAAMC,GACCA,EAAQ,MAAQ,EACTA,EAAQ,CAAC,EAGb,IACV,EACA,MAAM,IAAM,CACT,KAAK,wBAAwB,CACzB,QAAS,KAAK,IAAI,0DAA0D,CACpG,CAAqB,CACrB,CAAiB,CACR,EAED,gBAAgBD,EAAe,CAE3B,GAAI,KAAK,QAAQ,OAAS,SACtB,OAGJ,MAAME,EAAgBF,EAAgBA,EAAc,QAAU,CAAA,EACxDG,EACF,KAAK,QAAQ,OAAO,iBAAmB,IAAS,KAAK,QAAQ,OAAO,iBAAmB,GAErFC,EAAmB,KAAK,2BAA2B,SACrD,KAAK,QAAQ,aACb,KAAK,QAAQ,QACbF,EACAC,CAChB,EAEgBC,EAAiB,sBAAsB,OAAS,IAChD,KAAK,sBAAwBA,EAAiB,sBAErD,EAED,iBAAkB,CACd,KAAK,sBAAwB,EAChC,EAED,oBAAoBC,EAAiB,CACjC,KAAK,oBAAsBA,CAC9B,EAED,YAAa,CACT,KAAK,MAAM,OAAO,UACrB,CACJ,CACL"}