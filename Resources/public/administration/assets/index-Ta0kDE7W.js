import{o as i,e as c}from"./channel-DxwX5hMG.js";import"./administration-BlrHhDOI.js";const l=`{% block sw_cms_layout_assignment_modal %} <sw-modal :title="$tc('sw-cms.detail.sidebar.titleLayoutAssignment')" class="sw-cms-layout-assignment-modal" @modal-close="onAbort" > {% block sw_cms_layout_assignment_modal_loader %} <sw-loader v-if="isLoading" class="sw-cms-layout-assignment-modal__loader" /> {% endblock %} {% block sw_cms_layout_assignment_modal_info_text_general %} <p v-if="page.type !== 'page' && page.type !== 'product_detail'" class="sw-cms-layout-assignment-modal__info-text" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.infoText') }} </p> {% endblock %} {% block sw_cms_layout_assignment_modal_info_text_shop_pages %} <p v-if="page.type === 'page'" class="sw-cms-layout-assignment-modal__info-text" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.infoTextShopPages') }} </p> {% endblock %} {% block sw_cms_layout_assignment_modal_info_text_product_detail_pages %} <p v-if="page.type === 'product_detail'" class="sw-cms-layout-assignment-modal__info-text" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.infoTextProductDetailPages') }} </p> {% endblock %} {% block sw_cms_layout_assignment_modal_tabs %} <sw-tabs position-identifier="sw-cms-layout-assignment-modal" class="sw-cms-layout-assignment-modal__tabs" default-item="categories" > <template #default="{ active }"> {% block sw_cms_layout_assignment_modal_tab_categories %} <sw-tabs-item v-if="page.type === 'page' || page.type === 'landingpage'" :active-tab="active" :title="$tc('sw-cms.components.cmsLayoutAssignmentModal.tabCategories')" class="sw-cms-layout-assignment-modal__tab-categories" name="categories" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.tabCategories') }} </sw-tabs-item> {% endblock %} {% block sw_cms_layout_assignment_modal_tab_shop_pages %} <sw-tabs-item v-if="page.type === 'page'" v-tooltip="{ message: $tc('sw-privileges.tooltip.warning'), showOnDisabledElements: true, disabled: acl.can('system.system_config') }" :active-tab="active" :title="$tc('sw-cms.components.cmsLayoutAssignmentModal.tabShopPages')" :disabled="!acl.can('system.system_config')" class="sw-cms-layout-assignment-modal__tab-shop-pages" name="shop_pages" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.tabShopPages') }} </sw-tabs-item> {% endblock %} {% block sw_cms_layout_assignment_modal_tab_landing_pages %} <sw-tabs-item v-if="page.type === 'landingpage'" v-tooltip="{ message: $tc('sw-privileges.tooltip.warning'), showOnDisabledElements: true, disabled: acl.can('system.system_config') }" :active-tab="active" :title="$tc('sw-cms.components.cmsLayoutAssignmentModal.tabLandingPages')" :disabled="!acl.can('system.system_config')" class="sw-cms-layout-assignment-modal__tab-landing-pages" name="landing_pages" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.tabLandingPages') }} </sw-tabs-item> {% endblock %} </template> <template #content="{ active }"> {% block sw_cms_layout_assignment_modal_landing_page_select %} <template v-if="active === 'landing_pages'"> {% block sw_cms_layout_assignment_modal_landing_page_select_field %} <sw-entity-multi-select v-model:entityCollection="page.landingPages" class="sw-cms-layout-assignment-modal__landing-page-select" :label="$tc('global.entities.landing_page')" :placeholder="$tc('sw-cms.components.cmsLayoutAssignmentModal.placeholderLandingPages')" entity-name="landing_page" /> {% endblock %} </template> {% endblock %} {% block sw_cms_layout_assignment_modal_category_select %} <template v-if="!isProductDetailPage && active === 'categories'"> {% block sw_cms_layout_assignment_modal_category_select_field %} <sw-category-tree-field key="categorySelect" :categories-collection="page.categories" :label="$tc('sw-cms.components.cmsLayoutAssignmentModal.labelCategories')" :placeholder="$tc('sw-cms.components.cmsLayoutAssignmentModal.placeholderCategories')" :page-id="page.id" :is-categories-loading="isCategoriesLoading" class="sw-cms-layout-assignment-modal__category-select" @categories-load-more="onExtraCategories" /> {% endblock %} </template> {% endblock %} {% block sw_cms_layout_assignment_modal_shop_pages_select %} <template v-if="!isProductDetailPage && active === 'shop_pages'"> {% block sw_cms_layout_assignment_modal_shop_pages_select_sales_channel_field %} <sw-entity-single-select v-model:value="shopPageSalesChannelId" class="sw-cms-layout-assignment-modal__sales-channel-select" entity="sales_channel" :label="$tc('sw-cms.components.cmsLayoutAssignmentModal.labelSalesChannel')" :placeholder="$tc('sw-cms.components.cmsLayoutAssignmentModal.placeholderSalesChannel')" :reset-option="$tc('sw-cms.components.cmsLayoutAssignmentModal.resetOptionSalesChannel')" :help-text="$tc('sw-cms.components.cmsLayoutAssignmentModal.helpTextSalesChannel')" show-clearable-button @update:value="onInputSalesChannelSelect" /> {% endblock %} {% block sw_cms_layout_assignment_modal_shop_pages_select_field %} <sw-inherit-wrapper v-model:value="selectedShopPages[shopPageSalesChannelId]" :inherited-value="selectedShopPages.null" :has-parent="shopPageSalesChannelId !== null" :label="$tc('sw-cms.components.cmsLayoutAssignmentModal.labelShopPages')" > <template #content="props"> <sw-multi-select class="sw-cms-layout-assignment-modal__shop-page-select" :options="shopPages" :disabled="props.isInherited" :value="props.currentValue" :map-inheritance="props" @update:value="props.updateCurrentValue" /> </template> </sw-inherit-wrapper> {% endblock %} </template> {% endblock %} {% block sw_cms_layout_assignment_modal_product_detail_pages_select %} <template v-if="page.type === 'product_detail'"> {% block sw_entity_many_to_many_assignment_card_select %} <sw-cms-product-assignment class="sw-cms-layout-assignment-modal__product-select" :local-mode="true" :entity-collection="page.products" :columns="productColumns" :criteria="productCriteria" :select-label="$tc('sw-cms.components.cmsLayoutAssignmentModal.products.productAssignmentLabel')" :placeholder="$tc('sw-cms.components.cmsLayoutAssignmentModal.products.productAssignmentPlaceholder')" > {% block sw_cms_layout_assignment_modal_product_detail_pages_column_name %} <template #column-name="{ item, column }"> <router-link :to="{ name: column.routerLink, params: { id: item.id } }" > <sw-product-variant-info :variations="item.options" @click="onAbort" > {{ item.translated.name }} </sw-product-variant-info> </router-link> </template> {% endblock %} {% block sw_cms_layout_assignment_modal_product_detail_pages_column_manufacturer %} <template #column-manufacturer.name="{ item, column }"> <router-link v-if="item.manufacturerId" :to="{ name: column.routerLink, params: { id: item.manufacturerId } }" > <p role="button" tabindex="0" @click="onAbort" @keydown.enter="onAbort" > {{ item.manufacturer.translated.name }} </p> </router-link> <span v-else></span> </template> {% endblock %} {% block sw_cms_layout_assignment_modal_product_detail_pages_empty_state %} <template #empty-state> <img class="sw-cms-product-assignment__empty-state" :src="assetFilter('/administration/static/img/empty-states/products-empty-state.svg')" alt="" > <p>{{ $tc('sw-cms.components.cmsLayoutAssignmentModal.products.productAssignmentEmptyStateDescription') }}</p> </template> {% endblock %} </sw-cms-product-assignment> {% endblock %} </template> {% endblock %} </template> </sw-tabs> {% endblock %} {% block sw_cms_layout_assignment_modal_confirm_changes %} <sw-modal v-if="showConfirmChangesModal" class="sw-cms-layout-assignment-modal__confirm-changes-modal" size="650px" :title="$tc('sw-cms.components.cmsLayoutAssignmentModal.confirmChangesTitle')" @modal-close="closeConfirmChangesModal" > {% block sw_cms_layout_assignment_modal_confirm_changes_text_categories %} <p v-if="hasDeletedCategories" class="sw-cms-layout-assignment-modal__confirm-text-categories" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.confirmChangesTextCategories') }} </p> {% endblock %} {% block sw_cms_layout_assignment_modal_confirm_changes_text_assigned_layouts %} <p v-if="hasCategoriesWithAssignedLayouts" class="sw-cms-layout-assignment-modal__confirm-text-assigned-layouts" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.confirmChangesTextCategoriesAssignedLayouts') }} </p> {% endblock %} {% block sw_cms_layout_assignment_modal_confirm_changes_text_landing_pages %} <p v-if="hasDeletedLandingPages" class="sw-cms-layout-assignment-modal__confirm-text-landing-pages" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.confirmChangesTextLandingPages') }} </p> {% endblock %} {% block sw_cms_layout_assignment_modal_confirm_changes_text_assigned_layouts_landing_pages %} <p v-if="hasLandingPagesWithAssignedLayouts" class="sw-cms-layout-assignment-modal__confirm-text-assigned-layouts" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.confirmChangesTextLandingPagesAssignedLayouts') }} </p> {% endblock %} {% block sw_cms_layout_assignment_modal_confirm_changes_text_shop_pages %} <p v-if="hasDeletedShopPages" class="sw-cms-layout-assignment-modal__confirm-text-shop-pages" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.confirmChangesTextShopPages') }} </p> {% endblock %} {% block sw_cms_layout_assignment_modal_confirm_changes_text_products %} <p v-if="hasDeletedProducts" class="sw-cms-layout-assignment-modal__confirm-text-products" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.confirmChangesTextProducts') }} </p> {% endblock %} {% block sw_cms_layout_assignment_modal_confirm_changes_text_products_assigned_layouts %} <p v-if="hasProductsWithAssignedLayouts" class="sw-cms-layout-assignment-modal__confirm-text-products-assigned-layouts" > {{ $tc('sw-cms.components.cmsLayoutAssignmentModal.confirmChangesTextProductsAssignedLayouts') }} </p> {% endblock %} {% block sw_cms_layout_assignment_modal_confirm_changes_text %} <p><strong>{{ $tc('sw-cms.components.cmsLayoutAssignmentModal.confirmChangesText') }}</strong></p> {% endblock %} <template #modal-footer> {% block sw_cms_layout_assignment_modal_confirm_changes_keep_editing %} <sw-button class="sw-cms-layout-assignment-modal__action-keep-editing" size="small" @click="onKeepEditing" > {{ $tc('global.default.cancel') }} </sw-button> {% endblock %} <div class="sw-cms-layout-assignment-modal__confirm-changes-modal-main-actions"> {% block sw_cms_layout_assignment_modal_confirm_changes_discard %} <sw-button class="sw-cms-layout-assignment-modal__action-changes-discard" variant="ghost" size="small" @click="onDiscardChanges" > {{ $tc('global.default.discard') }} </sw-button> {% endblock %} {% block sw_cms_layout_assignment_modal_confirm_changes_confirm %} <sw-button class="sw-cms-layout-assignment-modal__action-changes-confirm" variant="primary" size="small" @click="onConfirmChanges" > {{ $tc('global.default.confirm') }} </sw-button> {% endblock %} </div> </template> </sw-modal> {% endblock %} {% block sw_cms_layout_assignment_modal_actions %} <template #modal-footer> {% block sw_cms_layout_assignment_action_abort %} <sw-button :disabled="isLoading" class="sw-cms-layout-assignment-modal__action-cancel" size="small" @click="onAbort" > {{ $tc('global.default.cancel') }} </sw-button> {% endblock %} {% block sw_cms_layout_assignment_action_confirm %} <sw-button :disabled="isLoading" class="sw-cms-layout-assignment-modal__action-confirm" size="small" variant="primary" @click="onConfirm" > {{ $tc('global.default.apply') }} </sw-button> {% endblock %} </template> {% endblock %} </sw-modal> {% endblock %}`,{cloneDeep:m}=Cicada.Utils.object,{Criteria:n}=Cicada.Data,r=Cicada.Component.wrapComponentConfig({template:l,compatConfig:Cicada.compatConfig,inject:["repositoryFactory","systemConfigApiService","acl"],emits:["modal-close"],mixins:[Cicada.Mixin.getByName("notification")],props:{page:{type:Object,required:!0}},data(){return{shopPageSalesChannelId:null,previousCategories:[],previousCategoryIds:[],previousLandingPages:[],previousLandingPageIds:[],showConfirmChangesModal:!1,isLoading:!1,selectedShopPages:{},previousShopPages:{},confirmedCategories:!1,confirmedShopPages:!1,confirmedProducts:!1,confirmedLandingPages:!1,hasDeletedCategories:!1,hasDeletedShopPages:!1,hasDeletedProducts:!1,hasDeletedLandingPages:!1,hasCategoriesWithAssignedLayouts:!1,hasProductsWithAssignedLayouts:!1,hasLandingPagesWithAssignedLayouts:!1,previousProducts:[],previousProductIds:[],categoryIndex:1,isCategoriesLoading:!1}},computed:{systemConfigDomain(){return"core.basicInformation"},shopPages(){return[{label:this.$tc("sw-cms.components.cmsLayoutAssignmentModal.shopPages.tosPage"),value:"core.basicInformation.tosPage"},{label:this.$tc("sw-cms.components.cmsLayoutAssignmentModal.shopPages.privacyPage"),value:"core.basicInformation.privacyPage"},{label:this.$tc("sw-cms.components.cmsLayoutAssignmentModal.shopPages.404Page"),value:"core.basicInformation.404Page"},{label:this.$tc("sw-cms.components.cmsLayoutAssignmentModal.shopPages.maintenancePage"),value:"core.basicInformation.maintenancePage"},{label:this.$tc("sw-cms.components.cmsLayoutAssignmentModal.shopPages.contactPage"),value:"core.basicInformation.contactPage"},{label:this.$tc("sw-cms.components.cmsLayoutAssignmentModal.shopPages.newsletterPage"),value:"core.basicInformation.newsletterPage"}]},productColumns(){return[{property:"name",label:this.$tc("sw-cms.components.cmsLayoutAssignmentModal.products.columnNameLabel"),dataIndex:"name",routerLink:"sw.product.detail",sortable:!1},{property:"manufacturer.name",label:this.$tc("sw-cms.components.cmsLayoutAssignmentModal.products.columnManufacturerLabel"),routerLink:"sw.manufacturer.detail",sortable:!1}]},productCriteria(){const s=new n(1,5);return s.addAssociation("options.group").addAssociation("manufacturer").addFilter(n.equals("parentId",null)),s},isProductDetailPage(){return this.page.type==="product_detail"},assetFilter(){return Cicada.Filter.getByName("asset")},categoryRepository(){return this.repositoryFactory.create("category")}},created(){this.createdComponent()},methods:{createdComponent(){this.previousCategories=[...this.page.categories],this.previousCategoryIds=this.page.categories.getIds(),this.previousLandingPages=[...this.page.landingPages],this.previousLandingPageIds=this.page.landingPages.getIds(),this.previousProducts=[...this.page.products],this.previousProductIds=this.page.products.getIds(),this.loadSystemConfig()},onModalClose(s=!1){this.$emit("modal-close",s)},saveShopPages(){if(this.page.type!=="page"||!this.acl.can("system.system_config"))return Promise.resolve();const s={};let e=0;return Object.keys(this.selectedShopPages).forEach(a=>{var t;s[a]={},this.selectedShopPages[a]!==null&&((t=this.selectedShopPages[a])==null||t.forEach(o=>{s[a][o]=this.page.id}))}),Object.keys(this.previousShopPages).forEach(a=>{var t;this.previousShopPages[a]!==null&&((t=this.previousShopPages[a])==null||t.forEach(o=>{s[a][o]===void 0&&(s[a][o]=null,e+=1)}))}),!this.confirmedShopPages&&e>0?(this.hasDeletedShopPages=!0,this.openConfirmChangesModal(),Promise.reject()):this.systemConfigApiService.batchSave(s).catch(()=>{this.createNotificationError({message:this.$tc("sw-cms.components.cmsLayoutAssignmentModal.shopPagesSaveError")})})},loadSystemConfig(){return this.page.type!=="page"||!this.acl.can("system.system_config")||this.selectedShopPages.hasOwnProperty(this.shopPageSalesChannelId)?!1:(this.isLoading=!0,this.systemConfigApiService.getValues(this.systemConfigDomain,this.shopPageSalesChannelId).then(s=>{const e=[];Object.keys(s).forEach(a=>{this.shopPages.find(o=>o.value===a)&&s[a]===this.page.id&&e.push(a)}),e.length>0?this.isCompatEnabled("INSTANCE_SET")?this.$set(this.selectedShopPages,this.shopPageSalesChannelId,e):this.selectedShopPages[this.shopPageSalesChannelId]=e:this.isCompatEnabled("INSTANCE_SET")?this.$set(this.selectedShopPages,this.shopPageSalesChannelId,null):this.selectedShopPages[this.shopPageSalesChannelId]=null,this.previousShopPages=m(this.selectedShopPages)}).catch(()=>{this.createNotificationError({message:this.$tc("sw-cms.components.cmsLayoutAssignmentModal.shopPagesLoadError")})}).finally(()=>{this.isLoading=!1}))},validateCategories(){if(this.confirmedCategories)return Promise.resolve();const s=this.page.categories.getIds(),e=i.difference(s,this.previousCategoryIds);return this.previousCategoryIds.length>s.length||this.previousCategoryIds.length===s.length&&e.length?(this.hasDeletedCategories=!0,this.openConfirmChangesModal(),Promise.reject()):this.page.categories.find(t=>t.hasOwnProperty("cmsPageId")&&t.cmsPageId!==null&&t.cmsPageId!==this.page.id)?(this.hasCategoriesWithAssignedLayouts=!0,this.openConfirmChangesModal(),Promise.reject()):Promise.resolve()},validateLandingPages(){if(this.confirmedLandingPages)return Promise.resolve();const s=this.page.landingPages.getIds(),e=i.difference(s,this.previousLandingPageIds);return this.previousLandingPageIds.length>s.length||this.previousLandingPageIds.length===s.length&&e.length?(this.hasDeletedLandingPages=!0,this.openConfirmChangesModal(),Promise.reject()):this.page.landingPages.find(t=>t.hasOwnProperty("cmsPageId")&&t.cmsPageId!==null&&t.cmsPageId!==this.page.id)?(this.hasLandingPagesWithAssignedLayouts=!0,this.openConfirmChangesModal(),Promise.reject()):Promise.resolve()},validateProducts(){if(this.confirmedProducts)return Promise.resolve();const s=this.page.products.getIds(),e=i.difference(s,this.previousProductIds);return this.previousProductIds.length>s.length||this.previousProductIds.length===s.length&&e.length?(this.hasDeletedProducts=!0,this.openConfirmChangesModal(),Promise.reject()):this.page.products.find(t=>t.hasOwnProperty("cmsPageId")&&t.cmsPageId!==null&&t.cmsPageId!==this.page.id)?(this.hasProductsWithAssignedLayouts=!0,this.openConfirmChangesModal(),Promise.reject()):Promise.resolve()},onConfirm(){this.isLoading=!0,Promise.all([this.validateCategories(),this.saveShopPages(),this.validateProducts(),this.validateLandingPages()]).then(()=>{this.onModalClose(!0)}).catch(()=>{this.isLoading=!1})},openConfirmChangesModal(){this.showConfirmChangesModal=!0},closeConfirmChangesModal(){this.showConfirmChangesModal=!1},async onDiscardChanges(){this.discardCategoryChanges(),this.discardShopPageChanges(),this.discardProductChanges(),this.discardLandingPageChanges(),this.closeConfirmChangesModal(),await this.$nextTick(),this.onModalClose()},discardCategoryChanges(){this.page.categories=new c(this.page.categories.source,this.page.categories.entity,Cicada.Context.api,null,this.previousCategories??[])},discardLandingPageChanges(){this.page.landingPages=new c(this.page.landingPages.source,this.page.landingPages.entity,Cicada.Context.api,null,this.previousLandingPages??[])},discardShopPageChanges(){this.page.type==="page"&&(this.selectedShopPages=this.previousShopPages)},discardProductChanges(){this.page.products=new c(this.page.products.source,this.page.products.entity,Cicada.Context.api,null,this.previousProducts)},onAbort(){this.discardCategoryChanges(),this.discardShopPageChanges(),this.discardProductChanges(),this.discardLandingPageChanges(),this.onModalClose()},onKeepEditing(){this.closeConfirmChangesModal()},async onConfirmChanges(){this.closeConfirmChangesModal(),this.confirmedCategories=!0,this.confirmedLandingPages=!0,this.confirmedShopPages=!0,this.confirmedProducts=!0,await this.$nextTick(),this.onConfirm()},onInputSalesChannelSelect(){this.loadSystemConfig()},async onExtraCategories(){this.isCategoriesLoading=!0,this.categoryIndex+=1;const s=new n(this.categoryIndex,25);s.addFilter(n.equals("cmsPageId",this.page.id));const e=await this.categoryRepository.search(s);(e==null?void 0:e.length)>0&&this.page.categories.push(...e),this.isCategoriesLoading=!1}}});export{r as default};
//# sourceMappingURL=index-Ta0kDE7W.js.map
