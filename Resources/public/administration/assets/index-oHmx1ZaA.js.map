{"version":3,"file":"index-oHmx1ZaA.js","sources":["../../../app/administration/src/module/sw-settings-listing/page/sw-settings-listing-option-base/sw-settings-listing-option-base.html.twig","../../../app/administration/src/module/sw-settings-listing/page/sw-settings-listing-option-base/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_settings_listing_option_base %}\n<sw-page class=\"sw-settings-listing-base\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_listing_option_base_smart_bar_heading %}\n    <template #smart-bar-header>\n        <h2>{{ smartBarHeading }}</h2>\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_listing_option_base_language_switch %}\n    <template #language-switch>\n        <sw-language-switch @on-change=\"onChangeLanguage\" />\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_listing_option_base_smart_bar_actions %}\n    <template #smart-bar-actions>\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_listing_option_base_smart_bar_actions_save %}\n        <sw-button\n            variant=\"primary\"\n            :disabled=\"isSaveButtonDisabled\"\n            @click=\"onSave\"\n        >\n            {{ $t('global.default.save') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_listing_option_base_smart_content %}\n    <template #content>\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_listing_option_base_smart_content_general_info %}\n        <sw-settings-listing-option-general-info\n            v-if=\"productSortingEntity\"\n            :sorting-option=\"productSortingEntity\"\n            :is-default-sorting=\"isDefaultSorting\"\n            :label-error=\"sortingOptionLabelError\"\n            :technical-name-error=\"sortingOptionTechnicalNameError\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_listing_option_base_smart_bar_actions_grid %}\n        <sw-settings-listing-option-criteria-grid\n            v-if=\"productSortingEntity\"\n            :product-sorting-entity=\"productSortingEntity\"\n            @criteria-delete=\"onDeleteCriteria\"\n            @criteria-add=\"onAddCriteria\"\n            @inline-edit-save=\"onSave\"\n            @inline-edit-cancel=\"onCancelEditCriteria\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_listing_option_base_smart_bar_actions_grid_delete_modal %}\n        <sw-settings-listing-delete-modal\n            v-if=\"toBeDeletedCriteria\"\n            :title=\"$tc('sw-settings-listing.base.delete.modalTitle')\"\n            :description=\"$tc('sw-settings-listing.base.delete.modalDescription')\"\n            @cancel=\"toBeDeletedCriteria = null\"\n            @delete=\"onConfirmDeleteCriteria\"\n        />\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n","/**\n * @package inventory\n */\nimport template from './sw-settings-listing-option-base.html.twig';\nimport './sw-settings-listing-option-base.scss';\n\nconst { Mixin } = Cicada;\nconst { Criteria } = Cicada.Data;\nconst { CicadaError } = Cicada.Classes;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'systemConfigApiService',\n    ],\n\n    mixins: [\n        Mixin.getByName('notification'),\n    ],\n\n    data() {\n        return {\n            productSortingEntity: null,\n            toBeDeletedCriteria: null,\n            customFieldOptions: [],\n            customFields: [],\n            defaultSortingId: null,\n            sortingOptionTechnicalNameError: null,\n            sortingOptionLabelError: null,\n        };\n    },\n\n    computed: {\n        productSortingRepository() {\n            return this.repositoryFactory.create('product_sorting');\n        },\n\n        customFieldRepository() {\n            return this.repositoryFactory.create('custom_field');\n        },\n\n        smartBarHeading() {\n            return this.productSortingEntity && this.productSortingEntity.label\n                ? this.productSortingEntity.label\n                : this.$tc('sw-settings-listing.base.smartBarTitle');\n        },\n\n        isGeneralCardLoading() {\n            return !this.productSortingEntity;\n        },\n\n        customFieldCriteria() {\n            return new Criteria(1, 25);\n        },\n\n        productSortingEntityCriteria() {\n            return new Criteria(1, 25);\n        },\n\n        isSaveButtonDisabled() {\n            return (\n                !this.productSortingEntity ||\n                this.productSortingEntity.fields.length <= 0 ||\n                this.productSortingEntity.fields.some((field) => !field.field || field.field === 'customField')\n            );\n        },\n\n        isDefaultSorting() {\n            return this.defaultSortingId === this.productSortingEntity.id;\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            Promise.all([\n                this.fetchProductSortingEntity(),\n                this.fetchCustomFields(),\n                this.fetchDefaultSorting(),\n            ]);\n        },\n\n        fetchProductSortingEntity() {\n            const productSortingEntityId = this.getProductSortingEntityId();\n\n            this.productSortingRepository\n                .get(productSortingEntityId, Cicada.Context.api, this.productSortingEntityCriteria)\n                .then((response) => {\n                    if (!Array.isArray(response.fields)) {\n                        response.fields = [];\n                    }\n\n                    this.productSortingEntity = response;\n                });\n        },\n\n        fetchCustomFields() {\n            return this.customFieldRepository.search(this.customFieldCriteria).then((response) => {\n                this.customFields = response;\n            });\n        },\n\n        fetchDefaultSorting() {\n            this.systemConfigApiService.getValues('core.listing').then((response) => {\n                this.defaultSortingId = response['core.listing.defaultSorting'];\n            });\n        },\n\n        getProductSortingEntityId() {\n            return this.$route.params.id;\n        },\n\n        async isValidSortingOption() {\n            if (!this.productSortingEntity.key) {\n                this.sortingOptionTechnicalNameError = new CicadaError({\n                    code: 'c1051bb4-d103-4f74-8988-acbcafc7fdc3',\n                });\n            }\n\n            if (await this.searchForAlreadyExistingKey(this.productSortingEntity.key)) {\n                this.sortingOptionTechnicalNameError = new CicadaError({\n                    code: 'DUPLICATED_NAME',\n                });\n            }\n\n            if (!this.productSortingEntity.label) {\n                this.sortingOptionLabelError = new CicadaError({\n                    code: 'c1051bb4-d103-4f74-8988-acbcafc7fdc3',\n                });\n            }\n\n            return !(this.sortingOptionTechnicalNameError || this.sortingOptionLabelError);\n        },\n\n        async searchForAlreadyExistingKey(key) {\n            if (!key) {\n                return false;\n            }\n\n            const criteria = new Criteria();\n\n            criteria.addFilter(Criteria.equals('key', key));\n\n            const response = await this.productSortingRepository.search(criteria);\n\n            if (!response.first()) {\n                return false;\n            }\n\n            return response.first().id !== this.productSortingEntity.id;\n        },\n\n        async saveProductSorting() {\n            if (await this.isValidSortingOption()) {\n                return this.productSortingRepository.save(this.productSortingEntity);\n            }\n            return Promise.reject();\n        },\n\n        onSave() {\n            this.sortingOptionTechnicalNameError = null;\n            this.sortingOptionLabelError = null;\n\n            this.transformCustomFieldCriterias();\n\n            this.productSortingEntity.fields = this.productSortingEntity.fields.filter((field) => {\n                return field.field !== 'customField';\n            });\n\n            return this.saveProductSorting()\n                .then(() => {\n                    const sortingOptionName = this.productSortingEntity.label;\n\n                    this.createNotificationSuccess({\n                        message: this.$t('sw-settings-listing.base.notification.saveSuccess', { sortingOptionName }),\n                    });\n                })\n                .catch(() => {\n                    const sortingOptionName = this.productSortingEntity.label;\n\n                    this.createNotificationError({\n                        message: this.$t('sw-settings-listing.base.notification.saveError', { sortingOptionName }),\n                    });\n                });\n        },\n\n        getCriteriaTemplate(fieldName) {\n            return {\n                field: fieldName,\n                order: 'asc',\n                priority: 1,\n                naturalSorting: 0,\n            };\n        },\n\n        onDeleteCriteria(toBeRemovedItem) {\n            this.toBeDeletedCriteria = toBeRemovedItem;\n        },\n\n        onConfirmDeleteCriteria() {\n            // filter out criteria\n            this.productSortingEntity.fields = this.productSortingEntity.fields.filter((currentCriteria) => {\n                return currentCriteria.field !== this.toBeDeletedCriteria.field;\n            });\n\n            // save product sorting entity\n            this.saveProductSorting().finally(() => {\n                // close delete modal\n                this.toBeDeletedCriteria = null;\n            });\n        },\n\n        onAddCriteria(fieldName) {\n            if (!fieldName) {\n                return;\n            }\n\n            const newCriteria = this.getCriteriaTemplate(fieldName);\n\n            if (!this.productSortingEntity.fields) {\n                this.productSortingEntity.fields = [];\n            }\n\n            this.productSortingEntity.fields.push(newCriteria);\n        },\n\n        onCancelEditCriteria(item) {\n            if (this.getProductSortingEntityId()) {\n                this.fetchProductSortingEntity();\n\n                return;\n            }\n\n            this.productSortingEntity.fields = this.productSortingEntity.fields.filter((currentCriteria) => {\n                return currentCriteria.field !== item.field;\n            });\n        },\n\n        isCriteriaACustomField(technicalName) {\n            return this.customFields.some((currentCustomField) => {\n                return currentCustomField.name === technicalName;\n            });\n        },\n\n        transformCustomFieldCriterias() {\n            this.productSortingEntity.fields = this.productSortingEntity.fields.map((currentField) => {\n                if (!this.isCriteriaACustomField(currentField.field)) {\n                    return currentField;\n                }\n\n                currentField.field = `customFields.${currentField.field}`;\n\n                return currentField;\n            });\n        },\n\n        onChangeLanguage() {\n            this.fetchProductSortingEntity();\n        },\n    },\n};\n"],"names":["template","Mixin","Criteria","CicadaError","index","field","productSortingEntityId","response","key","criteria","sortingOptionName","fieldName","toBeRemovedItem","currentCriteria","newCriteria","item","technicalName","currentCustomField","currentField"],"mappings":"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"}