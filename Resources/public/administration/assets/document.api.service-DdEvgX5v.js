import{A as C}from"./api.service-DUFBkRAb.js";import"./channel-Cvr-E4M4.js";const h={DOCUMENT_FAILED:"create-document-fail",DOCUMENT_FINISHED:"create-document-finished"};class T extends C{constructor(e,t,n="document"){super(e,t,n),this.name="documentService",this.$listener=()=>({})}createDocument(e,t,n={},a=null,r={},m={},s=null){let o=`_action/order/document/${t}/create`;const d=this.getBasicHeaders(m),l={orderId:e,config:n,referencedDocumentId:a};(s||n.documentMediaFileId)&&(l.static=!0);let c;return this.httpClient.post(o,[l],{additionalParams:r,headers:d}).then(p=>{var u,D,$,E;if(c=(u=p.data)==null?void 0:u.data,s&&s instanceof File&&c&&((D=c[0])!=null&&D.documentId)){const f=($=c[0])==null?void 0:$.documentId,v=s.name.split(".").shift(),N=s.name.split(".").pop();o=`/_action/document/${f}/upload?fileName=${n.documentNumber}_${v}&extension=${N}`,d["Content-Type"]=s.type,c=this.httpClient.post(o,s,{additionalParams:r,headers:d})}const i=(E=p.data)==null?void 0:E.errors;if(i&&i.hasOwnProperty(e)){this.$listener(this.createDocumentEvent(h.DOCUMENT_FAILED,i[e].pop()));return}return this.$listener(this.createDocumentEvent(h.DOCUMENT_FINISHED)),Promise.resolve(c)}).catch(p=>{var i,u;(u=(i=p.response)==null?void 0:i.data)!=null&&u.errors&&this.$listener(this.createDocumentEvent(h.DOCUMENT_FAILED,p.response.data.errors.pop()))})}getDocumentPreview(e,t,n,a,r={}){const m=JSON.stringify(a);return this.httpClient.get(`/_action/order/${e}/${t}/document/${n}/preview`,{params:{config:m,...r},responseType:"blob",headers:this.getBasicHeaders()}).catch(async s=>{const o=JSON.parse(await s.response.data.text());o.errors&&this.$listener(this.createDocumentEvent("create-document-fail",o.errors.pop()))})}getDocument(e,t,n,a=!1,r="pdf"){return this.httpClient.get(`/_action/document/${e}/${t}?fileType=${r}${a?"&download=1":""}`,{responseType:"blob",headers:this.getBasicHeaders()})}createDocumentEvent(e,t){return{action:e,payload:t}}setListener(e){this.$listener=e}}export{h as DocumentEvents,T as default};
