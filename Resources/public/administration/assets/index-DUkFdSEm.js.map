{"version":3,"file":"index-DUkFdSEm.js","sources":["../../../app/administration/src/module/sw-product/component/sw-product-cross-selling-assignment/sw-product-cross-selling-assignment.html.twig","../../../app/administration/src/module/sw-product/component/sw-product-cross-selling-assignment/index.js"],"sourcesContent":["<div class=\"sw-product-cross-selling-assignment\">\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_cross_selling_assignment_container %}\n    <div class=\"sw-product-cross-selling-assignment__select-container\">\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_cross_selling_assignment_select %}\n        <sw-entity-single-select\n            :label=\"$tc('sw-product.crossselling.inputCrossSellingProductList')\"\n            entity=\"product\"\n            value=\"\"\n            :criteria=\"searchCriteria\"\n            :context=\"searchContext\"\n            disable-auto-close\n            :disabled=\"!allowEdit\"\n            show-clearable-button\n            @update:value=\"onToggleProduct\"\n        >\n\n            <template #result-item=\"{ item, index }\">\n                <slot\n                    name=\"result-item\"\n                    v-bind=\"{ item, index, isSelected }\"\n                >\n                    <sw-select-result\n                        :selected=\"isSelected(item)\"\n                        v-bind=\"{ item, index }\"\n                    >\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_entity_single_select_base_results_list_result_label %}\n                        <span class=\"sw-select-result__result-item-text\">\n                            <sw-product-variant-info :variations=\"item.variation\">\n                                {{ item.translated.name || item.name }}\n                            </sw-product-variant-info>\n                        </span>\n                        {% endblock %}\n                    </sw-select-result>\n                </slot>\n            </template>\n\n        </sw-entity-single-select>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_cross_selling_assignment_option_grid %}\n        <sw-data-grid\n            v-if=\"total\"\n            :key=\"isLoadingGrid\"\n            :data-source=\"assignedProducts\"\n            :is-loading=\"isLoadingGrid\"\n            :columns=\"assignedProductColumns\"\n            :show-settings=\"true\"\n            :show-selection=\"false\"\n        >\n\n            <template #actions=\"{ item }\">\n                <sw-context-menu-item\n                    :disabled=\"!allowEdit\"\n                    variant=\"danger\"\n                    @click=\"removeItem(item)\"\n                >\n                    {{ $tc('global.default.delete') }}\n                </sw-context-menu-item>\n            </template>\n\n            <template #column-product.translated.name=\"{ item }\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_data_grid_columns_render_value %}\n                <span>\n                    <sw-product-variant-info :variations=\"item.product.variation\">\n                        {{ item.product.translated.name || item.product.name || variantNames[item.product.id] }}\n                    </sw-product-variant-info>\n                </span>\n                {% endblock %}\n            </template>\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_cross_selling_assignment_option_grid_column_position %}\n            <template #column-position=\"{ item }\">\n                <sw-data-grid-column-position\n                    ref=\"columnPosition\"\n                    v-model:value=\"assignedProducts\"\n                    :show-value=\"true\"\n                    :item=\"item\"\n                />\n            </template>\n            {% endblock %}\n        </sw-data-grid>\n        {% endblock %}\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_cross_selling_assignment_empty_state %}\n        <sw-empty-state\n            v-if=\"!total && !isLoadingGrid\"\n            class=\"sw-product-cross-selling-assignment__option-list-empty-state\"\n            title=\"\"\n            :absolute=\"false\"\n            :subline=\"$tc('sw-product.crossselling.assignEmptyStateDescription')\"\n        >\n            <template #icon>\n                <img\n                    :src=\"assetFilter('/administration/static/img/empty-states/products-empty-state.svg')\"\n                    alt=\"\"\n                >\n            </template>\n        </sw-empty-state>\n        {% endblock %}\n    </div>\n    {% endblock %}\n</div>\n","/*\n * @package inventory\n */\n\nimport template from './sw-product-cross-selling-assignment.html.twig';\nimport './sw-product-cross-selling-assignment.scss';\n\nconst { mapGetters, mapState } = Cicada.Component.getComponentHelper();\nconst { Context } = Cicada;\nconst { Criteria } = Cicada.Data;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: ['repositoryFactory'],\n\n    props: {\n        assignedProducts: {\n            type: Array,\n            required: true,\n        },\n\n        crossSellingId: {\n            type: String,\n            required: true,\n        },\n        allowEdit: {\n            type: Boolean,\n            required: false,\n            // eslint-disable-next-line vue/no-boolean-default\n            default: true,\n        },\n    },\n\n    data() {\n        return {\n            isLoadingData: false,\n            variantNames: {},\n        };\n    },\n\n    computed: {\n        ...mapState('swProductDetail', [\n            'product',\n        ]),\n\n        ...mapGetters('swProductDetail', [\n            'isLoading',\n        ]),\n\n        isLoadingGrid() {\n            return this.isLoadingData || this.isLoading;\n        },\n\n        assignmentRepository() {\n            return this.repositoryFactory.create(this.assignedProducts.entity, this.assignedProducts.source);\n        },\n\n        productRepository() {\n            return this.repositoryFactory.create('product');\n        },\n\n        searchCriteria() {\n            const criteria = new Criteria(1, 25);\n\n            criteria.addFilter(Criteria.not('and', [Criteria.equals('id', this.product.id)]));\n            criteria.addFilter(\n                Criteria.multi('or', [\n                    Criteria.equals('childCount', 0),\n                    Criteria.not('and', [Criteria.equals('parentId', null)]),\n                ]),\n            );\n\n            criteria.addAssociation('options.group');\n\n            return criteria;\n        },\n\n        searchContext() {\n            return {\n                ...Context.api,\n                inheritance: true,\n            };\n        },\n\n        total() {\n            if (!this.assignedProducts || !Array.isArray(this.assignedProducts)) {\n                return 0;\n            }\n\n            return this.assignedProducts.length;\n        },\n\n        assignedProductColumns() {\n            return [\n                {\n                    property: 'product.translated.name',\n                    label: this.$tc('sw-product.list.columnName'),\n                    primary: true,\n                    allowResize: true,\n                    sortable: false,\n                },\n                {\n                    property: 'product.productNumber',\n                    label: this.$tc('sw-product.list.columnProductNumber'),\n                    allowResize: true,\n                    sortable: false,\n                },\n                {\n                    property: 'position',\n                    label: this.$tc('sw-product.crossselling.inputCrossSellingPosition'),\n                    allowResize: true,\n                    sortable: false,\n                },\n            ];\n        },\n\n        variantProductIds() {\n            const variantProductIds = [];\n\n            this.assignedProducts.forEach((item) => {\n                if (!item.product.parentId || item.product.translated.name || item.product.name) {\n                    return;\n                }\n\n                variantProductIds.push(item.product.id);\n            });\n\n            return variantProductIds;\n        },\n\n        variantCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.setIds(this.variantProductIds);\n\n            return criteria;\n        },\n\n        assetFilter() {\n            return Cicada.Filter.getByName('asset');\n        },\n    },\n\n    created() {\n        if (this.variantProductIds.length === 0) {\n            return;\n        }\n\n        this.productRepository.search(this.variantCriteria, { ...Context.api, inheritance: true }).then((variants) => {\n            const variantNames = {};\n            variants.forEach((variant) => {\n                variantNames[variant.id] = variant.translated.name;\n            });\n            this.variantNames = variantNames;\n        });\n    },\n\n    methods: {\n        onToggleProduct(productId) {\n            if (productId === null) {\n                return;\n            }\n\n            this.isLoadingData = true;\n            const matchedAssignedProduct = this.assignedProducts.find((assignedProduct) => {\n                return assignedProduct.productId === productId;\n            });\n\n            if (matchedAssignedProduct) {\n                this.removeItem(matchedAssignedProduct);\n                this.isLoadingData = false;\n            } else {\n                const newProduct = this.assignmentRepository.create();\n                newProduct.crossSellingId = this.crossSellingId;\n                newProduct.productId = productId;\n                newProduct.position = this.assignedProducts.length + 1;\n                this.assignedProducts.add(newProduct);\n\n                const criteria = new Criteria(1, 25);\n                criteria.addAssociation('options.group');\n\n                this.productRepository.get(productId, { ...Context.api, inheritance: true }, criteria).then((product) => {\n                    newProduct.product = product;\n                    this.isLoadingData = false;\n                });\n            }\n        },\n\n        removeItem(item) {\n            const oldPosition = item.position;\n\n            this.assignedProducts.remove(item.id);\n            this.assignedProducts.forEach((assignedProduct) => {\n                if (assignedProduct.position <= oldPosition) {\n                    return;\n                }\n\n                assignedProduct.position -= 1;\n            });\n        },\n\n        isSelected(item) {\n            return this.assignedProducts.some((p) => p.productId === item.id);\n        },\n    },\n};\n"],"names":["template","mapGetters","mapState","Context","Criteria","index","criteria","variantProductIds","item","variants","variantNames","variant","productId","matchedAssignedProduct","assignedProduct","newProduct","product","oldPosition","p"],"mappings":"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"}