import{E as f}from"./main.vite-CEuAX8cl.js";import{s as b}from"./state-B0fCRhHd.js";import"./administration-DCOj2uiN.js";import"./channel-oRk5-XZJ.js";const v=`{% block sw_product_detail %} <sw-page class="sw-product-detail"> {% block sw_product_detail_header %} <template #smart-bar-header> <h2> <sw-product-variant-info :variations="product.variation" :title-term="productTitle" > {{ productTitle }} </sw-product-variant-info> </h2> </template> {% endblock %} {% block sw_product_detail_actions %} <template #smart-bar-actions> {% block sw_product_detail_actions_abort %} <sw-button v-tooltip.bottom="tooltipCancel" :disabled="isLoading" @click="onCancel" > {{ $tc('global.default.cancel') }} </sw-button> {% endblock %} <sw-button-group v-tooltip.bottom="{ message: $tc('sw-privileges.tooltip.warning'), disabled: acl.can('product.editor'), showOnDisabledElements: true }" class="sw-product-detail__save-button-group" :split-button="true" > {% block sw_product_detail_actions_save %} <sw-button-process v-tooltip.bottom="tooltipSave" class="sw-product-detail__save-action" :is-loading="isLoading" :process-success="isSaveSuccessful" variant="primary" :disabled="isLoading || !acl.can('product.editor')" @update:process-success="saveFinish" @click.prevent="onSave" > {{ $tc('sw-product.detail.buttonSave') }} </sw-button-process> {% endblock %} {% block sw_product_detail_actions_save_context_menu %} <sw-context-button> <template #button> <sw-button class="sw-product-detail__button-context-menu" square variant="primary" :disabled="isLoading || !acl.can('product.editor')" > <sw-icon name="regular-chevron-down-xs" size="16" /> </sw-button> </template> {% block sw_product_detail_actions_save_context_menu_actions %} {% block sw_product_detail_actions_duplicate %} <sw-context-menu-item class="sw-product-detail__save-duplicate-action" :disabled="!acl.can('product.creator') || !acl.can('product.editor') || product.parentId != null" @click="onDuplicate" > {{ $tc('sw-product.detail.buttonSaveDuplicate') }} </sw-context-menu-item> {% endblock %} {% endblock %} </sw-context-button> {% endblock %} </sw-button-group> </template> {% endblock %} {% block sw_product_detail_language_switch %} <template #language-switch> <sw-language-switch :save-changes-function="saveOnLanguageChange" :abort-change-function="abortOnLanguageChange" :disabled="!productId" @on-change="onChangeLanguage" /> </template> {% endblock %} {% block sw_product_detail_content %} <template #content> <sw-card-view> {% block sw_product_detail_content_top %} <template v-if="!isLoading && isChild"> <router-link v-if="advanceModeEnabled" class="sw-card__back-link" :to="{ name: 'sw.product.detail.variants', params: { id: product.parentId } }" > <sw-icon name="regular-long-arrow-left" small /> {{ $tc('sw-product.general.backToParent') }} </router-link> <router-link v-else class="sw-card__back-link" :to="{ name: 'sw.product.detail.base', params: { id: product.parentId } }" > <sw-icon name="regular-long-arrow-left" small /> {{ $tc('sw-product.general.backToGeneralOverview') }} </router-link> </template> {% endblock %} {% block sw_product_detail_content_language_info %} <sw-language-info :entity-description="placeholder(product, 'name', $tc('sw-product.detail.textHeadline'))" :is-new-entity="!productId" /> {% endblock %} {% block sw_product_detail_inheritance_warning %} <sw-inheritance-warning v-if="isChild" :name="$tc('sw-product.general.inheritanceModuleName')" /> {% endblock %} {% block sw_product_detail_content_tabs %} <sw-tabs v-if="productId" class="sw-product-detail-page__tabs" position-identifier="sw-product-detail" > {% block sw_product_detail_content_tabs_general %} <sw-tabs-item class="sw-product-detail__tab-general" :route="{ name: 'sw.product.detail.base', params: { id: $route.params.id } }" :has-error="swProductDetailBaseError" :title="$tc('sw-product.detail.tabGeneral')" > {{ $tc('sw-product.detail.tabGeneral') }} </sw-tabs-item> {% endblock %} {% block sw_product_detail_content_tabs_specifications %} <sw-tabs-item class="sw-product-detail__tab-specifications" :route="{ name: 'sw.product.detail.specifications', params: { id: $route.params.id } }" :title="$tc('sw-product.detail.tabSpecifications')" > {{ $tc('sw-product.detail.tabSpecifications') }} </sw-tabs-item> {% endblock %} {% block sw_product_detail_content_tabs_advanced_prices %} <sw-tabs-item v-show="showModeSetting" class="sw-product-detail__tab-advanced-prices" :route="{ name: 'sw.product.detail.prices', params: { id: $route.params.id } }" :title="$tc('sw-product.detail.tabAdvancedPrices')" > {{ $tc('sw-product.detail.tabAdvancedPrices') }} </sw-tabs-item> {% endblock %} {% block sw_product_detail_content_tabs_advanced_variants %} <sw-tabs-item v-show="!isChild && showModeSetting" class="sw-product-detail__tab-variants" :route="{ name: 'sw.product.detail.variants', params: { id: $route.params.id } }" :title="$tc('sw-product.detail.tabVariation')" > {{ $tc('sw-product.detail.tabVariation') }} </sw-tabs-item> {% endblock %} {% block sw_product_detail_content_tabs_layout %} <sw-tabs-item v-show="!isChild && showModeSetting" class="sw-product-detail__tab-layout" :route="{ name: 'sw.product.detail.layout', params: { id: $route.params.id } }" :title="$tc('sw-product.detail.tabLayout')" > {{ $tc('sw-product.detail.tabLayout') }} </sw-tabs-item> {% endblock %} {% block sw_product_detail_content_tabs_seo %} <sw-tabs-item v-show="showModeSetting" class="sw-product-detail__tab-seo" :route="{ name: 'sw.product.detail.seo', params: { id: $route.params.id } }" :title="$tc('sw-product.detail.tabSeo')" > {{ $tc('sw-product.detail.tabSeo') }} </sw-tabs-item> {% endblock %} {% block sw_product_detail_content_tabs_cross_selling %} <sw-tabs-item v-show="showModeSetting" class="sw-product-detail__tab-cross-selling" :route="{ name: 'sw.product.detail.crossSelling', params: { id: $route.params.id } }" :has-error="swProductDetailCrossSellingError" :title="$tc('sw-product.detail.tabCrossSelling')" > {{ $tc('sw-product.detail.tabCrossSelling') }} </sw-tabs-item> {% endblock %} {% block sw_product_detail_content_tabs_reviews %} <sw-tabs-item v-show="showModeSetting" class="sw-product-detail__tab-reviews" :route="{ name: 'sw.product.detail.reviews', params: { id: $route.params.id } }" :title="$tc('sw-product.detail.tabReviews')" > {{ $tc('sw-product.detail.tabReviews') }} </sw-tabs-item> {% endblock %} {% block sw_product_detail_content_tabs_additional %} {% endblock %} </sw-tabs> {% endblock %} <sw-extension-component-section position-identifier="sw-product-detail__before-content" /> {% block sw_product_detail_content_view %} <router-view v-slot="{ Component }" > <component :is="Component" @cover-change="onCoverChange" /> </router-view> {% endblock %} {% block sw_product_detail_content_clone_modal %} <sw-product-clone-modal v-if="cloning" :product="product" @clone-finish="onDuplicateFinish" /> {% endblock %} {% block sw_product_settings_mode %} <sw-product-settings-mode v-if="showAdvanceModeSetting" :is-loading="isLoading" :mode-settings="advancedModeSetting" @settings-item-change="onChangeSettingItem" @settings-change="onChangeSetting" /> {% endblock %} </sw-card-view> </template> {% endblock %} <template #sidebar> {% block sw_product_detail_sidebar %} {% endblock %} </template> </sw-page> {% endblock %}`,C={"sw.product.detail.base":{product:["taxId","price","stock","manufacturerId","name","downloads"]},"sw.product.detail.cross.selling":{product_cross_selling:["name","type","position"]}},{Context:_,Mixin:p}=Cicada,{Criteria:s,ChangesetGenerator:P}=Cicada.Data,{cloneDeep:y}=Cicada.Utils.object,{mapPageErrors:k,mapState:A,mapGetters:M}=Cicada.Component.getComponentHelper(),d=Cicada.Utils.types,x={template:v,compatConfig:Cicada.compatConfig,inject:["mediaService","repositoryFactory","numberRangeService","seoUrlService","acl","systemConfigApiService","entityValidationService"],provide(){return{swProductDetailLoadAll:this.loadAll}},mixins:[p.getByName("notification"),p.getByName("placeholder")],shortcuts:{"SYSTEMKEY+S":{active(){return this.acl.can("product.editor")},method:"onSave"},ESCAPE:"onCancel"},props:{productId:{type:String,required:!1,default:null},creationStates:{type:Array,required:!1,default:null}},data(){return{productNumberPreview:"",isSaveSuccessful:!1,cloning:!1,defaultSalesChannelVisibility:30}},metaInfo(){return{title:this.$createTitle(this.identifier)}},computed:{...A("swProductDetail",["product","parentProduct","localMode","advancedModeSetting","modeSettings"]),...M("swProductDetail",["productRepository","isLoading","isChild","defaultCurrency","defaultFeatureSet","showModeSetting","advanceModeEnabled","productStates"]),...k(C),identifier(){return this.productTitle},productTitle(){return this.isChild&&this.product?this.getInheritTitle():this.$i18n?this.placeholder(this.product,"name",this.$tc("sw-product.detail.textHeadline")):""},productRepository(){return this.repositoryFactory.create("product")},syncRepository(){return this.repositoryFactory.create("product",null,{useSync:!0})},currencyRepository(){return this.repositoryFactory.create("currency")},taxRepository(){return this.repositoryFactory.create("tax")},customFieldSetRepository(){return this.repositoryFactory.create("custom_field_set")},salesChannelRepository(){return this.repositoryFactory.create("sales_channel")},productVisibilityRepository(){return this.repositoryFactory.create("product_visibility")},mediaRepository(){return this.product&&this.product.media?this.repositoryFactory.create(this.product.media.entity,this.product.media.source):null},featureSetRepository(){return this.repositoryFactory.create("product_feature_set")},currentUser(){return Cicada.State.get("session").currentUser},userModeSettingsRepository(){return this.repositoryFactory.create("user_config")},userModeSettingsCriteria(){const t=new s(1,25);return t.addFilter(s.equals("key","mode.setting.advancedModeSettings")),t.addFilter(s.equals("userId",this.currentUser&&this.currentUser.id)),t},productCriteria(){const t=new s(1,25);return t.getAssociation("media").addSorting(s.sort("position","ASC")),t.addAssociation("media.media"),t.getAssociation("properties").addSorting(s.sort("name","ASC",!0)),t.getAssociation("prices").addSorting(s.sort("quantityStart","ASC",!0)),t.getAssociation("tags").addSorting(s.sort("name","ASC")),t.getAssociation("seoUrls").addFilter(s.equals("isCanonical",!0)),t.getAssociation("crossSellings").addSorting(s.sort("position","ASC")).getAssociation("assignedProducts").addSorting(s.sort("position","ASC")).addAssociation("product").getAssociation("product").addAssociation("options.group"),t.addAssociation("cover.media").addAssociation("categories").addAssociation("visibilities.salesChannel").addAssociation("options").addAssociation("configuratorSettings.option").addAssociation("unit").addAssociation("productReviews").addAssociation("seoUrls").addAssociation("mainCategories").addAssociation("options.group").addAssociation("customFieldSets").addAssociation("featureSet").addAssociation("cmsPage").addAssociation("featureSet").addAssociation("downloads.media"),t.getAssociation("manufacturer").addAssociation("media"),t},customFieldSetCriteria(){const t=new s(1,null);return t.addFilter(s.equals("relations.entityName","product")),t.addSorting(s.sort("config.customFieldPosition","ASC",!0)),t},defaultFeatureSetCriteria(){const t=new s(1,1);return t.addSorting(s.sort("createdAt","ASC")).addFilter(s.equalsAny("name",["Default","Standard"])),t},taxCriteria(){const t=new s(1,500);return t.addSorting(s.sort("position")),t},tooltipSave(){return{message:`${this.$device.getSystemKey()} + S`,appearance:"light"}},tooltipCancel(){return{message:"ESC",appearance:"light"}},getModeSettingGeneralTab(){return[{key:"general_information",label:"sw-product.detailBase.cardTitleProductInfo",enabled:!0,name:"general"},{key:"prices",label:"sw-product.detailBase.cardTitlePrices",enabled:!0,name:"general"},{key:"deliverability",label:"sw-product.detailBase.cardTitleDeliverabilityInfo",enabled:!0,name:"general"},{key:"visibility_structure",label:"sw-product.detailBase.cardTitleAssignment",enabled:!0,name:"general"},{key:"media",label:"sw-product.detailBase.cardTitleMedia",enabled:!0,name:"general"},{key:"labelling",label:"sw-product.detailBase.cardTitleSettings",enabled:!0,name:"general"}]},getModeSettingSpecificationsTab(){return[{key:"measures_packaging",label:"sw-product.specifications.cardTitleMeasuresPackaging",enabled:!0,name:"specifications"},{key:"properties",label:"sw-product.specifications.cardTitleProperties",enabled:!0,name:"specifications"},{key:"essential_characteristics",label:"sw-product.specifications.cardTitleEssentialCharacteristics",enabled:!0,name:"specifications"},{key:"custom_fields",label:"sw-product.specifications.cardTitleCustomFields",enabled:!0,name:"specifications"}]},showAdvanceModeSetting(){return this.isChild?!1:["sw.product.detail.base","sw.product.detail.specifications"].includes(this.$route.name)},cmsPageState(){return Cicada.Store.get("cmsPage")},currentPage(){return Cicada.Store.get("cmsPage").currentPage}},watch:{productId(){this.destroyedComponent(),this.createdComponent()}},beforeCreate(){Cicada.State.registerModule("swProductDetail",b)},created(){this.createdComponent()},beforeUnmount(){Cicada.State.unregisterModule("swProductDetail")},unmounted(){this.destroyedComponent()},methods:{createdComponent(){Cicada.ExtensionAPI.publishData({id:"sw-product-detail__product",path:"product",scope:this}),Cicada.ExtensionAPI.publishData({id:"sw-product-detail__cmsPage",path:"currentPage",scope:this}),this.cmsPageState.resetCmsPageState(),this.productId||Cicada.State.getters["context/isSystemDefaultLanguage"]||Cicada.State.commit("context/resetLanguageToDefault"),this.initState(),this.isCompatEnabled("INSTANCE_EVENT_EMITTER")&&this.$root.$on("media-remove",t=>{this.removeMediaItem(t)}),this.initAdvancedModeSettings()},destroyedComponent(){this.isCompatEnabled("INSTANCE_EVENT_EMITTER")&&this.$root.$off("media-remove")},initState(){return Cicada.State.commit("swProductDetail/setApiContext",Cicada.Context.api),this.productId?this.loadState():this.createState().then(()=>{this.numberRangeService.reserve("product","",!0).then(t=>{this.productNumberPreview=t.number,this.product.productNumber=t.number})})},initAdvancedModeSettings(){Cicada.State.commit("swProductDetail/setAdvancedModeSetting",this.getAdvancedModeDefaultSetting()),this.getAdvancedModeSetting()},createUserModeSetting(){const t=this.userModeSettingsRepository.create();return t.key="mode.setting.advancedModeSettings",t.userId=this.currentUser&&this.currentUser.id,t},getAdvancedModeDefaultSetting(){const t=this.createUserModeSetting();return t.value={advancedMode:{label:"sw-product.general.textAdvancedMode",enabled:!0},settings:[...this.getModeSettingGeneralTab,...this.getModeSettingSpecificationsTab]},t},getAdvancedModeSetting(){return this.userModeSettingsRepository.search(this.userModeSettingsCriteria).then(async t=>{if(!t.total)return;const e=t.first(),a=this.getAdvancedModeDefaultSetting().value.settings;e.value.settings=a.reduce((r,i)=>{const o=e.value.settings.find(c=>c.key===i.key);return r.push(o||i),r},[]),Cicada.State.commit("swProductDetail/setAdvancedModeSetting",e),Cicada.State.commit("swProductDetail/setModeSettings",this.changeModeSettings()),await this.$nextTick()})},saveAdvancedMode(){Cicada.State.commit("swProductDetail/setLoading",["advancedMode",!0]),this.userModeSettingsRepository.save(this.advancedModeSetting).then(()=>{this.getAdvancedModeSetting().then(()=>{Cicada.State.commit("swProductDetail/setLoading",["advancedMode",!1])})}).catch(()=>{this.createNotificationError({message:this.$tc("global.notification.unspecifiedSaveErrorMessage")})})},onChangeSetting(){Cicada.State.commit("swProductDetail/setAdvancedModeSetting",this.advancedModeSetting),this.saveAdvancedMode()},changeModeSettings(){const t=this.advancedModeSetting.value.settings.filter(e=>e.enabled);return t.length?t.map(e=>e.key):[]},onChangeSettingItem(){Cicada.State.commit("swProductDetail/setModeSettings",this.changeModeSettings()),this.saveAdvancedMode()},loadState(){return Cicada.State.commit("swProductDetail/setLocalMode",!1),Cicada.State.commit("swProductDetail/setProductId",this.productId),Cicada.State.commit("cicadaApps/setSelectedIds",[this.productId]),this.loadAll()},loadAll(){return Promise.all([this.loadProduct(),this.loadCurrencies(),this.loadTaxes(),this.loadAttributeSet()])},createState(){return Cicada.State.commit("swProductDetail/setLocalMode",!0),Cicada.State.commit("cicadaApps/setSelectedIds",[]),Cicada.State.commit("swProductDetail/setLoading",["product",!0]),Cicada.State.commit("swProductDetail/setCreationStates",this.creationStates),Cicada.State.commit("swProductDetail/setProduct",this.productRepository.create()),Cicada.State.commit("swProductDetail/setProductId",this.product.id),this.product.active=!0,this.product.taxId=null,this.product.metaTitle="",this.product.additionalText="",this.product.variantListingConfig={},this.creationStates&&this.adjustProductAccordingToType(),Promise.all([this.loadCurrencies(),this.loadTaxes(),this.loadAttributeSet(),this.loadDefaultFeatureSet()]).then(()=>{this.product.price=[{currencyId:this.defaultCurrency.id,net:null,linked:!0,gross:null}],this.product.purchasePrices=this.getDefaultPurchasePrices(),this.product.isNew&&(this.getDefaultTaxRate().then(t=>{this.product.taxId=t}),this.getDefaultSalesChannels().then(t=>{d.isEmpty(t)||(this.product.active=t.defaultActive,!(!t.defaultSalesChannelIds||t.defaultSalesChannelIds.length<=0)&&this.fetchSalesChannelByIds(t.defaultSalesChannelIds).then(e=>{e.length&&e.forEach(a=>{const r=this.createProductVisibilityEntity(t.defaultVisibilities,a);this.product.visibilities.push(r)})}))})),this.defaultFeatureSet&&this.defaultFeatureSet.length>0&&(this.product.featureSetId=this.defaultFeatureSet[0].id),Cicada.State.commit("swProductDetail/setLoading",["product",!1])})},adjustProductAccordingToType(){this.creationStates.includes("is-download")&&(this.product.maxPurchase=1)},loadProduct(){return Cicada.State.commit("swProductDetail/setLoading",["product",!0]),this.productRepository.get(this.productId||this.product.id,Cicada.Context.api,this.productCriteria).then(async t=>{var e,a;!((e=t.purchasePrices)!=null&&e.length)>0&&!t.parentId&&((a=this.defaultCurrency)!=null&&a.id||await this.loadCurrencies(),t.purchasePrices=this.getDefaultPurchasePrices()),Cicada.State.commit("swProductDetail/setProduct",t),this.product.parentId?this.loadParentProduct():Cicada.State.commit("swProductDetail/setParentProduct",{}),Cicada.State.commit("swProductDetail/setLoading",["product",!1])})},getDefaultPurchasePrices(){return[{currencyId:this.defaultCurrency.id,net:0,linked:!0,gross:0}]},loadParentProduct(){return Cicada.State.commit("swProductDetail/setLoading",["parentProduct",!0]),this.productRepository.get(this.product.parentId,Cicada.Context.api,this.productCriteria).then(t=>{Cicada.State.commit("swProductDetail/setParentProduct",t)}).then(()=>{Cicada.State.commit("swProductDetail/setLoading",["parentProduct",!1])})},loadCurrencies(){return Cicada.State.commit("swProductDetail/setLoading",["currencies",!0]),this.currencyRepository.search(new s(1,500)).then(t=>{Cicada.State.commit("swProductDetail/setCurrencies",t)}).then(()=>{Cicada.State.commit("swProductDetail/setLoading",["currencies",!1])})},loadTaxes(){return Cicada.State.commit("swProductDetail/setLoading",["taxes",!0]),this.taxRepository.search(this.taxCriteria).then(t=>{Cicada.State.commit("swProductDetail/setTaxes",t)}).then(()=>{Cicada.State.commit("swProductDetail/setLoading",["taxes",!1])})},getDefaultTaxRate(){return this.systemConfigApiService.getValues("core.tax").then(t=>t["core.tax.defaultTaxRate"]??null)},loadAttributeSet(){return Cicada.State.commit("swProductDetail/setLoading",["customFieldSets",!0]),this.customFieldSetRepository.search(this.customFieldSetCriteria).then(t=>{Cicada.State.commit("swProductDetail/setAttributeSet",t)}).finally(()=>{Cicada.State.commit("swProductDetail/setLoading",["customFieldSets",!1])})},loadDefaultFeatureSet(){return Cicada.State.commit("swProductDetail/setLoading",["defaultFeatureSet",!0]),this.featureSetRepository.search(this.defaultFeatureSetCriteria).then(t=>{Cicada.State.commit("swProductDetail/setDefaultFeatureSet",t)}).then(()=>{Cicada.State.commit("swProductDetail/setLoading",["defaultFeatureSet",!1])})},getDefaultSalesChannels(){return this.systemConfigApiService.getValues("core.defaultSalesChannel").then(t=>d.isEmpty(t)?{}:{defaultSalesChannelIds:t==null?void 0:t["core.defaultSalesChannel.salesChannel"],defaultVisibilities:t==null?void 0:t["core.defaultSalesChannel.visibility"],defaultActive:!!(t!=null&&t["core.defaultSalesChannel.active"])})},fetchSalesChannelByIds(t){const e=new s(1,25);return e.addFilter(s.equalsAny("id",t)),this.salesChannelRepository.search(e)},createProductVisibilityEntity(t,e){const a=this.productVisibilityRepository.create(_.api);return Object.assign(a,{visibility:t[e.id]||this.defaultSalesChannelVisibility,productId:this.product.id,salesChannelId:e.id,salesChannel:e}),a},abortOnLanguageChange(){return this.productRepository.hasChanges(this.product)},saveOnLanguageChange(){return this.onSave()},onChangeLanguage(t){Cicada.State.commit("context/setApiLanguageId",t),this.initState()},saveFinish(){this.isSaveSuccessful=!1,this.productId||this.$router.push({name:"sw.product.detail",params:{id:this.product.id}})},onSave(){if(!this.validateProductPurchase())return this.createNotificationError({message:this.$tc("sw-product.detail.errorMinMaxPurchase")}),new Promise(e=>{e()});this.validateProductPrices(),this.productId||this.productNumberPreview===this.product.productNumber&&this.numberRangeService.reserve("product").then(e=>{this.productNumberPreview="reserved",this.product.productNumber=e.number}),this.isSaveSuccessful=!1;const t=this.getCmsPageOverrides();if(d.isPlainObject(t)&&(this.product.slotConfig=y(t)),!this.entityValidationService.validate(this.product,this.customValidate)){const e=this.$tc("global.default.error"),a=this.$tc("global.notification.notificationSaveErrorMessageRequiredFieldsInvalid");return this.createNotificationError({title:e,message:a}),Promise.resolve()}return this.saveProduct().then(this.onSaveFinished)},customValidate(t,e){return this.productStates.includes("is-download")&&(e.downloads===void 0||e.downloads.length<1)&&t.push(f.createRequiredError("/0/downloads")),t},validateProductPrices(){this.product.prices.forEach(t=>{this.validatePrices("listPrice",t.price)}),this.validatePrices("listPrice",this.product.price),this.product.prices.forEach(t=>{this.validatePrices("regulationPrice",t.price)}),this.validatePrices("regulationPrice",this.product.price)},validatePrices(t,e){e&&e.forEach(a=>{if(a[t]){if(!a[t].gross&&!a[t].net){a[t]=null;return}if(!a[t].gross){a[t].gross=0;return}a[t].net||(a[t].net=0)}})},onSaveFinished(t){const e=[];if(Cicada.State.list().includes("swSeoUrl")){const a=Cicada.State.getters["swSeoUrl/getNewOrModifiedUrls"](),r=Cicada.State.get("swSeoUrl").defaultSeoUrl;a&&a.forEach(i=>{i.seoPathInfo?i.isModified=!0:(i.seoPathInfo=r.seoPathInfo,i.isModified=!1),e.push(this.seoUrlService.updateCanonicalUrl(i,i.languageId))}),t==="empty"&&a.length>0&&(t="success")}Promise.all(e).then(()=>{this.isCompatEnabled("INSTANCE_EVENT_EMITTER")?this.$root.$emit("seo-url-save-finish"):Cicada.Utils.EventBus.emit("sw-product-detail-save-finish")}).then(()=>{var a,r,i,o,c,n,l,u;switch(t){case"empty":{this.isSaveSuccessful=!0,Cicada.State.commit("error/resetApiErrors");break}case"success":{this.isSaveSuccessful=!0;break}default:{if(((o=(i=(r=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:r.errors)==null?void 0:i[0])==null?void 0:o.code)==="CONTENT__DUPLICATE_PRODUCT_NUMBER"){const w=this.$tc("global.default.error"),S=this.$t("sw-product.notification.notificationSaveErrorProductNoAlreadyExists",{productNo:t.response.data.errors[0].meta.parameters.number});this.createNotificationError({title:w,message:S});break}const h=(u=(l=(n=(c=t==null?void 0:t.response)==null?void 0:c.data)==null?void 0:n.errors)==null?void 0:l[0])==null?void 0:u.detail,m=this.$tc("global.default.error"),g=h??this.$tc("global.notification.notificationSaveErrorMessageRequiredFieldsInvalid");this.createNotificationError({title:m,message:g});break}}})},onCancel(){this.$router.push({name:"sw.product.index"})},saveProduct(){return Cicada.State.commit("swProductDetail/setLoading",["product",!0]),this.product.media&&this.product.media.forEach((t,e)=>{t.position=e}),new Promise(t=>{if(!this.productRepository.hasChanges(this.product)){Cicada.State.commit("swProductDetail/setLoading",["product",!1]),t("empty"),Cicada.State.commit("swProductDetail/setLoading",["product",!1]);return}this.syncRepository.save(this.product).then(()=>{this.loadAll().then(()=>{Cicada.State.commit("swProductDetail/setLoading",["product",!1]),t("success")})}).catch(e=>{Cicada.State.commit("swProductDetail/setLoading",["product",!1]),t(e)})})},removeMediaItem(t,e){const a=this.product.media.find(r=>r.mediaId===e);this.product.coverId===a.id&&(this.product.coverId=null),this.product.media.remove(e)},onCoverChange(t){if(!t||t.length<0)return;const e=this.product.media.find(a=>a.mediaId===t);e&&(this.product.coverId=e.id)},getInheritTitle(){if(this.product.hasOwnProperty("translated")&&this.product.translated.hasOwnProperty("name")&&this.product.translated.name!==null)return this.product.translated.name;if(this.product.name!==null)return this.product.name;if(this.parentProduct&&this.parentProduct.hasOwnProperty("translated")){const t=this.parentProduct;return t.translated.hasOwnProperty("name")?t.translated.name:t.name}return""},onDuplicate(){this.cloning=!0},onDuplicateFinish(t){this.cloning=!1,this.$router.push({name:"sw.product.detail",params:{id:t.id}})},validateProductPurchase(){return!(this.product.maxPurchase&&this.product.minPurchase>this.product.maxPurchase)},getCmsPageOverrides(){if(this.currentPage===null)return null;this.deleteSpecifcKeys(this.currentPage.sections);const t=new P,{changes:e}=t.generate(this.currentPage),a={};return e===null||d.isArray(e.sections)&&e.sections.forEach(r=>{d.isArray(r.blocks)&&r.blocks.forEach(i=>{d.isArray(i.slots)&&i.slots.forEach(o=>{a[o.id]=o.config})})}),a},deleteSpecifcKeys(t){t&&t.forEach(e=>{e.blocks&&e.blocks.forEach(a=>{a.slots&&a.slots.forEach(r=>{r.config&&Object.values(r.config).forEach(i=>{i.entity&&delete i.entity,i.hasOwnProperty("required")&&delete i.required,i.type&&delete i.type})})})})}}};export{x as default};
//# sourceMappingURL=index-CSSFY88b.js.map
