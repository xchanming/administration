import"./store-BoTaGDaZ.js";const u=`{% block sw_category %} <sw-page class="sw-category" :class="pageClasses" > <template #search-bar> {% block sw_category_search_bar %} <sw-search-bar ref="searchBar" initial-search-type="category" :initial-search="term" type-search-always-in-container @search="onSearch" /> {% endblock %} </template> <template #smart-bar-header> {% block sw_category_smart_bar_header %} <h2 v-if="category"> {{ placeholder(category, 'name') }} </h2> <h2 v-else> {{ $tc('sw-category.general.headlineCategories') }} </h2> {% endblock %} </template> <template #language-switch> {% block sw_category_language_switch %} <sw-language-switch :save-changes-function="saveOnLanguageChange" :abort-change-function="abortOnLanguageChange" :disabled="landingPageId === 'create'" @on-change="onChangeLanguage" /> {% endblock %} </template> <template #smart-bar-actions> <template v-if="category || landingPage"> {% block sw_category_smart_bar_abort %} <sw-button v-tooltip.bottom="tooltipCancel" :disabled="isLoading" @click="cancelEdit" > {{ $tc('global.default.cancel') }} </sw-button> {% endblock %} {% block sw_category_smart_bar_save %} {% block sw_category_smart_bar_save_category %} <sw-button-process v-if="category" v-tooltip.bottom="tooltipSave" class="sw-category-detail__save-action" :is-loading="isLoading" :process-success="isSaveSuccessful" :disabled="isLoading || !acl.can('category.editor')" variant="primary" @update:process-success="saveFinish" @click.prevent="onSave" > {{ $tc('sw-category.general.buttonSafeCategory') }} </sw-button-process> {% endblock %} {% block sw_category_smart_bar_save_landing_page %} <sw-button-process v-if="landingPage" v-tooltip.bottom="landingPageTooltipSave" class="sw-category-detail__save-landing-page-action" :is-loading="isLoading" :process-success="isSaveSuccessful" :disabled="isLoading || !acl.can('landing_page.editor')" variant="primary" @update:process-success="saveFinish" @click.prevent="onSaveLandingPage" > {{ $tc('sw-category.general.buttonSafeCategory') }} </sw-button-process> {% endblock %} {% endblock %} </template> </template> <template #side-content> {% block sw_category_side_content %} {% block sw_category_collapse %} <sw-sidebar-collapse class="sw-category-detail__category-collapse" :expand-on-loading="landingPageId === null" > <template #header> {% block sw_category_collapse_header %} <div v-if="categoryCheckedItem > 0" class="sw-category-detail__collapse-selected-count" > {{ $tc(\`sw-category.general.treeHeadSelected\`, 0, { count: categoryCheckedItem }) }}: </div> <div v-else class="sw-category-detail__collapse-headline" > {{ $tc(\`sw-category.general.treeHeadline\`) }} </div> {% endblock %} </template> <template #actions> {% block sw_category_collapse_actions %} <div v-if="categoryCheckedItem > 0"> <sw-button class="sw-tree-actions__delete_categories" variant="danger" size="small" @click="onCategoryDelete" > {{ $tc('global.default.delete') }} </sw-button> </div> {% endblock %} </template> <template #content> {% block sw_category_tree %} <sw-category-tree ref="categoryTree" :category-id="categoryId" :current-language-id="currentLanguageId" :allow-edit="acl.can('category.editor')" :allow-create="acl.can('category.creator')" :allow-delete="acl.can('category.deleter')" @unsaved-changes="openChangeModal" @category-checked-elements-count="categoryCheckedElementsCount" /> {% endblock %} </template> </sw-sidebar-collapse> {% endblock %} {% block sw_landing_page_collapse %} <sw-sidebar-collapse class="sw-category-detail__landing-page-collapse" :expand-on-loading="landingPageId !== null" > <template #header> {% block sw_landing_page_collapse_header %} <div v-if="landingPageCheckedItem > 0" class="sw-category-detail__collapse-selected-count" > {{ $tc(\`sw-landing-page.general.treeHeadSelected\`, 0, { count: landingPageCheckedItem }) }}: </div> <div v-else class="sw-category-detail__collapse-headline" > {{ $tc(\`sw-landing-page.general.treeHeadline\`) }} </div> {% endblock %} </template> <template #actions> {% block sw_landing_page_collapse_actions %} <div v-if="landingPageCheckedItem > 0"> <sw-button class="sw-tree-actions__delete_categories" variant="danger" size="small" @click="onLandingPageDelete" > {{ $tc('global.default.delete') }} </sw-button> </div> {% endblock %} </template> <template #content> {% block sw_landing_page_tree %} <sw-landing-page-tree ref="landingPageTree" :landing-page-id="landingPageId" :current-language-id="currentLanguageId" :allow-edit="acl.can('landing_page.editor')" :allow-create="acl.can('landing_page.creator')" :allow-delete="acl.can('landing_page.deleter')" @unsaved-changes="openChangeModal" @landing-page-checked-elements-count="landingPageCheckedElementsCount" /> {% endblock %} </template> </sw-sidebar-collapse> {% endblock %} {% endblock %} </template> {% block sw_category_content %} <template #content> <template v-if="isLoading"> <sw-skeleton variant="detail-bold" /> <sw-skeleton /> </template> <template v-else> {% block sw_category_content_view %} <sw-category-view v-if="category" ref="categoryView" :is-loading="isLoading" :type="category.type" /> {% endblock %} {% block sw_category_content_entry_point_overwrite_modal %} <sw-category-entry-point-overwrite-modal v-if="showEntryPointOverwriteModal" :sales-channels="entryPointOverwriteSalesChannels" @cancel="cancelEntryPointOverwrite" @confirm="confirmEntryPointOverwrite" /> {% endblock %} {% block sw_landing_page_content_view %} <sw-landing-page-view v-if="landingPage" ref="landingPageView" :is-loading="isLoading" /> {% endblock %} {% block sw_category_content_discard_changes_modal %} <sw-discard-changes-modal v-if="isDisplayingLeavePageWarning" @keep-editing="onLeaveModalClose(nextRoute)" @discard-changes="onLeaveModalConfirm(nextRoute)" /> {% endblock %} {% block sw_category_content_empty %} <sw-empty-state v-if="showEmptyState" :title="$tc('sw-category.general.emptyStateHeadline')" > <template #icon> <img :src="assetFilter('/administration/static/img/empty-states/products-empty-state.svg')" :alt="$tc('sw-category.general.emptyStateHeadline')" > </template> </sw-empty-state> {% endblock %} </template> </template> {% endblock %} </sw-page> {% endblock %}`,{Context:y,Mixin:d}=Shopware,{Criteria:n,ChangesetGenerator:m,EntityCollection:w}=Shopware.Data,{cloneDeep:l,merge:h}=Shopware.Utils.object,g=Shopware.Utils.types,P={template:u,inject:["acl","cmsService","repositoryFactory","seoUrlService","systemConfigApiService"],mixins:[d.getByName("notification"),d.getByName("placeholder")],shortcuts:{"SYSTEMKEY+S":{active(){return this.acl.can("category.editor")},method:"onSave"},ESCAPE:"cancelEdit"},props:{categoryId:{type:String,required:!1,default:null},landingPageId:{type:String,required:!1,default:null}},data(){return{term:"",isLoading:!1,isCustomFieldLoading:!1,isSaveSuccessful:!1,isMobileViewport:null,splitBreakpoint:1024,isDisplayingLeavePageWarning:!1,nextRoute:null,currentLanguageId:Shopware.Context.api.languageId,forceDiscardChanges:!1,categoryCheckedItem:0,landingPageCheckedItem:0,entryPointOverwriteConfirmed:!1,entryPointOverwriteSalesChannels:null}},metaInfo(){return{title:this.$createTitle(this.identifier)}},computed:{changesetGenerator(){return new m},showEmptyState(){return!this.category&&!this.landingPage},identifier(){return this.category?this.placeholder(this.category,"name"):""},landingPageRepository(){return this.repositoryFactory.create("landing_page")},categoryRepository(){return this.repositoryFactory.create("category")},cmsPageRepository(){return this.repositoryFactory.create("cms_page")},landingPage(){return Shopware.Store.get("swCategoryDetail")?Shopware.Store.get("swCategoryDetail").landingPage:{}},category(){return Shopware.Store.get("swCategoryDetail")?Shopware.Store.get("swCategoryDetail").category:{}},showEntryPointOverwriteModal(){return this.entryPointOverwriteSalesChannels!==null&&this.entryPointOverwriteSalesChannels.length},cmsPage(){return Shopware.Store.get("cmsPage").currentPage},cmsPageState(){return Shopware.Store.get("cmsPage")},cmsPageId(){return this.landingPage?this.landingPage.cmsPageId:this.category?this.category.cmsPageId:null},customFieldSetRepository(){return this.repositoryFactory.create("custom_field_set")},customFieldSetCriteria(){const e=new n(1,null);return e.addFilter(n.equals("relations.entityName","category")),e},customFieldSetLandingPageCriteria(){const e=new n(1,null);return e.addFilter(n.equals("relations.entityName","landing_page")),e},mediaRepository(){return this.repositoryFactory.create("media")},pageClasses(){return{"has--category":!!this.category,"is--mobile":!!this.isMobileViewport}},tooltipSave(){return this.acl.can("category.editor")?{message:`${this.$device.getSystemKey()} + S`,appearance:"light"}:{message:this.$tc("sw-privileges.tooltip.warning"),disabled:this.acl.can("category.editor"),showOnDisabledElements:!0}},landingPageTooltipSave(){return this.acl.can("landing_page.editor")?{message:`${this.$device.getSystemKey()} + S`,appearance:"light"}:{message:this.$tc("sw-privileges.tooltip.warning"),disabled:this.acl.can("landing_page.editor"),showOnDisabledElements:!0}},tooltipCancel(){return{message:"ESC",appearance:"light"}},categoryCriteria(){const e=new n(1,1);return e.getAssociation("seoUrls").addFilter(n.equals("isCanonical",!0)),e.addAssociation("tags").addAssociation("media").addAssociation("navigationSalesChannels.homeCmsPage.previewMedia").addAssociation("serviceSalesChannels").addAssociation("footerSalesChannels").addAssociation("translations"),e},landingPageCriteria(){const e=new n(1,1);return e.addAssociation("tags"),e.addAssociation("salesChannels"),e},assetFilter(){return Shopware.Filter.getByName("asset")}},watch:{landingPageId(){this.setLandingPage()},categoryId(){this.setCategory()},cmsPageId(){this.isLoading||(this.category&&(this.cmsPageState.resetCmsPageState(),this.getAssignedCmsPage()),this.landingPage&&(this.cmsPageState.resetCmsPageState(),this.getAssignedCmsPageForLandingPage()))}},beforeCreate(){Shopware.Store.get("cmsPage").resetCmsPageState()},created(){this.createdComponent()},beforeRouteLeave(e,t,a){if(this.forceDiscardChanges){this.forceDiscardChanges=!1,a();return}if(!this.category){a();return}const{changes:s,deletionQueue:i}=this.changesetGenerator.generate(this.category);if(s===null){a();return}const o=["id","versionId"],r=Object.keys(s).filter(p=>!o.includes(p)),c=i.length>0;if(e.name==="sw.cms.create"&&r.length===1&&r[0]==="cmsPageId"&&s.cmsPageId===null&&!c){a();return}if(r.length===0&&!c){a();return}this.isDisplayingLeavePageWarning=!0,this.nextRoute=e,a(!1)},methods:{createdComponent(){if(Shopware.ExtensionAPI.publishData({id:"sw-category-detail__category",path:"category",scope:this}),Shopware.ExtensionAPI.publishData({id:"sw-category-detail__cmsPage",path:"cmsPage",scope:this}),this.isLoading=!0,this.checkViewport(),this.registerListener(),this.categoryId!==null){this.setCategory();return}this.setLandingPage()},categoryCheckedElementsCount(e){this.categoryCheckedItem=e},landingPageCheckedElementsCount(e){this.landingPageCheckedItem=e},registerListener(){this.$device.onResize({listener:this.checkViewport})},onSearch(e){e.length===0&&(e=void 0),this.term=e},checkViewport(){this.isMobileViewport=this.$device.getViewportWidth()<this.splitBreakpoint},getAssignedCmsPage(){if(this.cmsPageId===null)return Promise.resolve(null);const e=this.cmsPageId,t=new n(1,1);return t.setIds([e]),t.addAssociation("previewMedia"),t.addAssociation("sections"),t.getAssociation("sections").addSorting(n.sort("position")),t.addAssociation("sections.blocks"),t.getAssociation("sections.blocks").addSorting(n.sort("position","ASC")).addAssociation("slots"),this.cmsPageRepository.search(t).then(a=>{const s=a.get(e);return e!==this.cmsPageId?null:(this.category.slotConfig!==null&&s.sections.forEach(i=>{i.blocks.forEach(o=>{o.slots.forEach(r=>{this.category.slotConfig[r.id]&&(r.config===null&&(r.config={}),h(r.config,l(this.category.slotConfig[r.id])))})})}),this.updateCmsPageDataMapping(),this.cmsPageState.setCurrentPage(s),this.cmsPage)})},updateCmsPageDataMapping(){this.cmsPageState.setCurrentMappingEntity("category"),this.cmsPageState.setCurrentMappingTypes(this.cmsService.getEntityMappingTypes("category")),this.cmsPageState.setCurrentDemoEntity(this.category)},getAssignedCmsPageForLandingPage(){if(this.cmsPageId===null)return Promise.resolve(null);const e=this.cmsPageId,t=new n(1,1);return t.setIds([e]),t.addAssociation("previewMedia"),t.addAssociation("sections"),t.getAssociation("sections").addSorting(n.sort("position")),t.addAssociation("sections.blocks"),t.getAssociation("sections.blocks").addSorting(n.sort("position","ASC")).getAssociation("slots").addAssociation("translations"),this.cmsPageRepository.search(t).then(a=>{const s=a.get(e);return e!==this.cmsPageId?null:(this.landingPage.slotConfig!==null&&s.sections.forEach(i=>{i.blocks.forEach(o=>{o.slots.forEach(r=>{this.landingPage.slotConfig[r.id]&&(r.config===null&&(r.config={}),h(r.config,l(this.landingPage.slotConfig[r.id])))})})}),this.updateCmsPageDataMappingForLandingPage(),this.cmsPageState.setCurrentPage(s),this.cmsPage)})},updateCmsPageDataMappingForLandingPage(){this.cmsPageState.setCurrentMappingEntity("landing_page"),this.cmsPageState.setCurrentMappingTypes(this.cmsService.getEntityMappingTypes("landing_page")),this.cmsPageState.setCurrentDemoEntity(this.landingPage)},async setLandingPage(){this.isLoading=!0;try{if(this.landingPageId===null){Shopware.Store.get("shopwareApps").selectedIds=[],Shopware.Store.get("swCategoryDetail").landingPage=null,this.cmsPageState.resetCmsPageState();return}Shopware.Store.get("shopwareApps").selectedIds=[this.landingPageId],await Shopware.Store.get("swCategoryDetail").loadActiveLandingPage({repository:this.landingPageRepository,apiContext:Shopware.Context.api,id:this.landingPageId,criteria:this.landingPageCriteria}),this.cmsPageState.resetCmsPageState(),await this.getAssignedCmsPageForLandingPage(),await this.loadLandingPageCustomFieldSet()}catch{this.createNotificationError({title:this.$tc("global.default.error"),message:this.$tc("global.notification.unspecifiedSaveErrorMessage")})}finally{this.isLoading=!1}},setCategory(){if(this.isLoading=!0,this.categoryId===null){Shopware.Store.get("shopwareApps").selectedIds=[],Shopware.Store.get("swCategoryDetail").category=null,this.cmsPageState.resetCmsPageState(),this.isLoading=!1;return}Shopware.Store.get("shopwareApps").selectedIds=[this.categoryId],Shopware.Store.get("swCategoryDetail").loadActiveCategory({repository:this.categoryRepository,apiContext:Shopware.Context.api,id:this.categoryId,criteria:this.categoryCriteria}).then(()=>(this.cmsPageState.resetCmsPageState(),Promise.resolve())).then(this.getAssignedCmsPage).then(this.loadCustomFieldSet).then(()=>{this.isLoading=!1})},loadCustomFieldSet(){return this.isCustomFieldLoading=!0,this.customFieldSetRepository.search(this.customFieldSetCriteria).then(e=>{Shopware.Store.get("swCategoryDetail").customFieldSets=e}).finally(()=>{this.isCustomFieldLoading=!0})},loadLandingPageCustomFieldSet(){return this.isCustomFieldLoading=!0,this.customFieldSetRepository.search(this.customFieldSetLandingPageCriteria).then(e=>{Shopware.Store.get("swCategoryDetail").customFieldSets=e}).finally(()=>{this.isCustomFieldLoading=!0})},onSaveCategories(){return this.categoryRepository.save(this.category)},openChangeModal(e){this.nextRoute=e,this.isDisplayingLeavePageWarning=!0},onLeaveModalClose(){this.nextRoute=null,this.isDisplayingLeavePageWarning=!1},onLeaveModalConfirm(e){Shopware.Store.get("error").removeApiError("category"),this.forceDiscardChanges=!0,this.isDisplayingLeavePageWarning=!1,this.$nextTick(()=>{this.$router.push({name:e.name,params:e.params})})},cancelEdit(){this.resetCategory()},resetCategory(){this.$router.push({name:"sw.category.index"})},onChangeLanguage(e){this.currentLanguageId=e,this.landingPageId!==null&&this.setLandingPage(),this.setCategory()},abortOnLanguageChange(){return this.landingPage?this.landingPage?this.categoryRepository.hasChanges(this.landingPage):!1:this.category?this.categoryRepository.hasChanges(this.category):!1},saveOnLanguageChange(){return this.landingPage?this.onSaveLandingPage():this.onSave()},saveFinish(){this.isSaveSuccessful=!1},async onSave(){this.isSaveSuccessful=!1;const e=this.getCmsPageOverrides();if(g.isPlainObject(e)&&(this.category.slotConfig=l(e)),!this.entryPointOverwriteConfirmed&&(this.checkForEntryPointOverwrite(),this.showEntryPointOverwriteModal))return Promise.resolve();this.isLoading=!0,await this.updateSeoUrls();const t=await this.systemConfigApiService.getValues("core.cms");return this.defaultCategoryId=t["core.cms.default_category_cms_page"],this.category.cmsPageId===this.defaultCategoryId&&(this.category.cmsPageId=null),this.categoryRepository.save(this.category,{...Shopware.Context.api}).then(()=>(this.isSaveSuccessful=!0,this.entryPointOverwriteConfirmed=!1,this.setCategory())).catch(()=>{this.isLoading=!1,this.entryPointOverwriteConfirmed=!1,this.createNotificationError({message:this.$tc("global.notification.notificationSaveErrorMessageRequiredFieldsInvalid")})})},checkForEntryPointOverwrite(){this.entryPointOverwriteSalesChannels=new w("/sales_channel","sales_channel",y.api),this.category.navigationSalesChannels.forEach(e=>{e.navigationCategoryId!==null&&e.navigationCategoryId!==this.categoryId&&this.entryPointOverwriteSalesChannels.add(e)}),this.category.footerSalesChannels.forEach(e=>{e.footerCategoryId!==null&&e.footerCategoryId!==this.categoryId&&this.entryPointOverwriteSalesChannels.add(e)}),this.category.serviceSalesChannels.forEach(e=>{e.serviceCategoryId!==null&&e.serviceCategoryId!==this.categoryId&&this.entryPointOverwriteSalesChannels.add(e)})},cancelEntryPointOverwrite(){this.entryPointOverwriteSalesChannels=null},confirmEntryPointOverwrite(){this.entryPointOverwriteSalesChannels=null,this.entryPointOverwriteConfirmed=!0,this.$nextTick(()=>{this.onSave()})},onSaveLandingPage(){this.isSaveSuccessful=!1;const e=this.getCmsPageOverrides();return g.isPlainObject(e)&&(this.landingPage.slotConfig=l(e)),this.landingPageId!=="create"&&this.landingPage.salesChannels.length===0?(this.addLandingPageSalesChannelError(),Promise.resolve()):(this.isLoading=!0,this.landingPageRepository.save(this.landingPage,Shopware.Context.api).then(()=>(this.isSaveSuccessful=!0,this.landingPageId==="create"?(this.$router.push({name:"sw.category.landingPageDetail",params:{id:this.landingPage.id}}),Promise.resolve()):this.setLandingPage())).catch(()=>{if(this.isLoading=!1,this.landingPage.salesChannels.length===0){this.addLandingPageSalesChannelError();return}this.createNotificationError({message:this.$tc("global.notification.notificationSaveErrorMessageRequiredFieldsInvalid")})}))},addLandingPageSalesChannelError(){const e=new Shopware.Classes.ShopwareError({code:"landing_page_sales_channel_blank",detail:"This value should not be blank.",status:"400"});Shopware.Store.get("error").addApiError({expression:`landing_page.${this.landingPage.id}.salesChannels`,error:e}),this.createNotificationError({message:this.$tc("global.notification.notificationSaveErrorMessageRequiredFieldsInvalid")})},getCmsPageOverrides(){if(this.cmsPage===null)return null;this.deleteSpecifcKeys(this.cmsPage.sections);const{changes:e}=this.changesetGenerator.generate(this.cmsPage),t={};return e===null||g.isArray(e.sections)&&e.sections.forEach(a=>{g.isArray(a.blocks)&&a.blocks.forEach(s=>{g.isArray(s.slots)&&s.slots.forEach(i=>{t[i.id]=i.config})})}),t},deleteSpecifcKeys(e){e&&e.forEach(t=>{t.blocks&&t.blocks.forEach(a=>{a.slots&&a.slots.forEach(s=>{s.config&&Object.values(s.config).forEach(i=>{i.entity&&delete i.entity,i.hasOwnProperty("required")&&delete i.required,i.type&&delete i.type})})})})},updateSeoUrls(){if(!Shopware.Store.list().includes("swSeoUrl"))return Promise.resolve();const e=Shopware.Store.get("swSeoUrl").newOrModifiedUrls;return Promise.all(e.map(t=>t.seoPathInfo?(t.isModified=!0,this.seoUrlService.updateCanonicalUrl(t,t.languageId)):Promise.resolve()))},onLandingPageDelete(){Shopware.Store.get("swCategoryDetail").landingPagesToDelete=null},onCategoryDelete(){Shopware.Store.get("swCategoryDetail").categoriesToDelete=null}}};export{P as default};
