const p=`{% block sw_import_export_entity_path_select %} <sw-select-base ref="selectBase" class="sw-import-export-entity-path-select" :is-loading="isLoading" v-bind="$attrs" @select-expanded="onSelectExpanded" @select-collapsed="onSelectCollapsed" > {% block sw_import_export_entity_path_select_base %} {% block sw_import_export_entity_path_select_base_selection %} <template #sw-select-selection="{ identification, error, disabled, size, setFocusClass, removeFocusClass }"> {% block sw_import_export_entity_path_select_base_selection_slot %} <div class="sw-import-export-entity-path-select__selection"> {% block sw_import_export_entity_path_select_single_selection_inner %} {% block sw_import_export_entity_path_select_single_selection_inner_label %} <div v-if="!isExpanded" class="sw-import-export-entity-path-select__selection-text" :class="selectionTextClasses" > <template v-if="singleSelection"> <slot name="selection-label-property" v-bind="{ item: singleSelection, labelProperty, valueProperty, searchTerm, getKey }" > {{ getKey(singleSelection, labelProperty) }} </slot> </template> <template v-else> {{ placeholder }} </template> </div> {% endblock %} {% block sw_import_export_entity_path_select_single_selection_inner_input %} <input ref="swSelectInput" v-model="searchInput" class="sw-import-export-entity-path-select__selection-input" :class="inputClasses" type="text" :placeholder="placeholder" @input="onInputSearch" > {% endblock %} {% endblock %} </div> {% endblock %} </template> {% endblock %} {% block sw_import_export_entity_path_select_base_results %} <template #results-list> {% block sw_import_export_entity_path_select_base_results_slot %} <sw-select-result-list ref="resultsList" :options="visibleResults" :is-loading="isLoading" :empty-message="$tc('global.sw-single-select.messageNoResults', { term: searchInput }, 0)" :focus-el="$refs.swSelectInput" :popover-classes="resultListClasses" @paginate="$emit('paginate')" @item-select="setValue" > {% block sw_import_export_entity_path_select_base_results_list %} {% block sw_import_export_entity_path_select_base_results_list_before %} <template #before-item-list> <slot name="before-item-list"> <sw-select-result :selected="isSelected(notMappedItem)" v-bind="{ item: notMappedItem, index: -1 }" @item-select="setValue" > {% block sw_import_export_entity_path_select_base_results_list_not_mapped_label %} {{ notMappedItem.label }} {% endblock %} </sw-select-result> <hr class="sw-import-export-entity-path-select__listing-seperator"> </slot> </template> {% endblock %} {% block sw_import_export_entity_path_select_base_results_list_result %} <template #result-item="{ item, index }"> <slot name="result-item" v-bind="{ item, index, labelProperty, searchTerm, highlightSearchTerm, isSelected, setValue, getKey }" > <sw-select-result :selected="isSelected(item)" v-bind="{ item, index }" @item-select="setValue" > {% block sw_import_export_entity_path_select_base_results_list_result_label %} <slot name="result-label-property" v-bind="{ item, index, labelProperty, valueProperty, searchTerm, highlightSearchTerm, getKey }" > <sw-highlight-text v-if="highlightSearchTerm" :text="getKey(item, labelProperty)" :search-term="searchTerm" /> <template v-else> {{ getKey(item, labelProperty) }} </template> <sw-icon v-if="item.relation && item.relation !== 'many_to_many'" name="regular-chevron-right-xxs" size="16px" /> </slot> {% endblock %} </sw-select-result> </slot> </template> {% endblock %} {% block sw_import_export_entity_path_select_base_results_list_after %} <template #after-item-list> <slot name="after-item-list"></slot> </template> {% endblock %} {% endblock %} </sw-select-result-list> {% endblock %} </template> {% endblock %} {% endblock %} </sw-select-base> {% endblock %}`,{Mixin:u}=Shopware,{debounce:h,get:d,flow:_}=Shopware.Utils,f={template:p,inject:["feature"],emits:["paginate","update:value","before-selection-clear","search"],mixins:[u.getByName("remove-api-error")],props:{value:{required:!0},entityType:{type:String,required:!0},isLoading:{type:Boolean,required:!1,default:!1},highlightSearchTerm:{type:Boolean,required:!1,default:!0},placeholder:{type:String,required:!1,default:""},valueProperty:{type:String,required:!1,default:"value"},searchFunction:{type:Function,required:!1,default({options:e,labelProperty:t,searchTerm:s}){return e.filter(r=>{const i=this.getKey(r,t);return i?s?this.actualPathPrefix?!!i.split(this.actualPathPrefix)[1].match(new RegExp(s.split(this.actualPathPrefix)[1].replaceAll(/\./g,"([-.\\w]*)"),"gi")):i.match(new RegExp(s.replaceAll(/\./g,"([-.\\w]*)"),"gi")):!0:!1})}},currencies:{type:Array,required:!1,default(){return[{isoCode:"DEFAULT"}]}},languages:{type:Array,required:!1,default(){return[{locale:{code:"DEFAULT"}}]}},customFieldSets:{type:Array,required:!1,default(){return[]}}},data(){return{labelProperty:"label",searchInput:"",actualSearch:"",isExpanded:!1,itemRecentlySelected:!1,priceProperties:["net","gross","currencyId","linked","listPrice.net","listPrice.gross","listPrice.linked"],visibilityProperties:["all","link","search"],notMappedItem:{label:this.$t("sw-import-export.profile.mapping.notMapped"),relation:void 0,value:""}}},computed:{currentValue:{get(){return this.value||""},set(e){this.$emit("update:value",e)}},inputClasses(){return{"is--expanded":this.isExpanded}},selectionTextClasses(){return{"is--placeholder":!this.singleSelection}},resultListClasses(){return["sw-import-export-entity-path-select__result-list"]},singleSelection:{get(){return this.currentValue===""||this.currentValue===null?this.notMappedItem:this.results.find(e=>this.getKey(e,this.valueProperty)===this.currentValue)},set(e){e===null&&(e=""),this.currentValue=this.getKey(e,this.valueProperty)}},visibleResults(){if(this.singleSelection){const e=[];this.singleSelection.value!==this.notMappedItem.value&&e.push(this.singleSelection);const t=this.getKey(this.singleSelection,this.valueProperty);return this.results.forEach(s=>{this.getKey(s,this.valueProperty)!==t&&e.push(s)}),e}return this.results},actualPathPrefix(){let e="",t=this.entityType;return this.actualPathParts.forEach(s=>{var i;if(!t)return;if(s==="customFields"||this.lowerCaseIsoCodes.includes(s.toLowerCase())||this.lowerCaseLocales.includes(s.toLowerCase())){e=e.concat(s,".");return}const r=Shopware.EntityDefinition.get(t);if(!((i=r.properties[s])!=null&&i.entity)){t="";return}e=e.concat(s,"."),t=r.properties[s].entity}),e},actualPathParts(){const e=this.isExpanded?this.actualSearch.split("."):this.currentValue.split(".");return e.splice(-1,1),e[e.length-1]==="customFields"?e:e.filter(t=>this.lowerCaseIsoCodes.includes(t.toLowerCase())||this.lowerCaseLocales.includes(t.toLowerCase())?!1:!["translations","visibilities","price","listPrice","purchasePrices"].includes(t))},currentEntity(){if(this.actualPathParts.length===0)return this.entityType;const e=this.actualPathParts;let t=Shopware.EntityDefinition.get(this.entityType),s=!1;return e.forEach(r=>{const i=t.properties[r];if(!i||r==="translations"&&i.relation==="one_to_many"||r==="visibilities"&&i.relation==="one_to_many"||r==="media"&&i.relation==="one_to_many"||r==="assignedProducts"&&i.relation==="one_to_many"||r==="lineItems"&&i.relation==="one_to_many"||r==="categories"&&i.relation==="many_to_many"||r==="price"&&i.type==="json_object"||r==="customFields"&&i.type==="json_object")return;const n=t.properties[r].entity;s=Shopware.EntityDefinition.has(n),s&&(t=Shopware.EntityDefinition.get(n))}),s?t.entity:null},processFunctions(){return[this.processTranslations,this.processVisibilities,this.processMedia,this.processAssignedProducts,this.processPrice,this.processLineItems,this.processTransactions,this.processDeliveries,this.processProperties,this.processCategories]},options(){const e=this.actualPathParts[this.actualPathParts.length-1]==="customFields";if(this.currentEntity===null&&!e)return[];let t;e?t={properties:this.getCustomFields(this.currentEntity||this.entityType)}:t=Shopware.EntityDefinition.get(this.currentEntity);const s={definition:t,options:[],properties:Object.keys(t.properties),path:this.actualPathPrefix},{options:r}=_(this.processFunctions)(s);return r.sort(this.sortOptions)},results(){return this.searchFunction({options:this.options,labelProperty:this.labelProperty,valueProperty:this.valueProperty,searchTerm:this.actualSearch})},availableIsoCodes(){return this.currencies.map(e=>e.isoCode)},lowerCaseIsoCodes(){return this.availableIsoCodes.map(e=>e.toLowerCase())},availableLocales(){return this.languages.map(e=>e.locale.code)},lowerCaseLocales(){return this.availableLocales.map(e=>e.toLowerCase())},searchTerm(){return this.actualSearch.split(".").pop()}},methods:{isSelected(e){return this.getKey(e,this.valueProperty)===this.value},onSelectExpanded(){this.isExpanded=!0,this.searchInput=this.currentValue,this.$nextTick(()=>{this.resetActiveItem(),this.$refs.swSelectInput.select(),this.$refs.swSelectInput.focus(),this.search()})},tryGetSearchText(e){return this.getKey(e,this.labelProperty,"")},onSelectCollapsed(){this.$attrs.disabled||(this.searchInput===""&&!this.itemRecentlySelected&&(this.$emit("before-selection-clear",this.singleSelection,this.value),this.currentValue=""),this.$refs.swSelectInput.blur(),this.searchInput="",this.actualSearch="",this.itemRecentlySelected=!1,this.isExpanded=!1)},closeResultList(){this.$refs.selectBase.collapse()},setValue(e){if(this.itemRecentlySelected=!0,this.singleSelection=e,e.relation&&e.relation!=="many_to_many"){this.actualSearch=`${e.value}.`,this.searchInput=this.actualSearch,this.$refs.swSelectInput.select();return}this.currentValue=e.value,this.closeResultList()},resetActiveItem(e=0){this.$refs.resultsList&&(this.singleSelection&&(e=1),this.$refs.resultsList.setActiveItemIndex(e))},onInputSearch(){this.debouncedSearch()},debouncedSearch:h(function(){this.search()},300),search(){this.$emit("search",this.searchInput),this.actualSearch=this.searchInput,this.$nextTick(()=>{this.resetActiveItem()})},getKey(e,t,s){return d(e,t,s)},processTranslations({definition:e,options:t,properties:s,path:r}){const i=e.properties.translations;if(!i||i.relation!=="one_to_many")return{properties:s,options:t,definition:e,path:r};const n=Shopware.EntityDefinition.get(i.entity),o=Object.keys(n.properties),l=[...t,...this.getTranslationProperties(r,o)];return{properties:s.filter(a=>!o.includes(a)&&a!=="translations"),options:l,definition:e,path:r}},getTranslationProperties(e,t){e=`${e}translations.`;const s=[];return this.availableLocales.forEach(r=>{t.forEach(i=>{const n=`${e}${r}.${i}`;if(i==="customFields"){s.push({label:n,value:n,relation:!0});return}s.push({label:n,value:n})})}),s},processPrice({definition:e,options:t,properties:s,path:r}){const i=e.properties.price;if(!i||i.type!=="json_object")return{properties:s,options:t,definition:e,path:r};const n=[...t,...this.getPriceProperties(r)];return{properties:s.filter(l=>l!=="price"&&l!=="purchasePrices"),options:n,definition:e,path:r}},getPriceProperties(e){return[...this.generatePriceProperties("price",e),...this.generatePriceProperties("purchasePrices",e)]},generatePriceProperties(e,t){const s=[];return this.currencies.forEach(r=>{this.priceProperties.forEach(i=>{const n=`${t}${e}.${r.isoCode}.${i}`;s.push({label:n,value:n})})}),s},processLineItems({definition:e,options:t,properties:s,path:r}){const i=e.properties.lineItems;if(!i||i.relation!=="one_to_many")return{definition:e,options:t,properties:s,path:r};const n=[...t,...this.generateLineItemProperties(r)];return{properties:s.filter(l=>l!=="lineItems"),options:n,definition:e,path:r}},generateLineItemProperties(e){const t=`${e}lineItems`;return[{label:t,value:t}]},processTransactions({definition:e,options:t,properties:s,path:r}){const i=e.properties.transactions;if(!i||i.relation!=="one_to_many")return{definition:e,options:t,properties:s,path:r};const n=Shopware.EntityDefinition.get(i.entity),o=Object.keys(n.properties),l=[...t,...this.generateTransactionsProperties(r,o)];return{properties:s.filter(a=>a!=="transactions"),options:l,definition:e,path:r}},generateTransactionsProperties(e,t){return t.reduce((s,r)=>{const i=`${e}transactions.${r}`;return s.push({value:i,label:i}),s},[])},processDeliveries({definition:e,options:t,properties:s,path:r}){const i=e.properties.deliveries;if(!i||i.relation!=="one_to_many")return{properties:s,options:t,definition:e,path:r};const n=Shopware.EntityDefinition.get(i.entity),o=Object.keys(n.properties),l=[...t,...this.generateDeliveryProperties(r,o)];return{properties:s.filter(a=>a!=="deliveries"),options:l,definition:e,path:r}},generateDeliveryProperties(e,t){return t.reduce((s,r)=>{const i=`${e}deliveries.${r}`;return s.push({value:i,label:i}),s},[])},processProperties({definition:e,options:t,properties:s,path:r}){const i=[...t];return s.forEach(n=>{const o=`${r}${n}`,l=e.properties[n];l.relation!=="one_to_many"&&i.push({label:o,value:o,relation:l.relation})}),{definition:e,options:i,properties:s,path:r}},processVisibilities({definition:e,options:t,properties:s,path:r}){const i=e.properties.visibilities;if(!i||i.relation!=="one_to_many")return{properties:s,options:t,definition:e,path:r};const n=[...t,...this.getVisibilityProperties(r)];return{properties:s.filter(l=>l!=="visibilities"),options:n,definition:e,path:r}},getVisibilityProperties(e){return this.visibilityProperties.reduce((t,s)=>{const r=`${e}visibilities.${s}`;return t.push({label:r,value:r}),t},[])},processMedia({definition:e,options:t,properties:s,path:r}){const i=e.properties.media;if(!i||i.relation!=="one_to_many")return{properties:s,options:t,definition:e,path:r};const n=[...t,...this.getMediaProperties(r)];return{properties:s.filter(l=>l!=="media"),options:n,definition:e,path:r}},getMediaProperties(e){const t=`${e}media`;return[{label:t,value:t}]},processAssignedProducts({definition:e,options:t,properties:s,path:r}){const i=e.properties.assignedProducts;if(!i||i.relation!=="one_to_many")return{properties:s,options:t,definition:e,path:r};const n=[...t,...this.getAssignedProductsProperties(r)];return{properties:s.filter(l=>l!=="assignedProducts"),options:n,definition:e,path:r}},getAssignedProductsProperties(e){const t=`${e}assignedProducts`;return[{label:t,value:t}]},processCategories({definition:e,options:t,properties:s,path:r}){const i=e.properties.categories;if((i==null?void 0:i.relation)!=="one_to_many")return{properties:s,options:t,definition:e,path:r};const n=[...t,...this.getCategoryProperties(r)];return{properties:s.filter(l=>l!=="categories"),options:n,definition:e,path:r}},getCategoryProperties(e){const t=`${e}categories`;return[{label:t,value:t}]},sortOptions(e,t){return e.value>t.value?1:t.value>e.value?-1:0},getCustomFields(e){const t={};return this.customFieldSets.forEach(s=>{s.relations.filter(i=>i.entityName===e).length>0&&s.customFields.forEach(i=>{t[i.name]={label:i.name,value:i.name}})}),t}}};export{f as default};
