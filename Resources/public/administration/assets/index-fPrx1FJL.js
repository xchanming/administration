const d=`{% block sw_order_document_settings_modal %} <sw-modal :title="modalTitle" class="sw-order-document-settings-modal" @modal-close="onCancel" > {% block sw_order_document_settings_modal_form_first_row %} <sw-container columns="1fr 1fr" gap="0px 14px" > {% block sw_order_document_settings_modal_form_document_number %} <sw-text-field v-model:value="documentConfig.documentNumber" :label="$tc('sw-order.documentModal.labelDocumentNumber')" /> {% endblock %} {% block sw_order_document_settings_modal_form_document_date %} <sw-datepicker v-model:value="documentConfig.documentDate" date-type="date" required hide-hint :label="$tc('sw-order.documentModal.labelDocumentDate')" :placeholder="$tc('sw-datepicker.date.placeholder')" /> {% endblock %} </sw-container> {% endblock %} {% block sw_order_document_settings_modal_form_file_upload %} {% block sw_order_document_settings_modal_form_file_upload_toggle %} <sw-switch-field v-model:value="uploadDocument" name="sw-field--uploadDocument" class="sw-order-document-settings-modal__file-toggle" :label="$tc('sw-order.documentModal.fileInputLabel')" /> {% endblock %} {% block sw_order_document_settings_modal_form_file_upload_input %} <sw-upload-listener v-if="uploadDocument" auto-upload :upload-tag="order.id" @media-upload-finish="successfulUploadFromUrl" /> <sw-media-upload-v2 v-if="uploadDocument" ref="fileInput" variant="small" class="sw-order-document-settings-modal__file-input" use-file-data :source="selectedDocumentFile" :allow-multi-select="false" :file-accept="features.fileAcceptTypes" :max-file-size="features.uploadFileSizeLimit" default-folder="document" :upload-tag="order.id" @media-upload-add-file="onAddDocument" @media-upload-sidebar-open="openMediaModal" @media-upload-remove-image="removeCustomDocument" /> {% endblock %} {% endblock %} {% block sw_order_document_settings_modal_media_modal %} <sw-media-modal-v2 v-if="showMediaModal" :allow-multi-select="false" :file-accept="features.fileAcceptTypes" @media-modal-selection-change="onAddMediaFromLibrary" @modal-close="closeMediaModal" /> {% endblock %} {% block sw_order_document_settings_modal_form_additional_content %}{% endblock %} {% block sw_order_document_settings_modal_form_document_comment %} <sw-textarea-field v-model:value="documentConfig.documentComment" name="sw-field--documentConfig-documentComment" class="sw-order-document-settings-modal__comment" :label="$tc('sw-order.documentModal.labelDocumentComment')" /> {% endblock %} {% block sw_order_document_settings_modal_form_document_footer %} <template #modal-footer> <sw-button-group split-button> {% block sw_order_document_settings_modal_form_document_footer_preview %} <sw-button class="sw-order-document-settings-modal__preview-button" size="small" :disabled="isLoadingDocument" :is-loading="isLoadingPreview" @click="onPreview()" > {{ $tc('sw-order.documentModal.labelPreview') }} </sw-button> {% endblock %} <sw-context-button menu-width="160"> <template #button> <sw-button square size="small" > <sw-icon name="regular-chevron-down-xs" size="16" /> </sw-button> </template> <sw-context-menu-item class="sw-order-document-settings-modal__preview-button-html" :disabled="htmlPreviewDisabled" @click="onPreview('html')" > {{ $tc('sw-order.documentModal.labelPreviewOnlyHtml') }} </sw-context-menu-item> </sw-context-button> </sw-button-group> <div> {% block sw_order_document_settings_modal_form_document_footer_cancel %} <sw-button size="small" @click="onCancel" > {{ $tc('sw-order.documentModal.labelCancel') }} </sw-button> {% endblock %} {% block sw_order_document_settings_modal_form_document_footer_split_button %} <sw-button-group split-button> {% block sw_order_document_settings_modal_form_document_footer_split_button_create %} <sw-button class="sw-order-document-settings-modal__create" variant="primary" size="small" :disabled="!documentPreconditionsFulfilled || isLoadingPreview" :is-loading="isLoadingDocument" @click="onCreateDocument" > {{ $tc('sw-order.documentModal.labelCreate') }} </sw-button> {% endblock %} {% block sw_order_document_settings_modal_form_document_footer_split_button_context %} <sw-context-button :disabled="!documentPreconditionsFulfilled || undefined" > {% block sw_order_document_settings_modal_form_document_footer_split_button_context_arrow %} <template #button> <sw-button square variant="primary" size="small" :disabled="!documentPreconditionsFulfilled" > <sw-icon name="regular-chevron-down-xs" size="16" /> </sw-button> </template> {% endblock %} {% block sw_order_document_settings_modal_form_document_footer_split_button_context_create_send %} <sw-context-menu-item class="sw-order-document-settings-modal__send-button" @click="onCreateDocument('send')" > {{ $tc('sw-order.documentModal.labelCreateSend') }} </sw-context-menu-item> {% endblock %} {% block sw_order_document_settings_modal_form_document_footer_split_button_context_create_download %} <sw-context-menu-item class="sw-order-document-settings-modal__download-button" @click="onCreateDocument('download')" > {{ $tc('sw-order.documentModal.labelCreateDownloadPdf') }} </sw-context-menu-item> {% endblock %} </sw-context-button> {% endblock %} </sw-button-group> {% endblock %} </div> </template> {% endblock %} </sw-modal> {% endblock %}`,{Mixin:l,Utils:i}=Shopware,{isEmpty:s}=i.types,c={template:d,inject:["numberRangeService","repositoryFactory"],emits:["loading-document","document-create","preview-show","page-leave-confirm","page-leave"],mixins:[l.getByName("notification")],props:{order:{type:Object,required:!0},currentDocumentType:{type:Object,required:!0},isLoadingDocument:{type:Boolean,required:!0},isLoadingPreview:{type:Boolean,required:!0}},data(){return{showModal:!1,selectedDocumentFile:null,uploadDocument:!1,documentConfig:{custom:{},documentNumber:"0",documentComment:"",documentDate:""},documentNumberPreview:!1,features:{uploadFileSizeLimit:52428800,fileAcceptTypes:"application/pdf"},showMediaModal:!1}},computed:{documentPreconditionsFulfilled(){return!0},modalTitle(){var e,t,o;if(this.currentDocumentType){const n=((t=(e=this.currentDocumentType)==null?void 0:e.translated)==null?void 0:t.name)||((o=this.currentDocumentType)==null?void 0:o.name);return`${this.$tc("sw-order.documentModal.modalTitle")} - ${n}`}return this.$tc("sw-order.documentModal.modalTitle")},mediaRepository(){return this.repositoryFactory.create("media")},htmlPreviewDisabled(){var e,t;return((t=(e=this.currentDocumentType)==null?void 0:e.technicalName)==null?void 0:t.startsWith("zugferd_"))??!1}},created(){this.createdComponent()},methods:{async createdComponent(){this.documentConfig.documentNumber=await this.reserveDocumentNumber(!0),this.documentNumberPreview=this.documentConfig.documentNumber,this.documentConfig.documentDate=new Date().toISOString()},async onCreateDocument(e=!1){if(this.$emit("loading-document"),this.documentNumberPreview===this.documentConfig.documentNumber){const t=await this.reserveDocumentNumber(!1);t!==this.documentConfig.documentNumber&&this.createNotificationInfo({message:this.$tc("sw-order.documentCard.info.DOCUMENT__NUMBER_WAS_CHANGED")}),this.documentConfig.documentNumber=t}await this.addAdditionalInformationToDocument(),this.callDocumentCreate(e)},callDocumentCreate(e,t=null){this.$emit("document-create",this.documentConfig,e,t,this.uploadDocument?this.selectedDocumentFile:null)},async reserveDocumentNumber(e){let t=this.currentDocumentType.technicalName;t!=null&&t.startsWith("zugferd_")&&(t="invoice");const{number:o}=await this.numberRangeService.reserve(`document_${t}`,this.order.salesChannelId,e);return o},addAdditionalInformationToDocument(){},onPreview(e="pdf"){this.$emit("preview-show",{...this.documentConfig,fileTypes:[e]},e)},onConfirm(){this.$emit("page-leave-confirm")},onCancel(){this.$emit("page-leave")},openMediaModal(){this.showMediaModal=!0},closeMediaModal(){this.showMediaModal=!1},async onAddMediaFromLibrary(e){s(e)||this.validateFile(e[0])},successfulUploadFromUrl(e){this.mediaRepository.get(e.targetId).then(t=>{this.validateFile(t)})},validateFile(e){this.$refs.fileInput.checkFileSize(e)&&this.$refs.fileInput.checkFileType(e)&&(this.selectedDocumentFile=e,this.documentConfig.documentMediaFileId=e.id)},removeCustomDocument(){this.documentConfig.documentMediaFileId=null,this.selectedDocumentFile=null,this.sourceDocument=null},onAddDocument(e){this.selectedDocumentFile=e[0]}}};export{c as default};
