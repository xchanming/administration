{"version":3,"file":"index-BJI1JNlZ.js","sources":["../../../app/administration/src/app/component/rule/sw-rule-modal/sw-rule-modal.html.twig","../../../app/administration/src/app/component/rule/sw-rule-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_rule_modal %}\n<sw-modal\n    class=\"sw-rule-modal\"\n    variant=\"full\"\n    :title=\"modalTitle\"\n    :is-loading=\"isLoading\"\n    @modal-close=\"$emit('modal-close')\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_rule_modal_basic_info %}\n    <sw-container\n        v-if=\"rule\"\n        columns=\"2fr 1fr\"\n        gap=\"0px 32px\"\n    >\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_rule_modal_basic_info_name %}\n        <sw-text-field\n            v-model:value=\"rule.name\"\n            name=\"sw-field--rule-name\"\n            :label=\"$tc('sw-rule-modal.labelName')\"\n            :placeholder=\"$tc('sw-rule-modal.placeholderName')\"\n            :error=\"ruleNameError\"\n            required\n        />\n        {% endblock %}\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_rule_modal_basic_info_priority %}\n        <sw-number-field\n            v-model:value=\"rule.priority\"\n            name=\"sw-field--rule-priority\"\n            :label=\"$tc('sw-rule-modal.labelPriority')\"\n            :placeholder=\"$tc('sw-rule-modal.placeholderPriority')\"\n            :error=\"rulePriorityError\"\n            required\n        />\n        {% endblock %}\n    </sw-container>\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_rule_modal_basic_info_description %}\n    <sw-textarea-field\n        v-if=\"rule\"\n        v-model:value=\"rule.description\"\n        name=\"sw-field--rule-description\"\n        :label=\"$tc('sw-rule-modal.labelDescription')\"\n        :placeholder=\"$tc('sw-rule-modal.placeholderDescription')\"\n    />\n    {% endblock %}\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_rule_modal_condition_tree %}\n    <sw-condition-tree\n        v-if=\"rule\"\n        :condition-repository=\"ruleConditionRepository\"\n        :condition-data-provider-service=\"ruleConditionDataProviderService\"\n        :root-condition=\"null\"\n        association-field=\"ruleId\"\n        :association-value=\"rule.id\"\n        :association-entity=\"rule\"\n        :initial-conditions=\"initialConditions\"\n        :scopes=\"allowedRuleScopes\"\n        @conditions-changed=\"conditionsChanged\"\n    />\n    {% endblock %}\n\n    <template #modal-footer>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_rule_modal_footer %}\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_rule_modal_footer_button_abort %}\n        <sw-button\n            size=\"small\"\n            @click=\"$emit('modal-close')\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_rule_modal_footer_button_save %}\n        <sw-button\n            :disabled=\"isLoading\"\n            class=\"sw-rule-modal__save\"\n            size=\"small\"\n            variant=\"primary\"\n            @click=\"saveAndClose\"\n        >\n            {{ $tc('global.default.save') }}\n        </sw-button>\n        {% endblock %}\n        {% endblock %}\n    </template>\n</sw-modal>\n{% endblock %}\n","import template from './sw-rule-modal.html.twig';\nimport './sw-rule-modal.scss';\n\nconst { Component, Mixin, Context } = Cicada;\nconst { EntityCollection, Criteria } = Cicada.Data;\nconst { mapPropertyErrors } = Component.getComponentHelper();\n\n/**\n * @private\n * @package services-settings\n * @status ready\n * @description The <u>sw-rule-modal</u> component is used to create or modify a rule.\n * @example-type code-only\n * @component-example\n * <sw-rule-modal ruleId=\"0fd38734776f41e9a1ba431f1667e677\" @save=\"onSave\" @modal-close=\"onCloseModal\">\n * </sw-rule-modal>\n */\nComponent.register('sw-rule-modal', {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'ruleConditionDataProviderService',\n        'ruleConditionsConfigApiService',\n        'feature',\n    ],\n\n    emits: [\n        'save',\n        'modal-close',\n    ],\n\n    mixins: [\n        Mixin.getByName('notification'),\n        Mixin.getByName('placeholder'),\n    ],\n\n    props: {\n        allowedRuleScopes: {\n            type: Array,\n            required: false,\n            default: null,\n        },\n        ruleAwareGroupKey: {\n            type: String,\n            required: false,\n            default: null,\n        },\n    },\n\n    data() {\n        return {\n            rule: null,\n            initialConditions: null,\n            isLoading: false,\n        };\n    },\n\n    computed: {\n        ruleRepository() {\n            return this.repositoryFactory.create('rule');\n        },\n\n        ruleConditionRepository() {\n            if (!this.rule) {\n                return null;\n            }\n\n            return this.repositoryFactory.create(this.rule.conditions.entity, this.rule.conditions.source);\n        },\n\n        appScriptConditionRepository() {\n            return this.repositoryFactory.create('app_script_condition');\n        },\n\n        modalTitle() {\n            if (!this.rule || this.rule.isNew()) {\n                return this.$tc('sw-rule-modal.modalTitleNew');\n            }\n            return this.placeholder(this.rule, 'name', this.$tc('sw-rule-modal.modalTitleModify'));\n        },\n\n        ...mapPropertyErrors('rule', [\n            'name',\n            'priority',\n        ]),\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.isLoading = true;\n\n            this.loadConditionData().then((scripts) => {\n                this.ruleConditionDataProviderService.addScriptConditions(scripts);\n                this.rule = this.ruleRepository.create(Context.api);\n                this.initialConditions = EntityCollection.fromCollection(this.rule.conditions);\n\n                if (this.rule[this.ruleAwareGroupKey]) {\n                    this.rule[this.ruleAwareGroupKey].push({});\n                }\n\n                this.isLoading = false;\n            });\n        },\n\n        loadConditionData() {\n            const context = {\n                ...Context.api,\n                languageId: Cicada.State.get('session').languageId,\n            };\n            const criteria = new Criteria(1, 500);\n            criteria.addAssociation('appScriptCondition');\n\n            return Promise.all([\n                this.appScriptConditionRepository.search(criteria, context),\n                this.ruleConditionsConfigApiService.load(),\n            ]).then((results) => {\n                return results[0];\n            });\n        },\n\n        conditionsChanged({ conditions }) {\n            this.rule.conditions = conditions;\n        },\n\n        getChildrenConditions(condition) {\n            const conditions = [];\n            condition.children.forEach((child) => {\n                conditions.push(child);\n                if (child.children) {\n                    const children = this.getChildrenConditions(child);\n                    conditions.push(...children);\n                }\n            });\n\n            return conditions;\n        },\n\n        validateRuleAwareness() {\n            const conditions = [];\n            this.rule.conditions.forEach((condition) => {\n                conditions.push(condition);\n\n                if (condition.children) {\n                    const children = this.getChildrenConditions(condition);\n                    conditions.push(...children);\n                }\n            });\n\n            const tooltip = this.ruleConditionDataProviderService.getRestrictedRuleTooltipConfig(\n                conditions,\n                this.ruleAwareGroupKey,\n            );\n\n            if (!tooltip.disabled) {\n                this.createNotificationError({\n                    title: this.$tc('global.default.error'),\n                    message: tooltip.message,\n                });\n                return false;\n            }\n\n            return true;\n        },\n\n        saveAndClose() {\n            if (!this.validateRuleAwareness()) {\n                return Promise.resolve();\n            }\n            if (this.rule[this.ruleAwareGroupKey]) {\n                this.rule[this.ruleAwareGroupKey] = [];\n            }\n\n            const titleSaveSuccess = this.$tc('global.default.success');\n            const messageSaveSuccess = this.$tc('sw-rule-modal.messageSaveSuccess', 0, { name: this.rule.name });\n\n            const titleSaveError = this.$tc('global.default.error');\n            const messageSaveError = this.$tc('sw-rule-modal.messageSaveError', 0, { name: this.rule.name });\n\n            this.isLoading = true;\n            return this.ruleRepository\n                .save(this.rule, Context.api)\n                .then(() => {\n                    this.createNotificationSuccess({\n                        title: titleSaveSuccess,\n                        message: messageSaveSuccess,\n                    });\n\n                    this.loading = false;\n                    this.$emit('save', this.rule.id, this.rule);\n                    this.$emit('modal-close');\n                })\n                .catch(() => {\n                    this.isLoading = false;\n                    this.createNotificationError({\n                        title: titleSaveError,\n                        message: messageSaveError,\n                    });\n                });\n        },\n    },\n});\n"],"names":["template","Component","Mixin","Context","EntityCollection","Criteria","mapPropertyErrors","scripts","context","criteria","results","conditions","condition","child","children","tooltip","titleSaveSuccess","messageSaveSuccess","titleSaveError","messageSaveError"],"mappings":"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"}