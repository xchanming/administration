const n=`{% block sw_promotion_v2_conditions %} <div class="sw-promotion-v2-conditions"> {% block sw_promotion_v2_conditions_pre_conditions_card %} <sw-card :title="$tc('sw-promotion-v2.detail.conditions.preConditions.cardTitlePreConditions')" position-identifier="sw-promotion-conditions-pre-conditions" > {% block sw_promotion_v2_conditions_pre_conditions_sales_channel_selection %} <sw-promotion-v2-sales-channel-select class="sw-promotion-v2-conditions__sales-channel-selection" :promotion="promotion" :entity-collection="promotion.salesChannels" :disabled="!acl.can('promotion.editor')" :label="$tc('sw-promotion-v2.detail.conditions.preConditions.labelPromotionSalesChannel')" :placeholder="$tc('sw-promotion-v2.detail.conditions.preConditions.labelPromotionSalesChannel')" /> {% endblock %} {% block sw_promotion_v2_conditions_pre_conditions_prevent_combination %} <sw-switch-field v-model:value="promotion.preventCombination" class="sw-promotion-v2-conditions__prevent-combination" :disabled="!acl.can('promotion.editor')" :label="$tc('sw-promotion-v2.detail.conditions.preConditions.labelPreventCombination')" :help-text="$tc('sw-promotion-v2.detail.conditions.preConditions.helpTextPreventCombination')" /> {% endblock %} {% block sw_promotion_v2_conditions_pre_conditions_exclusions %} <sw-entity-multi-select class="sw-promotion-v2-conditions__rules-exclusion-selection" :label="$tc('sw-promotion-v2.detail.conditions.preConditions.labelPromotionExclusions')" :placeholder="$tc('sw-promotion-v2.detail.conditions.preConditions.placeholderPromotionExclusions')" :criteria="exclusionCriteria" :entity-collection="excludedPromotions" :disabled="!acl.can('promotion.editor') || promotion.preventCombination" @update:entity-collection="onChangeExclusions" /> {% endblock %} </sw-card> {% endblock %} {% block sw_promotion_v2_rule_conditions_card %} <sw-card :title="$tc('sw-promotion-v2.detail.conditions.preConditions.cardTitleRuleConditions')" position-identifier="sw-promotion-conditions-rules" > {% block sw_promotion_v2_rule_conditions_rule_select_customer %} <sw-promotion-v2-rule-select v-if="promotion" v-model:collection="promotion.personaRules" class="sw-promotion-v2-conditions__rule-select-customer" :local-mode="promotion.isNew()" :criteria="personaRuleFilter" :label="$tc('sw-promotion-v2.detail.conditions.preConditions.labelCustomerSelect')" :placeholder="$tc('sw-promotion-v2.detail.conditions.preConditions.placeholderCustomerSelect')" :rule-scope="['checkout']" :disabled="!acl.can('promotion.editor')" rule-aware-group-key="personaPromotions" /> {% endblock %} {% block sw_promotion_v2_rule_conditions_rule_select_cart_conditions %} <sw-promotion-v2-cart-condition-form :promotion="promotion" :restricted-rules="cartRestrictedRules" /> {% endblock %} {% block sw_promotion_v2_rule_conditions_rule_select_order_conditions %} <sw-promotion-v2-rule-select v-if="promotion" v-model:collection="promotion.orderRules" class="sw-promotion-v2-conditions__rule-select-order-conditions" :label="$tc('sw-promotion-v2.detail.conditions.preConditions.labelOrderConditionSelect')" :placeholder="$tc('sw-promotion-v2.detail.conditions.preConditions.placeholderOrderConditionSelect')" :criteria="orderConditionsFilter" :rule-scope="['checkout']" :disabled="!acl.can('promotion.editor')" rule-aware-group-key="orderPromotions" /> {% endblock %} </sw-card> {% endblock %} </div> {% endblock %}`,{Criteria:i,EntityCollection:r}=Shopware.Data,s=Shopware.Utils.types,l={template:n,inject:["repositoryFactory","acl","ruleConditionDataProviderService"],props:{promotion:{type:Object,required:!1,default(){return null}}},data(){return{excludedPromotions:this.createPromotionCollection(),personaRestrictedRules:[],orderRestrictedRules:[],cartRestrictedRules:[]}},computed:{exclusionCriteria(){const o=new i(1,25);return o.addFilter(i.not("and",[i.equals("id",this.promotion.id)])),o},personaRuleFilter(){const o=new i(1,25);return o.addAssociation("conditions").addSorting(i.sort("name","ASC",!1)),o},cartConditionsRuleFilter(){const o=new i(1,25);return o.addAssociation("conditions").addSorting(i.sort("name","ASC",!1)),o},orderConditionsFilter(){const o=new i(1,25);return o.addAssociation("conditions").addSorting(i.sort("name","ASC",!1)),o}},created(){this.createdComponent()},methods:{createdComponent(){this.loadExclusions()},loadExclusions(){if(s.isEmpty(this.promotion.exclusionIds)){this.excludedPromotions=this.createPromotionCollection();return}const o=this.repositoryFactory.create("promotion"),t=new i(1,25).addFilter(i.equalsAny("id",this.promotion.exclusionIds));o.search(t).then(e=>{this.excludedPromotions=e})},onChangeExclusions(o){this.promotion.exclusionIds=o.map(t=>t.id),this.loadExclusions()},createPromotionCollection(){return new r("/promotion","promotion",Shopware.Context.api,new i(1,25))}}};export{l as default};
