import{r as b}from"./channel-Cvr-E4M4.js";const m=`{% block sw_text_editor %} <div class="sw-text-editor" :class="classes" @click="onClick" > {% block sw_text_editor_label %} <div v-if="showLabel" class="sw-text-editor__label" > <slot name="label"> {{ label }} </slot> </div> {% endblock %} {% block sw_text_editor_box %} <div class="sw-text-editor__box"> {% block sw_text_editor_box_toolbar %} <sw-text-editor-toolbar v-if="(hasSelection && !disabled) || !isInlineEdit" ref="text-editor-toolbar" :parent-is-active="isActive" :is-inline-edit="isInlineEdit" :selection="selection" :button-config="buttonConfig" :is-code-edit="isCodeEdit" :is-table-edit="isTableEdit" @created-el="onToolbarCreated" @destroyed-el="onToolbarDestroyed" @on-set-link="onSetLink" @remove-link="onRemoveLink" @table-edit="onTableEdit" @text-style-change="onTextStyleChange" /> {% endblock %} {% block sw_text_editor_box_table_toolbar %} <sw-text-editor-table-toolbar v-if="isTableEdit && !isInlineEdit && !isCodeEdit" :selection="selection" @table-delete="onTableDelete" @table-modify="onTableModify" /> {% endblock %} {% block sw_text_editor_box_content %} <sw-code-editor v-if="isCodeEdit" ref="codeEditor" :value="value" :sanitize-input="sanitizeInput" :sanitize-field-name="sanitizeFieldName" :sanitize-info-warn="sanitizeInfoWarn" set-focus @blur="emitHtmlContent" @update:value="emitHtmlContent" /> <div v-else class="sw-text-editor__content" :class="contentClasses" > <div ref="textEditor" class="sw-text-editor__content-editor" :contenteditable="!disabled" :style="verticalAlignStyle" :spellcheck="true" tabindex="-1" @focus="onFocus" @keyup.enter="onEnter" @paste="onPaste" @input="onInput" @copy="onCopy" @mousedown.right.stop v-html="$sanitize(content, { ADD_ATTR: ['target'] })" ></div> <div v-if="placeholderVisible" class="sw-text-editor__content-placeholder" v-html="$sanitize(placeholder)" ></div> </div> {% endblock %} {% block sw_text_editor_box_word_count %} <div v-if="!isInlineEdit && !isCodeEdit" class="sw-text-editor__word_count" > <sw-container columns="1fr" justify="right" > <span class="sw-text-editor__text-length"> {{ $tc('global.sw-text-editor.labelTextLength', textLength, { count: textLength }) }} </span> </sw-container> </div> {% endblock %} </div> {% endblock %} <sw-field-error v-if="error" :error="error" /> </div> {% endblock %}`,{Component:x}=Shopware;x.register("sw-text-editor",{template:m,inject:["feature"],emits:["update:value"],props:{value:{type:String,required:!1,default:""},isInlineEdit:{type:Boolean,required:!1,default:!1},verticalAlign:{type:String,required:!1,default:"",validator(t){return["","center","flex-start","flex-end"].includes(t)}},label:{type:String,required:!1,default:""},placeholder:{type:String,required:!1,default:""},disabled:{type:Boolean,required:!1,default:!1},allowInlineDataMapping:{type:Boolean,required:!1,default:!1},sanitizeInput:{type:Boolean,required:!1,default:!1},sanitizeFieldName:{type:String,required:!1,default:null},sanitizeInfoWarn:{type:Boolean,required:!1,default:!1},enableTransparentBackground:{type:Boolean,required:!1,default:!1},buttonConfig:{type:Array,required:!1,default(){return b([{type:"paragraph",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.format"),icon:"regular-style-xs",children:[{type:"formatBlock",name:Shopware.Snippet.tc("sw-text-editor-toolbar.title.paragraph"),value:"p",tag:"p"},{type:"formatBlock",name:Shopware.Snippet.tc("sw-text-editor-toolbar.title.h1"),value:"h1",tag:"h1"},{type:"formatBlock",name:Shopware.Snippet.tc("sw-text-editor-toolbar.title.h2"),value:"h2",tag:"h2"},{type:"formatBlock",name:Shopware.Snippet.tc("sw-text-editor-toolbar.title.h3"),value:"h3",tag:"h3"},{type:"formatBlock",name:Shopware.Snippet.tc("sw-text-editor-toolbar.title.h4"),value:"h4",tag:"h4"},{type:"formatBlock",name:Shopware.Snippet.tc("sw-text-editor-toolbar.title.h5"),value:"h5",tag:"h5"},{type:"formatBlock",name:Shopware.Snippet.tc("sw-text-editor-toolbar.title.h6"),value:"h6",tag:"h6"},{type:"formatBlock",name:Shopware.Snippet.tc("sw-text-editor-toolbar.title.blockquote"),value:"blockquote",tag:"blockquote"}]},{type:"foreColor",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.text-color"),value:"",tag:"font"},{type:"bold",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.bold"),icon:"regular-bold-xs",tag:"b"},{type:"italic",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.italic"),icon:"regular-italic-xs",tag:"i"},{type:"underline",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.underline"),icon:"regular-underline-xs",tag:"u"},{type:"strikethrough",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.strikethrough"),icon:"regular-strikethrough-xs",tag:"strike"},{type:"superscript",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.superscript"),icon:"regular-superscript-xs",tag:"sup"},{type:"subscript",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.subscript"),icon:"regular-subscript-xs",tag:"sub"},{type:"justify",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.textAlign"),icon:"regular-align-left-xs",children:[{type:"justifyLeft",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.alignLeft"),icon:"regular-align-left"},{type:"justifyCenter",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.alignCenter"),icon:"regular-align-center"},{type:"justifyRight",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.alignRight"),icon:"regular-align-right"},{type:"justifyFull",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.justify"),icon:"regular-align-justify"}]},{type:"insertUnorderedList",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.insert-unordered-list"),icon:"regular-list-unordered-xs",tag:"ul"},{type:"insertOrderedList",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.insert-ordered-list"),icon:"regular-list-numbered-xs",tag:"ol"},{type:"link",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.link"),icon:"regular-link-xs",expanded:!1,newTab:!1,displayAsButton:!1,value:"",tag:"a"},{type:"undo",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.undo"),icon:"regular-undo-xs",position:"middle"},{type:"redo",title:Shopware.Snippet.tc("sw-text-editor-toolbar.title.redo"),icon:"regular-redo-xs",position:"middle"}])}},error:{type:Object,required:!1,default:null}},data(){return{isActive:!1,isEmpty:!1,hasSelection:!1,selection:null,currentSelection:null,isShiftPressed:!1,toolbar:null,textLength:0,content:"",placeholderHeight:null,placeholderVisible:!1,isCodeEdit:!1,tableData:{pageX:null,curCol:null,nextCol:null,curColWidth:null,nextColWidth:null},isTableEdit:!1,cmsPageState:Shopware.Store.get("cmsPage"),minorElementTags:["#text","br","b","strong","mark","del","s","ins","small","i","em","u","a","ul","ol","dl","img"],sectionElementTags:["p","h1","h2","h3","h4","h5","h6","blockquote","table"]}},computed:{classes(){return{"is--active":this.isActive,"is--disabled":this.disabled,"is--boxed":!this.isInlineEdit,"is--empty":this.isEmpty,"has--vertical-align":!!this.verticalAlign,"has--error":!!this.error}},contentClasses(){return{"is--transparent-background":this.enableTransparentBackground}},verticalAlignStyle(){return this.verticalAlign?{"justify-content":this.verticalAlign}:null},availableDataMappings(){let t=[];return Object.entries(this.cmsPageState.currentMappingTypes).forEach(e=>{const[i,s]=e;i==="string"&&(t=[...t,...s])}),t}},watch:{value:{handler(){this.$refs.textEditor&&this.value!==this.$refs.textEditor.innerHTML&&(this.$refs.textEditor.innerHTML="",this.content=this.value,this.isEmpty=this.emptyCheck(this.content),this.placeholderVisible=this.isEmpty),this.$nextTick(()=>{this.setWordCount(),this.setTablesResizable()})}},isCodeEdit(){this.isCodeEdit||this.$nextTick(()=>{this.setWordCount()})}},created(){this.createdComponent()},mounted(){this.mountedComponent()},unmounted(){this.destroyedComponent()},methods:{createdComponent(){if(this.content=this.value,!this.$options.buttonConfig&&(this.buttonConfig.push({type:"table",title:this.$tc("sw-text-editor-toolbar.title.insert-table"),icon:"regular-table-xs",tag:"table",expanded:!1,handler:this.handleInsertTable}),this.isInlineEdit||this.buttonConfig.push({type:"codeSwitch",title:this.$tc("sw-text-editor-toolbar.title.code-switch"),icon:"regular-code-xs",expanded:this.isCodeEdit,handler:this.toggleCodeEditor,position:"right"}),this.allowInlineDataMapping&&this.availableDataMappings.length>0)){const t={type:"data-mapping",title:this.$tc("sw-text-editor-toolbar.title.data-mapping"),icon:"regular-variables-xs",position:"left",dropdownPosition:"left",tooltipShowDelay:500,tooltipHideDelay:100},e=this.availableDataMappings.map(i=>({type:i,name:i,title:i,handler:this.handleInsertDataMapping}));t.children=e,this.buttonConfig.push(t)}document.addEventListener("mouseup",this.onSelectionChange),document.addEventListener("mousedown",this.onSelectionChange),document.addEventListener("keydown",this.onSelectionChange),document.addEventListener("keydown",this.keyListener),document.addEventListener("keyup",this.keyListener)},mountedComponent(){this.isEmpty=this.emptyCheck(this.content),this.placeholderVisible=this.isEmpty,this.$nextTick(()=>{this.setWordCount(),this.setTablesResizable()})},destroyedComponent(){document.removeEventListener("mouseup",this.onSelectionChange),document.removeEventListener("mousedown",this.onSelectionChange),document.removeEventListener("keydown",this.onSelectionChange),document.removeEventListener("keydown",this.keyListener),document.removeEventListener("keyup",this.keyListener)},keyListener(t){this.isShiftPressed=t.shiftKey},onSelectionChange(t){var s;if(this.isCodeEdit||!this.isActive)return;const e=this.getPath(t);if(e.some(o=>{var n;return(n=o.classList)==null?void 0:n.contains("sw-popover__wrapper")}))return;if((t.type==="keydown"||t.type==="mousedown")&&!e.includes(this.$el)&&!e.includes(this.toolbar)){this.hasSelection=!1;return}const i=(s=t==null?void 0:t.target)==null?void 0:s.tagName;if(e.includes(this.toolbar)){i!=="INPUT"&&i!=="SELECT"&&t.preventDefault();return}t.type==="mousedown"&&(document.getSelection().empty(),this.resetForeColor()),this.hasSelection=!!document.getSelection().toString(),this.selection=document.getSelection()},getPath(t){const e=[];let i=t.target;for(;i;)e.push(i),i=i.parentNode;return e},toggleCodeEditor(t){this.isCodeEdit=!this.isCodeEdit,t.expanded=!t.expanded},handleInsertDataMapping({name:t}){this.onTextStyleChange("insertText",`{{ ${t} }}`),this.selection=document.getSelection()},resetForeColor(){Object.keys(this.buttonConfig).forEach(t=>{this.buttonConfig[t].type==="foreColor"&&(this.buttonConfig[t].value="")})},onToolbarCreated(t){this.toolbar=t},onToolbarDestroyed(){this.toolbar=null},onTextStyleChange(t,e){const i=document.getSelection().toString();if(i.length>0){const s=this.containsStartBracket(i),o=this.containsEndBracket(i),n=this.isInsideInlineMapping();s&&!o&&this.expandSelectionToNearestEndBracket(),!s&&o&&this.expandSelectionToNearestStartBracket(),n&&(this.expandSelectionToNearestStartBracket(),this.expandSelectionToNearestEndBracket())}document.execCommand(t,!1,e),this.emitContent()},expandSelectionToNearestEndBracket(){const{anchorNode:t,anchorOffset:e,focusNode:i,focusNode:{nodeValue:s},focusOffset:o}=this.selection,l=Array.from(s).splice(o,s.length).join("").indexOf("}}"),r=/\{\{/.test(this.selection.toString());this.setSelection(t,i,r?e:e-1,o+l+2)},expandSelectionToNearestStartBracket(){const{anchorOffset:t,anchorNode:e,anchorNode:{nodeValue:i},focusNode:s,focusOffset:o}=this.selection,l=Array.from(i).splice(0,t).reverse().join("").indexOf("{{"),r=/}}/.test(this.selection.toString());this.setSelection(e,s,t-l-2,r?o:o+1)},setSelection(t,e,i,s){const o=new Range;o.setStart(t,i),o.setEnd(e,s),this.selection.empty(),this.selection.addRange(o)},containsStartBracket(t){return/\{{1,2}/.test(t)},containsEndBracket(t){return/}{1,2}/.test(t)},isInsideInlineMapping(){const t=this.selection.toString(),e=t.includes("{"),i=t.includes("}");if(e||i)return!1;const{anchorOffset:s,anchorNode:{textContent:o},focusOffset:n,focusNode:{textContent:l}}=this.selection,r=Array.from(o).splice(0,s).reverse().join(""),a=/^[^}]*{{/.test(r),c=Array.from(l).splice(n,l.length).join(""),h=/^[^{]*}}/.test(c);return!!a&&!!h},handleInsertTable(t){this.onTextStyleChange("insertHTML",t.value),this.selection=document.getSelection(),this.$nextTick(()=>{this.setTablesResizable(),this.isTableEdit=!0})},setTablesResizable(){const t=this.$el.querySelectorAll(".sw-text-editor-table");t&&t.forEach(e=>{this.setTableResizable(e)})},setTableResizable(t){const e=t.getElementsByTagName("tr")[0];if(!(e?e.children:void 0))return;const s=t.querySelectorAll(".sw-text-editor-table__col-selector");s.length>0&&(s.forEach(o=>{o.style.height=`${t.offsetHeight}px`,o.contentEditable=!1,this.setTableSelectorListeners(o)}),this.setTableListeners())},setTableSelectorListeners(t){t.addEventListener("mousedown",e=>{this.tableData.curCol=e.target.parentElement,this.tableData.nextCol=this.tableData.curCol.nextElementSibling,this.tableData.pageX=e.pageX,this.tableData.curColWidth=this.tableData.curCol.offsetWidth,this.tableData.nextCol&&(this.tableData.nextColWidth=this.tableData.nextCol.offsetWidth)})},setTableListeners(){this.$el.addEventListener("mousemove",t=>{if(this.tableData.curCol){const e=t.pageX-this.tableData.pageX;this.tableData.nextCol&&(this.tableData.nextCol.style.width=`${this.tableData.nextColWidth-e}px`),this.tableData.curCol.style.width=`${this.tableData.curColWidth+e}px`}}),this.$el.addEventListener("mouseup",()=>{this.tableData.curCol=null,this.tableData.nextCol=null,this.tableData.pageX=null,this.tableData.nextColWidth=null,this.tableData.curColWidth=null})},onSetLink(t,e,i,s){if(!this.selection.toString())return;const o=[],n=[`target="${e}"`,`href="${t}"`];e==="_blank"&&n.push('rel="noopener"'),i&&(o.push("btn"),o.push(...s.split("-").map(l=>`btn-${l}`))),o.length>0&&n.push(`class="${o.join(" ")}"`),this.onTextStyleChange("insertHTML",`<a ${n.join(" ")}>${this.selection}</a>`),this.selection=document.getSelection()},onRemoveLink(){const t=this.selection.focusNode.parentElement.closest("a");t&&(t.insertAdjacentHTML("afterend",t.innerHTML),t.remove())},onClick(){this.isActive=!0},onFocus(){this.setFocus(),document.execCommand("defaultParagraphSeparator",!1,"p")},onEnter(t){t.key==="Enter"&&!t.shiftKey&&this.hasDirectMinorElements()&&this.fixWrongNodes(!1)},fixWrongNodes(t=!1){const e=this.sectionElementTags,i=["div"],s=this.minorElementTags,o=this.$refs.textEditor.childNodes;let n=null,l=null,r=[];o.forEach(a=>{const c=a.nodeName.toLowerCase(),h=s.includes(c),u=e.includes(c),f=t===!0&&i.includes(c),g=(h||!u)&&!i.includes(c);if(f){const d=document.createElement("p");d.innerHTML=a.innerHTML,a.hasAttributes()&&Array.from(a.attributes).forEach(p=>{d.setAttribute(p.name,p.value)}),this.$refs.textEditor.replaceChild(d,a)}else g?n===null?(n=document.createElement("p"),n.appendChild(a.cloneNode(!0)),l=a):(n.appendChild(a.cloneNode(!0)),r.push(a)):(n!==null&&l!==null&&this.$refs.textEditor.replaceChild(n,l),r.forEach(d=>{this.$refs.textEditor.removeChild(d)}),n=null,l=null,r=[])}),this.emitContent()},hasDirectMinorElements(){return Array.from(this.$refs.textEditor.childNodes).some(e=>this.minorElementTags.includes(e.nodeName.toLowerCase()))},setFocus(){this.isActive||(document.addEventListener("mousedown",this.onDocumentClick),this.isActive=!0,this.placeholderVisible=!1)},removeFocus(){this.isActive&&(this.$refs.textEditor&&this.$refs.textEditor.innerHTML.length<=0&&(this.placeholderVisible=!0),this.isActive=!1,this.emitContent(),document.removeEventListener("mousedown",this.onDocumentClick))},onDocumentClick(t){const e=this.getPath(t);e.includes(this.toolbar)||e.includes(this.$el)||this.removeFocus()},onInput(){this.onContentChange(),this.emitContent()},onContentChange(){this.isEmpty=this.emptyCheck(this.getContentValue()),this.placeholderVisible=this.isEmpty,this.setWordCount()},onCopy(t){var o;t.preventDefault();const e=[];let i=this.selection.focusNode;for(;i.parentNode&&!((o=i==null?void 0:i.parentNode)!=null&&o.classList.contains("sw-text-editor__content-editor"));)e.unshift(i.parentNode),i=i.parentNode;const s=e.map(n=>n.tagName.toLowerCase()).filter(n=>n!=="p").reduce((n,l)=>`<${l}>${n}</${l}>`,this.selection.toString());t.clipboardData.setData("text/plain",this.selection.toString()),t.clipboardData.setData("text/html",s)},onPaste(t){t.preventDefault();const e={USE_PROFILES:{html:!0}},i=t.clipboardData,s=i.getData("text/plain"),o=i.getData("text/html");let n;o&&!this.isShiftPressed?n=document.createRange().createContextualFragment(this.$sanitize(o,e)):n=document.createTextNode(this.$sanitize(s));const l=window.getSelection();l.rangeCount&&(l.deleteFromDocument(),l.getRangeAt(0).insertNode(n))},emitContent(){this.$emit("update:value",this.getContentValue())},emitHtmlContent(t){this.content=t,this.$emit("update:value",t),this.isEmpty=this.emptyCheck(this.content),this.placeholderVisible=this.isEmpty},getContentValue(){return!this.$refs.textEditor||!this.$refs.textEditor.innerHTML||!this.$refs.textEditor.textContent||!this.$refs.textEditor.textContent.length||this.$refs.textEditor.textContent.length<=0?null:this.$refs.textEditor.innerHTML},emptyCheck(t){return!t||t===null||!t.length||t.length<=0},setWordCount(){this.$refs.textEditor&&(this.textLength=this.$refs.textEditor.innerText.length)},onTableEdit(t){this.isTableEdit=t},onTableModify(t){this.$nextTick(()=>{this.setTableResizable(t)})},onTableDelete(t){t.stopPropagation(),this.isTableEdit=!1},showLabel(){var t,e;return!!this.label||!!this.$slots.label||!!((e=(t=this.$scopedSlots)==null?void 0:t.label)!=null&&e.call(t))}}});
