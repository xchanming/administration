{"version":3,"file":"index-BHSTXdt9.js","sources":["../../../app/administration/src/module/sw-product/view/sw-product-detail-variants/sw-product-detail-variants.html.twig","../../../app/administration/src/module/sw-product/view/sw-product-detail-variants/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_product_detail_variants %}\n<div class=\"sw-product-detail-variants\">\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_detail_variants_sw_card_generated_variants %}\n    <sw-card\n        class=\"sw-product-detail-variants__generated-variants\"\n        position-identifier=\"sw-product-detail-variants-generated-variants\"\n        :class=\"{'is--loading': isLoading}\"\n        :title=\"$tc('sw-product.variations.generatedVariationCardTitle')\"\n        large\n    >\n        <template\n            v-if=\"!isLoading && propertiesAvailable\"\n            #tabs\n        >\n            <sw-tabs\n                position-identifier=\"sw-variant-card-tabs\"\n                :small=\"false\"\n                :default-item=\"defaultTab\"\n                @new-item-active=\"setActiveTab($event.name)\"\n            >\n                <sw-tabs-item\n                    name=\"all\"\n                    :active-tab=\"activeTab\"\n                >\n                    {{ $tc('sw-product.variations.variationCard.tabs.allProducts') }}\n                </sw-tabs-item>\n\n                <sw-tabs-item\n                    name=\"is-physical\"\n                    :active-tab=\"activeTab\"\n                >\n                    {{ $tc('sw-product.variations.variationCard.tabs.physicalProducts') }}\n                </sw-tabs-item>\n\n                <sw-tabs-item\n                    name=\"is-download\"\n                    :active-tab=\"activeTab\"\n                >\n                    {{ $tc('sw-product.variations.variationCard.tabs.digitalProducts') }}\n                </sw-tabs-item>\n            </sw-tabs>\n        </template>\n\n        <sw-skeleton v-if=\"isLoading\" />\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_variants_sw_card_empty_state %}\n        <sw-empty-state\n            v-else-if=\"!propertiesAvailable\"\n            class=\"sw-product-detail-variants__generated-variants-empty-state\"\n            :absolute=\"false\"\n            :title=\"$tc('sw-product.variations.emptyStatePropertyTitle')\"\n            :subline=\"$tc('sw-product.variations.emptyStatePropertyDescription')\"\n        >\n\n            <template #icon>\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_properties_empty_state_image %}\n                <img\n                    :src=\"assetFilter('/administration/static/img/empty-states/products-empty-state.svg')\"\n                    :alt=\"$tc('sw-product.properties.titleEmptyState')\"\n                >\n                {% endblock %}\n            </template>\n\n            <template #actions>\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_properties_empty_state_button_property %}\n                <sw-button\n                    v-tooltip=\"{\n                        message: $tc('sw-privileges.tooltip.warning'),\n                        disabled: acl.can('product.editor'),\n                        showOnDisabledElements: true\n                    }\"\n                    variant=\"ghost\"\n                    :disabled=\"!acl.can('product.editor')\"\n                    @click=\"openAddPropertiesModal\"\n                >\n                    {{ $tc('sw-product.properties.buttonAddProperties') }}\n                </sw-button>\n                {% endblock %}\n            </template>\n        </sw-empty-state>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_variants_sw_card_empty_state_variant %}\n        <sw-empty-state\n            v-if=\"!isLoading && propertiesAvailable && variants.length === 0\"\n            class=\"sw-product-detail-variants__generated-variants-empty-state\"\n            :absolute=\"false\"\n            :title=\"$tc('sw-product.variations.emptyStateTitle')\"\n            :subline=\"$tc('sw-product.variations.emptyStateDescription')\"\n        >\n\n            <template #icon>\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_properties_empty_state_image %}\n                <img\n                    :src=\"assetFilter('/administration/static/img/empty-states/products-empty-state.svg')\"\n                    :alt=\"$tc('sw-product.properties.titleEmptyState')\"\n                >\n                {% endblock %}\n            </template>\n\n            <template #actions>\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_properties_empty_state_button %}\n                <sw-button\n                    v-tooltip=\"{\n                        message: $tc('sw-privileges.tooltip.warning'),\n                        disabled: acl.can('product.creator'),\n                        showOnDisabledElements: true\n                    }\"\n                    class=\"sw-product-detail-variants__generated-variants-empty-state-button\"\n                    variant=\"ghost\"\n                    :disabled=\"!acl.can('product.creator')\"\n                    @click=\"openModal('variantGeneration')\"\n                >\n                    {{ $tc('sw-product.variations.emptyStateButton') }}\n                </sw-button>\n                {% endblock %}\n            </template>\n        </sw-empty-state>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_variants_sw_card_generated_variants_overview %}\n        <sw-product-variants-overview\n            v-if=\"product.id\"\n            v-show=\"variantListHasContent && !isLoading\"\n            ref=\"generatedVariants\"\n            :product-states=\"currentProductStates\"\n            :groups=\"groups\"\n            :selected-groups=\"configSettingGroups\"\n            :product-entity=\"productEntity\"\n            @variants-finish-update=\"updateVariantListHasContent\"\n            @generator-open=\"openModal('variantGeneration')\"\n            @delivery-open=\"openModal('deliveryModal')\"\n        />\n        {% endblock %}\n\n    </sw-card>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_detail_variants_modal_variant_generation %}\n    <sw-product-modal-variant-generation\n        v-if=\"activeModal === 'variantGeneration'\"\n        :product=\"productEntity\"\n        :groups=\"groups\"\n        :actual-status=\"activeTab\"\n        :selected-groups=\"configSettingGroups\"\n        @modal-close=\"activeModal = ''\"\n        @variations-finish-generate=\"updateVariations\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_detail_variants_modal_delivery %}\n    <sw-product-modal-delivery\n        v-if=\"activeModal === 'deliveryModal'\"\n        :product=\"productEntity\"\n        :selected-groups=\"configSettingGroups\"\n        @configuration-close=\"onConfigurationClosed\"\n        @modal-close=\"activeModal = ''\"\n    />\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_product_properties_add_properties_modal %}\n    <sw-product-add-properties-modal\n        v-if=\"showAddPropertiesModal\"\n        :new-properties=\"newProperties\"\n        @modal-cancel=\"onCancelAddPropertiesModal\"\n        @modal-save=\"onSaveAddPropertiesModal\"\n    />\n    {% endblock %}\n</div>\n{% endblock %}\n","/*\n * @package inventory\n */\n\nimport template from './sw-product-detail-variants.html.twig';\nimport './sw-product-detail-variants.scss';\n\nconst { Criteria, EntityCollection } = Cicada.Data;\nconst { uniqBy } = Cicada.Utils.array;\nconst { mapState, mapGetters } = Cicada.Component.getComponentHelper();\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n    ],\n\n    data() {\n        return {\n            variantListHasContent: false,\n            activeModal: '',\n            isLoading: true,\n            productEntity: {},\n            configuratorSettingsRepository: {},\n            groups: [],\n            productEntityLoaded: false,\n            propertiesAvailable: true,\n            showAddPropertiesModal: false,\n            defaultTab: 'all',\n            activeTab: 'all',\n            configSettingGroups: [],\n        };\n    },\n\n    computed: {\n        ...mapState('swProductDetail', [\n            'product',\n            'variants',\n        ]),\n\n        ...mapState('context', {\n            contextLanguageId: (state) => state.api.languageId,\n        }),\n\n        ...mapGetters('swProductDetail', {\n            isStoreLoading: 'isLoading',\n        }),\n\n        productRepository() {\n            return this.repositoryFactory.create('product');\n        },\n\n        groupRepository() {\n            return this.repositoryFactory.create('property_group');\n        },\n\n        propertyRepository() {\n            return this.repositoryFactory.create('property_group_option');\n        },\n\n        productProperties() {\n            return this.isChild && this.product?.properties?.length <= 0\n                ? this.parentProduct.properties\n                : this.product.properties;\n        },\n\n        currentProductStates() {\n            return this.activeTab.split(',');\n        },\n\n        assetFilter() {\n            return Cicada.Filter.getByName('asset');\n        },\n    },\n\n    watch: {\n        isStoreLoading: {\n            handler() {\n                if (this.isStoreLoading === false) {\n                    this.loadData();\n                }\n            },\n        },\n\n        contextLanguageId: {\n            handler() {\n                this.$refs.generatedVariants.getList();\n            },\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    mounted() {\n        this.mountedComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.checkIfPropertiesExists();\n        },\n\n        mountedComponent() {\n            this.loadData();\n        },\n\n        setActiveTab(tabName) {\n            this.activeTab = tabName;\n        },\n\n        loadData() {\n            if (!this.isStoreLoading) {\n                this.loadOptions()\n                    .then(() => {\n                        return this.loadGroups();\n                    })\n                    .then(() => {\n                        return this.loadConfigSettingGroups();\n                    });\n            }\n        },\n\n        async loadConfigSettingGroups() {\n            const groupIds = uniqBy(this.productEntity.configuratorSettings, 'option.groupId').map(\n                (group) => group.option.groupId,\n            );\n\n            const criteria = new Criteria(1, null);\n            if (groupIds.length) {\n                criteria.addFilter(Criteria.equalsAny('id', groupIds));\n            }\n\n            this.configSettingGroups = await this.groupRepository.search(criteria);\n        },\n\n        loadOptions() {\n            return new Promise((resolve) => {\n                const criteria = new Criteria(1, 25);\n\n                criteria.addAssociation('configuratorSettings.option');\n                criteria.addAssociation('prices');\n\n                this.productRepository.get(this.product.id, Cicada.Context.api, criteria).then((product) => {\n                    this.productEntity = product;\n                    this.productEntityLoaded = true;\n\n                    resolve();\n                });\n            });\n        },\n\n        loadGroups() {\n            return new Promise((resolve) => {\n                this.$nextTick().then(() => {\n                    const groupCriteria = new Criteria(1, null);\n\n                    this.groupRepository.search(groupCriteria).then((searchResult) => {\n                        this.groups = searchResult;\n                        resolve();\n                    });\n                });\n            });\n        },\n\n        updateVariations() {\n            // Reset filter\n            this.$refs.generatedVariants.includeOptions = [];\n            this.$refs.generatedVariants.filterWindowOpen = false;\n\n            // get new filter options\n            this.loadOptions()\n                .then(() => {\n                    return this.loadGroups();\n                })\n                .then(() => {\n                    this.$refs.generatedVariants.getFilterOptions();\n                    this.$refs.generatedVariants.resetFilterOptions();\n                });\n        },\n\n        updateVariantListHasContent(variantList) {\n            // Check for empty search or filter results\n            const isFilterActive = this.$refs.generatedVariants.includeOptions.length > 0;\n            const searchTerm = this.$route.query ? this.$route.query.term : '';\n\n            this.variantListHasContent = variantList.length > 0 || searchTerm || isFilterActive;\n            this.isLoading = false;\n        },\n\n        openModal(value) {\n            this.activeModal = value;\n        },\n\n        onConfigurationClosed() {\n            this.loadData();\n            this.activeModal = '';\n        },\n\n        checkIfPropertiesExists() {\n            this.propertyRepository.search(new Criteria(1, 1)).then((res) => {\n                this.propertiesAvailable = res.total > 0;\n            });\n        },\n\n        openAddPropertiesModal() {\n            if (!this.propertiesAvailable) {\n                this.$router.push({ name: 'sw.property.index' });\n            } else {\n                this.updateNewProperties();\n                this.showAddPropertiesModal = true;\n            }\n        },\n\n        closeAddPropertiesModal() {\n            this.showAddPropertiesModal = false;\n            this.updateNewProperties();\n        },\n\n        updateNewProperties() {\n            this.newProperties = new EntityCollection(\n                this.productProperties.source,\n                this.productProperties.entity,\n                this.productProperties.context,\n                Criteria.fromCriteria(this.productProperties.criteria),\n                this.productProperties,\n                this.productProperties.total,\n                this.productProperties.aggregations,\n            );\n        },\n\n        onCancelAddPropertiesModal() {\n            this.closeAddPropertiesModal();\n        },\n\n        onSaveAddPropertiesModal(newProperties) {\n            this.closeAddPropertiesModal();\n\n            if (newProperties.length <= 0) {\n                return;\n            }\n\n            this.productProperties.splice(0, this.productProperties.length, ...newProperties);\n        },\n    },\n};\n"],"names":["template","Criteria","EntityCollection","uniqBy","mapState","mapGetters","index","state","_a","_b","tabName","groupIds","group","criteria","resolve","product","groupCriteria","searchResult","variantList","isFilterActive","searchTerm","value","res","newProperties"],"mappings":"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"}