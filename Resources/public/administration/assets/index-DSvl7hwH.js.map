{"version":3,"file":"index-DSvl7hwH.js","sources":["../../../app/administration/src/module/sw-settings-tag/component/sw-settings-tag-detail-modal/sw-settings-tag-detail-modal.html.twig","../../../app/administration/src/module/sw-settings-tag/component/sw-settings-tag-detail-modal/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_settings_tag_detail_modal %}\n<sw-modal\n    class=\"sw-settings-tag-detail-modal\"\n    :class=\"{ 'is--auto-height': initialTab === 'general' }\"\n    :title=\"title\"\n    :is-loading=\"isLoading\"\n    variant=\"full\"\n    @modal-close=\"$emit('close')\"\n>\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_tag_detail_modal_tabs %}\n    <sw-tabs\n        position-identifier=\"sw-settings-tag-detail-modal\"\n        :small=\"false\"\n        :default-item=\"initialTab\"\n        @new-item-active=\"active => initialTab = active.name\"\n    >\n        <template #default=\"{ active }\">\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_tag_detail_modal_tabs_general %}\n            <sw-tabs-item\n                :title=\"$tc('sw-settings-tag.detail.generalTab')\"\n                :active-tab=\"active\"\n                name=\"general\"\n            >\n                {{ $tc('sw-settings-tag.detail.generalTab') }}\n            </sw-tabs-item>\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_settings_tag_detail_modal_tabs_assignments %}\n            <sw-tabs-item\n                :title=\"$tc('sw-settings-tag.detail.assignmentsTab')\"\n                :active-tab=\"active\"\n                name=\"assignments\"\n            >\n                {{ $tc('sw-settings-tag.detail.assignmentsTab') }}\n            </sw-tabs-item>\n            {% endblock %}\n        </template>\n\n        <template #content=\"{ active }\">\n            <template v-if=\"active === 'general'\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_tag_detail_modal_tabs_general_tab %}\n                <p class=\"sw-settings-tag-detail-modal__tag-name\">\n                    <sw-text-field\n                        id=\"sw-field--tag-name\"\n                        v-model:value=\"tag.name\"\n                        name=\"sw-field--tag-name\"\n                        :label=\"$tc('sw-settings-tag.list.columnName')\"\n                        :placeholder=\"$tc('sw-settings-tag.list.placeholderTagName')\"\n                        :error=\"tagNameError\"\n                        maxlength=\"255\"\n                        required\n                    />\n                </p>\n                {% endblock %}\n            </template>\n\n            <template v-if=\"active === 'assignments'\">\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_settings_tag_detail_modal_tabs_assignments_tab %}\n                <sw-settings-tag-detail-assignments\n                    :tag=\"tag\"\n                    :initial-counts=\"computedCounts\"\n                    :to-be-added=\"assignmentsToBeAdded\"\n                    :to-be-deleted=\"assignmentsToBeDeleted\"\n                    :property=\"property\"\n                    :entity=\"entity\"\n                    @add-assignment=\"addAssignment\"\n                    @remove-assignment=\"removeAssignment\"\n                />\n                {% endblock %}\n            </template>\n        </template>\n    </sw-tabs>\n    {% endblock %}\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_settings_tag_detail_modal_footer %}\n    <template #modal-footer>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_tag_detail_modal_cancel %}\n        <sw-button\n            size=\"small\"\n            @click=\"$emit('close')\"\n        >\n            {{ $tc('global.default.cancel') }}\n        </sw-button>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_settings_tag_detail_modal_confirm %}\n        <sw-button\n            variant=\"primary\"\n            size=\"small\"\n            :disabled=\"!allowSave\"\n            :is-loading=\"isLoading\"\n            @click=\"onSave\"\n        >\n            {{ $tc('sw-settings-tag.detail.buttonSave') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n","/**\n * @package inventory\n */\nimport template from './sw-settings-tag-detail-modal.html.twig';\nimport './sw-settings-tag-detail-modal.scss';\n\nconst { Mixin } = Cicada;\nconst { mapPropertyErrors } = Cicada.Component.getComponentHelper();\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'syncService',\n        'acl',\n    ],\n\n    emits: [\n        'close',\n        'finish',\n    ],\n\n    mixins: [\n        Mixin.getByName('notification'),\n    ],\n\n    shortcuts: {\n        'SYSTEMKEY+S': {\n            active() {\n                return this.allowSave;\n            },\n            method: 'onSave',\n        },\n        ESCAPE: 'onCancel',\n    },\n\n    props: {\n        editedTag: {\n            type: Object,\n            required: false,\n            default: null,\n        },\n        counts: {\n            type: Object,\n            required: false,\n            default() {\n                return {};\n            },\n        },\n        property: {\n            type: String,\n            required: false,\n            default: null,\n        },\n        entity: {\n            type: String,\n            required: false,\n            default: null,\n        },\n    },\n\n    data() {\n        return {\n            tag: null,\n            isLoading: false,\n            assignmentsToBeAdded: {},\n            assignmentsToBeDeleted: {},\n            initialTab: this.property && this.entity ? 'assignments' : 'general',\n        };\n    },\n\n    computed: {\n        tagRepository() {\n            return this.repositoryFactory.create('tag');\n        },\n\n        tagDefinition() {\n            return Cicada.EntityDefinition.get('tag');\n        },\n\n        ...mapPropertyErrors('tag', ['name']),\n\n        title() {\n            return this.tag.isNew()\n                ? this.$tc('sw-settings-tag.list.buttonAddTag')\n                : this.$tc('sw-settings-tag.detail.editTitle', 0, {\n                      name: this.tag.name,\n                  });\n        },\n\n        allowSave() {\n            return this.tag.isNew() ? this.acl.can('tag.creator') : this.acl.can('tag.editor');\n        },\n\n        tooltipSave() {\n            if (!this.allowSave) {\n                return {\n                    message: this.$tc('sw-privileges.tooltip.warning'),\n                    disabled: this.allowSave,\n                    showOnDisabledElements: true,\n                };\n            }\n\n            const systemKey = this.$device.getSystemKey();\n\n            return {\n                message: `${systemKey} + S`,\n                appearance: 'light',\n            };\n        },\n\n        computedCounts() {\n            const counts = { ...this.counts };\n\n            Object.keys(this.assignmentsToBeDeleted).forEach((propertyName) => {\n                if (!counts.hasOwnProperty(propertyName)) {\n                    return;\n                }\n\n                counts[propertyName] -= Object.keys(this.assignmentsToBeDeleted[propertyName]).length;\n            });\n\n            Object.keys(this.assignmentsToBeAdded).forEach((propertyName) => {\n                if (!counts.hasOwnProperty(propertyName)) {\n                    counts[propertyName] = Object.keys(this.assignmentsToBeAdded[propertyName]).length;\n\n                    return;\n                }\n\n                counts[propertyName] += Object.keys(this.assignmentsToBeAdded[propertyName]).length;\n            });\n\n            return counts;\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            if (this.editedTag) {\n                this.tag = Object.assign(this.tagRepository.create(), this.editedTag);\n                this.tag._isNew = false;\n            } else {\n                this.tag = this.tagRepository.create();\n            }\n\n            Object.entries(this.tagDefinition.properties).forEach(\n                ([\n                    propertyName,\n                    property,\n                ]) => {\n                    if (property.relation === 'many_to_many') {\n                        if (this.isCompatEnabled('INSTANCE_SET')) {\n                            this.$set(this.assignmentsToBeAdded, propertyName, {});\n                            this.$set(this.assignmentsToBeDeleted, propertyName, {});\n                        } else {\n                            this.assignmentsToBeAdded[propertyName] = {};\n                            this.assignmentsToBeDeleted[propertyName] = {};\n                        }\n                    }\n                },\n            );\n        },\n\n        async onSave() {\n            this.isLoading = true;\n            const deletePayload = [];\n\n            Object.entries(this.tagDefinition.properties).forEach(\n                ([\n                    propertyName,\n                    property,\n                ]) => {\n                    if (property.relation !== 'many_to_many') {\n                        return;\n                    }\n\n                    const toBeAdded = Object.keys(this.assignmentsToBeAdded[propertyName]);\n\n                    if (toBeAdded.length !== 0) {\n                        toBeAdded.forEach((id) => {\n                            this.tag[propertyName].add(this.assignmentsToBeAdded[propertyName][id]);\n                        });\n                    }\n\n                    const toBeDeleted = Object.keys(this.assignmentsToBeDeleted[propertyName]);\n\n                    if (toBeDeleted.length === 0) {\n                        return;\n                    }\n\n                    const ids = toBeDeleted.map((id) => {\n                        return {\n                            [property.reference]: id,\n                            [property.local]: this.tag.id,\n                        };\n                    });\n\n                    deletePayload.push({\n                        action: 'delete',\n                        entity: property.mapping,\n                        payload: ids,\n                    });\n                },\n            );\n\n            if (deletePayload.length) {\n                await this.syncService.sync(deletePayload, {}, { 'single-operation': 1 });\n            }\n\n            return this.tagRepository\n                .save(this.tag)\n                .then(() => {\n                    this.$emit('finish');\n                })\n                .catch(() => {\n                    this.createNotificationError({\n                        message: this.$tc('global.notification.unspecifiedSaveErrorMessage'),\n                    });\n                    this.isLoading = false;\n                });\n        },\n\n        onCancel() {\n            this.$emit('close');\n        },\n\n        addAssignment(assignment, id, item) {\n            if (this.assignmentsToBeDeleted[assignment].hasOwnProperty(id)) {\n                if (this.isCompatEnabled('INSTANCE_DELETE')) {\n                    this.$delete(this.assignmentsToBeDeleted[assignment], id);\n                } else {\n                    delete this.assignmentsToBeDeleted[assignment][id];\n                }\n\n                return;\n            }\n\n            if (this.isCompatEnabled('INSTANCE_SET')) {\n                this.$set(this.assignmentsToBeAdded[assignment], id, item);\n            } else {\n                this.assignmentsToBeAdded[assignment][id] = item;\n            }\n        },\n\n        removeAssignment(assignment, id, item) {\n            if (this.assignmentsToBeAdded[assignment].hasOwnProperty(id)) {\n                if (this.isCompatEnabled('INSTANCE_DELETE')) {\n                    this.$delete(this.assignmentsToBeAdded[assignment], id);\n                } else {\n                    delete this.assignmentsToBeAdded[assignment][id];\n                }\n\n                return;\n            }\n\n            if (this.isCompatEnabled('INSTANCE_SET')) {\n                this.$set(this.assignmentsToBeDeleted[assignment], id, item);\n            } else {\n                this.assignmentsToBeDeleted[assignment][id] = item;\n            }\n        },\n    },\n};\n"],"names":["template","Mixin","mapPropertyErrors","index","counts","propertyName","property","deletePayload","toBeAdded","id","toBeDeleted","ids","assignment","item"],"mappings":"AAAA,MAAeA,EAAA,i1ECMT,CAAE,MAAAC,CAAO,EAAG,OACZ,CAAE,kBAAAC,CAAiB,EAAK,OAAO,UAAU,mBAAkB,EAGlDC,EAAA,CACX,SAAAH,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,oBACA,cACA,KACH,EAED,MAAO,CACH,QACA,QACH,EAED,OAAQ,CACJC,EAAM,UAAU,cAAc,CACjC,EAED,UAAW,CACP,cAAe,CACX,QAAS,CACL,OAAO,KAAK,SACf,EACD,OAAQ,QACX,EACD,OAAQ,UACX,EAED,MAAO,CACH,UAAW,CACP,KAAM,OACN,SAAU,GACV,QAAS,IACZ,EACD,OAAQ,CACJ,KAAM,OACN,SAAU,GACV,SAAU,CACN,MAAO,EACV,CACJ,EACD,SAAU,CACN,KAAM,OACN,SAAU,GACV,QAAS,IACZ,EACD,OAAQ,CACJ,KAAM,OACN,SAAU,GACV,QAAS,IACZ,CACJ,EAED,MAAO,CACH,MAAO,CACH,IAAK,KACL,UAAW,GACX,qBAAsB,CAAE,EACxB,uBAAwB,CAAE,EAC1B,WAAY,KAAK,UAAY,KAAK,OAAS,cAAgB,SACvE,CACK,EAED,SAAU,CACN,eAAgB,CACZ,OAAO,KAAK,kBAAkB,OAAO,KAAK,CAC7C,EAED,eAAgB,CACZ,OAAO,OAAO,iBAAiB,IAAI,KAAK,CAC3C,EAED,GAAGC,EAAkB,MAAO,CAAC,MAAM,CAAC,EAEpC,OAAQ,CACJ,OAAO,KAAK,IAAI,MAAO,EACjB,KAAK,IAAI,mCAAmC,EAC5C,KAAK,IAAI,mCAAoC,EAAG,CAC5C,KAAM,KAAK,IAAI,IACrC,CAAmB,CACV,EAED,WAAY,CACR,OAAO,KAAK,IAAI,MAAO,EAAG,KAAK,IAAI,IAAI,aAAa,EAAI,KAAK,IAAI,IAAI,YAAY,CACpF,EAED,aAAc,CACV,OAAK,KAAK,UAUH,CACH,QAAS,GAHK,KAAK,QAAQ,aAAY,CAGlB,OACrB,WAAY,OAC5B,EAZuB,CACH,QAAS,KAAK,IAAI,+BAA+B,EACjD,SAAU,KAAK,UACf,uBAAwB,EAC5C,CASS,EAED,gBAAiB,CACb,MAAME,EAAS,CAAE,GAAG,KAAK,MAAM,EAE/B,cAAO,KAAK,KAAK,sBAAsB,EAAE,QAASC,GAAiB,CAC1DD,EAAO,eAAeC,CAAY,IAIvCD,EAAOC,CAAY,GAAK,OAAO,KAAK,KAAK,uBAAuBA,CAAY,CAAC,EAAE,OAC/F,CAAa,EAED,OAAO,KAAK,KAAK,oBAAoB,EAAE,QAASA,GAAiB,CAC7D,GAAI,CAACD,EAAO,eAAeC,CAAY,EAAG,CACtCD,EAAOC,CAAY,EAAI,OAAO,KAAK,KAAK,qBAAqBA,CAAY,CAAC,EAAE,OAE5E,MACH,CAEDD,EAAOC,CAAY,GAAK,OAAO,KAAK,KAAK,qBAAqBA,CAAY,CAAC,EAAE,MAC7F,CAAa,EAEMD,CACV,CACJ,EAED,SAAU,CACN,KAAK,iBAAgB,CACxB,EAED,QAAS,CACL,kBAAmB,CACX,KAAK,WACL,KAAK,IAAM,OAAO,OAAO,KAAK,cAAc,OAAQ,EAAE,KAAK,SAAS,EACpE,KAAK,IAAI,OAAS,IAElB,KAAK,IAAM,KAAK,cAAc,OAAM,EAGxC,OAAO,QAAQ,KAAK,cAAc,UAAU,EAAE,QAC1C,CAAC,CACGC,EACAC,CACpB,IAAsB,CACEA,EAAS,WAAa,iBAClB,KAAK,gBAAgB,cAAc,GACnC,KAAK,KAAK,KAAK,qBAAsBD,EAAc,CAAE,CAAA,EACrD,KAAK,KAAK,KAAK,uBAAwBA,EAAc,CAAE,CAAA,IAEvD,KAAK,qBAAqBA,CAAY,EAAI,GAC1C,KAAK,uBAAuBA,CAAY,EAAI,IAGvD,CACjB,CACS,EAED,MAAM,QAAS,CACX,KAAK,UAAY,GACjB,MAAME,EAAgB,CAAA,EAEtB,cAAO,QAAQ,KAAK,cAAc,UAAU,EAAE,QAC1C,CAAC,CACGF,EACAC,CACpB,IAAsB,CACF,GAAIA,EAAS,WAAa,eACtB,OAGJ,MAAME,EAAY,OAAO,KAAK,KAAK,qBAAqBH,CAAY,CAAC,EAEjEG,EAAU,SAAW,GACrBA,EAAU,QAASC,GAAO,CACtB,KAAK,IAAIJ,CAAY,EAAE,IAAI,KAAK,qBAAqBA,CAAY,EAAEI,CAAE,CAAC,CAClG,CAAyB,EAGL,MAAMC,EAAc,OAAO,KAAK,KAAK,uBAAuBL,CAAY,CAAC,EAEzE,GAAIK,EAAY,SAAW,EACvB,OAGJ,MAAMC,EAAMD,EAAY,IAAKD,IAClB,CACH,CAACH,EAAS,SAAS,EAAGG,EACtB,CAACH,EAAS,KAAK,EAAG,KAAK,IAAI,EACvD,EACqB,EAEDC,EAAc,KAAK,CACf,OAAQ,SACR,OAAQD,EAAS,QACjB,QAASK,CACjC,CAAqB,CACJ,CACjB,EAEgBJ,EAAc,QACd,MAAM,KAAK,YAAY,KAAKA,EAAe,CAAA,EAAI,CAAE,mBAAoB,CAAC,CAAE,EAGrE,KAAK,cACP,KAAK,KAAK,GAAG,EACb,KAAK,IAAM,CACR,KAAK,MAAM,QAAQ,CACvC,CAAiB,EACA,MAAM,IAAM,CACT,KAAK,wBAAwB,CACzB,QAAS,KAAK,IAAI,iDAAiD,CAC3F,CAAqB,EACD,KAAK,UAAY,EACrC,CAAiB,CACR,EAED,UAAW,CACP,KAAK,MAAM,OAAO,CACrB,EAED,cAAcK,EAAYH,EAAII,EAAM,CAChC,GAAI,KAAK,uBAAuBD,CAAU,EAAE,eAAeH,CAAE,EAAG,CACxD,KAAK,gBAAgB,iBAAiB,EACtC,KAAK,QAAQ,KAAK,uBAAuBG,CAAU,EAAGH,CAAE,EAExD,OAAO,KAAK,uBAAuBG,CAAU,EAAEH,CAAE,EAGrD,MACH,CAEG,KAAK,gBAAgB,cAAc,EACnC,KAAK,KAAK,KAAK,qBAAqBG,CAAU,EAAGH,EAAII,CAAI,EAEzD,KAAK,qBAAqBD,CAAU,EAAEH,CAAE,EAAII,CAEnD,EAED,iBAAiBD,EAAYH,EAAII,EAAM,CACnC,GAAI,KAAK,qBAAqBD,CAAU,EAAE,eAAeH,CAAE,EAAG,CACtD,KAAK,gBAAgB,iBAAiB,EACtC,KAAK,QAAQ,KAAK,qBAAqBG,CAAU,EAAGH,CAAE,EAEtD,OAAO,KAAK,qBAAqBG,CAAU,EAAEH,CAAE,EAGnD,MACH,CAEG,KAAK,gBAAgB,cAAc,EACnC,KAAK,KAAK,KAAK,uBAAuBG,CAAU,EAAGH,EAAII,CAAI,EAE3D,KAAK,uBAAuBD,CAAU,EAAEH,CAAE,EAAII,CAErD,CACJ,CACL"}