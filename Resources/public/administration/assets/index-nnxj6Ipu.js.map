{"version":3,"file":"index-nnxj6Ipu.js","sources":["../../../app/administration/src/module/sw-category/view/sw-category-detail-custom-entity/sw-category-detail-custom-entity.html.twig","../../../app/administration/src/module/sw-category/view/sw-category-detail-custom-entity/index.ts"],"sourcesContent":["<div class=\"sw-category-detail-custom-entity\">\n    <template v-if=\"category\">\n        <sw-card\n            v-if=\"!Array.isArray(customEntityAssignments)\"\n            :title=\"$tc('sw-category.base.customEntity.cardTitle')\"\n            position-identifier=\"category-detail-custom-entity\"\n            class=\"sw-category-detail-custom-entity__selection-container\"\n        >\n            <sw-entity-single-select\n                class=\"sw-category-detail-custom-entity__assignment\"\n                :value=\"category.customEntityTypeId\"\n                :label=\"$tc('sw-category.base.customEntity.assignment.label')\"\n                :help-text=\"$tc('sw-category.base.customEntity.assignment.helpText')\"\n                :disabled=\"!acl.can('category.editor')\"\n                :criteria=\"customEntityCriteria\"\n                entity=\"custom_entity\"\n                required\n                @update:value=\"onEntityChange\"\n            />\n        </sw-card>\n\n        <sw-many-to-many-assignment-card\n            v-else\n            :entity-collection=\"customEntityAssignments\"\n            :title=\"$tc('sw-category.base.customEntity.cardTitle')\"\n            :columns=\"customEntityColumns\"\n            :local-mode=\"category.isNew()\"\n            label-property=\"cmsAwareTitle\"\n            :criteria=\"sortingCriteria\"\n            :select-label=\"$tc('sw-category.base.customEntity.instanceAssignment.label')\"\n            :placeholder=\"$tc('sw-category.base.customEntity.instanceAssignment.placeholder')\"\n            @update:entity-collection=\"onAssignmentChange\"\n        >\n            <template #prepend-select>\n                <sw-entity-single-select\n                    class=\"sw-category-detail-custom-entity__assignment\"\n                    :value=\"category.customEntityTypeId\"\n                    :label=\"$tc('sw-category.base.customEntity.assignment.label')\"\n                    :help-text=\"$tc('sw-category.base.customEntity.assignment.helpText')\"\n                    :disabled=\"!acl.can('category.editor')\"\n                    :criteria=\"customEntityCriteria\"\n                    entity=\"custom_entity\"\n                    required\n                    @update:value=\"onEntityChange\"\n                />\n            </template>\n\n            <template #empty-state>\n                <sw-empty-state\n                    :title=\"$tc('sw-category.base.customEntity.instanceAssignment.emptyState.title')\"\n                    :absolute=\"false\"\n                >\n                    <template #icon>\n                        <img\n                            :src=\"assetFilter('/administration/static/img/empty-states/products-empty-state.svg')\"\n                            alt=\"$tc('sw-category.base.customEntity.instanceAssignment.emptyState.title')\"\n                        >\n                    </template>\n                </sw-empty-state>\n            </template>\n        </sw-many-to-many-assignment-card>\n    </template>\n</div>\n","import type { Entity } from '@cicada-ag/meteor-admin-sdk/es/_internals/data/Entity';\nimport type EntityCollection from 'src/core/data/entity-collection.data';\n\nimport Criteria from '@cicada-ag/meteor-admin-sdk/es/data/Criteria';\nimport template from './sw-category-detail-custom-entity.html.twig';\nimport './sw-category-detail-custom-entity.scss';\n\nconst { Utils } = Cicada;\nconst EXTENSION_POSTFIX = 'SwCategories';\n\n/**\n * @private\n * @package discovery\n */\nexport default Cicada.Component.wrapComponentConfig({\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n    ],\n\n    data() {\n        return {\n            categoryCustomEntityProperty: '',\n        };\n    },\n\n    props: {\n        isLoading: {\n            type: Boolean,\n            required: false,\n            default: false,\n        },\n    },\n\n    computed: {\n        customEntityAssignments(): EntityCollection<'custom_entity'> | undefined {\n            return this.category?.extensions?.[`${this.categoryCustomEntityProperty}${EXTENSION_POSTFIX}`] as\n                | EntityCollection<'custom_entity'>\n                | undefined;\n        },\n\n        customEntityColumns(): {\n            dataIndex: string;\n            property: string;\n            label: string;\n        }[] {\n            return [\n                {\n                    dataIndex: 'cmsAwareTitle',\n                    property: 'cmsAwareTitle',\n                    label: this.$tc('sw-category.base.customEntity.instanceAssignment.title'),\n                },\n            ];\n        },\n\n        category(): Entity<'category'> | null {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            return Cicada.State.get('swCategoryDetail').category as Entity<'category'> | null;\n        },\n\n        customEntityCriteria(): Criteria {\n            return new Criteria(1, 10).addFilter(Criteria.contains('flags', 'cms-aware'));\n        },\n\n        sortingCriteria(): Criteria {\n            return new Criteria(1, 10).addSorting(Criteria.sort('cmsAwareTitle', 'ASC'));\n        },\n\n        assetFilter() {\n            return Cicada.Filter.getByName('asset');\n        },\n    },\n\n    created(): void {\n        void this.fetchCustomEntityName();\n    },\n\n    methods: {\n        onAssignmentChange(customEntityAssignments: EntityCollection<'custom_entity'>): void {\n            const categoryExtensions = this.category?.extensions;\n            if (!categoryExtensions) {\n                return;\n            }\n\n            categoryExtensions[`${this.categoryCustomEntityProperty}${EXTENSION_POSTFIX}`] = customEntityAssignments;\n        },\n\n        onEntityChange(id: string, entity?: Entity<'custom_entity'>) {\n            if (!this.category) {\n                return;\n            }\n\n            this.category.customEntityTypeId = id;\n\n            this.categoryCustomEntityProperty = Utils.string.camelCase(entity?.name ?? '');\n        },\n\n        async fetchCustomEntityName(): Promise<void> {\n            if (!this.category?.customEntityTypeId) {\n                return;\n            }\n\n            const customEntityRepository = this.repositoryFactory.create('custom_entity');\n            const customEntity = await customEntityRepository.get(this.category.customEntityTypeId);\n\n            if (!customEntity) {\n                return;\n            }\n\n            this.categoryCustomEntityProperty = Utils.string.camelCase(customEntity.name);\n        },\n    },\n});\n"],"names":["template","Utils","EXTENSION_POSTFIX","index","_b","_a","Criteria","customEntityAssignments","categoryExtensions","id","entity","customEntity"],"mappings":"+EAAA,MAAeA,EAAA,4+DCOT,CAAE,MAAAC,CAAU,EAAA,OACZC,EAAoB,eAM1BC,EAAe,OAAO,UAAU,oBAAoB,CAChD,SAAAH,EAEA,aAAc,OAAO,aAErB,OAAQ,CACJ,oBACA,KACJ,EAEA,MAAO,CACI,MAAA,CACH,6BAA8B,EAAA,CAEtC,EAEA,MAAO,CACH,UAAW,CACP,KAAM,QACN,SAAU,GACV,QAAS,EACb,CACJ,EAEA,SAAU,CACN,yBAAyE,SAC9D,OAAAI,GAAAC,EAAA,KAAK,WAAL,YAAAA,EAAe,aAAf,YAAAD,EAA4B,GAAG,KAAK,4BAA4B,GAAGF,CAAiB,GAG/F,EAEA,qBAII,CACO,MAAA,CACH,CACI,UAAW,gBACX,SAAU,gBACV,MAAO,KAAK,IAAI,wDAAwD,CAC5E,CAAA,CAER,EAEA,UAAsC,CAElC,OAAO,OAAO,MAAM,IAAI,kBAAkB,EAAE,QAChD,EAEA,sBAAiC,CACtB,OAAA,IAAII,EAAS,EAAG,EAAE,EAAE,UAAUA,EAAS,SAAS,QAAS,WAAW,CAAC,CAChF,EAEA,iBAA4B,CACjB,OAAA,IAAIA,EAAS,EAAG,EAAE,EAAE,WAAWA,EAAS,KAAK,gBAAiB,KAAK,CAAC,CAC/E,EAEA,aAAc,CACH,OAAA,OAAO,OAAO,UAAU,OAAO,CAC1C,CACJ,EAEA,SAAgB,CACP,KAAK,uBACd,EAEA,QAAS,CACL,mBAAmBC,EAAkE,OAC3E,MAAAC,GAAqBH,EAAA,KAAK,WAAL,YAAAA,EAAe,WACrCG,IAILA,EAAmB,GAAG,KAAK,4BAA4B,GAAGN,CAAiB,EAAE,EAAIK,EACrF,EAEA,eAAeE,EAAYC,EAAkC,CACpD,KAAK,WAIV,KAAK,SAAS,mBAAqBD,EAEnC,KAAK,6BAA+BR,EAAM,OAAO,WAAUS,GAAA,YAAAA,EAAQ,OAAQ,EAAE,EACjF,EAEA,MAAM,uBAAuC,OACrC,GAAA,GAACL,EAAA,KAAK,WAAL,MAAAA,EAAe,oBAChB,OAIJ,MAAMM,EAAe,MADU,KAAK,kBAAkB,OAAO,eAAe,EAC1B,IAAI,KAAK,SAAS,kBAAkB,EAEjFA,IAIL,KAAK,6BAA+BV,EAAM,OAAO,UAAUU,EAAa,IAAI,EAChF,CACJ,CACJ,CAAC"}