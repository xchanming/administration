{"version":3,"file":"index-dpNlRdda.js","sources":["../../../app/administration/src/module/sw-product/view/sw-product-detail-base/sw-product-detail-base.html.twig","../../../app/administration/src/module/sw-product/view/sw-product-detail-base/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_product_detail_base %}\n<div class=\"sw-product-detail-base\">\n    <template v-if=\"isLoading\">\n        <sw-skeleton variant=\"detail-bold\" />\n        <sw-skeleton />\n    </template>\n\n    <template v-else>\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_base_basic_info_card %}\n        <sw-card\n            v-show=\"showProductCard('general_information')\"\n            class=\"sw-product-detail-base__info\"\n            position-identifier=\"sw-product-detail-base-info\"\n            :title=\"$tc('sw-product.detailBase.cardTitleProductInfo')\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_detail_base_basic_info_form %}\n            <sw-product-basic-form\n                :show-settings-information=\"showModeSetting\"\n                :allow-edit=\"acl.can('product.editor')\"\n            />\n            {% endblock %}\n\n        </sw-card>\n        {% endblock %}\n\n        <sw-card\n            v-show=\"productStates.includes('is-download')\"\n            class=\"sw-product-detail-base__downloads\"\n            :subtitle=\"$tc('sw-product.detailBase.cardSubtitleDownloads')\"\n            :is-loading=\"loading.product || loading.customFieldSets || loading.downloads\"\n            position-identifier=\"sw-product-detail-base-downloads\"\n        >\n            <template #title>\n                <div class=\"sw-card__title\">\n                    {{ $tc('sw-product.detailBase.cardTitleDownloads') }}\n                </div>\n            </template>\n\n            <sw-product-download-form\n                v-if=\"mediaFormVisible\"\n                :product-id=\"product.id\"\n                :label=\"$tc('sw-product.detailBase.downloadsLabel')\"\n                :disabled=\"!acl.can('product.editor')\"\n                required\n                @media-open=\"onOpenDownloadMediaModal\"\n            />\n        </sw-card>\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_base_price_card %}\n        <sw-card\n            v-show=\"showProductCard('prices')\"\n            class=\"sw-product-detail-base__prices\"\n            position-identifier=\"sw-product-detail-base-prices\"\n            :title=\"$tc('sw-product.detailBase.cardTitlePrices')\"\n            :is-loading=\"loading.product\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_detail_base_price_form %}\n            <sw-product-price-form :allow-edit=\"acl.can('product.editor')\" />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_detail_base_advanced_prices_link %}\n            <sw-container\n                v-if=\"productId\"\n                columns=\"1fr\"\n                justify=\"end\"\n            >\n\n                <router-link\n                    :to=\"{ name: 'sw.product.detail.prices', params: { id: $route.params.id } }\"\n                    class=\"sw-card__quick-link\"\n                >\n                    {{ $tc('sw-product.detailBase.linkAdvancedPrices') }} <sw-icon\n                        name=\"regular-long-arrow-right\"\n                        small\n                    />\n                </router-link>\n            </sw-container>\n            {% endblock %}\n\n        </sw-card>\n        {% endblock %}\n\n        <template v-if=\"productStates.includes('is-download')\">\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_detail_deliverability_downloadable_info_card %}\n            <sw-card\n                v-show=\"showProductCard('deliverability')\"\n                class=\"sw-product-detail-base__deliverability-downloadable\"\n                position-identifier=\"sw-product-detail-base-deliverability-downloadable\"\n                :title=\"$tc('sw-product.detailBase.cardTitleDeliverabilityInfo')\"\n            >\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_detail_deliverability_downloadable_info_form %}\n                <sw-product-deliverability-downloadable-form :disabled=\"!acl.can('product.editor')\" />\n                {% endblock %}\n            </sw-card>\n            {% endblock %}\n        </template>\n\n        <template v-else>\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_detail_deliverability_info_card %}\n            <sw-card\n                v-show=\"showProductCard('deliverability')\"\n                class=\"sw-product-detail-base__deliverability\"\n                position-identifier=\"sw-product-detail-base-deliverability\"\n                :title=\"$tc('sw-product.detailBase.cardTitleDeliverabilityInfo')\"\n            >\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_detail_deliverability_info_form %}\n                <sw-product-deliverability-form :allow-edit=\"acl.can('product.editor')\" />\n                {% endblock %}\n            </sw-card>\n            {% endblock %}\n        </template>\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_base_category_card %}\n        <sw-card\n            v-show=\"showProductCard('visibility_structure')\"\n            class=\"sw-product-detail-base__visibility-structure\"\n            position-identifier=\"sw-product-detail-base-visibility-structure\"\n            :title=\"$tc('sw-product.detailBase.cardTitleAssignment')\"\n            :is-loading=\"loading.product\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_detail_base_category_form %}\n            <sw-product-category-form :allow-edit=\"acl.can('product.editor')\" />\n            {% endblock %}\n\n        </sw-card>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_base_media %}\n        <sw-inherit-wrapper\n            v-show=\"showProductCard('media')\"\n            ref=\"productMediaInheritance\"\n            v-model:value=\"product.media\"\n            class=\"sw-product-detail-base__media\"\n            :inherited-value=\"parentProduct.media\"\n            :custom-restore-inheritance-function=\"mediaRestoreInheritanceFunction\"\n            :custom-remove-inheritance-function=\"mediaRemoveInheritanceFunction\"\n            is-association\n        >\n            <template #content=\"{ isInherited, isInheritField, restoreInheritance, removeInheritance }\">\n\n                <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                {% block sw_product_detail_base_media_card %}\n                <sw-card\n                    :subtitle=\"$tc('sw-product.detailBase.cardSubtitleMedia')\"\n                    :is-loading=\"loading.product || loading.customFieldSets || loading.media\"\n                    :class=\"{ 'sw-card__inherited': isInherited }\"\n                    position-identifier=\"sw-product-detail-base-media\"\n                >\n                    <template #title>\n\n                        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                        {% block sw_product_detail_base_media_card_title %}\n                        <div\n                            class=\"sw-card__title\"\n                            :class=\"{ 'sw-card__title__inherited': isInherited }\"\n                        >\n                            <sw-inheritance-switch\n                                v-if=\"isInheritField\"\n                                class=\"sw-inherit-wrapper__inheritance-icon\"\n                                :is-inherited=\"isInherited\"\n                                @inheritance-restore=\"restoreInheritance\"\n                                @inheritance-remove=\"removeInheritance\"\n                            />\n                            {# TODO: headline is not clickable yet #}\n                            {{ $tc('sw-product.detailBase.cardTitleMedia') }}\n                        </div>\n                        {% endblock %}\n\n                    </template>\n\n                    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n                    {% block sw_product_detail_base_media_card_form %}\n                    <sw-product-media-form\n                        v-if=\"mediaFormVisible\"\n                        :key=\"isInherited\"\n                        :product-id=\"isInherited ? parentProduct.id : product.id\"\n                        :is-inherited=\"isInherited\"\n                        :disabled=\"isInherited || !acl.can('product.editor')\"\n                        @media-open=\"onOpenMediaModal\"\n                    />\n                    {% endblock %}\n\n                </sw-card>\n                {% endblock %}\n\n            </template>\n        </sw-inherit-wrapper>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_base_media_modal %}\n        <sw-media-modal-v2\n            v-if=\"showMediaModal\"\n            :initial-folder-id=\"mediaDefaultFolderId\"\n            :entity-context=\"product.getEntityName()\"\n            @media-modal-selection-change=\"onAddMedia\"\n            @modal-close=\"onCloseMediaModal\"\n        />\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_product_detail_base_settings_card %}\n        <sw-card\n            v-show=\"showProductCard('labelling')\"\n            class=\"sw-product-detail-base__labelling-card\"\n            position-identifier=\"sw-product-detail-base-labelling\"\n            :title=\"$tc('sw-product.detailBase.cardTitleSettings')\"\n            :is-loading=\"loading.product\"\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_product_detail_base_settings_form %}\n            <sw-product-settings-form :allow-edit=\"acl.can('product.editor')\" />\n            {% endblock %}\n\n        </sw-card>\n        {% endblock %}\n\n    </template>\n</div>\n{% endblock %}\n","/*\n * @package inventory\n */\n\nimport Criteria from 'src/core/data/criteria.data';\nimport template from './sw-product-detail-base.html.twig';\nimport './sw-product-detail-base.scss';\n\nconst { Component, Context, Utils, Mixin } = Cicada;\nconst { mapState, mapGetters } = Component.getComponentHelper();\nconst { isEmpty } = Utils.types;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n    ],\n\n    mixins: [\n        Mixin.getByName('notification'),\n    ],\n\n    props: {\n        productId: {\n            type: String,\n            required: false,\n            default: null,\n        },\n    },\n\n    data() {\n        return {\n            showMediaModal: false,\n            mediaDefaultFolderId: null,\n        };\n    },\n\n    computed: {\n        ...mapState('swProductDetail', [\n            'product',\n            'parentProduct',\n            'customFieldSets',\n            'loading',\n        ]),\n\n        ...mapGetters('swProductDetail', [\n            'isLoading',\n            'showModeSetting',\n            'showProductCard',\n            'productStates',\n        ]),\n\n        ...mapState('swProductDetail', {}),\n\n        mediaFormVisible() {\n            return (\n                !this.loading.product && !this.loading.parentProduct && !this.loading.customFieldSets && !this.loading.media\n            );\n        },\n\n        productMediaRepository() {\n            return this.repositoryFactory.create(this.product.media.entity);\n        },\n\n        mediaDefaultFolderRepository() {\n            return this.repositoryFactory.create('media_default_folder');\n        },\n\n        mediaDefaultFolderCriteria() {\n            const criteria = new Criteria(1, 1);\n\n            criteria.addAssociation('folder');\n            criteria.addFilter(Criteria.equals('entity', 'product'));\n\n            return criteria;\n        },\n    },\n\n    watch: {\n        product() {},\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.getMediaDefaultFolderId().then((mediaDefaultFolderId) => {\n                this.mediaDefaultFolderId = mediaDefaultFolderId;\n            });\n        },\n\n        getMediaDefaultFolderId() {\n            return this.mediaDefaultFolderRepository\n                .search(this.mediaDefaultFolderCriteria, Context.api)\n                .then((mediaDefaultFolder) => {\n                    const defaultFolder = mediaDefaultFolder.first();\n\n                    if (defaultFolder.folder?.id) {\n                        return defaultFolder.folder.id;\n                    }\n\n                    return null;\n                });\n        },\n\n        mediaRemoveInheritanceFunction(newValue) {\n            newValue.forEach(({ id, mediaId, position }) => {\n                const media = this.productMediaRepository.create(Context.api);\n                Object.assign(media, {\n                    mediaId,\n                    position,\n                    productId: this.product.id,\n                });\n                if (this.parentProduct.coverId === id) {\n                    this.product.coverId = media.id;\n                }\n\n                this.product.media.push(media);\n            });\n\n            this.$refs.productMediaInheritance.forceInheritanceRemove = true;\n\n            return this.product.media;\n        },\n\n        mediaRestoreInheritanceFunction() {\n            this.$refs.productMediaInheritance.forceInheritanceRemove = false;\n            this.product.coverId = null;\n\n            this.product.media.getIds().forEach((mediaId) => {\n                this.product.media.remove(mediaId);\n            });\n\n            return this.product.media;\n        },\n\n        onOpenMediaModal() {\n            this.showMediaModal = true;\n        },\n\n        onCloseMediaModal() {\n            this.showMediaModal = false;\n        },\n\n        onOpenDownloadMediaModal() {\n            this.showDownloadMediaModal = true;\n        },\n\n        onCloseDownloadMediaModal() {\n            this.showDownloadMediaModal = false;\n        },\n\n        onAddMedia(media) {\n            if (isEmpty(media)) {\n                return;\n            }\n\n            media.forEach((item) => {\n                this.addMedia(item).catch(({ fileName }) => {\n                    this.createNotificationError({\n                        message: this.$tc('sw-product.mediaForm.errorMediaItemDuplicated', 0, { fileName }),\n                    });\n                });\n            });\n        },\n\n        addMedia(media) {\n            if (this.isExistingMedia(media)) {\n                return Promise.reject(media);\n            }\n\n            const newMedia = this.productMediaRepository.create(Context.api);\n            newMedia.mediaId = media.id;\n            newMedia.media = {\n                url: media.url,\n                id: media.id,\n            };\n\n            if (isEmpty(this.product.media) && !this.isSpatial(newMedia)) {\n                this.setMediaAsCover(newMedia);\n            }\n\n            this.product.media.add(newMedia);\n\n            return Promise.resolve();\n        },\n\n        /**\n         * @experimental stableVersion:v6.7.0 feature:SPATIAL_BASES\n         */\n        isSpatial(productMedia) {\n            if (productMedia.media?.fileExtension === 'glb') {\n                return true;\n            }\n            // we need to check the media url since media.fileExtension is set directly after upload\n            return !!productMedia.media?.url?.endsWith('.glb');\n        },\n\n        isExistingMedia(media) {\n            return this.product.media.some(({ id, mediaId }) => {\n                return id === media.id || mediaId === media.id;\n            });\n        },\n\n        setMediaAsCover(media) {\n            media.position = 0;\n            this.product.coverId = media.id;\n        },\n    },\n};\n"],"names":["template","Component","Context","Utils","Mixin","mapState","mapGetters","isEmpty","index","criteria","Criteria","mediaDefaultFolderId","mediaDefaultFolder","defaultFolder","_a","newValue","id","mediaId","position","media","item","fileName","newMedia","productMedia","_c","_b"],"mappings":"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"}