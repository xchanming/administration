import{C as c}from"./channel-DxwX5hMG.js";import"./administration-BlrHhDOI.js";const g=`<div> <sw-card class="sw-generic-cms-page-assignment" position-identifier="sw-generic-cms-page-assignment" :title="$tc('sw-category.base.cms.title')" :is-loading="isLoading" > <div class="sw-generic-cms-page-assignment__base-layout"> <sw-cms-list-item active :page="cmsPage" @on-item-click="openLayoutModal" /> <div class="sw-generic-cms-page-assignment__page-selection"> <div class="sw-generic-cms-page-assignment__page-selection-info"> <div class="sw-generic-cms-page-assignment__page-selection-headline" :class="{ 'is--empty': !cmsPage }" > {{ cmsPage ? cmsPage.name : $tc('sw-category.base.cms.defaultTitle') }} </div> <div class="sw-generic-cms-page-assignment__page-selection-subheadline" :class="{ 'is--empty': !cmsPage }" > {{ pageTypeTitle }} </div> </div> <div v-if="cmsPage" class="sw-generic-cms-page-assignment__page-selection-actions" > <sw-button class="sw-generic-cms-page-assignment__change-layout-action" size="small" @click="openLayoutModal" > {{ $tc('sw-category.base.cms.changeLayout') }} </sw-button> <sw-button class="sw-generic-cms-page-assignment__open-in-pagebuilder" size="small" @click="openInCmsEditor" > {{ $tc('sw-category.base.cms.editInPagebuilder') }} </sw-button> <sw-button size="small" class="sw-generic-cms-page-assignment__layout-reset" square @click="onLayoutSelect(null)" > <sw-icon name="regular-trash" small /> </sw-button> </div> <div v-else class="sw-generic-cms-page-assignment__page-selection-actions" > <sw-button class="sw-generic-cms-page-assignment__change-layout-action" size="small" @click="openLayoutModal" > {{ $tc('sw-category.base.cms.changeLayoutEmpty') }} </sw-button> <sw-button class="sw-generic-cms-page-assignment__create-layout" size="small" @click="createNewLayout" > {{ $tc('sw-category.base.cms.editInPagebuilderEmpty') }} </sw-button> </div> </div> </div> </sw-card> <sw-cms-page-form v-if="cmsPage" :page="cmsPage" /> <sw-cms-layout-modal v-if="showLayoutSelection" :cms-page-types="allowedPageTypes" :pre-selection="cmsPage" @modal-layout-select="onLayoutSelect" @modal-close="closeLayoutModal" /> </div>`,l=Cicada.Utils.object,p=Cicada.Component.wrapComponentConfig({template:g,compatConfig:Cicada.compatConfig,inject:["repositoryFactory","cmsPageTypeService"],props:{cmsPageId:{type:String,required:!1,default:null},slotOverrides:{type:Object,required:!1,default:null},allowedPageTypes:{type:Array,required:!1,default:()=>[]}},data(){return{cmsPage:null,showLayoutSelection:!1,isLoading:!1}},computed:{cmsPageRepository(){return this.repositoryFactory.create("cms_page")},changesetGenerator(){return new Cicada.Data.ChangesetGenerator},cmsPageCriteria(){const e=new c(1,1);return e.addAssociation("previewMedia").getAssociation("sections").addSorting(c.sort("position")).getAssociation("blocks").addSorting(c.sort("position","ASC")).addAssociation("slots"),e},pageTypeTitle(e){var i;const s=this.$tc("sw-category.base.cms.defaultDesc");if(!e)return s;const t=this.cmsPageTypeService.getType((i=this.cmsPage)==null?void 0:i.type);return t?this.$tc(t.title):s}},watch:{cmsPageId(){this.getCmsPage()},cmsPage:{handler(e,s){s&&this.emitCmsPageOverrides()},deep:!0}},created(){this.getCmsPage()},methods:{openLayoutModal(){this.showLayoutSelection=!0},closeLayoutModal(){this.showLayoutSelection=!1},onLayoutSelect(e){this.$emit("update:cms-page-id",e)},openInCmsEditor(){this.cmsPageId&&this.$router.push({name:"sw.cms.detail",params:{id:this.cmsPageId}})},createNewLayout(){this.$emit("create-layout")},applySlotOverrides(e){var s;return this.slotOverrides&&((s=e.sections)==null||s.forEach(t=>{var i;(i=t.blocks)==null||i.forEach(a=>{var o;(o=a.slots)==null||o.forEach(r=>{const n=this.slotOverrides[r.id];n&&l.merge(r.config,l.cloneDeep(n))})})})),e},async getCmsPage(){if(this.cmsPageId===null){this.cmsPage=null;return}this.isLoading=!0;const e=this.cmsPageCriteria;e.setIds([this.cmsPageId]);const s=await this.cmsPageRepository.search(e),t=this.applySlotOverrides(s[0]);Cicada.Store.get("cmsPage").setCurrentPage(t),this.cmsPage=t,this.isLoading=!1},deleteSpecificKeys(e){e&&e.forEach(s=>{s.blocks&&s.blocks.forEach(t=>{t.slots&&t.slots.forEach(i=>{i.config&&Object.values(i.config).forEach(a=>{a&&(a.entity&&delete a.entity,a.hasOwnProperty("required")&&delete a.required,a.type&&delete a.type)})})})})},emitCmsPageOverrides(){if(this.cmsPage===null)return;this.cmsPage.sections&&this.deleteSpecificKeys(this.cmsPage.sections);const{changes:e}=this.changesetGenerator.generate(this.cmsPage),s={};e&&(Array.isArray(e.sections)&&e.sections.forEach(t=>{Array.isArray(t.blocks)&&t.blocks.forEach(i=>{Array.isArray(i.slots)&&i.slots.forEach(a=>{s[a.id]=a.config})})}),this.$emit("update:slot-overrides",s))}}});export{p as default};
//# sourceMappingURL=index-ONsuUskQ.js.map
