import{e as r}from"./main.vite-CEuAX8cl.js";import"./administration-DCOj2uiN.js";import"./channel-oRk5-XZJ.js";const c=`{% block sw_flow_mail_send_modal %} <sw-modal class="sw-flow-mail-send-modal" :title="$tc('sw-flow.modals.mail.titleSendMail')" :closable="false" @modal-close="onClose" > <sw-single-select :value="replyToSelection" class="sw-flow-mail-send-modal__use-different-reply-to" :options="replyToOptions" :label="$tc('sw-flow.modals.mail.useDifferentReplyToLabel')" :help-text="buildReplyToTooltip('sw-flow.modals.mail.tooltipDifferentReplyTo')" @update:value="changeShowReplyToField" /> <sw-text-field v-if="showReplyToField" v-model:value="replyTo" name="sw-field--replyTo" class="sw-flow-mail-send-modal__reply-to" :label="$tc('sw-flow.modals.mail.labelReplyTo')" :placeholder="$tc('sw-flow.modals.mail.placeholderReplyTo')" :error="replyToError" required @update:value="replyToError = null" /> {% block sw_flow_mail_send_modal_recipient %} <sw-single-select v-model:value="mailRecipient" name="sw-field--mailRecipient" class="sw-flow-mail-send-modal__recipient" :options="recipientOptions" :label="$tc('sw-flow.modals.mail.labelRecipient')" :placeholder="$tc('sw-flow.modals.mail.placeholderRecipient')" @update:value="onChangeRecipient" /> {% endblock %} {% block sw_flow_mail_send_modal_recipient_emails_grid %} <sw-data-grid v-if="showRecipientEmails" ref="recipientsGrid" class="sw-flow-mail-send-modal__recipient-grid" :class="recipientGridError ? 'has--error' : ''" :data-source="recipients" :columns="recipientColumns" :show-selection="false" :plain-appearance="true" @inline-edit-save="saveRecipient" @inline-edit-cancel="cancelSaveRecipient" > {% block sw_event_action_detail_recipients_grid_column_email %} <template #column-email="{ item, column, isInlineEdit, compact }"> <sw-text-field v-if="isInlineEdit" v-model:value="item.email" name="sw-field--item-email" class="sw-flow-mail-send-modal__recipient-email" :size="compact ? 'small' : 'default'" :error="item.errorMail" :placeholder="$tc('sw-flow.modals.mail.placeholderRecipientEmailAddress')" /> <template v-else> {{ item.email }} </template> </template> {% endblock %} {% block sw_event_action_detail_recipients_grid_column_name %} <template #column-name="{ item, column, isInlineEdit, compact }"> <sw-text-field v-if="isInlineEdit" v-model:value="item.name" name="sw-field--item-name" class="sw-flow-mail-send-modal__recipient-name" :size="compact ? 'small' : 'default'" :error="item.errorName" :placeholder="$tc('sw-flow.modals.mail.placeholderRecipientName')" /> <template v-else> {{ item.name }} </template> </template> {% endblock %} <template #actions="{ item, itemIndex }"> {% block sw_event_action_detail_recipients_grid_action_edit %} <sw-context-menu-item class="sw-flow-mail-send-modal__grid-action-edit" @click="onEditRecipient(item)" > {{ $tc('global.default.edit') }} </sw-context-menu-item> {% endblock %} {% block sw_event_action_detail_recipients_grid_action_delete %} <sw-context-menu-item class="sw-flow-mail-send-modal__grid-action-delete" variant="danger" :disabled="!allowDeleteRecipient(itemIndex)" @click="onDeleteRecipient(itemIndex)" > {{ $tc('global.default.delete') }} </sw-context-menu-item> {% endblock %} </template> </sw-data-grid> {% endblock %} {% block sw_flow_mail_send_modal_mail_template_select %} <sw-entity-single-select v-model:value="mailTemplateId" name="sw-field--mailTemplateId" class="sw-flow-mail-send-modal__mail-template-select" required entity="mail_template" value-property="title" label-property="description" :criteria="mailTemplateCriteria" :label="$tc('sw-flow.modals.mail.labelEmailTemplate')" :placeholder="$tc('sw-flow.modals.mail.placeholderEmailTemplate')" :error="mailTemplateIdError" @update:value="(id, template) => onChangeMailTemplate(id, template)" > <template #before-item-list> {% block sw_flow_mail_send_modal_mail_template_select_before_list %} <ul class="sw-select-result__item-list"> <li class="sw-select-result sw-select-result__create-new-template" role="button" tabindex="0" @click="onCreateMailTemplate" @keydown.enter="onCreateMailTemplate" > {{ $tc('sw-flow.modals.mail.titleNewEmailTemplate') }} </li> </ul> {% endblock %} </template> <template #selection-label-property="{ item }"> <strong>{{ item.translated.description }}</strong> <template v-if="item.translated.description"> - </template> {{ item.mailTemplateType.translated.name }} </template> <template #result-label-property="{ item, highlightSearchTerm, labelProperty, searchTerm }"> <strong> <sw-highlight-text :text="item.translated.description" :search-term="searchTerm" /> </strong> {{ item.mailTemplateType.translated.name }} </template> </sw-entity-single-select> {% endblock %} {% block sw_flow_mail_send_modal_mail_template_detail_link %} <div class="sw-flow-mail-send-modal__mail-template-detail"> <router-link v-if="mailTemplateId" target="_blank" rel="noopener" :to="{ name: 'sw.mail.template.detail', params: { id: mailTemplateId } }" > {{ $tc('sw-flow.modals.mail.fieldMailTemplateDetailLink') }} </router-link> </div> {% endblock %} {% block sw_flow_mail_send_modal_document_types %} <sw-entity-multi-id-select v-model:value="documentTypeIds" name="sw-field--documentTypeIds" :repository="documentTypeRepository" class="sw-flow-mail-send-modal__document-types" :label="$tc('sw-flow.modals.mail.labelLatestDocuments')" :placeholder="$tc('sw-flow.modals.mail.placeholderLatestDocuments')" /> {% endblock %} {% block sw_flow_mail_send_create_new_template %} <sw-flow-create-mail-template-modal v-if="showCreateMailTemplateModal" class="sw-flow-mail-send-modal__create-mail-template" @process-finish="onCreateMailTemplateSuccess" @modal-close="onCloseCreateMailTemplateModal" /> {% endblock %} {% block sw_flow_mail_send_modal_document_warning %} <sw-alert class="sw-flow-mail-send-modal__document_warning" variant="info" > {{ $tc('sw-flow.modals.mail.documentDescription') }} </sw-alert> {% endblock %} {% block sw_flow_mail_send_modal_custom %} {% endblock %} {% block sw_flow_mail_send_modal_footer %} <template #modal-footer> {% block sw_flow_mail_send_modal_footer_cancel_button %} <sw-button class="sw-flow-mail-send-modal__cancel-button" size="small" @click="onClose" > {{ $tc('global.default.cancel') }} </sw-button> {% endblock %} {% block sw_flow_mail_send_modal_footer_save_button %} <sw-button class="sw-flow-mail-send-modal__save-button" variant="primary" size="small" @click="onAddAction" > {{ sequence.id ? $tc('sw-flow.modals.buttonSaveAction') : $tc('sw-flow.modals.buttonAddAction') }} </sw-button> {% endblock %} </template> {% endblock %} </sw-modal> {% endblock %}`,{Component:m,Utils:n,Classes:{CicadaError:s}}=Cicada,{Criteria:d}=Cicada.Data,{mapState:p}=m.getComponentHelper(),f={template:c,compatConfig:Cicada.compatConfig,inject:["repositoryFactory"],emits:["modal-close","process-finish"],props:{sequence:{type:Object,required:!0}},data(){return{showCreateMailTemplateModal:!1,mailTemplateId:"",showRecipientEmails:!1,mailRecipient:null,documentTypeIds:[],recipients:[],selectedRecipient:null,mailTemplateIdError:null,recipientGridError:null,replyTo:null,replyToError:null}},computed:{mailTemplateCriteria(){const e=new d(1,25);return e.addAssociation("mailTemplateType"),e},documentTypeRepository(){return this.repositoryFactory.create("document_type")},isNewMail(){var e;return!((e=this.sequence)!=null&&e.id)},recipientCustomer(){return[{value:"default",label:this.$tc("sw-flow.modals.mail.labelCustomer")}]},recipientAdmin(){return[{value:"admin",label:this.$tc("sw-flow.modals.mail.labelAdmin")}]},recipientCustom(){return[{value:"custom",label:this.$tc("sw-flow.modals.mail.labelCustom")}]},recipientDefault(){return[{value:"default",label:this.$tc("sw-flow.modals.mail.labelDefault")}]},recipientContactFormMail(){return[{value:"contactFormMail",label:this.$tc("sw-flow.modals.mail.labelContactFormMail")}]},entityAware(){return["CustomerAware","UserAware","OrderAware","CustomerGroupAware"]},recipientOptions(){const e=this.triggerEvent.aware??[],t=[];return e.forEach(l=>{l=l.slice(l.lastIndexOf("\\")+1);const a=l.charAt(0).toUpperCase()+l.slice(1);t.includes(a)||t.push(a)}),t.length===0?this.recipientCustom:this.triggerEvent.name==="contact_form.send"?[...this.recipientDefault,...this.recipientContactFormMail,...this.recipientAdmin,...this.recipientCustom]:["newsletter.confirm","newsletter.register","newsletter.unsubscribe"].includes(this.triggerEvent.name)?[...this.recipientCustomer,...this.recipientAdmin,...this.recipientCustom]:t.some(l=>this.entityAware.includes(l))?[...this.recipientCustomer,...this.recipientAdmin,...this.recipientCustom]:[...this.recipientAdmin,...this.recipientCustom]},recipientColumns(){return[{property:"email",label:"sw-flow.modals.mail.columnRecipientMail",inlineEdit:"string"},{property:"name",label:"sw-flow.modals.mail.columnRecipientName",inlineEdit:"string"}]},replyToOptions(){return this.triggerEvent.name==="contact_form.send"?[...this.recipientDefault,...this.recipientContactFormMail,...this.recipientCustom]:[...this.recipientDefault,...this.recipientCustom]},replyToSelection(){switch(this.replyTo){case null:return"default";case"contactFormMail":return"contactFormMail";default:return"custom"}},showReplyToField(){return!(this.replyTo===null||this.replyTo==="contactFormMail")},...p("swFlowState",["mailTemplates","triggerEvent","triggerActions"])},created(){this.createdComponent()},methods:{createdComponent(){var e,t;if(this.mailRecipient=this.recipientOptions[0].value,!this.isNewMail){const{config:i}=this.sequence;this.mailRecipient=(e=i.recipient)==null?void 0:e.type,((t=i.recipient)==null?void 0:t.type)==="custom"&&(Object.entries(i.recipient.data).forEach(([l,a])=>{const o=n.createId();this.recipients.push({id:o,email:l,name:a,isNew:!1})}),this.addRecipient(),this.showRecipientEmails=!0),i.replyTo&&(this.replyTo=i.replyTo),this.mailTemplateId=i.mailTemplateId,this.documentTypeIds=i.documentTypeIds}},onClose(){this.$emit("modal-close")},getRecipientData(){const e={};return this.mailRecipient!=="custom"||this.recipients.forEach(t=>{!t.email&&!t.name||Object.assign(e,{[t.email]:t.name})}),e},isRecipientGridError(){if(this.mailRecipient!=="custom")return!1;if(this.recipients.length===1&&!this.recipients[0].email&&!this.recipients[0].name)return this.validateRecipient(this.recipients[0],0),!0;const e=this.recipients.filter(t=>!t.isNew).findIndex(t=>!t.name||!t.email||!r(t.email));return e>=0&&this.validateRecipient(this.recipients[e],e),e>=0},onAddAction(){if(this.mailTemplateIdError=this.mailTemplateError(this.mailTemplateId),this.showReplyToField&&(this.replyToError=this.setMailError(this.replyTo)),this.recipientGridError=this.isRecipientGridError(),this.mailTemplateIdError||this.replyToError||this.recipientGridError)return;this.resetError();const e={...this.sequence,config:{mailTemplateId:this.mailTemplateId,documentTypeIds:this.documentTypeIds,recipient:{type:this.mailRecipient,data:this.getRecipientData()},replyTo:this.replyTo}};this.$nextTick(()=>{this.$emit("process-finish",e)})},onCreateMailTemplate(){this.showCreateMailTemplateModal=!0},onCloseCreateMailTemplateModal(){this.showCreateMailTemplateModal=!1},onCreateMailTemplateSuccess(e){this.mailTemplateId=e.id,this.onChangeMailTemplate(e.id,e)},onChangeMailTemplate(e,t){e&&(this.mailTemplateIdError=null),!this.mailTemplates.find(l=>l.id===e)&&t&&Cicada.State.commit("swFlowState/setMailTemplates",[...this.mailTemplates,t])},onChangeRecipient(e){e==="custom"?(this.showRecipientEmails=!0,this.addRecipient()):this.showRecipientEmails=!1},addRecipient(){const e=n.createId();this.recipients.push({id:e,email:"",name:"",isNew:!0}),this.$nextTick().then(()=>{this.$refs.recipientsGrid.currentInlineEditId=e,this.$refs.recipientsGrid.enableInlineEdit()})},saveRecipient(e){const t=this.recipients.findIndex(i=>i.id===e.id);if(this.validateRecipient(e,t)){this.$nextTick(()=>{this.$refs.recipientsGrid.currentInlineEditId=e.id,this.$refs.recipientsGrid.enableInlineEdit()});return}e.isNew&&(this.addRecipient(),this.recipients[t].isNew=!1),this.resetError()},cancelSaveRecipient(e){if(e.isNew)e.name="",e.email="";else{const t=this.recipients.findIndex(i=>i.id===this.selectedRecipient.id);this.recipients[t]=this.selectedRecipient}this.resetError()},onEditRecipient(e){const t=this.recipients.findIndex(i=>e.id===i.id);!e.name&&!e.email?this.isCompatEnabled("INSTANCE_SET")?(this.$set(this.recipients,t,{...e,errorName:null}),this.$set(this.recipients,t,{...e,errorMail:null})):(this.recipients[t]={...e,errorName:null},this.recipients[t]={...e,errorMail:null}):this.validateRecipient(e,t),this.$refs.recipientsGrid.currentInlineEditId=e.id,this.$refs.recipientsGrid.enableInlineEdit(),this.selectedRecipient={...e}},onDeleteRecipient(e){this.recipients.splice(e,1)},mailTemplateError(e){return e?null:new s({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})},setNameError(e){return e?null:new s({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})},setMailError(e){let t=null;return e||(t=new s({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})),r(e)||(t=new s({code:"INVALID_MAIL"})),t},validateRecipient(e,t){const i=this.setNameError(e.name),l=this.setMailError(e.email);return this.isCompatEnabled("INSTANCE_SET")?this.$set(this.recipients,t,{...e,errorName:i,errorMail:l}):this.recipients[t]={...e,errorName:i,errorMail:l},i||l},resetError(){this.recipientGridError=null,this.recipients.forEach(e=>{e.errorName=null,e.errorMail=null})},allowDeleteRecipient(e){return e!==this.recipients.length-1},changeShowReplyToField(e){switch(e){case"default":this.replyToError=null,this.replyTo=null;return;case"contactFormMail":this.replyToError=null,this.replyTo="contactFormMail";return;default:this.replyTo=""}},buildReplyToTooltip(e){const t={name:"sw.settings.basic.information.index"},l={settingsLink:this.$router.resolve(t).href};return this.$tc(e,0,l)}}};export{f as default};
//# sourceMappingURL=index-TZ-Fxd4G.js.map
