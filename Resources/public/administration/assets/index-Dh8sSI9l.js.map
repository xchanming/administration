{"version":3,"file":"index-Dh8sSI9l.js","sources":["../../../app/administration/src/module/sw-category/view/sw-category-detail-products/sw-category-detail-products.html.twig","../../../app/administration/src/module/sw-category/view/sw-category-detail-products/index.js"],"sourcesContent":["<!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n{% block sw_category_detail_products %}\n<div class=\"sw-category-detail-products\">\n\n    <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n    {% block sw_category_detail_product_assignment %}\n    <sw-many-to-many-assignment-card\n        v-if=\"category.type !== 'folder'\"\n        :title=\"$tc('sw-category.base.products.productAssignmentHeadline')\"\n        :entity-collection=\"category.products\"\n        :columns=\"productColumns\"\n        :is-loading=\"isLoading\"\n        :disabled=\"!acl.can('category.editor')\"\n        :local-mode=\"category.isNew()\"\n        :criteria=\"productCriteria\"\n        :select-label=\"$tc('sw-category.base.products.productAssignmentLabel')\"\n        :placeholder=\"$tc('sw-category.base.products.productAssignmentPlaceholder')\"\n        @paginate=\"onPaginateManualProductAssignment\"\n    >\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_category_detail_product_assignment_type_select %}\n        <template #prepend-select>\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_category_detail_product_assignment_type_select_field %}\n            <sw-single-select\n                v-model:value=\"category.productAssignmentType\"\n                class=\"sw-category-detail-products__product-assignment-type-select\"\n                :label=\"$tc('sw-category.base.products.productAssignmentTypeLabel')\"\n                :error=\"categoryProductAssignmentTypeError\"\n                :options=\"productAssignmentTypes\"\n                :disabled=\"!acl.can('category.editor')\"\n                required\n                show-clearable-button\n            />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_category_detail_product_assignment_manual_alert %}\n            <sw-alert\n                v-if=\"category.productAssignmentType === 'product_stream' && manualAssignedProductsCount > 0\"\n                variant=\"info\"\n            >\n                {{ $tc('sw-category.base.products.alertManualAssignedProductsOnAssignmentTypeStream') }}\n            </sw-alert>\n            {% endblock %}\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_category_detail_product_assignment_stream_select %}\n        <template\n            v-if=\"category.productAssignmentType === 'product_stream'\"\n            #select\n        >\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_category_detail_product_assignment_stream_select_field %}\n            <sw-entity-single-select\n                v-model:value=\"category.productStreamId\"\n                class=\"sw-category-detail-products__product-stream-select\"\n                entity=\"product_stream\"\n                show-clearable-button\n                :disabled=\"!acl.can('category.editor')\"\n                :label=\"$tc('sw-category.base.products.productAssignmentTypeStreamLabel')\"\n                :help-text=\"dynamicProductGroupHelpText\"\n                :placeholder=\"$tc('sw-category.base.products.productAssignmentTypeStreamPlaceholder')\"\n                :error=\"productStreamInvalidError || categoryProductStreamIdError\"\n            />\n            {% endblock %}\n\n            <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n            {% block sw_category_detail_product_assignment_stream_preview_link %}\n            <div class=\"sw-category-detail-products__product-stream-preview-link\">\n                <router-link\n                    v-if=\"category.productStreamId\"\n                    :to=\"{ name: 'sw.product.stream.detail', params: { id: category.productStreamId } }\"\n                >\n                    {{ $tc('sw-category.base.products.dynamicProductGroupDetailLinkText') }}\n                    <sw-icon\n                        name=\"regular-long-arrow-right\"\n                        small\n                    />\n                </router-link>\n            </div>\n            {% endblock %}\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_category_detail_product_assignment_stream_preview_grid %}\n        <template\n            v-if=\"category.productAssignmentType === 'product_stream'\"\n            #data-grid\n        >\n            <sw-product-stream-grid-preview\n                :filters=\"productStreamFilter\"\n                :columns=\"productColumns\"\n            />\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_category_detail_product_assignment_column_name %}\n        <template #[nameColumn]=\"{ item, column }\">\n            <router-link\n                :to=\"{ name: column.routerLink, params: { id: item.id } }\"\n            >\n                <sw-product-variant-info :variations=\"item.variation\">\n                    {{ item.name || item.translated.name }}\n                </sw-product-variant-info>\n            </router-link>\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_category_detail_product_assignment_column_manufacturer %}\n        <template #[manufacturerColumn]=\"{ item, column }\">\n            <router-link\n                v-if=\"getManufacturer(item)\"\n                :to=\"{ name: column.routerLink, params: { id: item.manufacturerId } }\"\n            >\n                {{ getManufacturer(item).name || getManufacturer(item).translated.name }}\n            </router-link>\n            <span v-else></span>\n        </template>\n        {% endblock %}\n\n        <!-- eslint-disable-next-line sw-deprecation-rules/no-twigjs-blocks -->\n        {% block sw_category_detail_product_assignment_empty_state %}\n        <template #empty-state>\n            <sw-empty-state\n                :title=\"$tc('sw-category.base.products.productAssignmentEmptyStateDescription')\"\n                :subline=\"''\"\n                auto-height\n            >\n                <template #icon>\n                    <img\n                        :src=\"assetFilter('/administration/static/img/empty-states/products-empty-state.svg')\"\n                        :alt=\"$tc('sw-category.base.products.productAssignmentEmptyStateDescription')\"\n                    >\n                </template>\n            </sw-empty-state>\n        </template>\n        {% endblock %}\n\n    </sw-many-to-many-assignment-card>\n    {% endblock %}\n\n</div>\n{% endblock %}\n","import template from './sw-category-detail-products.html.twig';\nimport './sw-category-detail-products.scss';\n\nconst { Criteria } = Cicada.Data;\nconst { mapPropertyErrors } = Cicada.Component.getComponentHelper();\nconst CicadaError = Cicada.Classes.CicadaError;\n\n/**\n * @package discovery\n */\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    compatConfig: Cicada.compatConfig,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n    ],\n\n    mixins: [\n        'placeholder',\n    ],\n\n    props: {\n        isLoading: {\n            type: Boolean,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            productStreamFilter: null,\n            productStreamInvalid: false,\n            manualAssignedProductsCount: 0,\n            parentProducts: [],\n        };\n    },\n\n    computed: {\n        category() {\n            return Cicada.State.get('swCategoryDetail').category;\n        },\n\n        productStreamRepository() {\n            return this.repositoryFactory.create('product_stream');\n        },\n\n        productRepository() {\n            return this.repositoryFactory.create('product');\n        },\n\n        productColumns() {\n            return [\n                {\n                    property: 'name',\n                    label: this.$tc('sw-category.base.products.columnNameLabel'),\n                    dataIndex: 'name',\n                    routerLink: 'sw.product.detail',\n                    sortable: false,\n                },\n                {\n                    property: 'manufacturer.name',\n                    label: this.$tc('sw-category.base.products.columnManufacturerLabel'),\n                    routerLink: 'sw.manufacturer.detail',\n                    sortable: false,\n                },\n            ];\n        },\n\n        manufacturerColumn() {\n            return 'column-manufacturer.name';\n        },\n\n        nameColumn() {\n            return 'column-name';\n        },\n\n        productCriteria() {\n            return new Criteria(1, 10)\n                .addAssociation('options.group')\n                .addAssociation('manufacturer')\n                .addFilter(\n                    Criteria.multi('OR', [\n                        Criteria.equals('parentId', null),\n                        Criteria.multi('AND', [\n                            Criteria.not('AND', [\n                                Criteria.equals('parentId', null),\n                            ]),\n                            Criteria.equals('categories.id', this.category.id),\n                        ]),\n                    ]),\n                );\n        },\n\n        productStreamInvalidError() {\n            if (this.productStreamInvalid) {\n                return new CicadaError({\n                    code: 'PRODUCT_STREAM_INVALID',\n                    detail: this.$tc('sw-category.base.products.dynamicProductGroupInvalidMessage'),\n                });\n            }\n            return null;\n        },\n\n        ...mapPropertyErrors('category', [\n            'productStreamId',\n            'productAssignmentType',\n        ]),\n\n        productAssignmentTypes() {\n            return [\n                {\n                    value: 'product',\n                    label: this.$tc('sw-category.base.products.productAssignmentTypeManualLabel'),\n                },\n                {\n                    value: 'product_stream',\n                    label: this.$tc('sw-category.base.products.productAssignmentTypeStreamLabel'),\n                },\n            ];\n        },\n\n        dynamicProductGroupHelpText() {\n            const link = {\n                name: 'sw.product.stream.index',\n            };\n\n            const helpText = this.$tc('sw-category.base.products.dynamicProductGroupHelpText.label', 0, {\n                link: `<sw-internal-link\n                           :router-link=${JSON.stringify(link)}\n                           :inline=\"true\">\n                           ${this.$tc('sw-category.base.products.dynamicProductGroupHelpText.linkText')}\n                       </sw-internal-link>`,\n            });\n\n            try {\n                // eslint-disable-next-line no-new\n                new URL(this.$tc('sw-category.base.products.dynamicProductGroupHelpText.videoUrl'));\n            } catch {\n                return helpText;\n            }\n\n            return `${helpText}\n                    <br>\n                    <sw-external-link\n                        href=\"${this.$tc('sw-category.base.products.dynamicProductGroupHelpText.videoUrl')}\">\n                        ${this.$tc('sw-category.base.products.dynamicProductGroupHelpText.videoLink')}\n                    </sw-external-link>`;\n        },\n\n        assetFilter() {\n            return Cicada.Filter.getByName('asset');\n        },\n    },\n\n    watch: {\n        'category.productStreamId'(id) {\n            if (!id) {\n                this.productStreamFilter = null;\n                return;\n            }\n            this.loadProductStreamPreview();\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            if (!this.category.productStreamId) {\n                return;\n            }\n            this.loadProductStreamPreview();\n        },\n\n        loadProductStreamPreview() {\n            this.productStreamRepository\n                .get(this.category.productStreamId)\n                .then((response) => {\n                    this.productStreamFilter = response.apiFilter;\n                    this.productStreamInvalid = response.invalid;\n                })\n                .catch(() => {\n                    this.productStreamFilter = null;\n                    this.productStreamInvalid = true;\n                });\n        },\n\n        onPaginateManualProductAssignment(assignment) {\n            this.getParentProducts(assignment);\n\n            this.manualAssignedProductsCount = assignment.total;\n        },\n\n        getParentProducts(products) {\n            const parentIds = products.map((product) => product.parentId).filter((id) => id !== null);\n\n            if (parentIds.length > 0) {\n                const criteria = new Criteria(1, parentIds.length)\n                    .addAssociation('manufacturer')\n                    .addFilter(Criteria.equalsAny('id', parentIds));\n\n                this.productRepository.search(criteria).then((parentProducts) => {\n                    this.parentProducts = parentProducts;\n                });\n            }\n        },\n\n        getManufacturer(product) {\n            if (product.manufacturerId) {\n                return product.manufacturer;\n            }\n\n            const parent = this.parentProducts.find((parentProduct) => {\n                return parentProduct.id === product.parentId;\n            });\n\n            if (parent && parent.manufacturerId) {\n                return parent.manufacturer;\n            }\n\n            return null;\n        },\n    },\n};\n"],"names":["template","Criteria","mapPropertyErrors","CicadaError","index","link","helpText","id","response","assignment","products","parentIds","product","criteria","parentProducts","parent","parentProduct"],"mappings":"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"}